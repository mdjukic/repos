markod@ip-172-20-0-174:/home/markod/repos/bigdata/redshift/steps : diff 00151_recreate_quadrant_ar.sql 00151_recreate_quadrant_ar_rollback.sql
21c21
< ,R0_Product VARCHAR(70) ENCODE bytedict
---
> ,R0_Product VARCHAR(15) ENCODE bytedict

---------------------------------------------------------------------------------------------------
-- Transform directory
---------------------------------------------------------------------------------------------------
Only insert_quadrant_stickrate_refined.sql
has columnd r3_product defined, and it is defined as follows:    null::varchar(70) as r3_product,
*** This is the correct definition

---------------------------------------------------------------------------------------------------
*** Add this to the line within mdj_profile
---------------------------------------------------------------------------------------------------
git clone https://git-codecommit.eu-west-1.amazonaws.com/v1/repos/bigdata

cd preprocessor:
python getconfig.py -p admin  -f "Adobe Economist Online (adobe.economistcomprod)"

python getconfig.py  -p admin -f "Economist server log (economistdotcom.serverlog)"

python getconfig.py -p admin -f "Common (common.country_regions)"

python getconfig.py -p admin -filetype "SFMC"

python getconfig.py -p admin -f "Google Analytics Events (ga.events)"


 - 'access-facade.csv.log-([0-9]{18}).gz$'
    access-facade.csv.log-201703051488673801.gz
    access-facade.csv.log-201702261488069001.gz 
 
 
    access-facade.csv.log-201702261488069001.gz 
 
 'access-facade.csv.log-([0-9]{4}[0-9]{2}[0-9]{2})([0-9]{10}).gz$'
 
If you git status it will tell you (amongst other things) what branch you are on
to go to the develop branch you would do: git checkout develop
to  make a commit comment: git commit -m <message>
and finally to push: git push
Jenkins will then start running some basic regression tests, build a test db, etc.


economist-analytics-euw1-prd01/adobe/econprodappipad/staging2

---------------------------------------------------------------------------------------------------
-- After filespec updates to economistcomprod
---------------------------------------------------------------------------------------------------
markod@ip-172-20-0-174:/home/markod/repos/bigdata/preprocessor/filespec : grep -i remove_email adobe.economistcomprod.yaml
- fieldformula: formulae.remove_email( x[134] )
  inputformularaw: remove_email(first_hit_page_url)
- fieldformula: formulae.remove_email( x[136] )
  inputformularaw: remove_email(first_hit_referrer)
- fieldformula: formulae.remove_email( x[245] )
  inputformularaw: remove_email(post_evar32)
- fieldformula: formulae.remove_email( x[349] )
  inputformularaw: remove_email(post_page_url)
- fieldformula: formulae.remove_email( x[351] )
  inputformularaw: remove_email(post_pagename_no_url)
- fieldformula: formulae.remove_email( x[433] )
  inputformularaw: remove_email(post_referrer)
- fieldformula: formulae.remove_email( x[566] )
  inputformularaw: remove_email(referrer)
- fieldformula: formulae.remove_email( x[644] )
  inputformularaw: remove_email(visit_referrer)
- fieldformula: formulae.remove_email( x[646] )
  inputformularaw: remove_email(visit_start_page_url)


---------------------------------------------------------------------------------------------------
-- redshift/align/refresh.sh - Merge changes.....
---------------------------------------------------------------------------------------------------  
  set -e
   
  if [ -z $1 ]; then echo "Must specify database"; exit 1; fi;
  if [ -z $1 ]; then echo "Must specify Linux user"; exit 1; fi;
   
  source ~/bigdataconfig.py
   
  echo "Recreating the $1 db"
  echo "Recreating the db"
  ~/repos/bigdata/build/drop_create_db.sh $1
  echo "Building the db"
  /usr/bin/python ~/repos/bigdata/redshift/align/align.py -t 100
  /usr/bin/python ~/repos/bigdata/redshift/align/align.py -t 200
 
---------------------------------------------------------------------------------------------------
-- serverlogs - Check with Neil..... 
--------------------------------------------------------------------------------------------------- 
https://console.aws.amazon.com/s3/home?region=eu-west-1&bucket=economist-analytics-euw1-dev01&prefix=economistdotcom/serverlog/posttransform/ 

https://console.aws.amazon.com/s3/home?region=eu-west-1&bucket=


access-facade.csv.log-201702051486254601-172-17-2-163.gz
access-facade.csv.log-201702051486254601-172-17-3-20.gz
access-facade.csv.log-201702121486859401.gz
access-facade.csv.log-201702191487464201.gz
access-facade.csv.log-201702261488069001.gz
access-facade.csv.log-201703051488673801.gz

aws s3 cp s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201702261488069001.gz s3://economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201702261488069001.gz
aws s3 cp s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703051488673801.gz s3://economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201703051488673801.gz

aws s3 cp s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201702051486254601-172-17-2-163.gz s3://economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201702051486254601-172-17-2-163.gz
aws s3 cp s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201702051486254601-172-17-3-20.gz s3://economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201702051486254601-172-17-3-20.gz


Files in Serverlog/Staging
---------------------------
2017-02-11 23:35:04   26457043 access-facade.csv.log-201702051486254601-172-17-2-163.gz
2017-02-07 13:35:45  165404525 access-facade.csv.log-201702051486254601-172-17-3-20
2017-02-07 13:44:10   29233329 access-facade.csv.log-201702051486254601-172-17-3-20.gz
2017-02-18 23:35:02   27789682 access-facade.csv.log-201702121486859401.gz
2017-02-25 23:35:03   25938529 access-facade.csv.log-201702191487464201.gz
2017-03-04 23:35:02   50131989 access-facade.csv.log-201702261488069001.gz
2017-03-10 08:35:03   18803310 access-facade.csv.log-201703051488673801.gz


aws s3 cp s3://economist-analytics-euw1-test-repository/economistdotcom/serverlog/"xxxxxx"
s3://economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201703051488673801.gz
-- Comprehensive Test in Jenkins to edit

    if [ $format == "economistdotcom" ] || [ $format == "all" ]; then
    # economistdotcom
    python ~/repos/bigdata/pipeline/create_pipeline.py -p economistdotcom -c RunsOn
    ~/repos/bigdata/pipeline/create_or_replace_pipeline.sh economistdotcom replace | awk 'END{print}'
    aws s3 cp s3://economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201702261488069001.gz s3://economist-analytics-euw1-${myenv}/economistdotcom/serverlog/staging/access-facade.csv.log-201702261488069001.gz
	aws s3 cp s3://economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201703051488673801.gz s3://economist-analytics-euw1-${myenv}/economistdotcom/serverlog/staging/access-facade.csv.log-201703051488673801.gz
    aws s3 cp s3://economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201702051486254601-172-17-2-163.gz s3://economist-analytics-euw1-${myenv}/economistdotcom/serverlog/staging/access-facade.csv.log-201702051486254601-172-17-2-163.gz
	aws s3 cp s3://economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201702051486254601-172-17-3-20.gz s3://economist-analytics-euw1-${myenv}/economistdotcom/serverlog/staging/access-facade.csv.log-201702051486254601-172-17-3-20.gz
	fi

---------------------------------------------------------------------------------------------------	
-- Files now in Test-Repository for economistdotcom
---------------------------------------------------------------------------------------------------
    economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201702261488069001.gz
	economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201703051488673801.gz
---------------------------------------------------------------------------------------------------	
	

This reg exp seems to work:

select regexp_replace('xxxhttps://www.economist.com/users/.+%2540.+yyy'
     ,'https://www.economist.com/users/.+%2540.+'
	 ,'https://www.economist.com/users/DroppedEmailAddress')
  --where 'xxxhttps://www.economist.com/users/.+%2540.+yyy' like '%https://www.economist.com/users/.+%2540.+%'
 where 'xxxhttps://www.economist.com/users/.+%2540.+yyy' ~ 'https://www.economist.com/users/.+%2540.+'
union all
select regexp_replace('xxxlastname=markodjukichttps&yyy'
     ,'lastname=[^&](.*)?&'
	 ,'lastname=DroppedEmailAddress')
where 'xxxlastname=markodjukichttps&yyy' ~ 'lastname=[^&](.*)?&'


---------------------------------------------------------------------------------------------------
-- petegrant [7:47 AM] 
@markodjukic 
I reckon the best bet on that issue 140 is check those like statements work fine with SQL like syntax, 
i.e. get rid of the posix regex stuff that’s in there (such as .*), because according to the doco, 
regex like (~ operator) is quite slow relative to SQL like.

[7:48]  
that’s prob a quick find and replace

[7:48]  
then assign that bad boy back to me again

[7:49]  
and I’ll make a new data test env for stuff like this and write a process for it, and check it works on this, 
then I’ll run it this weekend and we’ll be sorted

[7:52]  
not urgent for right now on the 140, later today is fine

[7:52]  
would be good to get that 166 done sooner

---------------------------------------------------------------------------------------------------
-- Economist Template Folder.....
---------------------------------------------------------------------------------------------------
neil [9:22 AM] 
Yes. Check if the google sheet is in the Economist Load Template folder - I think they have all have access to this folder

neil [9:22 AM] 
It can be hard to find things in Google Drive (and even harder to move things!) 
but the folder is here: https://drive.google.com/drive/folders/0B0gBpYILU6LPcEVTcHVwQkVvYTA

---------------------------------------------------------------------------------------------------
-- data pipeline via AWS Console.....
---------------------------------------------------------------------------------------------------

Hi Marko

[12:30]  
Try this (I will have a look as well but this is useful to know!):

[12:30]  
- go to the AWS console

[12:30]  
- go the Data Pipeline screen

[12:31]  
- scroll down to your pipeline (tst01-economistdotcom)

[12:31]  
- click the pipeline id

[12:32]  
from there you can see all the different steps in the pipeline (also, if it has been run many time you will see all of the history)

[12:33]  
Here's the actual error (it's a bit hard to find!):


---

eid=zhengchaode1991@gmail.com


http://www.stumbleupon.com/su/1S4131/GCi@z!EX:IyweYg2z/www.freelancewritingsuccess.com/bly1.php
http://zhidao.baidu.com/question/571827283.html?fr=ala&word=the%20economist%E5%93%AA%E9%87%8C%E8%83%BD%E7%9C%8B&device=mobile&ssid=0&from=1000575g&uid=0&pu=sz%401320_480%2Ccuid%40li2PtgP_v8lcaHaMgPvNul8q-f0u8-ilguSni_iNBu8Muv8CgavV8_u128_suv8MA%2Ccua%40_a
http://zhidao.baidu.com/question/571827283.html?fr=ala&word=the%20economist%E5%93%AA%E9%87%8C%E8%83%BD%E7%9C%8B&device=mobile&ssid=0&from=1000575g&uid=0&pu=sz%401320_480%2Ccuid%40li2PtgP_v8lcaHaMgPvNul8q-f0u8-ilguSni_iNBu8Muv8CgavV8_u128_suv8MA%2Ccua%40_a
http://www.stumbleupon.com/su/6PI9eE/OIYa$BL9:eSG9djY@/philip.greenspun.com/humor/choosing-a-major.text
http://m.baidu.com/from=1009698b/pu=sz%401320_1004/s?word=the+economist%E6%9D%82%E5%BF%97&sa=ts_6&ts=8127585&t_kt=0&ss=101&rq=The+econo
http://pro02.etrack.hk/track?t=c&eas=1&msid=&auid=&mid=CPLP_S_711_A_h&msgid=S4001E1439&did=data_CPLP_S_711_A_h&sn=16779142&eid=cindychui99@hotmail.com&uid=kJQLLmfhkOeGidngUP&tgid=&fl=&extra=MultivariateId=&&&0001&&&https://subscriptions.economist.com/asia
http://www.stumbleupon.com/su/1Pw7yN/1bEnmkWbG:EynH.@5y/1389blog.com/2012/12/23/larry-correia-refutes-the-gun-controllers-once-and-for-all
http://www.stumbleupon.com/su/1Pw7yN/1bEnmkWbG:EynH.@5y/1389blog.com/2012/12/23/larry-correia-refutes-the-gun-controllers-once-and-for-all
http://m.baidu.com/s?tn=zbios&pu=sz%401320_480%2Ccuid%403448F258D56E3178E719FE73F6375933A8D393108FCQNRAJEMO%2Ccua%40750_1334_iphone_6.3.6.0_0%2Ccut%40iPhone7%252C2_8.1.2%2Cosname%40baiduboxapp%2Cctv%401%2Ccfrom%401099a%2Ccsrc%40app_box_txt&bd_page_type=1&
http://web.b.ebscohost.com/ehost/external?sid=5426d58f-99d5-47d1-9dd2-717e22a71ee0%40sessionmgr111&vid=2&hid=106
http://m.baidu.com/from=1269a/bd_page_type=1/ssid=0/uid=0/pu=usm%400%2Csz%40224_220%2Cta%40middle___11_1.0/baiduid=1D2406124F97007C1DD84695CD8314C2/w=0_10_economist/t=wap/l=0/tc?ref=www_colorful&lid=7900723450861988412&order=1&vit=osres&tj=www_normal_1_0_
http://m.baidu.com/from=1269a/bd_page_type=1/ssid=0/uid=0/pu=usm%400%2Csz%40224_220%2Cta%40middle___11_1.0/baiduid=1D2406124F97007C1DD84695CD8314C2/w=0_10_economist/t=wap/l=0/tc?ref=www_colorful&lid=7900723450861988412&order=1&vit=osres&tj=www_normal_1_0_
http://m.baidu.com/s?tn=zbios&pu=sz%401320_480%2Ccuid%40giSt8_ufv80suviHgaSJulamHigZuHii_829i_8tH88Ga-8fgPvNi_uqBfgfuviMA%2Ccua%40_a-qi4uq-igBNE6lI5me6NIy2I_UCvC5SdNqA%2Ccut%400ksIOjac2iygaXibzuLe8gNXxok55FqJjqqSB%2Cosname%40baiduboxapp%2Cctv%402%2Ccfrom%
http://m.baidu.com/s?tn=zbios&pu=sz%401320_480%2Ccuid%40giSt8_ufv80suviHgaSJulamHigZuHii_829i_8tH88Ga-8fgPvNi_uqBfgfuviMA%2Ccua%40_a-qi4uq-igBNE6lI5me6NIy2I_UCvC5SdNqA%2Ccut%400ksIOjac2iygaXibzuLe8gNXxok55FqJjqqSB%2Cosname%40baiduboxapp%2Cctv%402%2Ccfrom%
http://mail.qq.com/cgi-bin/mail_spam?action=check_link&url=http://www.economist.com/news/business/21647617-chinas-steel-production-and-consumption-may-soon-start-falling-twin-peaks&mailid=@1a1515bd001b&spam=0
http://mail.qq.com/cgi-bin/mail_spam?action=check_link&url=http://www.economist.com/news/business/21647617-chinas-steel-production-and-consumption-may-soon-start-falling-twin-peaks&mailid=@1a1515bd001b&spam=0
http://www.economist.com/news/special-report/21628597-after-decades-messianic-fervour-iran-becoming-more-mature-and-modern-country?frsc=dg%7Cd%20via%20@theeconomist
http://zhidao.baidu.com/question/77432246.html?fr=ala&word=%E6%97%B6%E4%BB%A3%E5%91%A8%E5%88%8A&device=mobile&ssid=0&from=1002253z&uid=0&pu=usm@0,sz@1321_1004,ta@utouch_2_4.1_11_2.1&bd_page_type=1&baiduid=D16959DD543DEE0C3B8694EFCBF475DE&tj=zhidao_3_0_10_
http://m.baidu.com/s?tn=zbios&pu=sz%401320_480%2Ccuid%40jOvliliNv80eO2iN082xa08BS8_aavi_0i2ItgO1vu8_y2zJIy-Dz_aH28ANLZqOC%2Ccua%40_avLCgaH-i46ywoUfpw1z4adXi45a2iLA%2Ccut%405kSYMltqVRgfhWiYjI2UN_h5vhgcODOHpi3pur6aC%2Cosname%40baiduboxapp%2Cctv%402%2Ccfrom%
http://mail.friends.wilmington.de.us/mini/detail.php?fld=%7Egvancatledge%40wilmingtonfriends.org%2FINBOX&uid=136719
http://m.baidu.com/from=1001192k/pu=sz%401320_1001/s?word=economist+app&ts=6975957&t_kt=78&prefon=1&sa=is_2&ss=101&rq=economist
http://m.baidu.com/from=1001192k/pu=sz%401320_1001/s?word=economist+app&ts=6975957&t_kt=78&prefon=1&sa=is_2&ss=101&rq=economist
http://mail.terra.com.br/tablet/index.php?r=message/show&Message%5Buid%5D=43114&Message%5Benvelope%5D%5Bmessage-id%5D=%3C0.0.15.1FC.1D06BB6CABA8DC6.0%40ukrs394972.pur3.net%3E&Message%5Bmark_read_flag%5D=&Message%5BmailBox%5D%5Bmailbox_id%5D=INBOX&MailBox%
http://m.baidu.com/s?tn=zbios&pu=sz%401320_480%2Ccuid%40jOvliliNv80eO2iN082xa08BS8_aavi_0i2ItgO1vu8_y2zJIy-Dz_aH28ANLZqOC%2Ccua%40_avLCgaH-i46ywoUfpw1z4adXi45a2iLA%2Ccut%405kSYMltqVRgfhWiYjI2UN_h5vhgcODOHpi3purxaC%2Cosname%40baiduboxapp%2Cctv%402%2Ccfrom%
http://m.baidu.com/s?tn=zbios&pu=sz%401320_480%2Ccuid%400066D8537E3EC43D2B6EF7B031312187EC9C08511FGKMLCTCJO%2Ccua%40640_1136_iphone_6.3.2.0_0%2Ccut%40iPhone5%252C2_8.0.2%2Cosname%40baiduboxapp%2Cctv%401%2Ccfrom%401099a%2Ccsrc%40app_box_txt&bd_page_type=1&
http://economist.extole.com/micro/microsite?e=george.brandt12%40stjohns.edu&amp;partner_user_id=99006&amp;country=USA
https://subscriptions.economist.com/renos/us/?crn=02809963&lastname=52140
http://economist.extole.com/micro/microsite?e=george.brandt12%40stjohns.edu&amp;partner_user_id=99006&amp;country=USA
http://m.baidu.com/?from=1001192k&bd_page_type=1&ssid=0&uid=0&ref=www_iphone&pu=usm%400%2Csz%401320_1001&lid=9032218124099250769&baiduid=5F8B3AF36219A92E45B699B93CCD0F66&nw=1
http://m.baidu.com/?from=1001192k&bd_page_type=1&ssid=0&uid=0&ref=www_iphone&pu=usm%400%2Csz%401320_1001&lid=9032218124099250769&baiduid=5F8B3AF36219A92E45B699B93CCD0F66&nw=1
http://m.baidu.com/ssid=0/from=844b/bd_page_type=1/uid=486AF9819D06BDEEC9015DE3A1449BE2/baiduid=BFB2F2E752163C9CB61DC39AC8D8A50E/pu=ta%40middle____%2Csz%40240_320/baiduid=BFB2F2E752163C9CB61DC39AC8D8A50E/w=0_10_%E7%BB%8F%E6%B5%8E%E5%AD%A6%E4%BA%BA/t=wap/l
http://m.baidu.com/ssid=0/from=844b/bd_page_type=1/uid=486AF9819D06BDEEC9015DE3A1449BE2/baiduid=BFB2F2E752163C9CB61DC39AC8D8A50E/pu=ta%40middle____%2Csz%40240_320/baiduid=BFB2F2E752163C9CB61DC39AC8D8A50E/w=0_10_%E7%BB%8F%E6%B5%8E%E5%AD%A6%E4%BA%BA/t=wap/l
http://m.baidu.com/ssid=0/from=844b/bd_page_type=1/uid=486AF9819D06BDEEC9015DE3A1449BE2/baiduid=BFB2F2E752163C9CB61DC39AC8D8A50E/pu=ta%40middle____%2Csz%40240_320/baiduid=BFB2F2E752163C9CB61DC39AC8D8A50E/w=0_10_%E7%BB%8F%E6%B5%8E%E5%AD%A6%E4%BA%BA/t=wap/l
http://m.baidu.com/bd_page_type=1/pu=ta%40middle____%2Csz%40224_220/uid=0/t=wap/w=0_10_%E7%BB%8F%E6%B5%8E%E5%AD%A6%E4%BA%BA/ssid=0/from=1011496b/l=0/baiduid=BFB2F2E752163C9CB61DC39AC8D8A50E/tc?pn=11&m=0&baiduid=BFB2F2E752163C9CB61DC39AC8D8A50E&src=http://
http://m.baidu.com/bd_page_type=1/pu=ta%40middle____%2Csz%40224_220/uid=0/t=wap/w=0_10_%E7%BB%8F%E6%B5%8E%E5%AD%A6%E4%BA%BA/ssid=0/from=1011496b/l=0/baiduid=BFB2F2E752163C9CB61DC39AC8D8A50E/tc?pn=11&m=0&baiduid=BFB2F2E752163C9CB61DC39AC8D8A50E&src=http://
http://m.baidu.com/bd_page_type=1/pu=ta%40middle____%2Csz%40224_220/uid=0/t=wap/w=0_10_%E7%BB%8F%E6%B5%8E%E5%AD%A6%E4%BA%BA/ssid=0/from=1011496b/l=0/baiduid=BFB2F2E752163C9CB61DC39AC8D8A50E/tc?pn=11&m=0&baiduid=BFB2F2E752163C9CB61DC39AC8D8A50E&src=http://
https://subscriptions.economist.com/renos/us/?crn=01775704&lastname=drummond
http://m.baidu.com/s?tn=zbios&pu=sz%401320_480%2Ccuid%40j8Sfu_aoHag0OS8L_aS-i_Pzvt0qPSfS0iSza_ud2iiYavt3_a-18_az28_Ra2tHA%2Ccua%40gu2MiyuC2ig-NE6lI5me6NIy2IgUI28nAqqqB%2Ccut%40rI2NkJ5Mmh_Dh2IJgNvHt4ftAqv5xqqSB%2Cosname%40baiduboxapp%2Cctv%402%2Ccfrom%4010
http://m.baidu.com/s?tn=zbios&pu=sz%401320_480%2Ccuid%40j8Sfu_aoHag0OS8L_aS-i_Pzvt0qPSfS0iSza_ud2iiYavt3_a-18_az28_Ra2tHA%2Ccua%40gu2MiyuC2ig-NE6lI5me6NIy2IgUI28nAqqqB%2Ccut%40rI2NkJ5Mmh_Dh2IJgNvHt4ftAqv5xqqSB%2Cosname%40baiduboxapp%2Cctv%402%2Ccfrom%4010
http://m.baidu.com/s?tn=zbios&pu=sz%401320_480%2Ccuid%40j8Sfu_aoHag0OS8L_aS-i_Pzvt0qPSfS0iSza_ud2iiYavt3_a-18_az28_Ra2tHA%2Ccua%40gu2MiyuC2ig-NE6lI5me6NIy2IgUI28nAqqqB%2Ccut%40rI2NkJ5Mmh_Dh2IJgNvHt4ftAqv5xqqSB%2Cosname%40baiduboxapp%2Cctv%402%2Ccfrom%4010
http://web.b.ebscohost.com/ehost/resultsadvanced?sid=f3f8a050-3925-4994-8607-4a93f653e9cc%40sessionmgr115&vid=6&hid=110&bquery=(poverty+AND+education)+AND+(college+tuition)&bdata=JkF1dGhUeXBlPWlwLHVpZCZkYj1hOWgmY2xpMD1GVCZjbHYwPVkmdHlwZT0xJnNpdGU9ZWhvc3Qt
http://web.b.ebscohost.com/ehost/resultsadvanced?sid=f3f8a050-3925-4994-8607-4a93f653e9cc%40sessionmgr115&vid=6&hid=110&bquery=(poverty+AND+education)+AND+(college+tuition)&bdata=JkF1dGhUeXBlPWlwLHVpZCZkYj1hOWgmY2xpMD1GVCZjbHYwPVkmdHlwZT0xJnNpdGU9ZWhvc3Qt




access-facade.csv.log-201702051486254601-172-17-2-163.gz
access-facade.csv.log-201702051486254601-172-17-3-20.gz
access-facade.csv.log-201702121486859401.gz
access-facade.csv.log-201702191487464201.gz
access-facade.csv.log-201702261488069001.gz
access-facade.csv.log-201703051488673801.gz

---------------------------------------------------------------------------------------------------
-- problem with insert script step 179.....
---------------------------------------------------------------------------------------------------
[15:46]  
basically the table was created with the superuser so the marko user (used by align.py) couldn't see it
I did this:
grant select, insert, delete on common.country_regions to marko

---------------------------------------------------------------------------------------------------
-- files to change for regexp_replace
---------------------------------------------------------------------------------------------------
     1  Binary file ./preprocessor/formulae.pyc matches
     2  Binary file ./preprocessor/test_formulae.pyc matches
     3  ./preprocessor/formulae.py
     4  ./preprocessor/test_formulae.py
     5  ./redshift/transform/remove_addresses_recent.sql
     6  ./redshift/transform/remove_addresses.sql
---------------------------------------------------------------------------------------------------


-- Test 18
select 'Test 18', TestString, regexp 
  from (
select 'http://www.economist.com/admin/ec/user_search_advanced?mail=&uid=&given_name=&family_name=&crn=06770430++++&op=Search' as TestString
     , regexp_replace( 'http://www.economist.com/admin/ec/user_search_advanced?mail=&uid=&given_name=&family_name=&crn=06770430++++&op=Search'
     , 'user_search_advanced\\?mail=(.*)?&uid'
	 , 'user_search_advanced\\?mail=DroppedEmailAddress&uid'
	 ) as regexp
) a	 
 where 
     (TestString LIKE '%user_search_advanced?mail=%&uid%' )

--Test 18 results
--http://www.economist.com/admin/ec/user_search_advanced?mail=&uid=&given_name=&family_name=&crn=06770430++++&op=Search
--http://www.economist.com/admin/ec/user_search_advanced?mail=DroppedEmailAddress&uid=&given_name=&family_name=&crn=06770430++++&op=Search

union all

-- Test 19
select 'Test 19', TestString, regexp 
  from (
select 'http://www.economist.com/admin/ec/user_search_advanced?order=access&sort=asc&mail=&uid=&given_name=&family_name=&crn=07151037&op=Search' as TestString
     , regexp_replace( 'http://www.economist.com/admin/ec/user_search_advanced?order=access&sort=asc&mail=&uid=&given_name=&family_name=&crn=07151037&op=Search'
     , '&mail=(.*)?&uid'
	 , '&mail=DroppedEmailAddress&uid'
	 ) as regexp
) a	 
 where 
     (TestString LIKE '%user_search_advanced?%&mail=&uid%' )

--Test 19 results
--http://www.economist.com/admin/ec/user_search_advanced?order=access&sort=asc&mail=&uid=&given_name=&family_name=&crn=07151037&op=Search
--http://www.economist.com/admin/ec/user_search_advanced?order=access&sort=asc&mail=DroppedEmailAddress&uid=&given_name=&family_name=&crn=07151037&op=Search

union all

-- Test 20
select 'Test 20', TestString, regexp 
  from (
select 'http://pro02.etrack.hk/track?t=c&eas=1&msid=&auid=&mid=CPLP_S_752_A_h&msgid=S1001E1512&did=data_CPLP_S_752_A_h&sn=16779546&eid=richmanley@mac.com&uid=LiMooqPSnmSHkhkiRK&tgid=&fl=&extra=MultivariateId=&&&0002&&&https://subscriptions.economist.com/asia/reg/' as TestString
     , regexp_replace( 'http://pro02.etrack.hk/track?t=c&eas=1&msid=&auid=&mid=CPLP_S_752_A_h&msgid=S1001E1512&did=data_CPLP_S_752_A_h&sn=16779546&eid=richmanley@mac.com&uid=LiMooqPSnmSHkhkiRK&tgid=&fl=&extra=MultivariateId=&&&0002&&&https://subscriptions.economist.com/asia/reg/'
     , '&eid=(.*)?@(.*)?&uid'
	 , '&eid=DroppedEmailAddress&uid'
	 ) as regexp
) a	 
 where 
     (TestString LIKE '%&eid=%@%&uid%' )

--Test 20 results
--http://pro02.etrack.hk/track?t=c&eas=1&msid=&auid=&mid=CPLP_S_752_A_h&msgid=S1001E1512&did=data_CPLP_S_752_A_h&sn=16779546&eid=richmanley@mac.com&uid=LiMooqPSnmSHkhkiRK&tgid=&fl=&extra=MultivariateId=&&&0002&&&https://subscriptions.economist.com/asia/reg/
--http://pro02.etrack.hk/track?t=c&eas=1&msid=&auid=&mid=CPLP_S_752_A_h&msgid=S1001E1512&did=data_CPLP_S_752_A_h&sn=16779546&eid=DroppedEmailAddress&uid=LiMooqPSnmSHkhkiRK&tgid=&fl=&extra=MultivariateId=&&&0002&&&https://subscriptions.economist.com/asia/reg/

union all

-- Test 91
select 'Test 91', TestString, regexp 
  from (
select 'http://www.economist.com/whichmba/executive-mba-ranking/2015/hult-international-business-school?j=2594656&e=trevlamb10@gmail.com&l=5279_HTML&u=44273109&mid=1049976&jb=0&utm_medium=Email&utm_campaign=May+2015+Rankings+Update&fn=Trevor&ln=Lamb&utm_source=QS' as TestString
     , regexp_replace( 'http://www.economist.com/whichmba/executive-mba-ranking/2015/hult-international-business-school?j=2594656&e=trevlamb10@gmail.com&l=5279_HTML&u=44273109&mid=1049976&jb=0&utm_medium=Email&utm_campaign=May+2015+Rankings+Update&fn=Trevor&ln=Lamb&utm_source=QS'
     , '&e=(.*)?@(.*)?20'
	 , '&e=DroppedEmailAddress20'
	 ) as regexp
) a	 
 where 
     (TestString LIKE '%&e=%@%20%' )
	 
--http://www.economist.com/whichmba/executive-mba-ranking/2015/hult-international-business-school?j=2594656&e=trevlamb10@gmail.com&l=5279_HTML&u=44273109&mid=1049976&jb=0&utm_medium=Email&utm_campaign=May+2015+Rankings+Update&fn=Trevor&ln=Lamb&utm_source=QS
--http://www.economist.com/whichmba/executive-mba-ranking/2015/hult-international-business-school?j=2594656&e=DroppedEmailAddress2015+Rankings+Update&fn=Trevor&ln=Lamb&utm_source=QS
-- End of Test 91

union all

-- Test 92
select 'Test 92', TestString, regexp 
  from (
select 'http://www.militaryaerospace.com/articles/pt/2016/11/hunting-submarines-with-magnets.html?cmpid=enl_MAE_WrapUp_2016-11-18&email_address=ffrigerio@locustusa.com&eid=288646054&bid=1592658' as TestString
     , regexp_replace( 'http://www.militaryaerospace.com/articles/pt/2016/11/hunting-submarines-with-magnets.html?cmpid=enl_MAE_WrapUp_2016-11-18&email_address=ffrigerio@locustusa.com&eid=288646054&bid=1592658'
     , 'email_address=(.*)?@(.*)?&eid'
	 , 'email_address=DroppedEmailAddress&eid'
	 ) as regexp
) a	 
 where 
     (TestString LIKE '%email_address=%@%&eid%' )
	 
--http://www.militaryaerospace.com/articles/pt/2016/11/hunting-submarines-with-magnets.html?cmpid=enl_MAE_WrapUp_2016-11-18&email_address=ffrigerio@locustusa.com&eid=288646054&bid=1592658
--http://www.militaryaerospace.com/articles/pt/2016/11/hunting-submarines-with-magnets.html?cmpid=enl_MAE_WrapUp_2016-11-18&email_address=DroppedEmailAddress&eid=288646054&bid=1592658

union all

-- Test 93
select 'Test 93', TestString, regexp 
  from (
select 'http://tracking2.naylorcampaigns.com/track?type=click&eas=1&msid=&auid=&mailingid=556728&messageid=556728&databaseid=556728&serial=16792310&emailid=TheRaineyGroup@gmail.com&userid=5520&targetid=&fl=&mvid=&extra=&&&2053&&&http://www.economist.com/news/unit' as TestString
     , regexp_replace( 'http://tracking2.naylorcampaigns.com/track?type=click&eas=1&msid=&auid=&mailingid=556728&messageid=556728&databaseid=556728&serial=16792310&emailid=TheRaineyGroup@gmail.com&userid=5520&targetid=&fl=&mvid=&extra=&&&2053&&&http://www.economist.com/news/unit'
     , 'emailid=(.*)?@(.*)?&userid'
	 , 'emailid=DroppedEmailAddress&userid'
	 ) as regexp
) a	 
 where 
     (TestString LIKE '%emailid=%@%&userid%' )

--http://tracking2.naylorcampaigns.com/track?type=click&eas=1&msid=&auid=&mailingid=556728&messageid=556728&databaseid=556728&serial=16792310&emailid=TheRaineyGroup@gmail.com&userid=5520&targetid=&fl=&mvid=&extra=&&&2053&&&http://www.economist.com/news/unit
--http://tracking2.naylorcampaigns.com/track?type=click&eas=1&msid=&auid=&mailingid=556728&messageid=556728&databaseid=556728&serial=16792310&emailid=DroppedEmailAddress&userid=5520&targetid=&fl=&mvid=&extra=&&&2053&&&http://www.economist.com/news/unit

union all

-- Test 94
select 'Test 94', TestString, regexp 
  from (
select 'https://www.economist.com/user/10532964/change-password?destination=user%2F10532964%3Femail%3Dmohamadsholihin%2540yahoo.com%26cid1%3Dd%252Foc%252Fn%252Fn%252Fn%252F20161121n%252Fowned%252Fn%252Fn%252Fnwl%252Fn%252Fn%252Fn%252Femail' as TestString
     , regexp_replace( 'https://www.economist.com/user/10532964/change-password?destination=user%2F10532964%3Femail%3Dmohamadsholihin%2540yahoo.com%26cid1%3Dd%252Foc%252Fn%252Fn%252Fn%252F20161121n%252Fowned%252Fn%252Fn%252Fnwl%252Fn%252Fn%252Fn%252Femail'
     , 'Femail(.*)?cid1'
	 , 'FemailDroppedEmailAddresscid1'
	 ) as regexp
) a	 
 where 
     (TestString LIKE '%Femail%cid1%' )
	 
--https://www.economist.com/user/10532964/change-password?destination=user%2F10532964%3Femail%3Dmohamadsholihin%2540yahoo.com%26cid1%3Dd%252Foc%252Fn%252Fn%252Fn%252F20161121n%252Fowned%252Fn%252Fn%252Fnwl%252Fn%252Fn%252Fn%252Femail	 
--https://www.economist.com/user/10532964/change-password?destination=user%2F10532964%3FemailDroppedEmailAddresscid1%3Dd%252Foc%252Fn%252Fn%252Fn%252F20161121n%252Fowned%252Fn%252Fn%252Fnwl%252Fn%252Fn%252Fn%252Femail	 

union all

-- Test 95
select 'Test 95', TestString, regexp 
  from (
select 'https://subscriptionmanagement.economist.com/Catalogue/ContactSubmit.aspx?&ToEmail=economist.americas.subs@quadrantsubs.com&FromEmail=zmartin99@gmail.com' as TestString
     , regexp_replace( 'https://subscriptionmanagement.economist.com/Catalogue/ContactSubmit.aspx?&ToEmail=economist.americas.subs@quadrantsubs.com&FromEmail=zmartin99@gmail.com'
     , 'FromEmail=(.*)?@(.*)?'
	 , 'FromEmail=DroppedEmailAddress'
	 ) as regexp
) a	 
 where 
     (TestString LIKE '%FromEmail=%@%' )

--Test 95 results
--https://subscriptionmanagement.economist.com/Catalogue/ContactSubmit.aspx?&ToEmail=economist.americas.subs@quadrantsubs.com&FromEmail=zmartin99@gmail.com
--https://subscriptionmanagement.economist.com/Catalogue/ContactSubmit.aspx?&ToEmail=economist.americas.subs@quadrantsubs.com&FromEmail=DroppedEmailAddress

---------------------------------------------------------------------------------------------------
-- Just extract the regexp statements from the statements above
---------------------------------------------------------------------------------------------------

-- Test 18
     , 'user_search_advanced\\?mail=(.*)?&uid'
	 , 'user_search_advanced\\?mail=DroppedEmailAddress&uid'
 where 
     (TestString LIKE '%user_search_advanced?mail=%&uid%' )

-- Test 19
     , '&mail=(.*)?&uid'
	 , '&mail=DroppedEmailAddress&uid'
 where 
     (TestString LIKE '%user_search_advanced?%&mail=&uid%' )

-- Test 20
     , '&eid=(.*)?@(.*)?&uid'
	 , '&eid=DroppedEmailAddress&uid'
 where 
     (TestString LIKE '%&eid=%@%&uid%' )

-- Test 91
     , '&e=(.*)?@(.*)?20'
	 , '&e=DroppedEmailAddress20'
 where 
     (TestString LIKE '%&e=%@%20%' )
	 
-- Test 92
     , 'email_address=(.*)?@(.*)?&eid'
	 , 'email_address=DroppedEmailAddress&eid'
 where 
     (TestString LIKE '%email_address=%@%&eid%' )

-- Test 93
     , 'emailid=(.*)?@(.*)?&userid'
	 , 'emailid=DroppedEmailAddress&userid'
 where 
     (TestString LIKE '%emailid=%@%&userid%' )

-- Test 94
     , 'Femail(.*)?cid1'
	 , 'FemailDroppedEmailAddresscid1'
 where 
     (TestString LIKE '%Femail%cid1%' )

-- Test 95
     , 'FromEmail=(.*)?@(.*)?'
	 , 'FromEmail=DroppedEmailAddress'
 where 
     (TestString LIKE '%FromEmail=%@%' )

---------------------------------------------------------------------------------------------------
-- new test conditions to be implemented as per Pad's email.....CHECK FOR LAST COMMA, AND 
---------------------------------------------------------------------------------------------------

	       'user_search_advanced\\?mail=(.*)?&uid',
	       'user_search_advanced\\?mail=DroppedEmailAddress&uid',
           '&mail=(.*)?&uid',
	       '&mail=DroppedEmailAddress&uid',
           '&eid=(.*)?@(.*)?&uid',
	       '&eid=DroppedEmailAddress&uid',
           '&e=(.*)?@(.*)?20',
	       '&e=DroppedEmailAddress20',
           'email_address=(.*)?@(.*)?&eid',
	       'email_address=DroppedEmailAddress&eid',
           'emailid=(.*)?@(.*)?&userid',
	       'emailid=DroppedEmailAddress&userid',
           'Femail(.*)?cid1',
	       'FemailDroppedEmailAddresscid1',
           'FromEmail=(.*)?@(.*)?',
	       'FromEmail=DroppedEmailAddress'
 where 
 
OR ( referrer LIKE '%user_search_advanced?mail=%&uid%' )
OR ( referrer LIKE '%user_search_advanced?%&mail=&uid%' )
OR ( referrer LIKE '%&eid=%@%&uid%' )
OR ( referrer LIKE '%&e=%@%20%' )
OR ( referrer LIKE '%email_address=%@%&eid%' )
OR ( referrer LIKE '%emailid=%@%&userid%' )
OR ( referrer LIKE '%Femail%cid1%' )
OR ( referrer LIKE '%FromEmail=%@%' )

OR ( post_referrer LIKE '%user_search_advanced?mail=%&uid%' )
OR ( post_referrer LIKE '%user_search_advanced?%&mail=&uid%' )
OR ( post_referrer LIKE '%&eid=%@%&uid%' )
OR ( post_referrer LIKE '%&e=%@%20%' )
OR ( post_referrer LIKE '%email_address=%@%&eid%' )
OR ( post_referrer LIKE '%emailid=%@%&userid%' )
OR ( post_referrer LIKE '%Femail%cid1%' )
OR ( post_referrer LIKE '%FromEmail=%@%' )

OR ( visit_start_page_url LIKE '%user_search_advanced?mail=%&uid%' )
OR ( visit_start_page_url LIKE '%user_search_advanced?%&mail=&uid%' )
OR ( visit_start_page_url LIKE '%&eid=%@%&uid%' )
OR ( visit_start_page_url LIKE '%&e=%@%20%' )
OR ( visit_start_page_url LIKE '%email_address=%@%&eid%' )
OR ( visit_start_page_url LIKE '%emailid=%@%&userid%' )
OR ( visit_start_page_url LIKE '%Femail%cid1%' )
OR ( visit_start_page_url LIKE '%FromEmail=%@%' )

OR ( first_hit_page_url LIKE '%user_search_advanced?mail=%&uid%' )
OR ( first_hit_page_url LIKE '%user_search_advanced?%&mail=&uid%' )
OR ( first_hit_page_url LIKE '%&eid=%@%&uid%' )
OR ( first_hit_page_url LIKE '%&e=%@%20%' )
OR ( first_hit_page_url LIKE '%email_address=%@%&eid%' )
OR ( first_hit_page_url LIKE '%emailid=%@%&userid%' )
OR ( first_hit_page_url LIKE '%Femail%cid1%' )
OR ( first_hit_page_url LIKE '%FromEmail=%@%' )

OR ( first_hit_referrer LIKE '%user_search_advanced?mail=%&uid%' )
OR ( first_hit_referrer LIKE '%user_search_advanced?%&mail=&uid%' )
OR ( first_hit_referrer LIKE '%&eid=%@%&uid%' )
OR ( first_hit_referrer LIKE '%&e=%@%20%' )
OR ( first_hit_referrer LIKE '%email_address=%@%&eid%' )
OR ( first_hit_referrer LIKE '%emailid=%@%&userid%' )
OR ( first_hit_referrer LIKE '%Femail%cid1%' )
OR ( first_hit_referrer LIKE '%FromEmail=%@%' )

OR ( post_page_url LIKE '%user_search_advanced?mail=%&uid%' )
OR ( post_page_url LIKE '%user_search_advanced?%&mail=&uid%' )
OR ( post_page_url LIKE '%&eid=%@%&uid%' )
OR ( post_page_url LIKE '%&e=%@%20%' )
OR ( post_page_url LIKE '%email_address=%@%&eid%' )
OR ( post_page_url LIKE '%emailid=%@%&userid%' )
OR ( post_page_url LIKE '%Femail%cid1%' )
OR ( post_page_url LIKE '%FromEmail=%@%' )

OR ( post_pagename_no_url LIKE '%user_search_advanced?mail=%&uid%' )
OR ( post_pagename_no_url LIKE '%user_search_advanced?%&mail=&uid%' )
OR ( post_pagename_no_url LIKE '%&eid=%@%&uid%' )
OR ( post_pagename_no_url LIKE '%&e=%@%20%' )
OR ( post_pagename_no_url LIKE '%email_address=%@%&eid%' )
OR ( post_pagename_no_url LIKE '%emailid=%@%&userid%' )
OR ( post_pagename_no_url LIKE '%Femail%cid1%' )
OR ( post_pagename_no_url LIKE '%FromEmail=%@%' )

OR ( url LIKE '%user_search_advanced?mail=%&uid%' )
OR ( url LIKE '%user_search_advanced?%&mail=&uid%' )
OR ( url LIKE '%&eid=%@%&uid%' )
OR ( url LIKE '%&e=%@%20%' )
OR ( url LIKE '%email_address=%@%&eid%' )
OR ( url LIKE '%emailid=%@%&userid%' )
OR ( url LIKE '%Femail%cid1%' )
OR ( url LIKE '%FromEmail=%@%' )

OR ( visit_referrer LIKE '%user_search_advanced?mail=%&uid%' )
OR ( visit_referrer LIKE '%user_search_advanced?%&mail=&uid%' )
OR ( visit_referrer LIKE '%&eid=%@%&uid%' )
OR ( visit_referrer LIKE '%&e=%@%20%' )
OR ( visit_referrer LIKE '%email_address=%@%&eid%' )
OR ( visit_referrer LIKE '%emailid=%@%&userid%' )
OR ( visit_referrer LIKE '%Femail%cid1%' )
OR ( visit_referrer LIKE '%FromEmail=%@%' )


---------------------------------------------------------------------------------------------------
-- copying economistdotcom.serverlog files to POC.....
---------------------------------------------------------------------------------------------------

aws s3 cp s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201702261488069001.gz s3://economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201702261488069001.gz
aws s3 cp s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703051488673801.gz s3://economist-analytics-euw1-test-repository/economistdotcom/serverlog/access-facade.csv.log-201703051488673801.gz


economist-analytics-euw1-test-repository/load-to-poc copied here as well in case tst01 destructs itself

From Pete: Thursday 16-Mar-2017
Hi Marko, pls could you copy the economistdotcom.serverlog files from here: 
economist-analytics-euw1-tst01/load-to-poc

...into the POC cluster, eyeball them and advise Pad? 
Thanks


aws s3 cp s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703051488673801.gz 
    s3://economist-analytics-euw1-test-repository/xxxxxxxx/economistdotcom/serverlog/access-facade.csv.log-201703051488673801.gz
	
---------------------------------------------------------------------------------------------------	
--copying from here
---------------------------------------------------------------------------------------------------	
aws s3 cp s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-10cdbe4d-e6e3-46fd-9ec3-8e6a40f67b1c.csv.gz  s3://economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-10cdbe4d-e6e3-46fd-9ec3-8e6a40f67b1c.csv.gz
 
aws s3 cp s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-461a191b-c9c1-44f3-aae4-09d4105508f1.csv.gz  s3://economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-461a191b-c9c1-44f3-aae4-09d4105508f1.csv.gz

aws s3 cp s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-707dbb30-0f57-4086-81ea-781e80e092d6.csv.gz  s3://economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-707dbb30-0f57-4086-81ea-781e80e092d6.csv.gz

aws s3 cp s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-e4098074-bfb0-4095-8ac8-74f01afcedfd.csv.gz  s3://economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-e4098074-bfb0-4095-8ac8-74f01afcedfd.csv.gz
		  
to here

economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-10cdbe4d-e6e3-46fd-9ec3-8e6a40f67b1c.csv.gz

---------------------------------------------------------------------------------------------------	

	
                           PRE load-to-poc/
markod@ip-172-20-0-174:/home/markod/repos/bigdata : aws s3 ls  s3://economist-analytics-euw1-tst01/load-to-poc/
2017-03-16 06:48:44          0
2017-03-16 06:48:52   19406976 part-r-00000-10cdbe4d-e6e3-46fd-9ec3-8e6a40f67b1c.csv.gz
2017-03-16 06:49:46   51842895 part-r-00000-461a191b-c9c1-44f3-aae4-09d4105508f1.csv.gz
2017-03-16 06:50:40   27335423 part-r-00000-707dbb30-0f57-4086-81ea-781e80e092d6.csv.gz
2017-03-16 06:50:10   30198098 part-r-00000-e4098074-bfb0-4095-8ac8-74f01afcedfd.csv.gz

COPY ga.sessions from s3://<bucket>/<path>
 CREDENTIALS 'aws_iam_role=arn:aws:iam::334086281941:role/dev-redshift-copy-unload'
 EMPTYASNULL GZIP IGNOREBLANKLINES DELIMITER '\t' ACCEPTINVCHARS MAXERROR 10000 COMPUPDATE OFF;

 s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-10cdbe4d-e6e3-46fd-9ec3-8e6a40f67b1c.csv.gz

---------------------------------------------------------------------------------------------------
-- need the copyToRedshift connection to run COPY command.....to copy into POC
---------------------------------------------------------------------------------------------------
 
COPY economistdotcom.serverlog from s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-10cdbe4d-e6e3-46fd-9ec3-8e6a40f67b1c.csv.gz
 CREDENTIALS 'aws_iam_role=arn:aws:iam::334086281941:role/dev-redshift-copy-unload'
 EMPTYASNULL GZIP IGNOREBLANKLINES DELIMITER '\t' ACCEPTINVCHARS MAXERROR 10000 COMPUPDATE OFF
; 


COPY economistdotcom.serverlog from 's3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-461a191b-c9c1-44f3-aae4-09d4105508f1.csv.gz'
 CREDENTIALS 'aws_iam_role=arn:aws:iam::334086281941:role/dev-redshift-copy-unload'
 EMPTYASNULL GZIP IGNOREBLANKLINES DELIMITER '\t' ACCEPTINVCHARS MAXERROR 10000 COMPUPDATE OFF
;

COPY economistdotcom.serverlog from 's3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-707dbb30-0f57-4086-81ea-781e80e092d6.csv.gz'
 CREDENTIALS 'aws_iam_role=arn:aws:iam::334086281941:role/dev-redshift-copy-unload'
 EMPTYASNULL GZIP IGNOREBLANKLINES DELIMITER '\t' ACCEPTINVCHARS MAXERROR 10000 COMPUPDATE OFF
; 

COPY economistdotcom.serverlog from 's3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-e4098074-bfb0-4095-8ac8-74f01afcedfd.csv.gz'
 CREDENTIALS 'aws_iam_role=arn:aws:iam::334086281941:role/dev-redshift-copy-unload'
 EMPTYASNULL GZIP IGNOREBLANKLINES DELIMITER '\t' ACCEPTINVCHARS MAXERROR 10000 COMPUPDATE OFF
;

---------------------------------------------------------------------------------------------------
-- Need the DEV thursday connection to run SQL against the table populated in the COPY commands above
---------------------------------------------------------------------------------------------------
select raw_field_value, count(*)
  from stl_load_errors
 where filename like '%part-r-00000-10cdbe4d-e6e3-46fd-9ec3-8e6a40f67b1c.csv.gz%'
    or filename like '%part-r-00000-461a191b-c9c1-44f3-aae4-09d4105508f1.csv.gz%'
    or filename like '%part-r-00000-707dbb30-0f57-4086-81ea-781e80e092d6.csv.gz%'
	or filename like '%part-r-00000-e4098074-bfb0-4095-8ac8-74f01afcedfd.csv.gz%'
group by raw_field_value
	
---------------------------------------------------------------------------------------------------
-- This code will build all of the sfmc objects held in mdj_log:
-- Attributes Bounces ClickImpression Clicks Conversions Listmembershipchanges Lists NotSent Open SendJobImpression SendJobs Sent SentImpression StatusChanges Subscribers Unsubs
---------------------------------------------------------------------------------------------------
for i in $(cat mdj_log); do python getconfig.py -p admin --filetype "$i"; done


---------------------------------------------------------------------------------------------------
--Monday morning load - 
---------------------------------------------------------------------------------------------------
-- Once Comprehensive Tests have run through, the part* files should be present in the following bucket


2017-03-20 09:57:55   27334625 part-r-00000-3e9cac30-bbf8-490a-92d0-63ebbaf8c194.csv.gz
2017-03-20 09:58:53   19410653 part-r-00000-50c5876e-7509-4223-9494-69498c5e48ed.csv.gz
2017-03-20 09:58:30   51846336 part-r-00000-7783e17c-9d24-49f7-9e70-19d2249d3bd8.csv.gz
2017-03-20 09:57:32   30197320 part-r-00000-ef63bf98-b9c1-467f-a60b-a4e21a66d30f.csv.gz

aws s3 cp s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-3e9cac30-bbf8-490a-92d0-63ebbaf8c194.csv.gz  s3://economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-3e9cac30-bbf8-490a-92d0-63ebbaf8c194.csv.gz
aws s3 cp s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-50c5876e-7509-4223-9494-69498c5e48ed.csv.gz  s3://economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-50c5876e-7509-4223-9494-69498c5e48ed.csv.gz
aws s3 cp s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-7783e17c-9d24-49f7-9e70-19d2249d3bd8.csv.gz  s3://economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-7783e17c-9d24-49f7-9e70-19d2249d3bd8.csv.gz
aws s3 cp s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-ef63bf98-b9c1-467f-a60b-a4e21a66d30f.csv.gz  s3://economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-ef63bf98-b9c1-467f-a60b-a4e21a66d30f.csv.gz

COPY economistdotcom.serverlog from 's3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-3e9cac30-bbf8-490a-92d0-63ebbaf8c194.csv.gz'
 CREDENTIALS 'aws_iam_role=arn:aws:iam::334086281941:role/dev-redshift-copy-unload'
 EMPTYASNULL GZIP IGNOREBLANKLINES DELIMITER '\t' ACCEPTINVCHARS MAXERROR 10000 COMPUPDATE OFF
; 

COPY economistdotcom.serverlog from 's3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-50c5876e-7509-4223-9494-69498c5e48ed.csv.gz'
 CREDENTIALS 'aws_iam_role=arn:aws:iam::334086281941:role/dev-redshift-copy-unload'
 EMPTYASNULL GZIP IGNOREBLANKLINES DELIMITER '\t' ACCEPTINVCHARS MAXERROR 10000 COMPUPDATE OFF
; 

COPY economistdotcom.serverlog from 's3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-7783e17c-9d24-49f7-9e70-19d2249d3bd8.csv.gz'
 CREDENTIALS 'aws_iam_role=arn:aws:iam::334086281941:role/dev-redshift-copy-unload'
 EMPTYASNULL GZIP IGNOREBLANKLINES DELIMITER '\t' ACCEPTINVCHARS MAXERROR 10000 COMPUPDATE OFF
; 

COPY economistdotcom.serverlog from 's3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-ef63bf98-b9c1-467f-a60b-a4e21a66d30f.csv.gz'
 CREDENTIALS 'aws_iam_role=arn:aws:iam::334086281941:role/dev-redshift-copy-unload'
 EMPTYASNULL GZIP IGNOREBLANKLINES DELIMITER '\t' ACCEPTINVCHARS MAXERROR 10000 COMPUPDATE OFF
; 

---------------------------------------------------------------------------------------------------
--Monday afternoon load, after Pete's changes
---------------------------------------------------------------------------------------------------
-- Copy from the archive/date folders to s3://economist-analytics-euw1-tst01/load-to-poc
aws s3 cp s3://economist-analytics-euw1-tst01/economistdotcom/serverlog/archive/loaded/2017-02-05/1682146362287956424_537987_access-facade.csv.log-201702051486254601-172-17-2-163.gz/part-r-00000-a18f1be2-38c1-4456-997b-9cbd321a439e.csv.gz s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-a18f1be2-38c1-4456-997b-9cbd321a439e.csv.gz
aws s3 cp s3://economist-analytics-euw1-tst01/economistdotcom/serverlog/archive/loaded/2017-02-05/2508332028330435843_599808_access-facade.csv.log-201702051486254601-172-17-3-20.gz/part-r-00000-37bb012e-0c16-43bb-aebd-58d216f1883c.csv.gz  s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-37bb012e-0c16-43bb-aebd-58d216f1883c.csv.gz
aws s3 cp s3://economist-analytics-euw1-tst01/economistdotcom/serverlog/archive/loaded/2017-02-26/8251711920161960177_953982_access-facade.csv.log-201702261488069001.gz/part-r-00000-6b0eb8b4-ec8c-4734-96b7-225146404665.csv.gz              s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-6b0eb8b4-ec8c-4734-96b7-225146404665.csv.gz
aws s3 cp s3://economist-analytics-euw1-tst01/economistdotcom/serverlog/archive/loaded/2017-03-05/7005159006388452699_369570_access-facade.csv.log-201703051488673801.gz/part-r-00000-1d43d43a-8cb0-450a-9181-2f24074b1e48.csv.gz              s3://economist-analytics-euw1-tst01/load-to-poc/part-r-00000-1d43d43a-8cb0-450a-9181-2f24074b1e48.csv.gz

-- Copy also to temporary folder for safe keeping s3://economist-analytics-euw1-test-repository/load-to-poc
aws s3 cp s3://economist-analytics-euw1-tst01/economistdotcom/serverlog/archive/loaded/2017-02-05/1682146362287956424_537987_access-facade.csv.log-201702051486254601-172-17-2-163.gz/part-r-00000-a18f1be2-38c1-4456-997b-9cbd321a439e.csv.gz s3://economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-a18f1be2-38c1-4456-997b-9cbd321a439e.csv.gz
aws s3 cp s3://economist-analytics-euw1-tst01/economistdotcom/serverlog/archive/loaded/2017-02-05/2508332028330435843_599808_access-facade.csv.log-201702051486254601-172-17-3-20.gz/part-r-00000-37bb012e-0c16-43bb-aebd-58d216f1883c.csv.gz  s3://economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-37bb012e-0c16-43bb-aebd-58d216f1883c.csv.gz
aws s3 cp s3://economist-analytics-euw1-tst01/economistdotcom/serverlog/archive/loaded/2017-02-26/8251711920161960177_953982_access-facade.csv.log-201702261488069001.gz/part-r-00000-6b0eb8b4-ec8c-4734-96b7-225146404665.csv.gz  s3://economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-6b0eb8b4-ec8c-4734-96b7-225146404665.csv.gz
aws s3 cp s3://economist-analytics-euw1-tst01/economistdotcom/serverlog/archive/loaded/2017-03-05/7005159006388452699_369570_access-facade.csv.log-201703051488673801.gz/part-r-00000-1d43d43a-8cb0-450a-9181-2f24074b1e48.csv.gz  s3://economist-analytics-euw1-test-repository/load-to-poc/part-r-00000-1d43d43a-8cb0-450a-9181-2f24074b1e48.csv.gz


Neil. . .hi!! I can run the psql script as it on my linux laptop, 
replacing the ANALYSE command, with the following, just for convenience:

set -e; ssh markod@172.20.0.174 'source ~/bigdataconfig.py; psql -v "ON_ERROR_STOP=1" --host=${redshifthostname} --port=${redshiftport} --username=${myredshiftusername} --dbname=${myredshiftdbname} -c "SET wlm_query_slot_count = 2; select top 10 * from common.country_region; select top 10 * from common.country_regions; " '

The job fails as expected, because common.country_region does not exist but common.country_regions does. With set -e; preceeding the command, the session exits, and I loose my screen totally, thereby being unable to check the return code via 'echo $?'

However if I run the same identical script, but with 'set +e;' instead of 'set -e'; (this will turn off any previous set -e command), I get a better controlled behavior, in that the error msg is shown on the screen, plus, I can now check the error code via 'echo $?' which returns non-zero. Thoughts??

---------------------------------------------------------------------------------------------------
-- 10 rows unloaded into this s3 file:
---------------------------------------------------------------------------------------------------
aws s3 cp s3://economist-analytics-euw1-int01/mrd.ga_sessions/6412_part_00.bz2 ~


---------------------------------------------------------------------------------------------------
-- download one of the mrd.ga_pagestats s3 files to have a look....
---------------------------------------------------------------------------------------------------
aws s3 cp s3://economist-analytics-euw1-int01/mrd.ga_pagestats/0000_part_00.bz2 ~


---------------------------------------------------------------------------------------------------
-- From Google.....unload and copy
---------------------------------------------------------------------------------------------------
unload ('select * from tbl_example') to 's3://s3bucket/tbl_example' 
CREDENTIALS 'aws_access_key_id=xxx;aws_secret_access_key=xxx' 
ADDQUOTES DELIMITER '|' ESCAPE ALLOWOVERWRITE;

copy tbl_example2 from 's3://s3bucket/tbl_example' 
CREDENTIALS 'aws_access_key_id=xxx;aws_secret_access_key=xxx' 
delimiter '|' removequotes escape;

---------------------------------------------------------------------------------------------------
-- Jenkins job to unload 10 rows into s3 bucket.....
---------------------------------------------------------------------------------------------------
# MRD unload
#${sshprd01} "source ~/bigdataconfig.py; psql --host=\${redshifthostname} --port=\${redshiftport} --username=\${myredshiftusername} --dbname=\${myredshiftdbname} -c 'unload ('select * from mrd.ga_sessions' to 's3://economist-analytics-euw1-int01/mrd.ga_sessions/' iam_role 'arn:aws:iam::334086281941:role/prd-redshift-copy-unload' BZIP2 ESCAPE)'"
#${sshprd01}  "\""source ~/bigdataconfig.py; psql --host=\${redshifthostname} --port=\${redshiftport} --username=\${myredshiftusername} --dbname=\${myredshiftdbname} -c "unload ('select top 11 * from mrd.ga_sessions') to 's3://economist-analytics-euw1-int01/mrd.ga_sessions/' iam_role 'arn:aws:iam::334086281941:role/prd-redshift-copy-unload' BZIP2 ESCAPE; " "\""
${sshprd01} "source ~/bigdataconfig.py; psql --host=\${redshifthostname} --port=\${redshiftport} --username=\${myredshiftusername} --dbname=\${myredshiftdbname} \-c \" unload ('select * from (select * from mrd.ga_sessions limit 10 );' ) to 's3://economist-analytics-euw1-int01/mrd.ga_sessions/' iam_role 'arn:aws:iam::334086281941:role/prd-redshift-copy-unload' BZIP2 ESCAPE ALLOWOVERWRITE; \" "

--mrd.ga_pagestats
${sshprd01} "source ~/bigdataconfig.py; psql --host=\${redshifthostname} --port=\${redshiftport} --username=\${myredshiftusername} --dbname=\${myredshiftdbname} \-c \" unload ('select * from (select * from mrd.ga_pagestats );' ) to 's3://economist-analytics-euw1-int01/mrd.ga_pagestats/' iam_role 'arn:aws:iam::334086281941:role/prd-redshift-copy-unload' BZIP2 ESCAPE ALLOWOVERWRITE; \" "

--source s3 bucket
--'s3://economist-analytics-euw1-int01/mrd.ga_pagestats/'

-- this is the wildcard format of the COPY command, ie. specify the directory structure upto where the files reside, instead of '*'
COPY cbl_marko.mrd.ga_pagestats from 's3://economist-analytics-euw1-int01/mrd.ga_pagestats/'
 CREDENTIALS 'aws_iam_role=arn:aws:iam::334086281941:role/dev-redshift-copy-unload'
 EMPTYASNULL BZIP2 IGNOREBLANKLINES DELIMITER '|' ACCEPTINVCHARS MAXERROR 10000 COMPUPDATE OFF
; 

---------------------------------------------------------------------------------------------------
-- changed delimiter from '|' to '\t' as there were embedded '|' coming through in the users_total column
---------------------------------------------------------------------------------------------------
${sshprd01} "source ~/bigdataconfig.py; psql --host=\${redshifthostname} --port=\${redshiftport} --username=\${myredshiftusername} --dbname=\${myredshiftdbname} \-c \" unload ('select * from (select * from mrd.ga_pagestats );' ) to 's3://economist-analytics-euw1-int01/mrd.ga_pagestats/' iam_role 'arn:aws:iam::334086281941:role/prd-redshift-copy-unload' BZIP2 ESCAPE DELIMITER '\t' ALLOWOVERWRITE; \" "

---------------------------------------------------------------------------------------------------
-- unloading mrd.ga_profiles into s3.....
---------------------------------------------------------------------------------------------------
${sshprd01} "source ~/bigdataconfig.py; psql --host=\${redshifthostname} --port=\${redshiftport} --username=\${myredshiftusername} --dbname=\${myredshiftdbname} \-c \" unload ('select * from (select * from mrd.ga_profiles );' ) to 's3://economist-analytics-euw1-int01/mrd.ga_profiles/' iam_role 'arn:aws:iam::334086281941:role/prd-redshift-copy-unload' BZIP2 ESCAPE DELIMITER '\t' ALLOWOVERWRITE; \" "


---------------------------------------------------------------------------------------------------
-- Copy specific columns into mrd.ga_pagestats
---------------------------------------------------------------------------------------------------
COPY cbl_marko.mrd.hub_pagestats (
  	  profile_id
	, session_time
	, country_code
	, device_category
	, site_hostname
	, page_path
	, page_title
	, source_medium 
	, users_total
	, users_new
	, page_views_total
	, page_views_unique
	, time_on_page
	, page_exits
	, page_entrances
	, page_bounces
) from 's3://economist-analytics-euw1-int01/mrd.ga_pagestats/'
 CREDENTIALS 'aws_iam_role=arn:aws:iam::334086281941:role/dev-redshift-copy-unload'
 EMPTYASNULL BZIP2 IGNOREBLANKLINES DELIMITER '|' ACCEPTINVCHARS MAXERROR 10000 COMPUPDATE OFF
;


---------------------------------------------------------------------------------------------------

mar-23
https://s3-eu-west-1.amazonaws.com/economist-analytics-euw1-int01/mrd.ga_events/0000_part_00.bz2

---------------------------------------------------------------------------------------------------
-- copying data from prd to int01.....this is handy
---------------------------------------------------------------------------------------------------
Wed 29-Mar-2017

aws s3 cp 
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/raw/20170329/access-facade.csv.log-201703291490747401-172-16-3-61.gz 
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703051488673801.gz

s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703051488673801.gz



-- cp this transformed version of the raw file.....
aws s3 cp s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/7394034763956956003_502668_access-facade.csv.log-201703291490747401-172-16-3-61.gz/part-r-00000-0433fec0-08ae-454c-8273-d565e6f10def.csv.gz s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703051488673801.gz

-- line above split for easier visibility
aws s3 cp 
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/7394034763956956003_502668_access-facade.csv.log-201703291490747401-172-16-3-61.gz/part-r-00000-0433fec0-08ae-454c-8273-d565e6f10def.csv.gz 
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703051488673801.gz

COPY cbl_marko.economistdotcom.serverlog from 's3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703051488673801.gz'
 CREDENTIALS 'aws_iam_role=arn:aws:iam::334086281941:role/dev-redshift-copy-unload'
 EMPTYASNULL GZIP IGNOREBLANKLINES DELIMITER ',' ACCEPTINVCHARS MAXERROR 10000 COMPUPDATE OFF
;

---------------------------------------------------------------------------------------------------
-- copying data from prd to dev01.....all files in error
---------------------------------------------------------------------------------------------------
1
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/614462288920821528_505566_access-facade.csv.log-201703291490747401-172-16-2-237.gz/part-r-00000-bdf2c469-5f77-4e22-87d8-4f3c5310bf08.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703291490747401-172-16-2-237.gz

2
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/5314633042432338908_505843_access-facade.csv.log-201703291490754602-172-16-3-61.gz/part-r-00000-44209a3e-f48c-4b51-8c93-586bcb1bde82.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703291490754602-172-16-3-61.gz

3
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/2342108984049421528_497243_access-facade.csv.log-201703291490751001-172-16-2-237.gz/part-r-00000-3b1ebe10-40f8-4de4-a239-ca32afd1f562.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703291490751001-172-16-2-237.gz

4
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/2848041677307899229_549797_access-facade.csv.log-201703281490729401-172-16-3-61.gz/part-r-00000-decd8403-dddb-49db-9c1c-e95c9281e341.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490729401-172-16-3-61.gz

5
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/447720708108520860_505626_access-facade.csv.log-201703281490740201-172-16-2-237.gz/part-r-00000-5ea544c7-4d6c-44c5-960d-3189e8c9f6d6.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490740201-172-16-2-237.gz

6
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/6373792502256196270_533397_access-facade.csv.log-201703281490733001-172-16-3-61.gz/part-r-00000-62a00d93-c5db-49c0-8eea-a5b22481ed65.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490733001-172-16-3-61.gz

7
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/393069074756244803_509593_access-facade.csv.log-201703281490743801-172-16-3-61.gz/part-r-00000-e14d2378-793f-4dd7-941c-f64db321d43c.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490743801-172-16-3-61.gz

8
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/5236423643272570381_551628_access-facade.csv.log-201703281490729401-172-16-2-237.gz/part-r-00000-5dd467ea-9b94-460c-80bd-ff505a583d09.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490729401-172-16-2-237.gz

9
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/7512581353324091530_591282_access-facade.csv.log-201703281490718601-172-16-2-237.gz/part-r-00000-5707d414-9b43-443a-a262-cf1bfa3ef23f.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490718601-172-16-2-237.gz

10
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/2593591945414168033_599916_access-facade.csv.log-201703281490715001-172-16-2-237.gz/part-r-00000-ddede4f2-6dda-49fd-8cc2-3e606c42f8a0.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490715001-172-16-2-237.gz

11
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/1491752053551237695_567892_access-facade.csv.log-201703281490722201-172-16-3-61.gz/part-r-00000-ca11bd68-e889-48d7-9b9a-308aa77f6612.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490722201-172-16-3-61.gz

12
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/5427810124078567221_511012_access-facade.csv.log-201703291490754601-172-16-2-237.gz/part-r-00000-248b02b6-5c72-48ec-a3d4-0df1d9a9cd9e.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703291490754601-172-16-2-237.gz

13
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/6007389932608475217_520762_access-facade.csv.log-201703281490736601-172-16-2-237.gz/part-r-00000-cfbc6035-5455-4777-b4ec-5f0ef61730d8.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490736601-172-16-2-237.gz

14
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/6035414977466281051_554312_access-facade.csv.log-201703281490725801-172-16-3-61.gz/part-r-00000-97e9923c-efd6-4152-bd5d-b4f9406ae293.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490725801-172-16-3-61.gz

15
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/7187125511474686021_604377_access-facade.csv.log-201703281490715001-172-16-3-61.gz/part-r-00000-373128a7-38b0-429e-b451-82e2862b824e.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490715001-172-16-3-61.gz

16
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/1018236795272585056_544322_access-facade.csv.log-201703281490725801-172-16-2-237.gz/part-r-00000-6758f7fd-6d58-41fa-b0b8-43d8dbe5565d.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490725801-172-16-2-237.gz

17
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/1290440457004673301_524362_access-facade.csv.log-201703281490736602-172-16-3-61.gz/part-r-00000-ad63a365-97c8-4431-8090-92d354526c05.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490736602-172-16-3-61.gz

18
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/6865112051721471032_554452_access-facade.csv.log-201703281490722201-172-16-2-237.gz/part-r-00000-e1fab2e7-9b33-4779-9426-24026373bd61.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490722201-172-16-2-237.gz

19
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/3532498082753586257_591325_access-facade.csv.log-201703281490718601-172-16-3-61.gz/part-r-00000-dc7bfe32-b735-4bd4-977a-8f4b06bba64d.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490718601-172-16-3-61.gz

20
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/4078259987926949840_531876_access-facade.csv.log-201703281490733001-172-16-2-237.gz/part-r-00000-b02bdacb-0e5b-4769-9bb2-ad3ebd6aebe0.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490733001-172-16-2-237.gz

21
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/8683261620102503026_515096_access-facade.csv.log-201703281490743801-172-16-2-237.gz/part-r-00000-fd9da853-a1d0-4dcb-885d-a95359a54773.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490743801-172-16-2-237.gz

22
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/6436602399041348914_496542_access-facade.csv.log-201703291490751001-172-16-3-61.gz/part-r-00000-121dc00c-0626-43ae-b192-afb88282a9e6.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703291490751001-172-16-3-61.gz

23
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/2851924109997135620_504801_access-facade.csv.log-201703281490740201-172-16-3-61.gz/part-r-00000-5267de26-bb20-49cf-9b8c-c42c5effabda.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490740201-172-16-3-61.gz

24
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/3831665504497356070_607360_access-facade.csv.log-201703281490711401-172-16-3-61.gz/part-r-00000-da6c8787-6898-4a3d-91f0-39171b83ce14.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490711401-172-16-3-61.gz

25
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/4919525063978747199_569302_access-facade.csv.log-201703291490769001-172-16-3-61.gz/part-r-00000-6a44533f-1d09-429b-aa95-c1ddf9e5493f.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703291490769001-172-16-3-61.gz

26
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/4003603058034493426_517281_access-facade.csv.log-201703291490776201-172-16-3-61.gz/part-r-00000-1e2cf57d-a750-4ef1-8822-0e6001cf1501.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703291490776201-172-16-3-61.gz

27
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/7871959957961766510_600302_access-facade.csv.log-201703281490711401-172-16-2-237.gz/part-r-00000-8c56be68-aad2-420e-8167-74145b8948ac.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703281490711401-172-16-2-237.gz

28
aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/1732956697040741893_495873_access-facade.csv.log-201703291490776201-172-16-2-237.gz/part-r-00000-f2ecdc67-1d54-484a-80ec-95dd606bfa9a.csv.gz \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703291490776201-172-16-2-237.gz

---------------------------------------------------------------------------------------------------
-- end of copying data from prd to int01.....this is handy
---------------------------------------------------------------------------------------------------
-- copy all
aws s3 cp s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-28/ s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/

--markod@ip-172-20-0-174:/home/markod/repos/bigdata/redshift/align : aws s3 rm s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/

aws s3 cp \
s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/1732956697040741893_495873_access-facade.csv.log-201703291490776201-172-16-2-237.gz/ \
s3://economist-analytics-euw1-dev01/economistdotcom/serverlog/staging/access-facade.csv.log-201703291490776201-172-16-2-237.gz


aws s3 ls  s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/ | awk -F" *" '{print $3}'

---------------------------------------------------------------------------------------------------
-- script to use for creating the filelist flies from teh s3 buckets to process.....
---------------------------------------------------------------------------------------------------
aws s3 ls  s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-29/ | awk -F" *" '{gsub(/\/$/,""); print $3}' > ~/mdj_s3_filelist_20170329.list

aws s3 ls  s3://economist-analytics-euw1-prd01/economistdotcom/serverlog/archive/loaded/2017-03-30/ | awk -F" *" '{gsub(/\/$/,""); print $3}' > ~/mdj_s3_filelist_20170330.list
 

remove_email(request_uri)	request_uri		VARCHAR(32768)		mdj - increased from varchar(7680)
remove_email(http_referer)	http_referer	VARCHAR(7680)		mdj - increased from varchar(4096)
rvuuid						rvuuid			VARCHAR(4096)		mdj - increased from varchar(256)
http_user_agent				http_user_agent	VARCHAR(1024)		mdj - increased from varchar(512)

---------------------------------------------------------------------------------------------------
-- zstd compression conversion.....existing example
---------------------------------------------------------------------------------------------------
ALTER TABLE economistdotcom.serverlog RENAME TO economistdotcom_serverlog_old;

CREATE TABLE economistdotcom.serverlog
    (
        msec                          TIMESTAMP      ENCODE zstd
      , trace_id                      VARCHAR(256)   ENCODE zstd
      , request_method                VARCHAR(20)    ENCODE zstd
      , request_uri                   VARCHAR(32768) ENCODE zstd
      , status                        BIGINT         ENCODE zstd
      , request_time                  DECIMAL(6,3)   ENCODE zstd
      , body_bytes_sent               VARCHAR(20)    ENCODE zstd
      , http_x_forwarded_for          VARCHAR(256)   ENCODE zstd
      , remote_addr                   VARCHAR(256)   ENCODE zstd
      , http_referer                  VARCHAR(7680)  ENCODE zstd
      , upstream_http_age             VARCHAR(10)    ENCODE zstd
      , upstream_http_x_cache_hits    VARCHAR(10)    ENCODE zstd
      , rvuuid                        VARCHAR(4096)  ENCODE zstd
      , visitorID                     VARCHAR(256)   ENCODE zstd
      , journey                       VARCHAR(256)   ENCODE zstd
      , Column_of_5                   DECIMAL(5,2)   ENCODE zstd
      , bucketjourney                 VARCHAR(256)   ENCODE zstd
      , UAType                        VARCHAR(20)    ENCODE zstd
      , upstream_http_x_geoip_country CHAR(8)        ENCODE zstd
      , upstream_http_x_geoip_region  CHAR(8)        ENCODE zstd
      , http_user_agent               VARCHAR(1024)  ENCODE zstd
      , EXTERNAL_FILE_ID              BIGINT         ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER       BIGINT         ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY (msec)
;
GRANT INSERT ON economistdotcom.serverlog TO copyrole;
GRANT SELECT ON economistdotcom.serverlog TO GROUP readonly;

INSERT INTO economistdotcom.serverlog
SELECT *
  FROM economistdotcom.economistdotcom_serverlog_old
;

DROP TABLE economistdotcom.economistdotcom_serverlog_old;

---------------------------------------------------------------------------------------------------
-- zstd compression conversion.....original code
---------------------------------------------------------------------------------------------------
CREATE TABLE adobe.browser
(id BIGINT ENCODE lzo
,browser VARCHAR(256) ENCODE lzo
,EXTERNAL_FILE_ID BIGINT ENCODE lzo
,EXTERNAL_FILE_ROWNUMBER BIGINT ENCODE lzo
) DISTSTYLE EVEN SORTKEY (id);
GRANT INSERT ON adobe.browser TO copyrole;
GRANT SELECT ON adobe.browser TO GROUP readonly;

00207_recreate_economistdotcom_serverlog.sql

---------------------------------------------------------------------------------------------------
-- 00213_recreate_adobe_browser.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.browser RENAME TO adobe_browser_old;

CREATE TABLE adobe.browser
    (
        id                      BIGINT       ENCODE zstd
      , browser                 VARCHAR(256) ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.browser TO copyrole;
GRANT SELECT ON adobe.browser TO GROUP readonly;

INSERT INTO adobe.browser
SELECT * 
  FROM adobe.adobe_browser_old
;

DROP TABLE adobe.adobe_browser_old;

---------------------------------------------------------------------------------------------------
-- 00213_recreate_adobe_browser_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.browser RENAME TO adobe_browser_old;

CREATE TABLE adobe.browser
    (
        id                      BIGINT       ENCODE lzo
      , browser                 VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.browser TO copyrole;
GRANT SELECT ON adobe.browser TO GROUP readonly;

INSERT INTO adobe.browser
SELECT * 
  FROM adobe.adobe_browser_old
;

DROP TABLE adobe.adobe_browser_old;
---------------------------------------------------------------------------------------------------
-- 00214_recreate_adobe_browser_type.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.browser_type RENAME TO adobe_browser_type_old;

CREATE TABLE adobe.browser_type
    (
        id                      BIGINT       ENCODE zstd
      , browser_type            VARCHAR(256) ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.browser_type TO copyrole;
GRANT SELECT ON adobe.browser_type TO GROUP readonly;

INSERT INTO adobe.browser_type
SELECT * 
  FROM adobe.adobe_browser_type_old
;

DROP TABLE adobe.adobe_browser_type_old;
---------------------------------------------------------------------------------------------------
-- 00214_recreate_adobe_browser_type_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.browser_type RENAME TO adobe_browser_type_old;

CREATE TABLE adobe.browser_type
    (
        id                      BIGINT       ENCODE lzo
      , browser_type            VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.browser_type TO copyrole;
GRANT SELECT ON adobe.browser_type TO GROUP readonly;

INSERT INTO adobe.browser_type
SELECT * 
  FROM adobe.adobe_browser_type_old
;

DROP TABLE adobe.adobe_browser_type_old;

---------------------------------------------------------------------------------------------------
-- 00215_recreate_adobe_color_depth.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.color_depth RENAME TO adobe_color_depth_old;

CREATE TABLE adobe.color_depth
    (
        id                      BIGINT       ENCODE zstd
      , color_depth             VARCHAR(256) ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.color_depth TO copyrole;
GRANT SELECT ON adobe.color_depth TO GROUP readonly;

INSERT INTO adobe.color_depth
SELECT * 
  FROM adobe.adobe_color_depth_old
;

DROP TABLE adobe.adobe_color_depth_old;

---------------------------------------------------------------------------------------------------
-- 00215_recreate_adobe_color_depth_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.color_depth RENAME TO adobe_color_depth_old;

CREATE TABLE adobe.color_depth
    (
    
        id                      BIGINT       ENCODE lzo
      , color_depth             VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.color_depth TO copyrole;
GRANT SELECT ON adobe.color_depth TO GROUP readonly;

INSERT INTO adobe.color_depth
SELECT * 
  FROM adobe.adobe_color_depth_old
;

DROP TABLE adobe.adobe_color_depth_old;

---------------------------------------------------------------------------------------------------
-- 00216_recreate_adobe_connection_type.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.connection_type RENAME TO adobe_connection_type_old;

CREATE TABLE adobe.connection_type
    (
        id                      BIGINT       ENCODE zstd
      , connection_type         VARCHAR(256) ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.connection_type TO copyrole;
GRANT SELECT ON adobe.connection_type TO GROUP readonly;

INSERT INTO adobe.connection_type
SELECT * 
  FROM adobe.adobe_connection_type_old
; 

DROP TABLE adobe.adobe_connection_type_old;

---------------------------------------------------------------------------------------------------
-- 00216_recreate_adobe_connection_type_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.connection_type RENAME TO adobe_connection_type_old;

CREATE TABLE adobe.connection_type
    (
        id                      BIGINT       ENCODE lzo
      , connection_type         VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.connection_type TO copyrole;
GRANT SELECT ON adobe.connection_type TO GROUP readonly;

INSERT INTO adobe.connection_type
SELECT * 
  FROM adobe.adobe_connection_type_old
;

DROP TABLE adobe.adobe_connection_type_old;

---------------------------------------------------------------------------------------------------
-- 00217_recreate_adobe_connection_type.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.country RENAME TO adobe_country_old;

CREATE TABLE adobe.country
    (
        id                      BIGINT       ENCODE zstd
      , country                 VARCHAR(256) ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.country TO copyrole;
GRANT SELECT ON adobe.country TO GROUP readonly;

INSERT INTO adobe.country
SELECT * 
  FROM adobe.adobe_country_old
;

DROP TABLE adobe.adobe_country_old;

---------------------------------------------------------------------------------------------------
-- 00217_recreate_adobe_connection_type_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.country RENAME TO adobe_country_old;

CREATE TABLE adobe.country
    (
        id                      BIGINT       ENCODE lzo
      , country                 VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.country TO copyrole;
GRANT SELECT ON adobe.country TO GROUP readonly;

INSERT INTO adobe.country
SELECT * 
  FROM adobe.adobe_country_old
;

DROP TABLE adobe.adobe_country_old;

---------------------------------------------------------------------------------------------------
-- 00218_recreate_adobe_econdarwinproduction.sql
---------------------------------------------------------------------------------------------------
CREATE TABLE adobe.econdarwinproduction_new
(browser BIGINT ENCODE zstd
        ,browser_height BIGINT ENCODE zstd
        ,browser_width BIGINT ENCODE zstd
        ,campaign VARCHAR(300) ENCODE zstd
        ,carrier VARCHAR(128) ENCODE zstd
        ,click_action VARCHAR(256) ENCODE zstd
        ,click_action_type SMALLINT ENCODE zstd
        ,cookies CHAR(1) ENCODE zstd
        ,country BIGINT ENCODE zstd
        ,ct_connect_type VARCHAR(256) ENCODE zstd
        ,cust_hit_time_gmt TIMESTAMP ENCODE zstd
        ,curr_rate DECIMAL ENCODE zstd
        ,currency VARCHAR(256) ENCODE zstd
        ,cust_visid VARCHAR(256) ENCODE zstd
        ,date_time  TIMESTAMP ENCODE zstd
        ,domain VARCHAR(256) ENCODE zstd
        ,event_list VARCHAR(65535) ENCODE zstd
        ,exclude_hit SMALLINT ENCODE zstd
        ,first_hit_referrer VARCHAR(256) ENCODE zstd
        ,geo_city VARCHAR(256) ENCODE zstd
        ,geo_country VARCHAR(256) ENCODE zstd
        ,geo_dma BIGINT ENCODE zstd
        ,geo_region VARCHAR(256) ENCODE zstd
        ,geo_zip VARCHAR(256) ENCODE zstd
        ,hit_source SMALLINT ENCODE zstd
        ,hit_time_gmt BIGINT ENCODE zstd
        ,hitid_high BIGINT ENCODE zstd
        ,hitid_low BIGINT ENCODE zstd
        ,ip VARCHAR(256) ENCODE zstd
        ,ip2 VARCHAR(256) ENCODE zstd
        ,language BIGINT ENCODE zstd
        ,mobile_id BIGINT ENCODE zstd
        ,new_visit SMALLINT ENCODE zstd
        ,os BIGINT ENCODE zstd
        ,page_event SMALLINT ENCODE zstd
        ,page_event_var1 VARCHAR(65535) ENCODE zstd
        ,page_event_var2 VARCHAR(256) ENCODE zstd
        ,page_event_var3 VARCHAR(65535) ENCODE zstd
        ,pagename VARCHAR(256) ENCODE zstd
        ,page_type VARCHAR(256) ENCODE zstd
        ,page_url VARCHAR(65535) ENCODE zstd
        ,paid_search SMALLINT ENCODE zstd
        ,persistent_cookie CHAR(1) ENCODE zstd
        ,post_campaign VARCHAR(300) ENCODE zstd
        ,post_channel VARCHAR(256) ENCODE zstd
        ,post_cookies CHAR(1) ENCODE zstd
        ,post_currency VARCHAR(256) ENCODE zstd
        ,visitor_id_evar VARCHAR(256) ENCODE zstd
        ,event_type VARCHAR(256) ENCODE zstd
        ,issue_date VARCHAR(256) ENCODE zstd
        ,issue_region VARCHAR(256) ENCODE zstd
        ,story_title VARCHAR(256) ENCODE zstd
        ,ad_region VARCHAR(256) ENCODE zstd
        ,subscriber_type VARCHAR(256) ENCODE zstd
        ,drupal_id INTEGER ENCODE zstd
        ,delivery_method VARCHAR(256) ENCODE zstd
        ,product_id VARCHAR(256) ENCODE zstd
        ,referring_subdomain VARCHAR(256) ENCODE zstd
        ,hour_of_day VARCHAR(256) ENCODE zstd
        ,app_id VARCHAR(256) ENCODE zstd
        ,device_vendor_id VARCHAR(256) ENCODE zstd
        ,device_name VARCHAR(256) ENCODE zstd
        ,os_version VARCHAR(256) ENCODE zstd
        ,adload_adexit VARCHAR(256) ENCODE zstd
        ,connection_type VARCHAR(256) ENCODE zstd
        ,post_event_list VARCHAR(65535) ENCODE zstd
        ,post_hier1 VARCHAR(256) ENCODE zstd
        ,post_hier2 VARCHAR(256) ENCODE zstd
        ,post_hier3 VARCHAR(256) ENCODE zstd
        ,post_hier4 VARCHAR(256) ENCODE zstd
        ,post_hier5 VARCHAR(256) ENCODE zstd
        ,post_keywords VARCHAR(256) ENCODE zstd
        ,post_page_event SMALLINT ENCODE zstd
        ,post_page_event_var1 VARCHAR(256) ENCODE zstd
        ,post_page_event_var2 VARCHAR(256) ENCODE zstd
        ,post_page_event_var3 VARCHAR(65535) ENCODE zstd
        ,post_page_url VARCHAR(256) ENCODE zstd
        ,post_pagename VARCHAR(256) ENCODE zstd
        ,post_pagename_no_url VARCHAR(256) ENCODE zstd
        ,post_partner_plugins VARCHAR(256) ENCODE zstd
        ,post_persistent_cookie CHAR(1) ENCODE zstd
        ,post_product_list VARCHAR(65535) ENCODE zstd
        ,post_purchaseid VARCHAR(256) ENCODE zstd
        ,post_referrer VARCHAR(256) ENCODE zstd
        ,post_search_engine BIGINT ENCODE zstd
        ,post_state VARCHAR(256) ENCODE zstd
        ,post_survey VARCHAR(65535) ENCODE zstd
        ,post_t_time_info VARCHAR(256) ENCODE zstd
        ,prev_page BIGINT ENCODE zstd
        ,product_list VARCHAR(65535) ENCODE zstd
        ,purchase_id VARCHAR(256) ENCODE zstd
        ,ref_domain VARCHAR(256) ENCODE zstd
        ,ref_type SMALLINT ENCODE zstd
        ,referrer VARCHAR(256) ENCODE zstd
        ,s_resolution VARCHAR(256) ENCODE zstd
        ,sampled_hit VARCHAR(256) ENCODE zstd
        ,search_engine BIGINT ENCODE zstd
        ,search_page_num BIGINT ENCODE zstd
        ,secondary_hit SMALLINT ENCODE zstd
        ,service VARCHAR(256) ENCODE zstd
        ,state VARCHAR(256) ENCODE zstd
        ,stats_server VARCHAR(256) ENCODE zstd
        ,t_time_info VARCHAR(256) ENCODE zstd
        ,visid_high BIGINT ENCODE zstd
        ,visid_low BIGINT ENCODE zstd
        ,visid_new CHAR(1) ENCODE zstd
        ,visid_timestamp TIMESTAMP ENCODE zstd
        ,visid_type SMALLINT ENCODE zstd
        ,visit_keywords VARCHAR(256) ENCODE zstd
        ,visit_num BIGINT ENCODE zstd
        ,visit_referrer VARCHAR(256) ENCODE zstd
        ,visit_search_engine VARCHAR(256) ENCODE zstd
        ,visit_start_page_url VARCHAR(256) ENCODE zstd
        ,visit_start_pagename VARCHAR(256) ENCODE zstd
        ,visit_start_time_gmt TIMESTAMP ENCODE zstd
        ,accept_language VARCHAR(384) ENCODE zstd
        ,source VARCHAR(16) ENCODE zstd
        ,region VARCHAR(15) ENCODE zstd
        ,visitor_id varchar(256) ENCODE zstd
        ,visit_id VARCHAR(256) ENCODE zstd
        ,valid_user INTEGER ENCODE zstd
        ,valid_view INTEGER ENCODE zstd
        ,valid_visit INTEGER ENCODE zstd
        ,event_id_partition_key VARCHAR(87) ENCODE zstd
        ,hit_week TIMESTAMP ENCODE zstd
        ,subscription_page_new INTEGER ENCODE zstd
        ,subscription_new INTEGER ENCODE zstd
        ,teg_hit_local_datetime TIMESTAMP ENCODE zstd
        ,teg_hit_gmt_datetime TIMESTAMP ENCODE zstd
        ,teg_hit_timezone_offset INTEGER ENCODE zstd
        ,drupal_or_visitor_id VARCHAR(256) ENCODE zstd
        ,EXTERNAL_FILE_ID BIGINT ENCODE zstd
        ,EXTERNAL_FILE_ROWNUMBER BIGINT ENCODE zstd
) DISTKEY (drupal_or_visitor_id) SORTKEY (teg_hit_local_datetime);

set wlm_query_slot_count to 8;

INSERT INTO adobe.econdarwinproduction_new
SELECT * FROM adobe.econdarwinproduction;

ALTER TABLE adobe.econdarwinproduction RENAME TO econdarwinproduction_oldb;
ALTER TABLE adobe.econdarwinproduction_new RENAME TO econdarwinproduction;

GRANT INSERT ON adobe.econdarwinproduction TO copyrole;
GRANT SELECT ON adobe.econdarwinproduction TO GROUP readonly;

CREATE OR REPLACE VIEW adobe.combined
(
  accept_language,
  ad_impressions,
  ad_impresson,
  ad_load_exit,
  ad_region,
  ad_viewed_clicked,
  adload_adexit,
  advu_mpu,
  advu_mpu_prop,
  amstelnet_order_id,
  app_advertising_id,
  app_id,
  app_id_prop,
  app_name,
  app_rating,
  app_rating_prop,
  article_published_date,
  article_publishing,
  audio,
  audio_progress,
  audio_segment,
  br_camp_cid1_fst_click,
  br_camp_cid1_linear,
  br_camp_cid1_lst_click,
  br_camp_cid2_fst_click,
  br_camp_cid2_linear,
  br_camp_cid2_lst_click,
  browser,
  browser_height,
  browser_width,
  bulk_ip_address,
  campaign,
  campaign_attribution,
  campaign_attribution_owned_earned,
  campaign_attribution_paid,
  campaign_stacking_all,
  campaign_tracking,
  carrier,
  channel,
  click_action,
  click_action_type,
  click_tag,
  code_ver,
  connection_type,
  connection_type_prop,
  content_category,
  content_region,
  content_region_prop,
  content_source,
  content_type,
  cookies,
  country,
  country_residence,
  ct_connect_type,
  curr_factor,
  curr_rate,
  currency,
  cust_hit_time_gmt,
  cust_type_prod,
  cust_visid,
  customer_lifecycle,
  date_day_weektype,
  date_time,
  delivery_method,
  device_advertising_id,
  device_id,
  device_id_prop,
  device_name,
  device_type,
  device_type_prop,
  device_vendor_id,
  dfp_ad_id,
  dfp_site,
  dfp_zone,
  director_donor,
  domain,
  drupal_id,
  duplicate_events,
  duplicate_purchase,
  editors_pick_download,
  editors_pick_download_counter,
  editors_pick_download_prop,
  error_code,
  error_message,
  essay_section,
  event_id_partition_key,
  event_list,
  event_type,
  exclude_hit,
  facebook_widget_activity,
  fb_twitter_activity,
  first_hit_page_url,
  first_hit_pagename,
  first_hit_referrer,
  first_hit_time_gmt,
  form_name_field,
  form_sub_name,
  geo_city,
  geo_country,
  geo_dma,
  geo_region,
  geo_zip,
  google_play_subscriptions,
  grapeshot_value,
  hier1,
  hit_source,
  hit_time_gmt,
  hit_week,
  hitid_high,
  hitid_low,
  hour_of_day,
  int_sub_ads_first_click,
  int_sub_ads_last_click,
  internal_link,
  internal_link_external,
  ip,
  ip2,
  issue_date,
  issue_id,
  issue_region,
  key_interactions,
  key_interactions_pay_barrier_tracking,
  language,
  last_hit_time_gmt,
  last_purchase_num,
  last_purchase_time_gmt,
  link_name,
  link_page,
  loggedin,
  loggedin_prop,
  maximiser_campaign,
  mcvisid,
  meta_name,
  mobile_id,
  muls_subscription_type,
  multiuser_usage,
  navigated_by,
  navigated_by_prop,
  new_visit,
  newsletter_signup_from_reg,
  orientation,
  orientation_prop,
  os,
  os_version,
  page_event,
  page_event_var1,
  page_event_var2,
  page_event_var3,
  page_name,
  page_share_link,
  page_site_id,
  page_type,
  page_url,
  page_video_play,
  page_view,
  pagename,
  paid_free,
  paid_free_prop,
  paid_search,
  partner_referrals,
  payment_type,
  persistent_cookie,
  pointofinterest,
  pointofinterestdistance,
  post_ad_load_exit,
  post_campaign,
  post_channel,
  post_cookies,
  post_currency,
  post_event_list,
  post_hier1,
  post_hier2,
  post_hier3,
  post_hier4,
  post_hier5,
  post_java_enabled,
  post_keywords,
  post_mobileappid,
  post_mobiledayofweek,
  post_mobiledayssincefirstuse,
  post_mobiledayssincelastuse,
  post_mobiledevice,
  post_mobilehourofday,
  post_mobileinstalldate,
  post_mobilelaunchnumber,
  post_mobileosversion,
  post_mobileresolution,
  post_page_event,
  post_page_event_var1,
  post_page_event_var2,
  post_page_event_var3,
  post_page_url,
  post_pagename,
  post_pagename_no_url,
  post_partner_plugins,
  post_persistent_cookie,
  post_pointofinterest,
  post_pointofinterestdistance,
  post_product_list,
  post_purchaseid,
  post_referrer,
  post_search_engine,
  post_state,
  post_survey,
  post_t_time_info,
  post_zip,
  prev_page,
  product_id,
  product_list,
  promo_code,
  prop_article_published_date,
  prop_cust_type_prod,
  prop_drupal_id,
  prop_story_title,
  prop_user_login_status,
  purchase_id,
  purchaseid,
  ref_domain,
  ref_type,
  referrer,
  referring_subdomain,
  region,
  region_served,
  registration,
  renewal_start_end_date,
  revamp_tracking,
  s_resolution,
  sampled_hit,
  search_engine,
  search_page_num,
  search_results,
  secondary_hit,
  service,
  share_type,
  share_type_prop,
  sharelink,
  source,
  state,
  stats_server,
  story_title,
  story_title_prop,
  sub_data_protection,
  sub_date_end,
  sub_expiration,
  sub_length,
  sub_login_reg_activities,
  sub_start_date,
  sublength,
  subscriber_type,
  subscriber_type_prop,
  subscription_new,
  subscription_page_new,
  subscription_page_renew,
  subscription_renew,
  subscription_term_google_play,
  subsection,
  t_time_info,
  teg_hit_gmt_datetime,
  teg_hit_local_datetime,
  teg_hit_timezone_offset,
  template,
  template_type,
  ub_form_abandonment,
  ub_offer_country,
  ub_product_code,
  ub_sub,
  url,
  user_agent,
  user_agent_evar,
  user_agent_prop,
  user_login_status,
  userid,
  username,
  valid_user,
  valid_view,
  valid_visit,
  video_play,
  video_segment,
  video_tags,
  video_tags_prop,
  videos,
  videos_formatted,
  visid_high,
  visid_low,
  visid_new,
  visid_timestamp,
  visid_type,
  visit_id,
  visit_keywords,
  visit_num,
  visit_number_new_repeat,
  visit_page_num,
  visit_referrer,
  visit_search_engine,
  visit_start_page_url,
  visit_start_pagename,
  visitor_id,
  visitor_id_evar,
  week_type,
  drupal_or_visitor_id,
  external_file_id,
  external_file_rownumber
)
AS
( SELECT economistcomprod.accept_language,
NULL::"unknown" AS ad_impressions,
NULL::"unknown" AS ad_impresson,
NULL::"unknown" AS ad_load_exit,
NULL::"unknown" AS ad_region,
economistcomprod.ad_viewed_clicked,
NULL::"unknown" AS adload_adexit,
economistcomprod.advu_mpu,
economistcomprod.advu_mpu_prop,
economistcomprod.amstelnet_order_id,
NULL::"unknown" AS app_advertising_id,
NULL::"unknown" AS app_id,
NULL::"unknown" AS app_id_prop,
NULL::"unknown" AS app_name,
NULL::"unknown" AS app_rating,
NULL::"unknown" AS app_rating_prop,
economistcomprod.article_published_date,
economistcomprod.article_publishing,
economistcomprod.audio,
NULL::"unknown" AS audio_progress,
NULL::"unknown" AS audio_segment,
economistcomprod.br_camp_cid1_fst_click,
economistcomprod.br_camp_cid1_linear,
economistcomprod.br_camp_cid1_lst_click,
economistcomprod.br_camp_cid2_fst_click,
economistcomprod.br_camp_cid2_linear,
economistcomprod.br_camp_cid2_lst_click,
economistcomprod.browser,
economistcomprod.browser_height,
economistcomprod.browser_width,
economistcomprod.bulk_ip_address,
economistcomprod.campaign,
economistcomprod.campaign_attribution,
economistcomprod.campaign_attribution_owned_earned,
economistcomprod.campaign_attribution_paid,
economistcomprod.campaign_stacking_all,
economistcomprod.campaign_tracking,
NULL::"unknown" AS carrier,
economistcomprod.channel,
economistcomprod.click_action,
economistcomprod.click_action_type,
economistcomprod.click_tag,
NULL::"unknown" AS code_ver,
NULL::"unknown" AS connection_type,
NULL::"unknown" AS connection_type_prop,
economistcomprod.content_category,
NULL::"unknown" AS content_region,
NULL::"unknown" AS content_region_prop,
NULL::"unknown" AS content_source,
economistcomprod.content_type,
NULL::"unknown" AS cookies,
NULL::"unknown" AS country,
NULL::"unknown" AS country_residence,
economistcomprod.ct_connect_type,
economistcomprod.curr_factor,
economistcomprod.curr_rate,
economistcomprod.currency,
NULL::"unknown" AS cust_hit_time_gmt,
economistcomprod.cust_type_prod,
NULL::"unknown" AS cust_visid,
economistcomprod.customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
economistcomprod.date_time,
NULL::"unknown" AS delivery_method,
NULL::"unknown" AS device_advertising_id,
NULL::"unknown" AS device_id,
NULL::"unknown" AS device_id_prop,
NULL::"unknown" AS device_name,
NULL::"unknown" AS device_type,
NULL::"unknown" AS device_type_prop,
NULL::"unknown" AS device_vendor_id,
economistcomprod.dfp_ad_id,
economistcomprod.dfp_site,
economistcomprod.dfp_zone,
economistcomprod.director_donor,
economistcomprod."domain",
economistcomprod.drupal_id,
NULL::"unknown" AS duplicate_events,
NULL::"unknown" AS duplicate_purchase,
NULL::"unknown" AS editors_pick_download,
NULL::"unknown" AS editors_pick_download_counter,
NULL::"unknown" AS editors_pick_download_prop,
economistcomprod.error_code,
economistcomprod.error_message,
economistcomprod.essay_section,
economistcomprod.event_id_partition_key,
NULL::"unknown" AS event_list,
NULL::"unknown" AS event_type,
economistcomprod.exclude_hit,
economistcomprod.facebook_widget_activity,
economistcomprod.fb_twitter_activity,
economistcomprod.first_hit_page_url,
economistcomprod.first_hit_pagename,
economistcomprod.first_hit_referrer,
economistcomprod.first_hit_time_gmt,
economistcomprod.form_name_field,
economistcomprod.form_sub_name,
economistcomprod.geo_city,
economistcomprod.geo_country,
economistcomprod.geo_dma,
economistcomprod.geo_region,
economistcomprod.geo_zip,
NULL::"unknown" AS google_play_subscriptions,
economistcomprod.grapeshot_value,
economistcomprod.hier1,
economistcomprod.hit_source,
economistcomprod.hit_time_gmt,
economistcomprod.hit_week,
economistcomprod.hitid_high,
economistcomprod.hitid_low,
economistcomprod.hour_of_day,
economistcomprod.int_sub_ads_first_click,
economistcomprod.int_sub_ads_last_click,
economistcomprod.internal_link,
economistcomprod.internal_link_external,
economistcomprod.ip,
economistcomprod.ip2,
economistcomprod.issue_date,
NULL::"unknown" AS issue_id,
NULL::"unknown" AS issue_region,
economistcomprod.key_interactions,
economistcomprod.key_interactions_pay_barrier_tracking,
economistcomprod."language",
economistcomprod.last_hit_time_gmt,
economistcomprod.last_purchase_num,
NULL::"unknown" AS last_purchase_time_gmt,
economistcomprod.link_name,
NULL::"unknown" AS link_page,
NULL::"unknown" AS loggedin,
NULL::"unknown" AS loggedin_prop,
economistcomprod.maximiser_campaign,
NULL::"unknown" AS mcvisid,
economistcomprod.meta_name,
economistcomprod.mobile_id,
economistcomprod.muls_subscription_type,
economistcomprod.multiuser_usage,
NULL::"unknown" AS navigated_by,
NULL::"unknown" AS navigated_by_prop,
economistcomprod.new_visit,
economistcomprod.newsletter_signup_from_reg,
NULL::"unknown" AS orientation,
NULL::"unknown" AS orientation_prop,
economistcomprod.os,
NULL::"unknown" AS os_version,
economistcomprod.page_event,
economistcomprod.page_event_var1,
NULL::"unknown" AS page_event_var2,
NULL::"unknown" AS page_event_var3,
economistcomprod.page_name,
economistcomprod.page_share_link,
economistcomprod.page_site_id,
economistcomprod.page_type,
NULL::"unknown" AS page_url,
economistcomprod.page_video_play,
NULL::"unknown" AS page_view,
NULL::"unknown" AS pagename,
NULL::"unknown" AS paid_free,
NULL::"unknown" AS paid_free_prop,
economistcomprod.paid_search,
economistcomprod.partner_referrals,
economistcomprod.payment_type,
economistcomprod.persistent_cookie,
NULL::"unknown" AS pointofinterest,
NULL::"unknown" AS pointofinterestdistance,
NULL::"unknown" AS post_ad_load_exit,
economistcomprod.post_campaign,
economistcomprod.post_channel,
economistcomprod.post_cookies,
economistcomprod.post_currency,
economistcomprod.post_event_list,
economistcomprod.post_hier1,
economistcomprod.post_hier2,
economistcomprod.post_hier3,
economistcomprod.post_hier4,
economistcomprod.post_hier5,
NULL::"unknown" AS post_java_enabled,
economistcomprod.post_keywords,
NULL::"unknown" AS post_mobileappid,
NULL::"unknown" AS post_mobiledayofweek,
NULL::"unknown" AS post_mobiledayssincefirstuse,
NULL::"unknown" AS post_mobiledayssincelastuse,
NULL::"unknown" AS post_mobiledevice,
NULL::"unknown" AS post_mobilehourofday,
NULL::"unknown" AS post_mobileinstalldate,
NULL::"unknown" AS post_mobilelaunchnumber,
NULL::"unknown" AS post_mobileosversion,
NULL::"unknown" AS post_mobileresolution,
economistcomprod.post_page_event,
economistcomprod.post_page_event_var1,
NULL::"unknown" AS post_page_event_var2,
NULL::"unknown" AS post_page_event_var3,
economistcomprod.post_page_url,
economistcomprod.post_pagename,
economistcomprod.post_pagename_no_url,
economistcomprod.post_partner_plugins,
NULL::"unknown" AS post_persistent_cookie,
NULL::"unknown" AS post_pointofinterest,
NULL::"unknown" AS post_pointofinterestdistance,
economistcomprod.post_product_list,
economistcomprod.post_purchaseid,
economistcomprod.post_referrer,
economistcomprod.post_search_engine,
economistcomprod.post_state,
economistcomprod.post_survey,
economistcomprod.post_t_time_info,
NULL::"unknown" AS post_zip,
economistcomprod.prev_page,
NULL::"unknown" AS product_id,
economistcomprod.product_list,
economistcomprod.promo_code,
economistcomprod.prop_article_published_date,
economistcomprod.prop_cust_type_prod,
economistcomprod.prop_drupal_id,
economistcomprod.prop_story_title,
economistcomprod.prop_user_login_status,
NULL::"unknown" AS purchase_id,
economistcomprod.purchaseid,
economistcomprod.ref_domain,
economistcomprod.ref_type,
economistcomprod.referrer,
economistcomprod.referring_subdomain,
economistcomprod."region",
economistcomprod.region_served,
economistcomprod.registration,
economistcomprod.renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
economistcomprod.s_resolution,
NULL::"unknown" AS sampled_hit,
economistcomprod.search_engine,
economistcomprod.search_page_num,
economistcomprod.search_results,
NULL::"unknown" AS secondary_hit,
economistcomprod.service,
NULL::"unknown" AS share_type,
NULL::"unknown" AS share_type_prop,
economistcomprod.sharelink,
economistcomprod.source,
economistcomprod.state,
economistcomprod.stats_server,
economistcomprod.story_title,
NULL::"unknown" AS story_title_prop,
economistcomprod.sub_data_protection,
economistcomprod.sub_date_end,
economistcomprod.sub_expiration,
economistcomprod.sub_length,
economistcomprod.sub_login_reg_activities,
economistcomprod.sub_start_date,
economistcomprod.sublength,
NULL::"unknown" AS subscriber_type,
NULL::"unknown" AS subscriber_type_prop,
economistcomprod.subscription_new,
economistcomprod.subscription_page_new,
economistcomprod.subscription_page_renew,
economistcomprod.subscription_renew,
NULL::"unknown" AS subscription_term_google_play,
economistcomprod.subsection,
economistcomprod.t_time_info,
economistcomprod.teg_hit_gmt_datetime,
economistcomprod.teg_hit_local_datetime,
economistcomprod.teg_hit_timezone_offset,
NULL::"unknown" AS "template",
NULL::"unknown" AS template_type,
economistcomprod.ub_form_abandonment,
economistcomprod.ub_offer_country,
economistcomprod.ub_product_code,
economistcomprod.ub_sub,
economistcomprod.url,
NULL::"unknown" AS user_agent,
NULL::"unknown" AS user_agent_evar,
NULL::"unknown" AS user_agent_prop,
economistcomprod.user_login_status,
economistcomprod.userid,
economistcomprod.username,
economistcomprod.valid_user,
economistcomprod.valid_view,
economistcomprod.valid_visit,
economistcomprod.video_play,
economistcomprod.video_segment,
economistcomprod.video_tags,
economistcomprod.video_tags_prop,
economistcomprod.videos,
economistcomprod.videos_formatted,
NULL::"unknown" AS visid_high,
NULL::"unknown" AS visid_low,
NULL::"unknown" AS visid_new,
economistcomprod.visid_timestamp,
economistcomprod.visid_type,
economistcomprod.visit_id,
economistcomprod.visit_keywords,
economistcomprod.visit_num,
economistcomprod.visit_number_new_repeat,
economistcomprod.visit_page_num,
economistcomprod.visit_referrer,
economistcomprod.visit_search_engine,
economistcomprod.visit_start_page_url,
economistcomprod.visit_start_pagename,
economistcomprod.visitor_id,
NULL::"unknown" AS visitor_id_evar,
economistcomprod.week_type,
economistcomprod.drupal_or_visitor_id,
economistcomprod.external_file_id,
economistcomprod.external_file_rownumber
   FROM adobe.economistcomprod
UNION ALL
 SELECT econprodappipad.accept_language,
econprodappipad.ad_impressions,
econprodappipad.ad_impresson,
econprodappipad.ad_load_exit,
NULL::"unknown" AS ad_region,
NULL::"unknown" AS ad_viewed_clicked,
NULL::"unknown" AS adload_adexit,
NULL::"unknown" AS advu_mpu,
NULL::"unknown" AS advu_mpu_prop,
NULL::"unknown" AS amstelnet_order_id,
econprodappipad.app_advertising_id,
econprodappipad.app_id,
econprodappipad.app_id_prop,
econprodappipad.app_name,
econprodappipad.app_rating,
econprodappipad.app_rating_prop,
NULL::"unknown" AS article_published_date,
NULL::"unknown" AS article_publishing,
NULL::"unknown" AS audio,
econprodappipad.audio_progress,
econprodappipad.audio_segment,
NULL::"unknown" AS br_camp_cid1_fst_click,
NULL::"unknown" AS br_camp_cid1_linear,
NULL::"unknown" AS br_camp_cid1_lst_click,
NULL::"unknown" AS br_camp_cid2_fst_click,
NULL::"unknown" AS br_camp_cid2_linear,
NULL::"unknown" AS br_camp_cid2_lst_click,
econprodappipad.browser::character varying(256) AS browser,
econprodappipad.browser_height::character varying(256) AS browser_height,
econprodappipad.browser_width,
NULL::"unknown" AS bulk_ip_address,
econprodappipad.campaign,
NULL::"unknown" AS campaign_attribution,
NULL::"unknown" AS campaign_attribution_owned_earned,
NULL::"unknown" AS campaign_attribution_paid,
NULL::"unknown" AS campaign_stacking_all,
NULL::"unknown" AS campaign_tracking,
econprodappipad.carrier,
econprodappipad.channel,
NULL::"unknown" AS click_action,
NULL::"unknown" AS click_action_type,
NULL::"unknown" AS click_tag,
econprodappipad.code_ver,
econprodappipad.connection_type,
econprodappipad.connection_type_prop,
NULL::"unknown" AS content_category,
econprodappipad.content_region,
econprodappipad.content_region_prop,
NULL::"unknown" AS content_source,
NULL::"unknown" AS content_type,
econprodappipad.cookies,
econprodappipad.country,
econprodappipad.country_residence,
econprodappipad.ct_connect_type,
NULL::"unknown" AS curr_factor,
econprodappipad.curr_rate,
econprodappipad.currency,
econprodappipad.cust_hit_time_gmt,
NULL::"unknown" AS cust_type_prod,
NULL::"unknown" AS cust_visid,
NULL::"unknown" AS customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
econprodappipad.date_time,
NULL::"unknown" AS delivery_method,
econprodappipad.device_advertising_id,
econprodappipad.device_id,
econprodappipad.device_id_prop,
NULL::"unknown" AS device_name,
econprodappipad.device_type,
econprodappipad.device_type_prop,
NULL::"unknown" AS device_vendor_id,
NULL::"unknown" AS dfp_ad_id,
NULL::"unknown" AS dfp_site,
NULL::"unknown" AS dfp_zone,
NULL::"unknown" AS director_donor,
econprodappipad."domain",
econprodappipad.drupal_id,
econprodappipad.duplicate_events,
econprodappipad.duplicate_purchase,
econprodappipad.editors_pick_download,
econprodappipad.editors_pick_download_counter,
econprodappipad.editors_pick_download_prop,
econprodappipad.error_code,
econprodappipad.error_message,
NULL::"unknown" AS essay_section,
econprodappipad.event_id_partition_key,
econprodappipad.event_list,
NULL::"unknown" AS event_type,
econprodappipad.exclude_hit,
NULL::"unknown" AS facebook_widget_activity,
NULL::"unknown" AS fb_twitter_activity,
econprodappipad.first_hit_page_url,
econprodappipad.first_hit_pagename,
econprodappipad.first_hit_referrer,
econprodappipad.first_hit_time_gmt,
NULL::"unknown" AS form_name_field,
NULL::"unknown" AS form_sub_name,
econprodappipad.geo_city,
econprodappipad.geo_country,
econprodappipad.geo_dma,
econprodappipad.geo_region,
econprodappipad.geo_zip,
econprodappipad.google_play_subscriptions,
NULL::"unknown" AS grapeshot_value,
NULL::"unknown" AS hier1,
econprodappipad.hit_source,
NULL::"unknown" AS hit_time_gmt,
econprodappipad.hit_week,
econprodappipad.hitid_high,
econprodappipad.hitid_low,
NULL::"unknown" AS hour_of_day,
NULL::"unknown" AS int_sub_ads_first_click,
NULL::"unknown" AS int_sub_ads_last_click,
NULL::"unknown" AS internal_link,
NULL::"unknown" AS internal_link_external,
econprodappipad.ip,
econprodappipad.ip2,
econprodappipad.issue_date,
econprodappipad.issue_id,
NULL::"unknown" AS issue_region,
NULL::"unknown" AS key_interactions,
NULL::"unknown" AS key_interactions_pay_barrier_tracking,
econprodappipad."language",
NULL::"unknown" AS last_hit_time_gmt,
NULL::"unknown" AS last_purchase_num,
econprodappipad.last_purchase_time_gmt,
NULL::"unknown" AS link_name,
econprodappipad.link_page,
econprodappipad.loggedin,
econprodappipad.loggedin_prop,
NULL::"unknown" AS maximiser_campaign,
econprodappipad.mcvisid,
NULL::"unknown" AS meta_name,
econprodappipad.mobile_id,
NULL::"unknown" AS muls_subscription_type,
NULL::"unknown" AS multiuser_usage,
econprodappipad.navigated_by,
econprodappipad.navigated_by_prop,
econprodappipad.new_visit,
NULL::"unknown" AS newsletter_signup_from_reg,
econprodappipad.orientation,
econprodappipad.orientation_prop,
econprodappipad.os,
NULL::"unknown" AS os_version,
NULL::"unknown" AS page_event,
NULL::"unknown" AS page_event_var1,
NULL::"unknown" AS page_event_var2,
NULL::"unknown" AS page_event_var3,
NULL::"unknown" AS page_name,
NULL::"unknown" AS page_share_link,
NULL::"unknown" AS page_site_id,
NULL::"unknown" AS page_type,
NULL::"unknown" AS page_url,
NULL::"unknown" AS page_video_play,
econprodappipad.page_view,
econprodappipad.pagename,
econprodappipad.paid_free,
econprodappipad.paid_free_prop,
econprodappipad.paid_search,
NULL::"unknown" AS partner_referrals,
NULL::"unknown" AS payment_type,
econprodappipad.persistent_cookie,
econprodappipad.pointofinterest,
econprodappipad.pointofinterestdistance,
econprodappipad.post_ad_load_exit,
econprodappipad.post_campaign,
econprodappipad.post_channel,
econprodappipad.post_cookies,
econprodappipad.post_currency,
econprodappipad.post_event_list,
NULL::"unknown" AS post_hier1,
NULL::"unknown" AS post_hier2,
NULL::"unknown" AS post_hier3,
NULL::"unknown" AS post_hier4,
NULL::"unknown" AS post_hier5,
econprodappipad.post_java_enabled,
econprodappipad.post_keywords,
econprodappipad.post_mobileappid,
econprodappipad.post_mobiledayofweek,
econprodappipad.post_mobiledayssincefirstuse,
econprodappipad.post_mobiledayssincelastuse,
econprodappipad.post_mobiledevice,
econprodappipad.post_mobilehourofday,
econprodappipad.post_mobileinstalldate,
econprodappipad.post_mobilelaunchnumber,
econprodappipad.post_mobileosversion,
econprodappipad.post_mobileresolution,
econprodappipad.post_page_event::character varying(255) AS post_page_event,
NULL::"unknown" AS post_page_event_var1,
NULL::"unknown" AS post_page_event_var2,
NULL::"unknown" AS post_page_event_var3,
NULL::"unknown" AS post_page_url,
econprodappipad.post_pagename,
econprodappipad.post_pagename_no_url,
NULL::"unknown" AS post_partner_plugins,
econprodappipad.post_persistent_cookie,
econprodappipad.post_pointofinterest,
econprodappipad.post_pointofinterestdistance,
econprodappipad.post_product_list,
econprodappipad.post_purchaseid,
NULL::"unknown" AS post_referrer,
econprodappipad.post_search_engine,
econprodappipad.post_state,
econprodappipad.post_survey,
econprodappipad.post_t_time_info,
econprodappipad.post_zip,
econprodappipad.prev_page,
NULL::"unknown" AS product_id,
econprodappipad.product_list,
NULL::"unknown" AS promo_code,
NULL::"unknown" AS prop_article_published_date,
NULL::"unknown" AS prop_cust_type_prod,
NULL::"unknown" AS prop_drupal_id,
NULL::"unknown" AS prop_story_title,
NULL::"unknown" AS prop_user_login_status,
NULL::"unknown" AS purchase_id,
econprodappipad.purchaseid,
NULL::"unknown" AS ref_domain,
NULL::"unknown" AS ref_type,
NULL::"unknown" AS referrer,
NULL::"unknown" AS referring_subdomain,
econprodappipad."region",
NULL::"unknown" AS region_served,
NULL::"unknown" AS registration,
NULL::"unknown" AS renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
econprodappipad.s_resolution,
econprodappipad.sampled_hit,
econprodappipad.search_engine,
econprodappipad.search_page_num,
NULL::"unknown" AS search_results,
econprodappipad.secondary_hit,
econprodappipad.service,
econprodappipad.share_type,
econprodappipad.share_type_prop,
NULL::"unknown" AS sharelink,
econprodappipad.source,
econprodappipad.state,
econprodappipad.stats_server,
econprodappipad.story_title,
econprodappipad.story_title_prop,
NULL::"unknown" AS sub_data_protection,
NULL::"unknown" AS sub_date_end,
NULL::"unknown" AS sub_expiration,
NULL::"unknown" AS sub_length,
NULL::"unknown" AS sub_login_reg_activities,
NULL::"unknown" AS sub_start_date,
NULL::"unknown" AS sublength,
econprodappipad.subscriber_type,
econprodappipad.subscriber_type_prop,
econprodappipad.subscription_new,
econprodappipad.subscription_page_new,
NULL::"unknown" AS subscription_page_renew,
NULL::"unknown" AS subscription_renew,
econprodappipad.subscription_term_google_play,
NULL::"unknown" AS subsection,
econprodappipad.t_time_info,
econprodappipad.teg_hit_gmt_datetime,
econprodappipad.teg_hit_local_datetime,
econprodappipad.teg_hit_timezone_offset,
econprodappipad."template",
econprodappipad.template_type,
NULL::"unknown" AS ub_form_abandonment,
NULL::"unknown" AS ub_offer_country,
NULL::"unknown" AS ub_product_code,
NULL::"unknown" AS ub_sub,
NULL::"unknown" AS url,
econprodappipad.user_agent,
econprodappipad.user_agent_evar,
econprodappipad.user_agent_prop,
NULL::"unknown" AS user_login_status,
NULL::"unknown" AS userid,
NULL::"unknown" AS username,
econprodappipad.valid_user,
econprodappipad.valid_view,
econprodappipad.valid_visit,
NULL::"unknown" AS video_play,
NULL::"unknown" AS video_segment,
NULL::"unknown" AS video_tags,
NULL::"unknown" AS video_tags_prop,
NULL::"unknown" AS videos,
NULL::"unknown" AS videos_formatted,
econprodappipad.visid_high,
econprodappipad.visid_low,
econprodappipad.visid_new,
econprodappipad.visid_timestamp,
econprodappipad.visid_type,
econprodappipad.visit_id,
econprodappipad.visit_keywords,
econprodappipad.visit_num,
NULL::"unknown" AS visit_number_new_repeat,
NULL::"unknown" AS visit_page_num,
econprodappipad.visit_referrer,
econprodappipad.visit_search_engine,
NULL::"unknown" AS visit_start_page_url,
econprodappipad.visit_start_pagename,
econprodappipad.visitor_id,
NULL::"unknown" AS visitor_id_evar,
NULL::"unknown" AS week_type,
econprodappipad.drupal_or_visitor_id,
econprodappipad.external_file_id,
econprodappipad.external_file_rownumber
   FROM adobe.econprodappipad)
UNION ALL
 SELECT econdarwinproduction.accept_language,
NULL::"unknown" AS ad_impressions,
NULL::"unknown" AS ad_impresson,
NULL::"unknown" AS ad_load_exit,
econdarwinproduction.ad_region,
NULL::"unknown" AS ad_viewed_clicked,
econdarwinproduction.adload_adexit,
NULL::"unknown" AS advu_mpu,
NULL::"unknown" AS advu_mpu_prop,
NULL::"unknown" AS amstelnet_order_id,
NULL::"unknown" AS app_advertising_id,
econdarwinproduction.app_id,
NULL::"unknown" AS app_id_prop,
NULL::"unknown" AS app_name,
NULL::"unknown" AS app_rating,
NULL::"unknown" AS app_rating_prop,
NULL::"unknown" AS article_published_date,
NULL::"unknown" AS article_publishing,
NULL::"unknown" AS audio,
NULL::"unknown" AS audio_progress,
NULL::"unknown" AS audio_segment,
NULL::"unknown" AS br_camp_cid1_fst_click,
NULL::"unknown" AS br_camp_cid1_linear,
NULL::"unknown" AS br_camp_cid1_lst_click,
NULL::"unknown" AS br_camp_cid2_fst_click,
NULL::"unknown" AS br_camp_cid2_linear,
NULL::"unknown" AS br_camp_cid2_lst_click,
econdarwinproduction.browser::character varying(256) AS browser,
econdarwinproduction.browser_height::character varying(256) AS browser_height,
econdarwinproduction.browser_width,
NULL::"unknown" AS bulk_ip_address,
econdarwinproduction.campaign,
NULL::"unknown" AS campaign_attribution,
NULL::"unknown" AS campaign_attribution_owned_earned,
NULL::"unknown" AS campaign_attribution_paid,
NULL::"unknown" AS campaign_stacking_all,
NULL::"unknown" AS campaign_tracking,
econdarwinproduction.carrier,
NULL::"unknown" AS channel,
econdarwinproduction.click_action,
econdarwinproduction.click_action_type,
NULL::"unknown" AS click_tag,
NULL::"unknown" AS code_ver,
econdarwinproduction.connection_type,
NULL::"unknown" AS connection_type_prop,
NULL::"unknown" AS content_category,
NULL::"unknown" AS content_region,
NULL::"unknown" AS content_region_prop,
NULL::"unknown" AS content_source,
NULL::"unknown" AS content_type,
econdarwinproduction.cookies,
econdarwinproduction.country,
NULL::"unknown" AS country_residence,
econdarwinproduction.ct_connect_type,
NULL::"unknown" AS curr_factor,
econdarwinproduction.curr_rate,
econdarwinproduction.currency,
econdarwinproduction.cust_hit_time_gmt,
NULL::"unknown" AS cust_type_prod,
econdarwinproduction.cust_visid,
NULL::"unknown" AS customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
econdarwinproduction.date_time,
econdarwinproduction.delivery_method,
NULL::"unknown" AS device_advertising_id,
NULL::"unknown" AS device_id,
NULL::"unknown" AS device_id_prop,
econdarwinproduction.device_name,
NULL::"unknown" AS device_type,
NULL::"unknown" AS device_type_prop,
econdarwinproduction.device_vendor_id,
NULL::"unknown" AS dfp_ad_id,
NULL::"unknown" AS dfp_site,
NULL::"unknown" AS dfp_zone,
NULL::"unknown" AS director_donor,
econdarwinproduction."domain",
econdarwinproduction.drupal_id,
NULL::"unknown" AS duplicate_events,
NULL::"unknown" AS duplicate_purchase,
NULL::"unknown" AS editors_pick_download,
NULL::"unknown" AS editors_pick_download_counter,
NULL::"unknown" AS editors_pick_download_prop,
NULL::"unknown" AS error_code,
NULL::"unknown" AS error_message,
NULL::"unknown" AS essay_section,
econdarwinproduction.event_id_partition_key,
econdarwinproduction.event_list,
econdarwinproduction.event_type,
econdarwinproduction.exclude_hit,
NULL::"unknown" AS facebook_widget_activity,
NULL::"unknown" AS fb_twitter_activity,
NULL::"unknown" AS first_hit_page_url,
NULL::"unknown" AS first_hit_pagename,
econdarwinproduction.first_hit_referrer,
NULL::"unknown" AS first_hit_time_gmt,
NULL::"unknown" AS form_name_field,
NULL::"unknown" AS form_sub_name,
econdarwinproduction.geo_city,
econdarwinproduction.geo_country,
econdarwinproduction.geo_dma,
econdarwinproduction.geo_region,
econdarwinproduction.geo_zip,
NULL::"unknown" AS google_play_subscriptions,
NULL::"unknown" AS grapeshot_value,
NULL::"unknown" AS hier1,
econdarwinproduction.hit_source,
NULL::"unknown" AS hit_time_gmt,
econdarwinproduction.hit_week,
econdarwinproduction.hitid_high,
econdarwinproduction.hitid_low,
econdarwinproduction.hour_of_day,
NULL::"unknown" AS int_sub_ads_first_click,
NULL::"unknown" AS int_sub_ads_last_click,
NULL::"unknown" AS internal_link,
NULL::"unknown" AS internal_link_external,
econdarwinproduction.ip,
econdarwinproduction.ip2,
econdarwinproduction.issue_date,
NULL::"unknown" AS issue_id,
econdarwinproduction.issue_region,
NULL::"unknown" AS key_interactions,
NULL::"unknown" AS key_interactions_pay_barrier_tracking,
econdarwinproduction."language",
NULL::"unknown" AS last_hit_time_gmt,
NULL::"unknown" AS last_purchase_num,
NULL::"unknown" AS last_purchase_time_gmt,
NULL::"unknown" AS link_name,
NULL::"unknown" AS link_page,
NULL::"unknown" AS loggedin,
NULL::"unknown" AS loggedin_prop,
NULL::"unknown" AS maximiser_campaign,
NULL::"unknown" AS mcvisid,
NULL::"unknown" AS meta_name,
econdarwinproduction.mobile_id,
NULL::"unknown" AS muls_subscription_type,
NULL::"unknown" AS multiuser_usage,
NULL::"unknown" AS navigated_by,
NULL::"unknown" AS navigated_by_prop,
econdarwinproduction.new_visit,
NULL::"unknown" AS newsletter_signup_from_reg,
NULL::"unknown" AS orientation,
NULL::"unknown" AS orientation_prop,
econdarwinproduction.os,
econdarwinproduction.os_version,
econdarwinproduction.page_event,
econdarwinproduction.page_event_var1,
econdarwinproduction.page_event_var2,
econdarwinproduction.page_event_var3,
NULL::"unknown" AS page_name,
NULL::"unknown" AS page_share_link,
NULL::"unknown" AS page_site_id,
econdarwinproduction.page_type,
econdarwinproduction.page_url,
NULL::"unknown" AS page_video_play,
NULL::"unknown" AS page_view,
econdarwinproduction.pagename,
NULL::"unknown" AS paid_free,
NULL::"unknown" AS paid_free_prop,
econdarwinproduction.paid_search,
NULL::"unknown" AS partner_referrals,
NULL::"unknown" AS payment_type,
econdarwinproduction.persistent_cookie,
NULL::"unknown" AS pointofinterest,
NULL::"unknown" AS pointofinterestdistance,
NULL::"unknown" AS post_ad_load_exit,
econdarwinproduction.post_campaign,
econdarwinproduction.post_channel,
econdarwinproduction.post_cookies,
econdarwinproduction.post_currency,
econdarwinproduction.post_event_list,
econdarwinproduction.post_hier1,
econdarwinproduction.post_hier2,
econdarwinproduction.post_hier3,
econdarwinproduction.post_hier4,
econdarwinproduction.post_hier5,
NULL::"unknown" AS post_java_enabled,
econdarwinproduction.post_keywords,
NULL::"unknown" AS post_mobileappid,
NULL::"unknown" AS post_mobiledayofweek,
NULL::"unknown" AS post_mobiledayssincefirstuse,
NULL::"unknown" AS post_mobiledayssincelastuse,
NULL::"unknown" AS post_mobiledevice,
NULL::"unknown" AS post_mobilehourofday,
NULL::"unknown" AS post_mobileinstalldate,
NULL::"unknown" AS post_mobilelaunchnumber,
NULL::"unknown" AS post_mobileosversion,
NULL::"unknown" AS post_mobileresolution,
econdarwinproduction.post_page_event::character varying(255) AS post_page_event,
econdarwinproduction.post_page_event_var1,
econdarwinproduction.post_page_event_var2,
econdarwinproduction.post_page_event_var3,
econdarwinproduction.post_page_url,
econdarwinproduction.post_pagename,
econdarwinproduction.post_pagename_no_url,
econdarwinproduction.post_partner_plugins,
econdarwinproduction.post_persistent_cookie,
NULL::"unknown" AS post_pointofinterest,
NULL::"unknown" AS post_pointofinterestdistance,
econdarwinproduction.post_product_list,
econdarwinproduction.post_purchaseid,
econdarwinproduction.post_referrer,
econdarwinproduction.post_search_engine,
econdarwinproduction.post_state,
econdarwinproduction.post_survey,
econdarwinproduction.post_t_time_info,
NULL::"unknown" AS post_zip,
econdarwinproduction.prev_page,
econdarwinproduction.product_id,
econdarwinproduction.product_list,
NULL::"unknown" AS promo_code,
NULL::"unknown" AS prop_article_published_date,
NULL::"unknown" AS prop_cust_type_prod,
NULL::"unknown" AS prop_drupal_id,
NULL::"unknown" AS prop_story_title,
NULL::"unknown" AS prop_user_login_status,
econdarwinproduction.purchase_id,
NULL::"unknown" AS purchaseid,
econdarwinproduction.ref_domain,
econdarwinproduction.ref_type,
econdarwinproduction.referrer,
econdarwinproduction.referring_subdomain,
econdarwinproduction."region",
NULL::"unknown" AS region_served,
NULL::"unknown" AS registration,
NULL::"unknown" AS renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
econdarwinproduction.s_resolution,
econdarwinproduction.sampled_hit,
econdarwinproduction.search_engine,
econdarwinproduction.search_page_num,
NULL::"unknown" AS search_results,
econdarwinproduction.secondary_hit,
econdarwinproduction.service,
NULL::"unknown" AS share_type,
NULL::"unknown" AS share_type_prop,
NULL::"unknown" AS sharelink,
econdarwinproduction.source,
econdarwinproduction.state,
econdarwinproduction.stats_server,
econdarwinproduction.story_title,
NULL::"unknown" AS story_title_prop,
NULL::"unknown" AS sub_data_protection,
NULL::"unknown" AS sub_date_end,
NULL::"unknown" AS sub_expiration,
NULL::"unknown" AS sub_length,
NULL::"unknown" AS sub_login_reg_activities,
NULL::"unknown" AS sub_start_date,
NULL::"unknown" AS sublength,
econdarwinproduction.subscriber_type,
NULL::"unknown" AS subscriber_type_prop,
econdarwinproduction.subscription_new,
econdarwinproduction.subscription_page_new,
NULL::"unknown" AS subscription_page_renew,
NULL::"unknown" AS subscription_renew,
NULL::"unknown" AS subscription_term_google_play,
NULL::"unknown" AS subsection,
econdarwinproduction.t_time_info,
econdarwinproduction.teg_hit_gmt_datetime,
econdarwinproduction.teg_hit_local_datetime,
econdarwinproduction.teg_hit_timezone_offset,
NULL::"unknown" AS "template",
NULL::"unknown" AS template_type,
NULL::"unknown" AS ub_form_abandonment,
NULL::"unknown" AS ub_offer_country,
NULL::"unknown" AS ub_product_code,
NULL::"unknown" AS ub_sub,
NULL::"unknown" AS url,
NULL::"unknown" AS user_agent,
NULL::"unknown" AS user_agent_evar,
NULL::"unknown" AS user_agent_prop,
NULL::"unknown" AS user_login_status,
NULL::"unknown" AS userid,
NULL::"unknown" AS username,
econdarwinproduction.valid_user,
econdarwinproduction.valid_view,
econdarwinproduction.valid_visit,
NULL::"unknown" AS video_play,
NULL::"unknown" AS video_segment,
NULL::"unknown" AS video_tags,
NULL::"unknown" AS video_tags_prop,
NULL::"unknown" AS videos,
NULL::"unknown" AS videos_formatted,
econdarwinproduction.visid_high,
econdarwinproduction.visid_low,
econdarwinproduction.visid_new,
econdarwinproduction.visid_timestamp,
econdarwinproduction.visid_type,
econdarwinproduction.visit_id,
econdarwinproduction.visit_keywords,
econdarwinproduction.visit_num,
NULL::"unknown" AS visit_number_new_repeat,
NULL::"unknown" AS visit_page_num,
econdarwinproduction.visit_referrer,
econdarwinproduction.visit_search_engine,
econdarwinproduction.visit_start_page_url,
econdarwinproduction.visit_start_pagename,
econdarwinproduction.visitor_id,
econdarwinproduction.visitor_id_evar,
NULL::"unknown" AS week_type,
econdarwinproduction.drupal_or_visitor_id,
econdarwinproduction.external_file_id,
econdarwinproduction.external_file_rownumber
   FROM adobe.econdarwinproduction; 
GRANT SELECT ON adobe.combined TO GROUP readonly;

---------------------------------------------------------------------------------------------------
-- 00218_recreate_adobe_econdarwinproduction_rollback.sql
---------------------------------------------------------------------------------------------------
CREATE TABLE adobe.econdarwinproduction_new
(browser BIGINT ENCODE lzo
        ,browser_height BIGINT ENCODE lzo
        ,browser_width BIGINT ENCODE lzo
        ,campaign VARCHAR(300) ENCODE lzo
        ,carrier VARCHAR(128) ENCODE lzo
        ,click_action VARCHAR(256) ENCODE lzo
        ,click_action_type SMALLINT ENCODE lzo
        ,cookies CHAR(1) ENCODE lzo
        ,country BIGINT ENCODE lzo
        ,ct_connect_type VARCHAR(256) ENCODE lzo
        ,cust_hit_time_gmt TIMESTAMP ENCODE lzo
        ,curr_rate DECIMAL ENCODE lzo
        ,currency VARCHAR(256) ENCODE lzo
        ,cust_visid VARCHAR(256) ENCODE lzo
        ,date_time  TIMESTAMP ENCODE lzo
        ,domain VARCHAR(256) ENCODE lzo
        ,event_list VARCHAR(65535) ENCODE lzo
        ,exclude_hit SMALLINT ENCODE lzo
        ,first_hit_referrer VARCHAR(256) ENCODE lzo
        ,geo_city VARCHAR(256) ENCODE lzo
        ,geo_country VARCHAR(256) ENCODE lzo
        ,geo_dma BIGINT ENCODE lzo
        ,geo_region VARCHAR(256) ENCODE lzo
        ,geo_zip VARCHAR(256) ENCODE lzo
        ,hit_source SMALLINT ENCODE lzo
        ,hit_time_gmt BIGINT ENCODE lzo
        ,hitid_high BIGINT ENCODE lzo
        ,hitid_low BIGINT ENCODE lzo
        ,ip VARCHAR(256) ENCODE lzo
        ,ip2 VARCHAR(256) ENCODE lzo
        ,language BIGINT ENCODE lzo
        ,mobile_id BIGINT ENCODE lzo
        ,new_visit SMALLINT ENCODE lzo
        ,os BIGINT ENCODE lzo
        ,page_event SMALLINT ENCODE lzo
        ,page_event_var1 VARCHAR(65535) ENCODE lzo
        ,page_event_var2 VARCHAR(256) ENCODE lzo
        ,page_event_var3 VARCHAR(65535) ENCODE lzo
        ,pagename VARCHAR(256) ENCODE lzo
        ,page_type VARCHAR(256) ENCODE lzo
        ,page_url VARCHAR(65535) ENCODE lzo
        ,paid_search SMALLINT ENCODE lzo
        ,persistent_cookie CHAR(1) ENCODE lzo
        ,post_campaign VARCHAR(300) ENCODE lzo
        ,post_channel VARCHAR(256) ENCODE lzo
        ,post_cookies CHAR(1) ENCODE lzo
        ,post_currency VARCHAR(256) ENCODE lzo
        ,visitor_id_evar VARCHAR(256) ENCODE lzo
        ,event_type VARCHAR(256) ENCODE lzo
        ,issue_date VARCHAR(256) ENCODE lzo
        ,issue_region VARCHAR(256) ENCODE lzo
        ,story_title VARCHAR(256) ENCODE lzo
        ,ad_region VARCHAR(256) ENCODE lzo
        ,subscriber_type VARCHAR(256) ENCODE lzo
        ,drupal_id INTEGER ENCODE lzo
        ,delivery_method VARCHAR(256) ENCODE lzo
        ,product_id VARCHAR(256) ENCODE lzo
        ,referring_subdomain VARCHAR(256) ENCODE lzo
        ,hour_of_day VARCHAR(256) ENCODE lzo
        ,app_id VARCHAR(256) ENCODE lzo
        ,device_vendor_id VARCHAR(256) ENCODE lzo
        ,device_name VARCHAR(256) ENCODE lzo
        ,os_version VARCHAR(256) ENCODE lzo
        ,adload_adexit VARCHAR(256) ENCODE lzo
        ,connection_type VARCHAR(256) ENCODE lzo
        ,post_event_list VARCHAR(65535) ENCODE lzo
        ,post_hier1 VARCHAR(256) ENCODE lzo
        ,post_hier2 VARCHAR(256) ENCODE lzo
        ,post_hier3 VARCHAR(256) ENCODE lzo
        ,post_hier4 VARCHAR(256) ENCODE lzo
        ,post_hier5 VARCHAR(256) ENCODE lzo
        ,post_keywords VARCHAR(256) ENCODE lzo
        ,post_page_event SMALLINT ENCODE lzo
        ,post_page_event_var1 VARCHAR(256) ENCODE lzo
        ,post_page_event_var2 VARCHAR(256) ENCODE lzo
        ,post_page_event_var3 VARCHAR(65535) ENCODE lzo
        ,post_page_url VARCHAR(256) ENCODE lzo
        ,post_pagename VARCHAR(256) ENCODE lzo
        ,post_pagename_no_url VARCHAR(256) ENCODE lzo
        ,post_partner_plugins VARCHAR(256) ENCODE lzo
        ,post_persistent_cookie CHAR(1) ENCODE lzo
        ,post_product_list VARCHAR(65535) ENCODE lzo
        ,post_purchaseid VARCHAR(256) ENCODE lzo
        ,post_referrer VARCHAR(256) ENCODE lzo
        ,post_search_engine BIGINT ENCODE lzo
        ,post_state VARCHAR(256) ENCODE lzo
        ,post_survey VARCHAR(65535) ENCODE lzo
        ,post_t_time_info VARCHAR(256) ENCODE lzo
        ,prev_page BIGINT ENCODE lzo
        ,product_list VARCHAR(65535) ENCODE lzo
        ,purchase_id VARCHAR(256) ENCODE lzo
        ,ref_domain VARCHAR(256) ENCODE lzo
        ,ref_type SMALLINT ENCODE lzo
        ,referrer VARCHAR(256) ENCODE lzo
        ,s_resolution VARCHAR(256) ENCODE lzo
        ,sampled_hit VARCHAR(256) ENCODE lzo
        ,search_engine BIGINT ENCODE lzo
        ,search_page_num BIGINT ENCODE lzo
        ,secondary_hit SMALLINT ENCODE lzo
        ,service VARCHAR(256) ENCODE lzo
        ,state VARCHAR(256) ENCODE lzo
        ,stats_server VARCHAR(256) ENCODE lzo
        ,t_time_info VARCHAR(256) ENCODE lzo
        ,visid_high BIGINT ENCODE lzo
        ,visid_low BIGINT ENCODE lzo
        ,visid_new CHAR(1) ENCODE lzo
        ,visid_timestamp TIMESTAMP ENCODE lzo
        ,visid_type SMALLINT ENCODE lzo
        ,visit_keywords VARCHAR(256) ENCODE lzo
        ,visit_num BIGINT ENCODE lzo
        ,visit_referrer VARCHAR(256) ENCODE lzo
        ,visit_search_engine VARCHAR(256) ENCODE lzo
        ,visit_start_page_url VARCHAR(256) ENCODE lzo
        ,visit_start_pagename VARCHAR(256) ENCODE lzo
        ,visit_start_time_gmt TIMESTAMP ENCODE lzo
        ,accept_language VARCHAR(384) ENCODE lzo
        ,source VARCHAR(16) ENCODE lzo
        ,region VARCHAR(15) ENCODE lzo
        ,visitor_id varchar(256) ENCODE lzo
        ,visit_id VARCHAR(256) ENCODE lzo
        ,valid_user INTEGER ENCODE lzo
        ,valid_view INTEGER ENCODE lzo
        ,valid_visit INTEGER ENCODE lzo
        ,event_id_partition_key VARCHAR(87) ENCODE lzo
        ,hit_week TIMESTAMP ENCODE lzo
        ,subscription_page_new INTEGER ENCODE lzo
        ,subscription_new INTEGER ENCODE lzo
        ,teg_hit_local_datetime TIMESTAMP ENCODE lzo
        ,teg_hit_gmt_datetime TIMESTAMP ENCODE lzo
        ,teg_hit_timezone_offset INTEGER ENCODE lzo
        ,drupal_or_visitor_id VARCHAR(256) ENCODE lzo
        ,EXTERNAL_FILE_ID BIGINT ENCODE lzo
        ,EXTERNAL_FILE_ROWNUMBER BIGINT ENCODE lzo
) DISTKEY (drupal_or_visitor_id) SORTKEY (teg_hit_local_datetime);

set wlm_query_slot_count to 8;

INSERT INTO adobe.econdarwinproduction_new

SELECT * FROM adobe.econdarwinproduction;

ALTER TABLE adobe.econdarwinproduction RENAME TO econdarwinproduction_oldb;
ALTER TABLE adobe.econdarwinproduction_new RENAME TO econdarwinproduction;

GRANT INSERT ON adobe.econdarwinproduction TO copyrole;
GRANT SELECT ON adobe.econdarwinproduction TO GROUP readonly;

CREATE OR REPLACE VIEW adobe.combined
(
  accept_language,
  ad_impressions,
  ad_impresson,
  ad_load_exit,
  ad_region,
  ad_viewed_clicked,
  adload_adexit,
  advu_mpu,
  advu_mpu_prop,
  amstelnet_order_id,
  app_advertising_id,
  app_id,
  app_id_prop,
  app_name,
  app_rating,
  app_rating_prop,
  article_published_date,
  article_publishing,
  audio,
  audio_progress,
  audio_segment,
  br_camp_cid1_fst_click,
  br_camp_cid1_linear,
  br_camp_cid1_lst_click,
  br_camp_cid2_fst_click,
  br_camp_cid2_linear,
  br_camp_cid2_lst_click,
  browser,
  browser_height,
  browser_width,
  bulk_ip_address,
  campaign,
  campaign_attribution,
  campaign_attribution_owned_earned,
  campaign_attribution_paid,
  campaign_stacking_all,
  campaign_tracking,
  carrier,
  channel,
  click_action,
  click_action_type,
  click_tag,
  code_ver,
  connection_type,
  connection_type_prop,
  content_category,
  content_region,
  content_region_prop,
  content_source,
  content_type,
  cookies,
  country,
  country_residence,
  ct_connect_type,
  curr_factor,
  curr_rate,
  currency,
  cust_hit_time_gmt,
  cust_type_prod,
  cust_visid,
  customer_lifecycle,
  date_day_weektype,
  date_time,
  delivery_method,
  device_advertising_id,
  device_id,
  device_id_prop,
  device_name,
  device_type,
  device_type_prop,
  device_vendor_id,
  dfp_ad_id,
  dfp_site,
  dfp_zone,
  director_donor,
  domain,
  drupal_id,
  duplicate_events,
  duplicate_purchase,
  editors_pick_download,
  editors_pick_download_counter,
  editors_pick_download_prop,
  error_code,
  error_message,
  essay_section,
  event_id_partition_key,
  event_list,
  event_type,
  exclude_hit,
  facebook_widget_activity,
  fb_twitter_activity,
  first_hit_page_url,
  first_hit_pagename,
  first_hit_referrer,
  first_hit_time_gmt,
  form_name_field,
  form_sub_name,
  geo_city,
  geo_country,
  geo_dma,
  geo_region,
  geo_zip,
  google_play_subscriptions,
  grapeshot_value,
  hier1,
  hit_source,
  hit_time_gmt,
  hit_week,
  hitid_high,
  hitid_low,
  hour_of_day,
  int_sub_ads_first_click,
  int_sub_ads_last_click,
  internal_link,
  internal_link_external,
  ip,
  ip2,
  issue_date,
  issue_id,
  issue_region,
  key_interactions,
  key_interactions_pay_barrier_tracking,
  language,
  last_hit_time_gmt,
  last_purchase_num,
  last_purchase_time_gmt,
  link_name,
  link_page,
  loggedin,
  loggedin_prop,
  maximiser_campaign,
  mcvisid,
  meta_name,
  mobile_id,
  muls_subscription_type,
  multiuser_usage,
  navigated_by,
  navigated_by_prop,
  new_visit,
  newsletter_signup_from_reg,
  orientation,
  orientation_prop,
  os,
  os_version,
  page_event,
  page_event_var1,
  page_event_var2,
  page_event_var3,
  page_name,
  page_share_link,
  page_site_id,
  page_type,
  page_url,
  page_video_play,
  page_view,
  pagename,
  paid_free,
  paid_free_prop,
  paid_search,
  partner_referrals,
  payment_type,
  persistent_cookie,
  pointofinterest,
  pointofinterestdistance,
  post_ad_load_exit,
  post_campaign,
  post_channel,
  post_cookies,
  post_currency,
  post_event_list,
  post_hier1,
  post_hier2,
  post_hier3,
  post_hier4,
  post_hier5,
  post_java_enabled,
  post_keywords,
  post_mobileappid,
  post_mobiledayofweek,
  post_mobiledayssincefirstuse,
  post_mobiledayssincelastuse,
  post_mobiledevice,
  post_mobilehourofday,
  post_mobileinstalldate,
  post_mobilelaunchnumber,
  post_mobileosversion,
  post_mobileresolution,
  post_page_event,
  post_page_event_var1,
  post_page_event_var2,
  post_page_event_var3,
  post_page_url,
  post_pagename,
  post_pagename_no_url,
  post_partner_plugins,
  post_persistent_cookie,
  post_pointofinterest,
  post_pointofinterestdistance,
  post_product_list,
  post_purchaseid,
  post_referrer,
  post_search_engine,
  post_state,
  post_survey,
  post_t_time_info,
  post_zip,
  prev_page,
  product_id,
  product_list,
  promo_code,
  prop_article_published_date,
  prop_cust_type_prod,
  prop_drupal_id,
  prop_story_title,
  prop_user_login_status,
  purchase_id,
  purchaseid,
  ref_domain,
  ref_type,
  referrer,
  referring_subdomain,
  region,
  region_served,
  registration,
  renewal_start_end_date,
  revamp_tracking,
  s_resolution,
  sampled_hit,
  search_engine,
  search_page_num,
  search_results,
  secondary_hit,
  service,
  share_type,
  share_type_prop,
  sharelink,
  source,
  state,
  stats_server,
  story_title,
  story_title_prop,
  sub_data_protection,
  sub_date_end,
  sub_expiration,
  sub_length,
  sub_login_reg_activities,
  sub_start_date,
  sublength,
  subscriber_type,
  subscriber_type_prop,
  subscription_new,
  subscription_page_new,
  subscription_page_renew,
  subscription_renew,
  subscription_term_google_play,
  subsection,
  t_time_info,
  teg_hit_gmt_datetime,
  teg_hit_local_datetime,
  teg_hit_timezone_offset,
  template,
  template_type,
  ub_form_abandonment,
  ub_offer_country,
  ub_product_code,
  ub_sub,
  url,
  user_agent,
  user_agent_evar,
  user_agent_prop,
  user_login_status,
  userid,
  username,
  valid_user,
  valid_view,
  valid_visit,
  video_play,
  video_segment,
  video_tags,
  video_tags_prop,
  videos,
  videos_formatted,
  visid_high,
  visid_low,
  visid_new,
  visid_timestamp,
  visid_type,
  visit_id,
  visit_keywords,
  visit_num,
  visit_number_new_repeat,
  visit_page_num,
  visit_referrer,
  visit_search_engine,
  visit_start_page_url,
  visit_start_pagename,
  visitor_id,
  visitor_id_evar,
  week_type,
  drupal_or_visitor_id,
  external_file_id,
  external_file_rownumber
)
AS
( SELECT economistcomprod.accept_language,
NULL::"unknown" AS ad_impressions,
NULL::"unknown" AS ad_impresson,
NULL::"unknown" AS ad_load_exit,
NULL::"unknown" AS ad_region,
economistcomprod.ad_viewed_clicked,
NULL::"unknown" AS adload_adexit,
economistcomprod.advu_mpu,
economistcomprod.advu_mpu_prop,
economistcomprod.amstelnet_order_id,
NULL::"unknown" AS app_advertising_id,
NULL::"unknown" AS app_id,
NULL::"unknown" AS app_id_prop,
NULL::"unknown" AS app_name,
NULL::"unknown" AS app_rating,
NULL::"unknown" AS app_rating_prop,
economistcomprod.article_published_date,
economistcomprod.article_publishing,
economistcomprod.audio,
NULL::"unknown" AS audio_progress,
NULL::"unknown" AS audio_segment,
economistcomprod.br_camp_cid1_fst_click,
economistcomprod.br_camp_cid1_linear,
economistcomprod.br_camp_cid1_lst_click,
economistcomprod.br_camp_cid2_fst_click,
economistcomprod.br_camp_cid2_linear,
economistcomprod.br_camp_cid2_lst_click,
economistcomprod.browser,
economistcomprod.browser_height,
economistcomprod.browser_width,
economistcomprod.bulk_ip_address,
economistcomprod.campaign,
economistcomprod.campaign_attribution,
economistcomprod.campaign_attribution_owned_earned,
economistcomprod.campaign_attribution_paid,
economistcomprod.campaign_stacking_all,
economistcomprod.campaign_tracking,
NULL::"unknown" AS carrier,
economistcomprod.channel,
economistcomprod.click_action,
economistcomprod.click_action_type,
economistcomprod.click_tag,
NULL::"unknown" AS code_ver,
NULL::"unknown" AS connection_type,
NULL::"unknown" AS connection_type_prop,
economistcomprod.content_category,
NULL::"unknown" AS content_region,
NULL::"unknown" AS content_region_prop,
NULL::"unknown" AS content_source,
economistcomprod.content_type,
NULL::"unknown" AS cookies,
NULL::"unknown" AS country,
NULL::"unknown" AS country_residence,
economistcomprod.ct_connect_type,
economistcomprod.curr_factor,
economistcomprod.curr_rate,
economistcomprod.currency,
NULL::"unknown" AS cust_hit_time_gmt,
economistcomprod.cust_type_prod,
NULL::"unknown" AS cust_visid,
economistcomprod.customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
economistcomprod.date_time,
NULL::"unknown" AS delivery_method,
NULL::"unknown" AS device_advertising_id,
NULL::"unknown" AS device_id,
NULL::"unknown" AS device_id_prop,
NULL::"unknown" AS device_name,
NULL::"unknown" AS device_type,
NULL::"unknown" AS device_type_prop,
NULL::"unknown" AS device_vendor_id,
economistcomprod.dfp_ad_id,
economistcomprod.dfp_site,
economistcomprod.dfp_zone,
economistcomprod.director_donor,
economistcomprod."domain",
economistcomprod.drupal_id,
NULL::"unknown" AS duplicate_events,
NULL::"unknown" AS duplicate_purchase,
NULL::"unknown" AS editors_pick_download,
NULL::"unknown" AS editors_pick_download_counter,
NULL::"unknown" AS editors_pick_download_prop,
economistcomprod.error_code,
economistcomprod.error_message,
economistcomprod.essay_section,
economistcomprod.event_id_partition_key,
NULL::"unknown" AS event_list,
NULL::"unknown" AS event_type,
economistcomprod.exclude_hit,
economistcomprod.facebook_widget_activity,
economistcomprod.fb_twitter_activity,
economistcomprod.first_hit_page_url,
economistcomprod.first_hit_pagename,
economistcomprod.first_hit_referrer,
economistcomprod.first_hit_time_gmt,
economistcomprod.form_name_field,
economistcomprod.form_sub_name,
economistcomprod.geo_city,
economistcomprod.geo_country,
economistcomprod.geo_dma,
economistcomprod.geo_region,
economistcomprod.geo_zip,
NULL::"unknown" AS google_play_subscriptions,
economistcomprod.grapeshot_value,
economistcomprod.hier1,
economistcomprod.hit_source,
economistcomprod.hit_time_gmt,
economistcomprod.hit_week,
economistcomprod.hitid_high,
economistcomprod.hitid_low,
economistcomprod.hour_of_day,
economistcomprod.int_sub_ads_first_click,
economistcomprod.int_sub_ads_last_click,
economistcomprod.internal_link,
economistcomprod.internal_link_external,
economistcomprod.ip,
economistcomprod.ip2,
economistcomprod.issue_date,
NULL::"unknown" AS issue_id,
NULL::"unknown" AS issue_region,
economistcomprod.key_interactions,
economistcomprod.key_interactions_pay_barrier_tracking,
economistcomprod."language",
economistcomprod.last_hit_time_gmt,
economistcomprod.last_purchase_num,
NULL::"unknown" AS last_purchase_time_gmt,
economistcomprod.link_name,
NULL::"unknown" AS link_page,
NULL::"unknown" AS loggedin,
NULL::"unknown" AS loggedin_prop,
economistcomprod.maximiser_campaign,
NULL::"unknown" AS mcvisid,
economistcomprod.meta_name,
economistcomprod.mobile_id,
economistcomprod.muls_subscription_type,
economistcomprod.multiuser_usage,
NULL::"unknown" AS navigated_by,
NULL::"unknown" AS navigated_by_prop,
economistcomprod.new_visit,
economistcomprod.newsletter_signup_from_reg,
NULL::"unknown" AS orientation,
NULL::"unknown" AS orientation_prop,
economistcomprod.os,
NULL::"unknown" AS os_version,
economistcomprod.page_event,
economistcomprod.page_event_var1,
NULL::"unknown" AS page_event_var2,
NULL::"unknown" AS page_event_var3,
economistcomprod.page_name,
economistcomprod.page_share_link,
economistcomprod.page_site_id,
economistcomprod.page_type,
NULL::"unknown" AS page_url,
economistcomprod.page_video_play,
NULL::"unknown" AS page_view,
NULL::"unknown" AS pagename,
NULL::"unknown" AS paid_free,
NULL::"unknown" AS paid_free_prop,
economistcomprod.paid_search,
economistcomprod.partner_referrals,
economistcomprod.payment_type,
economistcomprod.persistent_cookie,
NULL::"unknown" AS pointofinterest,
NULL::"unknown" AS pointofinterestdistance,
NULL::"unknown" AS post_ad_load_exit,
economistcomprod.post_campaign,
economistcomprod.post_channel,
economistcomprod.post_cookies,
economistcomprod.post_currency,
economistcomprod.post_event_list,
economistcomprod.post_hier1,
economistcomprod.post_hier2,
economistcomprod.post_hier3,
economistcomprod.post_hier4,
economistcomprod.post_hier5,
NULL::"unknown" AS post_java_enabled,
economistcomprod.post_keywords,
NULL::"unknown" AS post_mobileappid,
NULL::"unknown" AS post_mobiledayofweek,
NULL::"unknown" AS post_mobiledayssincefirstuse,
NULL::"unknown" AS post_mobiledayssincelastuse,
NULL::"unknown" AS post_mobiledevice,
NULL::"unknown" AS post_mobilehourofday,
NULL::"unknown" AS post_mobileinstalldate,
NULL::"unknown" AS post_mobilelaunchnumber,
NULL::"unknown" AS post_mobileosversion,
NULL::"unknown" AS post_mobileresolution,
economistcomprod.post_page_event,
economistcomprod.post_page_event_var1,
NULL::"unknown" AS post_page_event_var2,
NULL::"unknown" AS post_page_event_var3,
economistcomprod.post_page_url,
economistcomprod.post_pagename,
economistcomprod.post_pagename_no_url,
economistcomprod.post_partner_plugins,
NULL::"unknown" AS post_persistent_cookie,
NULL::"unknown" AS post_pointofinterest,
NULL::"unknown" AS post_pointofinterestdistance,
economistcomprod.post_product_list,
economistcomprod.post_purchaseid,
economistcomprod.post_referrer,
economistcomprod.post_search_engine,
economistcomprod.post_state,
economistcomprod.post_survey,
economistcomprod.post_t_time_info,
NULL::"unknown" AS post_zip,
economistcomprod.prev_page,
NULL::"unknown" AS product_id,
economistcomprod.product_list,
economistcomprod.promo_code,
economistcomprod.prop_article_published_date,
economistcomprod.prop_cust_type_prod,
economistcomprod.prop_drupal_id,
economistcomprod.prop_story_title,
economistcomprod.prop_user_login_status,
NULL::"unknown" AS purchase_id,
economistcomprod.purchaseid,
economistcomprod.ref_domain,
economistcomprod.ref_type,
economistcomprod.referrer,
economistcomprod.referring_subdomain,
economistcomprod."region",
economistcomprod.region_served,
economistcomprod.registration,
economistcomprod.renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
economistcomprod.s_resolution,
NULL::"unknown" AS sampled_hit,
economistcomprod.search_engine,
economistcomprod.search_page_num,
economistcomprod.search_results,
NULL::"unknown" AS secondary_hit,
economistcomprod.service,
NULL::"unknown" AS share_type,
NULL::"unknown" AS share_type_prop,
economistcomprod.sharelink,
economistcomprod.source,
economistcomprod.state,
economistcomprod.stats_server,
economistcomprod.story_title,
NULL::"unknown" AS story_title_prop,
economistcomprod.sub_data_protection,
economistcomprod.sub_date_end,
economistcomprod.sub_expiration,
economistcomprod.sub_length,
economistcomprod.sub_login_reg_activities,
economistcomprod.sub_start_date,
economistcomprod.sublength,
NULL::"unknown" AS subscriber_type,
NULL::"unknown" AS subscriber_type_prop,
economistcomprod.subscription_new,
economistcomprod.subscription_page_new,
economistcomprod.subscription_page_renew,
economistcomprod.subscription_renew,
NULL::"unknown" AS subscription_term_google_play,
economistcomprod.subsection,
economistcomprod.t_time_info,
economistcomprod.teg_hit_gmt_datetime,
economistcomprod.teg_hit_local_datetime,
economistcomprod.teg_hit_timezone_offset,
NULL::"unknown" AS "template",
NULL::"unknown" AS template_type,
economistcomprod.ub_form_abandonment,
economistcomprod.ub_offer_country,
economistcomprod.ub_product_code,
economistcomprod.ub_sub,
economistcomprod.url,
NULL::"unknown" AS user_agent,
NULL::"unknown" AS user_agent_evar,
NULL::"unknown" AS user_agent_prop,
economistcomprod.user_login_status,
economistcomprod.userid,
economistcomprod.username,
economistcomprod.valid_user,
economistcomprod.valid_view,
economistcomprod.valid_visit,
economistcomprod.video_play,
economistcomprod.video_segment,
economistcomprod.video_tags,
economistcomprod.video_tags_prop,
economistcomprod.videos,
economistcomprod.videos_formatted,
NULL::"unknown" AS visid_high,
NULL::"unknown" AS visid_low,
NULL::"unknown" AS visid_new,
economistcomprod.visid_timestamp,
economistcomprod.visid_type,
economistcomprod.visit_id,
economistcomprod.visit_keywords,
economistcomprod.visit_num,
economistcomprod.visit_number_new_repeat,
economistcomprod.visit_page_num,
economistcomprod.visit_referrer,
economistcomprod.visit_search_engine,
economistcomprod.visit_start_page_url,
economistcomprod.visit_start_pagename,
economistcomprod.visitor_id,
NULL::"unknown" AS visitor_id_evar,
economistcomprod.week_type,
economistcomprod.drupal_or_visitor_id,
economistcomprod.external_file_id,
economistcomprod.external_file_rownumber
   FROM adobe.economistcomprod
UNION ALL
 SELECT econprodappipad.accept_language,
econprodappipad.ad_impressions,
econprodappipad.ad_impresson,
econprodappipad.ad_load_exit,
NULL::"unknown" AS ad_region,
NULL::"unknown" AS ad_viewed_clicked,
NULL::"unknown" AS adload_adexit,
NULL::"unknown" AS advu_mpu,
NULL::"unknown" AS advu_mpu_prop,
NULL::"unknown" AS amstelnet_order_id,
econprodappipad.app_advertising_id,
econprodappipad.app_id,
econprodappipad.app_id_prop,
econprodappipad.app_name,
econprodappipad.app_rating,
econprodappipad.app_rating_prop,
NULL::"unknown" AS article_published_date,
NULL::"unknown" AS article_publishing,
NULL::"unknown" AS audio,
econprodappipad.audio_progress,
econprodappipad.audio_segment,
NULL::"unknown" AS br_camp_cid1_fst_click,
NULL::"unknown" AS br_camp_cid1_linear,
NULL::"unknown" AS br_camp_cid1_lst_click,
NULL::"unknown" AS br_camp_cid2_fst_click,
NULL::"unknown" AS br_camp_cid2_linear,
NULL::"unknown" AS br_camp_cid2_lst_click,
econprodappipad.browser::character varying(256) AS browser,
econprodappipad.browser_height::character varying(256) AS browser_height,
econprodappipad.browser_width,
NULL::"unknown" AS bulk_ip_address,
econprodappipad.campaign,
NULL::"unknown" AS campaign_attribution,
NULL::"unknown" AS campaign_attribution_owned_earned,
NULL::"unknown" AS campaign_attribution_paid,
NULL::"unknown" AS campaign_stacking_all,
NULL::"unknown" AS campaign_tracking,
econprodappipad.carrier,
econprodappipad.channel,
NULL::"unknown" AS click_action,
NULL::"unknown" AS click_action_type,
NULL::"unknown" AS click_tag,
econprodappipad.code_ver,
econprodappipad.connection_type,
econprodappipad.connection_type_prop,
NULL::"unknown" AS content_category,
econprodappipad.content_region,
econprodappipad.content_region_prop,
NULL::"unknown" AS content_source,
NULL::"unknown" AS content_type,
econprodappipad.cookies,
econprodappipad.country,
econprodappipad.country_residence,
econprodappipad.ct_connect_type,
NULL::"unknown" AS curr_factor,
econprodappipad.curr_rate,
econprodappipad.currency,
econprodappipad.cust_hit_time_gmt,
NULL::"unknown" AS cust_type_prod,
NULL::"unknown" AS cust_visid,
NULL::"unknown" AS customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
econprodappipad.date_time,
NULL::"unknown" AS delivery_method,
econprodappipad.device_advertising_id,
econprodappipad.device_id,
econprodappipad.device_id_prop,
NULL::"unknown" AS device_name,
econprodappipad.device_type,
econprodappipad.device_type_prop,
NULL::"unknown" AS device_vendor_id,
NULL::"unknown" AS dfp_ad_id,
NULL::"unknown" AS dfp_site,
NULL::"unknown" AS dfp_zone,
NULL::"unknown" AS director_donor,
econprodappipad."domain",
econprodappipad.drupal_id,
econprodappipad.duplicate_events,
econprodappipad.duplicate_purchase,
econprodappipad.editors_pick_download,
econprodappipad.editors_pick_download_counter,
econprodappipad.editors_pick_download_prop,
econprodappipad.error_code,
econprodappipad.error_message,
NULL::"unknown" AS essay_section,
econprodappipad.event_id_partition_key,
econprodappipad.event_list,
NULL::"unknown" AS event_type,
econprodappipad.exclude_hit,
NULL::"unknown" AS facebook_widget_activity,
NULL::"unknown" AS fb_twitter_activity,
econprodappipad.first_hit_page_url,
econprodappipad.first_hit_pagename,
econprodappipad.first_hit_referrer,
econprodappipad.first_hit_time_gmt,
NULL::"unknown" AS form_name_field,
NULL::"unknown" AS form_sub_name,
econprodappipad.geo_city,
econprodappipad.geo_country,
econprodappipad.geo_dma,
econprodappipad.geo_region,
econprodappipad.geo_zip,
econprodappipad.google_play_subscriptions,
NULL::"unknown" AS grapeshot_value,
NULL::"unknown" AS hier1,
econprodappipad.hit_source,
NULL::"unknown" AS hit_time_gmt,
econprodappipad.hit_week,
econprodappipad.hitid_high,
econprodappipad.hitid_low,
NULL::"unknown" AS hour_of_day,
NULL::"unknown" AS int_sub_ads_first_click,
NULL::"unknown" AS int_sub_ads_last_click,
NULL::"unknown" AS internal_link,
NULL::"unknown" AS internal_link_external,
econprodappipad.ip,
econprodappipad.ip2,
econprodappipad.issue_date,
econprodappipad.issue_id,
NULL::"unknown" AS issue_region,
NULL::"unknown" AS key_interactions,
NULL::"unknown" AS key_interactions_pay_barrier_tracking,
econprodappipad."language",
NULL::"unknown" AS last_hit_time_gmt,
NULL::"unknown" AS last_purchase_num,
econprodappipad.last_purchase_time_gmt,
NULL::"unknown" AS link_name,
econprodappipad.link_page,
econprodappipad.loggedin,
econprodappipad.loggedin_prop,
NULL::"unknown" AS maximiser_campaign,
econprodappipad.mcvisid,
NULL::"unknown" AS meta_name,
econprodappipad.mobile_id,
NULL::"unknown" AS muls_subscription_type,
NULL::"unknown" AS multiuser_usage,
econprodappipad.navigated_by,
econprodappipad.navigated_by_prop,
econprodappipad.new_visit,
NULL::"unknown" AS newsletter_signup_from_reg,
econprodappipad.orientation,
econprodappipad.orientation_prop,
econprodappipad.os,
NULL::"unknown" AS os_version,
NULL::"unknown" AS page_event,
NULL::"unknown" AS page_event_var1,
NULL::"unknown" AS page_event_var2,
NULL::"unknown" AS page_event_var3,
NULL::"unknown" AS page_name,
NULL::"unknown" AS page_share_link,
NULL::"unknown" AS page_site_id,
NULL::"unknown" AS page_type,
NULL::"unknown" AS page_url,
NULL::"unknown" AS page_video_play,
econprodappipad.page_view,
econprodappipad.pagename,
econprodappipad.paid_free,
econprodappipad.paid_free_prop,
econprodappipad.paid_search,
NULL::"unknown" AS partner_referrals,
NULL::"unknown" AS payment_type,
econprodappipad.persistent_cookie,
econprodappipad.pointofinterest,
econprodappipad.pointofinterestdistance,
econprodappipad.post_ad_load_exit,
econprodappipad.post_campaign,
econprodappipad.post_channel,
econprodappipad.post_cookies,
econprodappipad.post_currency,
econprodappipad.post_event_list,
NULL::"unknown" AS post_hier1,
NULL::"unknown" AS post_hier2,
NULL::"unknown" AS post_hier3,
NULL::"unknown" AS post_hier4,
NULL::"unknown" AS post_hier5,
econprodappipad.post_java_enabled,
econprodappipad.post_keywords,
econprodappipad.post_mobileappid,
econprodappipad.post_mobiledayofweek,
econprodappipad.post_mobiledayssincefirstuse,
econprodappipad.post_mobiledayssincelastuse,
econprodappipad.post_mobiledevice,
econprodappipad.post_mobilehourofday,
econprodappipad.post_mobileinstalldate,
econprodappipad.post_mobilelaunchnumber,
econprodappipad.post_mobileosversion,
econprodappipad.post_mobileresolution,
econprodappipad.post_page_event::character varying(255) AS post_page_event,
NULL::"unknown" AS post_page_event_var1,
NULL::"unknown" AS post_page_event_var2,
NULL::"unknown" AS post_page_event_var3,
NULL::"unknown" AS post_page_url,
econprodappipad.post_pagename,
econprodappipad.post_pagename_no_url,
NULL::"unknown" AS post_partner_plugins,
econprodappipad.post_persistent_cookie,
econprodappipad.post_pointofinterest,
econprodappipad.post_pointofinterestdistance,
econprodappipad.post_product_list,
econprodappipad.post_purchaseid,
NULL::"unknown" AS post_referrer,
econprodappipad.post_search_engine,
econprodappipad.post_state,
econprodappipad.post_survey,
econprodappipad.post_t_time_info,
econprodappipad.post_zip,
econprodappipad.prev_page,
NULL::"unknown" AS product_id,
econprodappipad.product_list,
NULL::"unknown" AS promo_code,
NULL::"unknown" AS prop_article_published_date,
NULL::"unknown" AS prop_cust_type_prod,
NULL::"unknown" AS prop_drupal_id,
NULL::"unknown" AS prop_story_title,
NULL::"unknown" AS prop_user_login_status,
NULL::"unknown" AS purchase_id,
econprodappipad.purchaseid,
NULL::"unknown" AS ref_domain,
NULL::"unknown" AS ref_type,
NULL::"unknown" AS referrer,
NULL::"unknown" AS referring_subdomain,
econprodappipad."region",
NULL::"unknown" AS region_served,
NULL::"unknown" AS registration,
NULL::"unknown" AS renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
econprodappipad.s_resolution,
econprodappipad.sampled_hit,
econprodappipad.search_engine,
econprodappipad.search_page_num,
NULL::"unknown" AS search_results,
econprodappipad.secondary_hit,
econprodappipad.service,
econprodappipad.share_type,
econprodappipad.share_type_prop,
NULL::"unknown" AS sharelink,
econprodappipad.source,
econprodappipad.state,
econprodappipad.stats_server,
econprodappipad.story_title,
econprodappipad.story_title_prop,
NULL::"unknown" AS sub_data_protection,
NULL::"unknown" AS sub_date_end,
NULL::"unknown" AS sub_expiration,
NULL::"unknown" AS sub_length,
NULL::"unknown" AS sub_login_reg_activities,
NULL::"unknown" AS sub_start_date,
NULL::"unknown" AS sublength,
econprodappipad.subscriber_type,
econprodappipad.subscriber_type_prop,
econprodappipad.subscription_new,
econprodappipad.subscription_page_new,
NULL::"unknown" AS subscription_page_renew,
NULL::"unknown" AS subscription_renew,
econprodappipad.subscription_term_google_play,
NULL::"unknown" AS subsection,
econprodappipad.t_time_info,
econprodappipad.teg_hit_gmt_datetime,
econprodappipad.teg_hit_local_datetime,
econprodappipad.teg_hit_timezone_offset,
econprodappipad."template",
econprodappipad.template_type,
NULL::"unknown" AS ub_form_abandonment,
NULL::"unknown" AS ub_offer_country,
NULL::"unknown" AS ub_product_code,
NULL::"unknown" AS ub_sub,
NULL::"unknown" AS url,
econprodappipad.user_agent,
econprodappipad.user_agent_evar,
econprodappipad.user_agent_prop,
NULL::"unknown" AS user_login_status,
NULL::"unknown" AS userid,
NULL::"unknown" AS username,
econprodappipad.valid_user,
econprodappipad.valid_view,
econprodappipad.valid_visit,
NULL::"unknown" AS video_play,
NULL::"unknown" AS video_segment,
NULL::"unknown" AS video_tags,
NULL::"unknown" AS video_tags_prop,
NULL::"unknown" AS videos,
NULL::"unknown" AS videos_formatted,
econprodappipad.visid_high,
econprodappipad.visid_low,
econprodappipad.visid_new,
econprodappipad.visid_timestamp,
econprodappipad.visid_type,
econprodappipad.visit_id,
econprodappipad.visit_keywords,
econprodappipad.visit_num,
NULL::"unknown" AS visit_number_new_repeat,
NULL::"unknown" AS visit_page_num,
econprodappipad.visit_referrer,
econprodappipad.visit_search_engine,
NULL::"unknown" AS visit_start_page_url,
econprodappipad.visit_start_pagename,
econprodappipad.visitor_id,
NULL::"unknown" AS visitor_id_evar,
NULL::"unknown" AS week_type,
econprodappipad.drupal_or_visitor_id,
econprodappipad.external_file_id,
econprodappipad.external_file_rownumber
   FROM adobe.econprodappipad)
UNION ALL
 SELECT econdarwinproduction.accept_language,
NULL::"unknown" AS ad_impressions,
NULL::"unknown" AS ad_impresson,
NULL::"unknown" AS ad_load_exit,
econdarwinproduction.ad_region,
NULL::"unknown" AS ad_viewed_clicked,
econdarwinproduction.adload_adexit,
NULL::"unknown" AS advu_mpu,
NULL::"unknown" AS advu_mpu_prop,
NULL::"unknown" AS amstelnet_order_id,
NULL::"unknown" AS app_advertising_id,
econdarwinproduction.app_id,
NULL::"unknown" AS app_id_prop,
NULL::"unknown" AS app_name,
NULL::"unknown" AS app_rating,
NULL::"unknown" AS app_rating_prop,
NULL::"unknown" AS article_published_date,
NULL::"unknown" AS article_publishing,
NULL::"unknown" AS audio,
NULL::"unknown" AS audio_progress,
NULL::"unknown" AS audio_segment,
NULL::"unknown" AS br_camp_cid1_fst_click,
NULL::"unknown" AS br_camp_cid1_linear,
NULL::"unknown" AS br_camp_cid1_lst_click,
NULL::"unknown" AS br_camp_cid2_fst_click,
NULL::"unknown" AS br_camp_cid2_linear,
NULL::"unknown" AS br_camp_cid2_lst_click,
econdarwinproduction.browser::character varying(256) AS browser,
econdarwinproduction.browser_height::character varying(256) AS browser_height,
econdarwinproduction.browser_width,
NULL::"unknown" AS bulk_ip_address,
econdarwinproduction.campaign,
NULL::"unknown" AS campaign_attribution,
NULL::"unknown" AS campaign_attribution_owned_earned,
NULL::"unknown" AS campaign_attribution_paid,
NULL::"unknown" AS campaign_stacking_all,
NULL::"unknown" AS campaign_tracking,
econdarwinproduction.carrier,
NULL::"unknown" AS channel,
econdarwinproduction.click_action,
econdarwinproduction.click_action_type,
NULL::"unknown" AS click_tag,
NULL::"unknown" AS code_ver,
econdarwinproduction.connection_type,
NULL::"unknown" AS connection_type_prop,
NULL::"unknown" AS content_category,
NULL::"unknown" AS content_region,
NULL::"unknown" AS content_region_prop,
NULL::"unknown" AS content_source,
NULL::"unknown" AS content_type,
econdarwinproduction.cookies,
econdarwinproduction.country,
NULL::"unknown" AS country_residence,
econdarwinproduction.ct_connect_type,
NULL::"unknown" AS curr_factor,
econdarwinproduction.curr_rate,
econdarwinproduction.currency,
econdarwinproduction.cust_hit_time_gmt,
NULL::"unknown" AS cust_type_prod,
econdarwinproduction.cust_visid,
NULL::"unknown" AS customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
econdarwinproduction.date_time,
econdarwinproduction.delivery_method,
NULL::"unknown" AS device_advertising_id,
NULL::"unknown" AS device_id,
NULL::"unknown" AS device_id_prop,
econdarwinproduction.device_name,
NULL::"unknown" AS device_type,
NULL::"unknown" AS device_type_prop,
econdarwinproduction.device_vendor_id,
NULL::"unknown" AS dfp_ad_id,
NULL::"unknown" AS dfp_site,
NULL::"unknown" AS dfp_zone,
NULL::"unknown" AS director_donor,
econdarwinproduction."domain",
econdarwinproduction.drupal_id,
NULL::"unknown" AS duplicate_events,
NULL::"unknown" AS duplicate_purchase,
NULL::"unknown" AS editors_pick_download,
NULL::"unknown" AS editors_pick_download_counter,
NULL::"unknown" AS editors_pick_download_prop,
NULL::"unknown" AS error_code,
NULL::"unknown" AS error_message,
NULL::"unknown" AS essay_section,
econdarwinproduction.event_id_partition_key,
econdarwinproduction.event_list,
econdarwinproduction.event_type,
econdarwinproduction.exclude_hit,
NULL::"unknown" AS facebook_widget_activity,
NULL::"unknown" AS fb_twitter_activity,
NULL::"unknown" AS first_hit_page_url,
NULL::"unknown" AS first_hit_pagename,
econdarwinproduction.first_hit_referrer,
NULL::"unknown" AS first_hit_time_gmt,
NULL::"unknown" AS form_name_field,
NULL::"unknown" AS form_sub_name,
econdarwinproduction.geo_city,
econdarwinproduction.geo_country,
econdarwinproduction.geo_dma,
econdarwinproduction.geo_region,
econdarwinproduction.geo_zip,
NULL::"unknown" AS google_play_subscriptions,
NULL::"unknown" AS grapeshot_value,
NULL::"unknown" AS hier1,
econdarwinproduction.hit_source,
NULL::"unknown" AS hit_time_gmt,
econdarwinproduction.hit_week,
econdarwinproduction.hitid_high,
econdarwinproduction.hitid_low,
econdarwinproduction.hour_of_day,
NULL::"unknown" AS int_sub_ads_first_click,
NULL::"unknown" AS int_sub_ads_last_click,
NULL::"unknown" AS internal_link,
NULL::"unknown" AS internal_link_external,
econdarwinproduction.ip,
econdarwinproduction.ip2,
econdarwinproduction.issue_date,
NULL::"unknown" AS issue_id,
econdarwinproduction.issue_region,
NULL::"unknown" AS key_interactions,
NULL::"unknown" AS key_interactions_pay_barrier_tracking,
econdarwinproduction."language",
NULL::"unknown" AS last_hit_time_gmt,
NULL::"unknown" AS last_purchase_num,
NULL::"unknown" AS last_purchase_time_gmt,
NULL::"unknown" AS link_name,
NULL::"unknown" AS link_page,
NULL::"unknown" AS loggedin,
NULL::"unknown" AS loggedin_prop,
NULL::"unknown" AS maximiser_campaign,
NULL::"unknown" AS mcvisid,
NULL::"unknown" AS meta_name,
econdarwinproduction.mobile_id,
NULL::"unknown" AS muls_subscription_type,
NULL::"unknown" AS multiuser_usage,
NULL::"unknown" AS navigated_by,
NULL::"unknown" AS navigated_by_prop,
econdarwinproduction.new_visit,
NULL::"unknown" AS newsletter_signup_from_reg,
NULL::"unknown" AS orientation,
NULL::"unknown" AS orientation_prop,
econdarwinproduction.os,
econdarwinproduction.os_version,
econdarwinproduction.page_event,
econdarwinproduction.page_event_var1,
econdarwinproduction.page_event_var2,
econdarwinproduction.page_event_var3,
NULL::"unknown" AS page_name,
NULL::"unknown" AS page_share_link,
NULL::"unknown" AS page_site_id,
econdarwinproduction.page_type,
econdarwinproduction.page_url,
NULL::"unknown" AS page_video_play,
NULL::"unknown" AS page_view,
econdarwinproduction.pagename,
NULL::"unknown" AS paid_free,
NULL::"unknown" AS paid_free_prop,
econdarwinproduction.paid_search,
NULL::"unknown" AS partner_referrals,
NULL::"unknown" AS payment_type,
econdarwinproduction.persistent_cookie,
NULL::"unknown" AS pointofinterest,
NULL::"unknown" AS pointofinterestdistance,
NULL::"unknown" AS post_ad_load_exit,
econdarwinproduction.post_campaign,
econdarwinproduction.post_channel,
econdarwinproduction.post_cookies,
econdarwinproduction.post_currency,
econdarwinproduction.post_event_list,
econdarwinproduction.post_hier1,
econdarwinproduction.post_hier2,
econdarwinproduction.post_hier3,
econdarwinproduction.post_hier4,
econdarwinproduction.post_hier5,
NULL::"unknown" AS post_java_enabled,
econdarwinproduction.post_keywords,
NULL::"unknown" AS post_mobileappid,
NULL::"unknown" AS post_mobiledayofweek,
NULL::"unknown" AS post_mobiledayssincefirstuse,
NULL::"unknown" AS post_mobiledayssincelastuse,
NULL::"unknown" AS post_mobiledevice,
NULL::"unknown" AS post_mobilehourofday,
NULL::"unknown" AS post_mobileinstalldate,
NULL::"unknown" AS post_mobilelaunchnumber,
NULL::"unknown" AS post_mobileosversion,
NULL::"unknown" AS post_mobileresolution,
econdarwinproduction.post_page_event::character varying(255) AS post_page_event,
econdarwinproduction.post_page_event_var1,
econdarwinproduction.post_page_event_var2,
econdarwinproduction.post_page_event_var3,
econdarwinproduction.post_page_url,
econdarwinproduction.post_pagename,
econdarwinproduction.post_pagename_no_url,
econdarwinproduction.post_partner_plugins,
econdarwinproduction.post_persistent_cookie,
NULL::"unknown" AS post_pointofinterest,
NULL::"unknown" AS post_pointofinterestdistance,
econdarwinproduction.post_product_list,
econdarwinproduction.post_purchaseid,
econdarwinproduction.post_referrer,
econdarwinproduction.post_search_engine,
econdarwinproduction.post_state,
econdarwinproduction.post_survey,
econdarwinproduction.post_t_time_info,
NULL::"unknown" AS post_zip,
econdarwinproduction.prev_page,
econdarwinproduction.product_id,
econdarwinproduction.product_list,
NULL::"unknown" AS promo_code,
NULL::"unknown" AS prop_article_published_date,
NULL::"unknown" AS prop_cust_type_prod,
NULL::"unknown" AS prop_drupal_id,
NULL::"unknown" AS prop_story_title,
NULL::"unknown" AS prop_user_login_status,
econdarwinproduction.purchase_id,
NULL::"unknown" AS purchaseid,
econdarwinproduction.ref_domain,
econdarwinproduction.ref_type,
econdarwinproduction.referrer,
econdarwinproduction.referring_subdomain,
econdarwinproduction."region",
NULL::"unknown" AS region_served,
NULL::"unknown" AS registration,
NULL::"unknown" AS renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
econdarwinproduction.s_resolution,
econdarwinproduction.sampled_hit,
econdarwinproduction.search_engine,
econdarwinproduction.search_page_num,
NULL::"unknown" AS search_results,
econdarwinproduction.secondary_hit,
econdarwinproduction.service,
NULL::"unknown" AS share_type,
NULL::"unknown" AS share_type_prop,
NULL::"unknown" AS sharelink,
econdarwinproduction.source,
econdarwinproduction.state,
econdarwinproduction.stats_server,
econdarwinproduction.story_title,
NULL::"unknown" AS story_title_prop,
NULL::"unknown" AS sub_data_protection,
NULL::"unknown" AS sub_date_end,
NULL::"unknown" AS sub_expiration,
NULL::"unknown" AS sub_length,
NULL::"unknown" AS sub_login_reg_activities,
NULL::"unknown" AS sub_start_date,
NULL::"unknown" AS sublength,
econdarwinproduction.subscriber_type,
NULL::"unknown" AS subscriber_type_prop,
econdarwinproduction.subscription_new,
econdarwinproduction.subscription_page_new,
NULL::"unknown" AS subscription_page_renew,
NULL::"unknown" AS subscription_renew,
NULL::"unknown" AS subscription_term_google_play,
NULL::"unknown" AS subsection,
econdarwinproduction.t_time_info,
econdarwinproduction.teg_hit_gmt_datetime,
econdarwinproduction.teg_hit_local_datetime,
econdarwinproduction.teg_hit_timezone_offset,
NULL::"unknown" AS "template",
NULL::"unknown" AS template_type,
NULL::"unknown" AS ub_form_abandonment,
NULL::"unknown" AS ub_offer_country,
NULL::"unknown" AS ub_product_code,
NULL::"unknown" AS ub_sub,
NULL::"unknown" AS url,
NULL::"unknown" AS user_agent,
NULL::"unknown" AS user_agent_evar,
NULL::"unknown" AS user_agent_prop,
NULL::"unknown" AS user_login_status,
NULL::"unknown" AS userid,
NULL::"unknown" AS username,
econdarwinproduction.valid_user,
econdarwinproduction.valid_view,
econdarwinproduction.valid_visit,
NULL::"unknown" AS video_play,
NULL::"unknown" AS video_segment,
NULL::"unknown" AS video_tags,
NULL::"unknown" AS video_tags_prop,
NULL::"unknown" AS videos,
NULL::"unknown" AS videos_formatted,
econdarwinproduction.visid_high,
econdarwinproduction.visid_low,
econdarwinproduction.visid_new,
econdarwinproduction.visid_timestamp,
econdarwinproduction.visid_type,
econdarwinproduction.visit_id,
econdarwinproduction.visit_keywords,
econdarwinproduction.visit_num,
NULL::"unknown" AS visit_number_new_repeat,
NULL::"unknown" AS visit_page_num,
econdarwinproduction.visit_referrer,
econdarwinproduction.visit_search_engine,
econdarwinproduction.visit_start_page_url,
econdarwinproduction.visit_start_pagename,
econdarwinproduction.visitor_id,
econdarwinproduction.visitor_id_evar,
NULL::"unknown" AS week_type,
econdarwinproduction.drupal_or_visitor_id,
econdarwinproduction.external_file_id,
econdarwinproduction.external_file_rownumber
   FROM adobe.econdarwinproduction;
GRANT SELECT ON adobe.combined TO GROUP readonly;

---------------------------------------------------------------------------------------------------
-- 00219_recreate_adobe_econdarwinproduction_events.sql
---------------------------------------------------------------------------------------------------
DROP VIEW adobe.combined_events;

ALTER TABLE adobe.econdarwinproduction_events RENAME TO econdarwinproduction_events_old;

CREATE TABLE adobe.econdarwinproduction_events
(
   drupal_or_visitor_id     VARCHAR(256) ENCODE zstd,
   external_file_id         BIGINT       ENCODE zstd,
   external_file_rownumber  BIGINT       ENCODE zstd,
   teg_hit_local_datetime   TIMESTAMP    ENCODE zstd,
   event_code               INTEGER      ENCODE zstd,
   event_value              VARCHAR(256) ENCODE zstd,
   event_total_count        INTEGER      ENCODE zstd,
   event_sequence           INTEGER      ENCODE zstd,
   visit_event_total_count  INTEGER      ENCODE zstd,
   visit_event_sequence     INTEGER      ENCODE zstd,
   visit_id                 VARCHAR(256) ENCODE zstd,
   visit_num                INTEGER      ENCODE zstd
) DISTKEY (drupal_or_visitor_id) COMPOUND SORTKEY (external_file_id, external_file_rownumber)
;

GRANT SELECT ON adobe.econdarwinproduction_events TO GROUP readonly;

INSERT INTO adobe.econdarwinproduction_events
SELECT * 
  FROM adobe.econdarwinproduction_events_old;

DROP TABLE adobe.econdarwinproduction_events_old;

CREATE OR REPLACE VIEW adobe.combined_events
(
  drupal_or_visitor_id,
  external_file_id,
  external_file_rownumber,
  teg_hit_local_datetime,
  event_code,
  event_value,
  event_total_count,
  event_sequence,
  source,
  visit_event_total_count,
  visit_event_sequence,
  visit_id,
  visit_num
)
AS
( 
    SELECT
        economistcomprod_events.drupal_or_visitor_id
      , economistcomprod_events.external_file_id
      , economistcomprod_events.external_file_rownumber
      , economistcomprod_events.teg_hit_local_datetime
      , economistcomprod_events.event_code
      , economistcomprod_events.event_value
      , economistcomprod_events.event_total_count
      , economistcomprod_events.event_sequence
      , 'Economist Online' AS source
      , economistcomprod_events.visit_event_total_count
      , economistcomprod_events.visit_event_sequence
      , economistcomprod_events.visit_id
      , economistcomprod_events.visit_num
    FROM
        adobe.economistcomprod_events
    
    UNION ALL
    
    SELECT
        econdarwinproduction_events.drupal_or_visitor_id
      , econdarwinproduction_events.external_file_id
      , econdarwinproduction_events.external_file_rownumber
      , econdarwinproduction_events.teg_hit_local_datetime
      , econdarwinproduction_events.event_code
      , econdarwinproduction_events.event_value
      , econdarwinproduction_events.event_total_count
      , econdarwinproduction_events.event_sequence
      , 'Espresso' AS source
      , econdarwinproduction_events.visit_event_total_count
      , econdarwinproduction_events.visit_event_sequence
      , econdarwinproduction_events.visit_id
      , econdarwinproduction_events.visit_num
    FROM
        adobe.econdarwinproduction_events
)

UNION ALL

SELECT
    econprodappipad_events.drupal_or_visitor_id
  , econprodappipad_events.external_file_id
  , econprodappipad_events.external_file_rownumber
  , econprodappipad_events.teg_hit_local_datetime
  , econprodappipad_events.event_code
  , econprodappipad_events.event_value
  , econprodappipad_events.event_total_count
  , econprodappipad_events.event_sequence
  , 'Digital App' AS source
  , econprodappipad_events.visit_event_total_count
  , econprodappipad_events.visit_event_sequence
  , econprodappipad_events.visit_id
  , econprodappipad_events.visit_num
FROM
    adobe.econprodappipad_events
;

GRANT SELECT ON adobe.combined_events TO GROUP readonly;

---------------------------------------------------------------------------------------------------
-- 00219_recreate_adobe_econdarwinproduction_events_rollback.sql
---------------------------------------------------------------------------------------------------
DROP VIEW adobe.combined_events;

ALTER TABLE adobe.econdarwinproduction_events RENAME TO econdarwinproduction_events_old;

CREATE TABLE adobe.econdarwinproduction_events
(
   drupal_or_visitor_id     VARCHAR(256) ENCODE lzo,
   external_file_id         BIGINT,
   external_file_rownumber  BIGINT       ENCODE delta,
   teg_hit_local_datetime   TIMESTAMP    ENCODE lzo,
   event_code               INTEGER      ENCODE lzo,
   event_value              VARCHAR(256) ENCODE lzo,
   event_total_count        INTEGER      ENCODE lzo,
   event_sequence           INTEGER      ENCODE lzo,
   visit_event_total_count  INTEGER      ENCODE lzo,
   visit_event_sequence     INTEGER      ENCODE lzo,
   visit_id                 VARCHAR(256) ENCODE lzo,
   visit_num                INTEGER      ENCODE lzo
) DISTKEY (drupal_or_visitor_id) COMPOUND SORTKEY (external_file_id, external_file_rownumber)
;

GRANT SELECT ON adobe.econdarwinproduction_events TO GROUP readonly;

INSERT INTO adobe.econdarwinproduction_events
SELECT * 
  FROM adobe.econdarwinproduction_events_old;

DROP TABLE adobe.econdarwinproduction_events_old;

CREATE OR REPLACE VIEW adobe.combined_events
(
  drupal_or_visitor_id,
  external_file_id,
  external_file_rownumber,
  teg_hit_local_datetime,
  event_code,
  event_value,
  event_total_count,
  event_sequence,
  source,
  visit_event_total_count,
  visit_event_sequence,
  visit_id,
  visit_num
)
AS
( 
    SELECT
        economistcomprod_events.drupal_or_visitor_id
      , economistcomprod_events.external_file_id
      , economistcomprod_events.external_file_rownumber
      , economistcomprod_events.teg_hit_local_datetime
      , economistcomprod_events.event_code
      , economistcomprod_events.event_value
      , economistcomprod_events.event_total_count
      , economistcomprod_events.event_sequence
      , 'Economist Online' AS source
      , economistcomprod_events.visit_event_total_count
      , economistcomprod_events.visit_event_sequence
      , economistcomprod_events.visit_id
      , economistcomprod_events.visit_num
    FROM
        adobe.economistcomprod_events
    
    UNION ALL
    
    SELECT
        econdarwinproduction_events.drupal_or_visitor_id
      , econdarwinproduction_events.external_file_id
      , econdarwinproduction_events.external_file_rownumber
      , econdarwinproduction_events.teg_hit_local_datetime
      , econdarwinproduction_events.event_code
      , econdarwinproduction_events.event_value
      , econdarwinproduction_events.event_total_count
      , econdarwinproduction_events.event_sequence
      , 'Espresso' AS source
      , econdarwinproduction_events.visit_event_total_count
      , econdarwinproduction_events.visit_event_sequence
      , econdarwinproduction_events.visit_id
      , econdarwinproduction_events.visit_num
    FROM
        adobe.econdarwinproduction_events
)

UNION ALL

SELECT
    econprodappipad_events.drupal_or_visitor_id
  , econprodappipad_events.external_file_id
  , econprodappipad_events.external_file_rownumber
  , econprodappipad_events.teg_hit_local_datetime
  , econprodappipad_events.event_code
  , econprodappipad_events.event_value
  , econprodappipad_events.event_total_count
  , econprodappipad_events.event_sequence
  , 'Digital App' AS source
  , econprodappipad_events.visit_event_total_count
  , econprodappipad_events.visit_event_sequence
  , econprodappipad_events.visit_id
  , econprodappipad_events.visit_num
FROM
    adobe.econprodappipad_events
;


GRANT SELECT ON adobe.combined_events TO GROUP readonly;

---------------------------------------------------------------------------------------------------
-- 00220_recreate_adobe_economistcomprod.sql
---------------------------------------------------------------------------------------------------
DROP VIEW adobe.combined;

CREATE TABLE adobe.economistcomprod_new
(browser VARCHAR(256) ENCODE zstd
        ,browser_height VARCHAR(128) ENCODE zstd
        ,browser_width BIGINT ENCODE zstd
        ,campaign VARCHAR(300) ENCODE zstd
        ,channel VARCHAR(256) ENCODE zstd
        ,click_action VARCHAR(256) ENCODE zstd
        ,click_action_type SMALLINT ENCODE zstd
        ,click_tag VARCHAR(256) ENCODE zstd
        ,ct_connect_type VARCHAR(256) ENCODE zstd
        ,curr_factor SMALLINT ENCODE zstd
        ,curr_rate DECIMAL ENCODE zstd
        ,currency VARCHAR(256) ENCODE zstd
        ,date_time TIMESTAMP ENCODE zstd
        ,domain VARCHAR(256) ENCODE zstd
        ,exclude_hit SMALLINT ENCODE zstd
        ,first_hit_page_url VARCHAR(320) ENCODE zstd
        ,first_hit_pagename VARCHAR(320) ENCODE zstd
        ,first_hit_referrer VARCHAR(320) ENCODE zstd
        ,first_hit_time_gmt TIMESTAMP ENCODE zstd
        ,geo_city VARCHAR(256) ENCODE zstd
        ,geo_dma BIGINT ENCODE zstd
        ,geo_region VARCHAR(256) ENCODE zstd
        ,geo_zip VARCHAR(256) ENCODE zstd
        ,hier1 VARCHAR(256) ENCODE zstd
        ,hit_source SMALLINT ENCODE zstd
        ,hit_time_gmt TIMESTAMP ENCODE zstd
        ,hitid_high BIGINT ENCODE zstd
        ,hitid_low BIGINT ENCODE zstd
        ,ip VARCHAR(256) ENCODE zstd
        ,ip2 VARCHAR(256) ENCODE zstd
        ,language BIGINT ENCODE zstd
        ,last_hit_time_gmt TIMESTAMP ENCODE zstd
        ,last_purchase_num BIGINT ENCODE zstd
        ,mobile_id BIGINT ENCODE zstd
        ,new_visit SMALLINT ENCODE zstd
        ,os BIGINT ENCODE zstd
        ,page_event SMALLINT ENCODE zstd
        ,page_event_var1 VARCHAR(65535) ENCODE zstd
        ,page_share_link VARCHAR(256) ENCODE zstd
        ,page_video_play VARCHAR(65535) ENCODE zstd
        ,page_type VARCHAR(256) ENCODE zstd
        ,paid_search SMALLINT ENCODE zstd
        ,persistent_cookie CHAR(1) ENCODE zstd
        ,post_campaign VARCHAR(300) ENCODE zstd
        ,post_channel VARCHAR(256) ENCODE zstd
        ,post_cookies CHAR(1) ENCODE zstd
        ,post_currency VARCHAR(256) ENCODE zstd
        ,issue_date VARCHAR(256) ENCODE zstd
        ,article_publishing VARCHAR(256) ENCODE zstd
        ,content_type VARCHAR(256) ENCODE zstd
        ,story_title VARCHAR(256) ENCODE zstd
        ,grapeshot_value VARCHAR(256) ENCODE zstd
        ,hour_of_day VARCHAR(256) ENCODE zstd
        ,week_type VARCHAR(256) ENCODE zstd
        ,user_login_status VARCHAR(256) ENCODE zstd
        ,cust_type_prod VARCHAR(256) ENCODE zstd
        ,referring_subdomain VARCHAR(256) ENCODE zstd
        ,facebook_widget_activity VARCHAR(256) ENCODE zstd
        ,visit_number_new_repeat VARCHAR(256) ENCODE zstd
        ,key_interactions_pay_barrier_tracking VARCHAR(256) ENCODE zstd
        ,partner_referrals VARCHAR(2000) ENCODE zstd
        ,content_category VARCHAR(256) ENCODE zstd
        ,advu_mpu VARCHAR(256) ENCODE zstd
        ,videos VARCHAR(256) ENCODE zstd
        ,newsletter_signup_from_reg VARCHAR(256) ENCODE zstd
        ,promo_code VARCHAR(256) ENCODE zstd
        ,article_published_date TIMESTAMP ENCODE zstd
        ,url VARCHAR(320) ENCODE zstd
        ,multiuser_usage VARCHAR(256) ENCODE zstd
        ,fb_twitter_activity VARCHAR(256) ENCODE zstd
        ,video_tags VARCHAR(256) ENCODE zstd
        ,page_name VARCHAR(256) ENCODE zstd
        ,region_served VARCHAR(256) ENCODE zstd
        ,drupal_id INTEGER ENCODE zstd
        ,dfp_site VARCHAR(256) ENCODE zstd
        ,dfp_zone VARCHAR(256) ENCODE zstd
        ,geo_country VARCHAR(256) ENCODE zstd
        ,ad_viewed_clicked VARCHAR(256) ENCODE zstd
        ,muls_subscription_type VARCHAR(256) ENCODE zstd
        ,bulk_ip_address VARCHAR(256) ENCODE zstd
        ,campaign_attribution_paid VARCHAR(256) ENCODE zstd
        ,campaign_attribution_owned_earned VARCHAR(256) ENCODE zstd
        ,campaign_stacking_all VARCHAR(256) ENCODE zstd
        ,maximiser_campaign VARCHAR(256) ENCODE zstd
        ,internal_link VARCHAR(256) ENCODE zstd
        ,internal_link_external VARCHAR(256) ENCODE zstd
        ,br_camp_cid1_linear VARCHAR(300) ENCODE zstd
        ,br_camp_cid1_lst_click VARCHAR(300) ENCODE zstd
        ,br_camp_cid1_fst_click VARCHAR(300) ENCODE zstd
        ,br_camp_cid2_linear VARCHAR(300) ENCODE zstd
        ,br_camp_cid2_lst_click VARCHAR(300) ENCODE zstd
        ,br_camp_cid2_fst_click VARCHAR(300) ENCODE zstd
        ,ub_offer_country VARCHAR(256) ENCODE zstd
        ,ub_product_code VARCHAR(256) ENCODE zstd
        ,form_sub_name VARCHAR(256) ENCODE zstd
        ,form_name_field VARCHAR(256) ENCODE zstd
        ,ub_form_abandonment VARCHAR(256) ENCODE zstd
        ,dfp_ad_id VARCHAR(256) ENCODE zstd
        ,sub_login_reg_activities VARCHAR(256) ENCODE zstd
        ,renewal_start_end_date VARCHAR(256) ENCODE zstd
        ,sub_date_end VARCHAR(256) ENCODE zstd
        ,page_site_id VARCHAR(256) ENCODE zstd
        ,subsection VARCHAR(256) ENCODE zstd
        ,int_sub_ads_last_click VARCHAR(256) ENCODE zstd
        ,int_sub_ads_first_click VARCHAR(256) ENCODE zstd
        ,amstelnet_order_id VARCHAR(256) ENCODE zstd
        ,sub_length VARCHAR(256) ENCODE zstd
        ,post_event_list VARCHAR(65535) ENCODE zstd
        ,post_hier1 VARCHAR(256) ENCODE zstd
        ,post_hier2 VARCHAR(256) ENCODE zstd
        ,post_hier3 VARCHAR(256) ENCODE zstd
        ,post_hier4 VARCHAR(256) ENCODE zstd
        ,post_hier5 VARCHAR(256) ENCODE zstd
        ,post_keywords VARCHAR(256) ENCODE zstd
        ,post_page_event VARCHAR(256) ENCODE zstd
        ,post_page_event_var1 VARCHAR(320) ENCODE zstd
        ,sharelink VARCHAR(320) ENCODE zstd
        ,video_play VARCHAR(65535) ENCODE zstd
        ,post_page_url VARCHAR(320) ENCODE zstd
        ,post_pagename VARCHAR(256) ENCODE zstd
        ,post_pagename_no_url VARCHAR(256) ENCODE zstd
        ,post_partner_plugins VARCHAR(256) ENCODE zstd
        ,post_product_list VARCHAR(65535) ENCODE zstd
        ,revamp_tracking VARCHAR(65535) ENCODE zstd
        ,post_purchaseid VARCHAR(256) ENCODE zstd
        ,post_referrer VARCHAR(320) ENCODE zstd
        ,post_search_engine BIGINT ENCODE zstd
        ,post_state VARCHAR(256) ENCODE zstd
        ,post_survey VARCHAR(65535) ENCODE zstd
        ,post_t_time_info VARCHAR(256) ENCODE zstd
        ,prev_page BIGINT ENCODE zstd
        ,product_list VARCHAR(65535) ENCODE zstd
        ,prop_subsection_old VARCHAR(256) ENCODE zstd
        ,prop_issue_date VARCHAR(256) ENCODE zstd
        ,content_Source VARCHAR(256) ENCODE zstd
        ,content_type_prop VARCHAR(256) ENCODE zstd
        ,prop_story_title VARCHAR(256) ENCODE zstd
        ,date_day_Weektype VARCHAR(256) ENCODE zstd
        ,prop_user_login_status VARCHAR(256) ENCODE zstd
        ,prop_cust_type_prod VARCHAR(256) ENCODE zstd
        ,key_interactions VARCHAR(256) ENCODE zstd
        ,video_segment VARCHAR(256) ENCODE zstd
        ,prop_partner_referrals VARCHAR(256) ENCODE zstd
        ,sub_start_date VARCHAR(256) ENCODE zstd
        ,meta_name VARCHAR(256) ENCODE zstd
        ,advu_mpu_prop VARCHAR(256) ENCODE zstd
        ,prop_article_published_date VARCHAR(256) ENCODE zstd
        ,sub_data_protection  VARCHAR(256) ENCODE zstd
        ,video_tags_prop VARCHAR(256) ENCODE zstd
        ,prop_drupal_id INTEGER ENCODE zstd
        ,link_name VARCHAR(256) ENCODE zstd
        ,essay_section VARCHAR(256) ENCODE zstd
        ,sub_expiration VARCHAR(256) ENCODE zstd
        ,customer_lifecycle VARCHAR(256) ENCODE zstd
        ,sublength VARCHAR(256) ENCODE zstd
        ,campaign_attribution VARCHAR(256) ENCODE zstd
        ,payment_type VARCHAR(256) ENCODE zstd
        ,prop_subsection VARCHAR(256) ENCODE zstd
        ,campaign_tracking VARCHAR(256) ENCODE zstd
        ,director_donor VARCHAR(256) ENCODE zstd
        ,ub_sub VARCHAR(256) ENCODE zstd
        ,search_results VARCHAR(256) ENCODE zstd
        ,error_code VARCHAR(256) ENCODE zstd
        ,error_message VARCHAR(256) ENCODE zstd
        ,purchaseid VARCHAR(256) ENCODE zstd
        ,ref_domain VARCHAR(256) ENCODE zstd
        ,ref_type SMALLINT ENCODE zstd
        ,referrer VARCHAR(320) ENCODE zstd
        ,s_resolution VARCHAR(256) ENCODE zstd
        ,search_engine BIGINT ENCODE zstd
        ,search_page_num BIGINT ENCODE zstd
        ,service CHAR(2) ENCODE zstd
        ,state VARCHAR(256) ENCODE zstd
        ,stats_server VARCHAR(256) ENCODE zstd
        ,t_time_info VARCHAR(256) ENCODE zstd
        ,visid_timestamp TIMESTAMP ENCODE zstd
        ,visid_type SMALLINT ENCODE zstd
        ,visit_keywords VARCHAR(256) ENCODE zstd
        ,visit_num BIGINT ENCODE zstd
        ,visit_referrer VARCHAR(320) ENCODE zstd
        ,visit_search_engine VARCHAR(256) ENCODE zstd
        ,visit_start_page_url VARCHAR(320) ENCODE zstd
        ,visit_start_pagename VARCHAR(256) ENCODE zstd
        ,visit_start_time_gmt TIMESTAMP ENCODE zstd
        ,accept_language VARCHAR(384) ENCODE zstd
        ,source VARCHAR(16) ENCODE zstd
        ,region VARCHAR(15) ENCODE zstd
        ,visitor_id varchar(256) ENCODE zstd
        ,visit_id VARCHAR(256) ENCODE zstd
        ,userid BIGINT ENCODE zstd
        ,username VARCHAR(256) ENCODE zstd
        ,visit_page_num BIGINT ENCODE zstd
        ,videos_formatted VARCHAR(256) ENCODE zstd
        ,audio INTEGER ENCODE zstd
        ,valid_user INTEGER ENCODE zstd
        ,valid_view INTEGER ENCODE zstd
        ,valid_visit INTEGER ENCODE zstd
        ,event_id_partition_key VARCHAR(87) ENCODE zstd
        ,hit_week TIMESTAMP ENCODE zstd
        ,subscription_page_new INTEGER ENCODE zstd
        ,subscription_page_renew INTEGER ENCODE zstd
        ,subscription_new INTEGER ENCODE zstd
        ,subscription_renew INTEGER ENCODE zstd
        ,registration INTEGER ENCODE zstd
        ,teg_hit_local_datetime TIMESTAMP ENCODE zstd
        ,teg_hit_gmt_datetime TIMESTAMP ENCODE zstd
        ,teg_hit_timezone_offset INTEGER ENCODE zstd
        ,drupal_or_visitor_id VARCHAR(256) ENCODE zstd
        ,EXTERNAL_FILE_ID BIGINT ENCODE zstd
        ,EXTERNAL_FILE_ROWNUMBER BIGINT ENCODE zstd
) DISTKEY (drupal_or_visitor_id) SORTKEY (teg_hit_local_datetime);

set wlm_query_slot_count to 8;

INSERT INTO adobe.economistcomprod_new
SELECT * FROM adobe.economistcomprod;

ALTER TABLE adobe.economistcomprod RENAME TO economistcomprod_oldb;
ALTER TABLE adobe.economistcomprod_new RENAME TO economistcomprod;

GRANT INSERT ON adobe.economistcomprod TO copyrole;
GRANT SELECT ON adobe.economistcomprod TO GROUP readonly;

CREATE OR REPLACE VIEW adobe.combined
(
  accept_language,
  ad_impressions,
  ad_impresson,
  ad_load_exit,
  ad_region,
  ad_viewed_clicked,
  adload_adexit,
  advu_mpu,
  advu_mpu_prop,
  amstelnet_order_id,
  app_advertising_id,
  app_id,
  app_id_prop,
  app_name,
  app_rating,
  app_rating_prop,
  article_published_date,
  article_publishing,
  audio,
  audio_progress,
  audio_segment,
  br_camp_cid1_fst_click,
  br_camp_cid1_linear,
  br_camp_cid1_lst_click,
  br_camp_cid2_fst_click,
  br_camp_cid2_linear,
  br_camp_cid2_lst_click,
  browser,
  browser_height,
  browser_width,
  bulk_ip_address,
  campaign,
  campaign_attribution,
  campaign_attribution_owned_earned,
  campaign_attribution_paid,
  campaign_stacking_all,
  campaign_tracking,
  carrier,
  channel,
  click_action,
  click_action_type,
  click_tag,
  code_ver,
  connection_type,
  connection_type_prop,
  content_category,
  content_region,
  content_region_prop,
  content_source,
  content_type,
  cookies,
  country,
  country_residence,
  ct_connect_type,
  curr_factor,
  curr_rate,
  currency,
  cust_hit_time_gmt,
  cust_type_prod,
  cust_visid,
  customer_lifecycle,
  date_day_weektype,
  date_time,
  delivery_method,
  device_advertising_id,
  device_id,
  device_id_prop,
  device_name,
  device_type,
  device_type_prop,
  device_vendor_id,
  dfp_ad_id,
  dfp_site,
  dfp_zone,
  director_donor,
  domain,
  drupal_id,
  duplicate_events,
  duplicate_purchase,
  editors_pick_download,
  editors_pick_download_counter,
  editors_pick_download_prop,
  error_code,
  error_message,
  essay_section,
  event_id_partition_key,
  event_list,
  event_type,
  exclude_hit,
  facebook_widget_activity,
  fb_twitter_activity,
  first_hit_page_url,
  first_hit_pagename,
  first_hit_referrer,
  first_hit_time_gmt,
  form_name_field,
  form_sub_name,
  geo_city,
  geo_country,
  geo_dma,
  geo_region,
  geo_zip,
  google_play_subscriptions,
  grapeshot_value,
  hier1,
  hit_source,
  hit_time_gmt,
  hit_week,
  hitid_high,
  hitid_low,
  hour_of_day,
  int_sub_ads_first_click,
  int_sub_ads_last_click,
  internal_link,
  internal_link_external,
  ip,
  ip2,
  issue_date,
  issue_id,
  issue_region,
  key_interactions,
  key_interactions_pay_barrier_tracking,
  language,
  last_hit_time_gmt,
  last_purchase_num,
  last_purchase_time_gmt,
  link_name,
  link_page,
  loggedin,
  loggedin_prop,
  maximiser_campaign,
  mcvisid,
  meta_name,
  mobile_id,
  muls_subscription_type,
  multiuser_usage,
  navigated_by,
  navigated_by_prop,
  new_visit,
  newsletter_signup_from_reg,
  orientation,
  orientation_prop,
  os,
  os_version,
  page_event,
  page_event_var1,
  page_event_var2,
  page_event_var3,
  page_name,
  page_share_link,
  page_site_id,
  page_type,
  page_url,
  page_video_play,
  page_view,
  pagename,
  paid_free,
  paid_free_prop,
  paid_search,
  partner_referrals,
  payment_type,
  persistent_cookie,
  pointofinterest,
  pointofinterestdistance,
  post_ad_load_exit,
  post_campaign,
  post_channel,
  post_cookies,
  post_currency,
  post_event_list,
  post_hier1,
  post_hier2,
  post_hier3,
  post_hier4,
  post_hier5,
  post_java_enabled,
  post_keywords,
  post_mobileappid,
  post_mobiledayofweek,
  post_mobiledayssincefirstuse,
  post_mobiledayssincelastuse,
  post_mobiledevice,
  post_mobilehourofday,
  post_mobileinstalldate,
  post_mobilelaunchnumber,
  post_mobileosversion,
  post_mobileresolution,
  post_page_event,
  post_page_event_var1,
  post_page_event_var2,
  post_page_event_var3,
  post_page_url,
  post_pagename,
  post_pagename_no_url,
  post_partner_plugins,
  post_persistent_cookie,
  post_pointofinterest,
  post_pointofinterestdistance,
  post_product_list,
  post_purchaseid,
  post_referrer,
  post_search_engine,
  post_state,
  post_survey,
  post_t_time_info,
  post_zip,
  prev_page,
  product_id,
  product_list,
  promo_code,
  prop_article_published_date,
  prop_cust_type_prod,
  prop_drupal_id,
  prop_story_title,
  prop_user_login_status,
  purchase_id,
  purchaseid,
  ref_domain,
  ref_type,
  referrer,
  referring_subdomain,
  region,
  region_served,
  registration,
  renewal_start_end_date,
  revamp_tracking,
  s_resolution,
  sampled_hit,
  search_engine,
  search_page_num,
  search_results,
  secondary_hit,
  service,
  share_type,
  share_type_prop,
  sharelink,
  source,
  state,
  stats_server,
  story_title,
  story_title_prop,
  sub_data_protection,
  sub_date_end,
  sub_expiration,
  sub_length,
  sub_login_reg_activities,
  sub_start_date,
  sublength,
  subscriber_type,
  subscriber_type_prop,
  subscription_new,
  subscription_page_new,
  subscription_page_renew,
  subscription_renew,
  subscription_term_google_play,
  subsection,
  t_time_info,
  teg_hit_gmt_datetime,
  teg_hit_local_datetime,
  teg_hit_timezone_offset,
  template,
  template_type,
  ub_form_abandonment,
  ub_offer_country,
  ub_product_code,
  ub_sub,
  url,
  user_agent,
  user_agent_evar,
  user_agent_prop,
  user_login_status,
  userid,
  username,
  valid_user,
  valid_view,
  valid_visit,
  video_play,
  video_segment,
  video_tags,
  video_tags_prop,
  videos,
  videos_formatted,
  visid_high,
  visid_low,
  visid_new,
  visid_timestamp,
  visid_type,
  visit_id,
  visit_keywords,
  visit_num,
  visit_number_new_repeat,
  visit_page_num,
  visit_referrer,
  visit_search_engine,
  visit_start_page_url,
  visit_start_pagename,
  visitor_id,
  visitor_id_evar,
  week_type,
  drupal_or_visitor_id,
  external_file_id,
  external_file_rownumber
)
AS
( SELECT economistcomprod.accept_language,
NULL::"unknown" AS ad_impressions,
NULL::"unknown" AS ad_impresson,
NULL::"unknown" AS ad_load_exit,
NULL::"unknown" AS ad_region,
economistcomprod.ad_viewed_clicked,
NULL::"unknown" AS adload_adexit,
economistcomprod.advu_mpu,
economistcomprod.advu_mpu_prop,
economistcomprod.amstelnet_order_id,
NULL::"unknown" AS app_advertising_id,
NULL::"unknown" AS app_id,
NULL::"unknown" AS app_id_prop,
NULL::"unknown" AS app_name,
NULL::"unknown" AS app_rating,
NULL::"unknown" AS app_rating_prop,
economistcomprod.article_published_date,
economistcomprod.article_publishing,
economistcomprod.audio,
NULL::"unknown" AS audio_progress,
NULL::"unknown" AS audio_segment,
economistcomprod.br_camp_cid1_fst_click,
economistcomprod.br_camp_cid1_linear,
economistcomprod.br_camp_cid1_lst_click,
economistcomprod.br_camp_cid2_fst_click,
economistcomprod.br_camp_cid2_linear,
economistcomprod.br_camp_cid2_lst_click,
economistcomprod.browser,
economistcomprod.browser_height,
economistcomprod.browser_width,
economistcomprod.bulk_ip_address,
economistcomprod.campaign,
economistcomprod.campaign_attribution,
economistcomprod.campaign_attribution_owned_earned,
economistcomprod.campaign_attribution_paid,
economistcomprod.campaign_stacking_all,
economistcomprod.campaign_tracking,
NULL::"unknown" AS carrier,
economistcomprod.channel,
economistcomprod.click_action,
economistcomprod.click_action_type,
economistcomprod.click_tag,
NULL::"unknown" AS code_ver,
NULL::"unknown" AS connection_type,
NULL::"unknown" AS connection_type_prop,
economistcomprod.content_category,
NULL::"unknown" AS content_region,
NULL::"unknown" AS content_region_prop,
NULL::"unknown" AS content_source,
economistcomprod.content_type,
NULL::"unknown" AS cookies,
NULL::"unknown" AS country,
NULL::"unknown" AS country_residence,
economistcomprod.ct_connect_type,
economistcomprod.curr_factor,
economistcomprod.curr_rate,
economistcomprod.currency,
NULL::"unknown" AS cust_hit_time_gmt,
economistcomprod.cust_type_prod,
NULL::"unknown" AS cust_visid,
economistcomprod.customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
economistcomprod.date_time,
NULL::"unknown" AS delivery_method,
NULL::"unknown" AS device_advertising_id,
NULL::"unknown" AS device_id,
NULL::"unknown" AS device_id_prop,
NULL::"unknown" AS device_name,
NULL::"unknown" AS device_type,
NULL::"unknown" AS device_type_prop,
NULL::"unknown" AS device_vendor_id,
economistcomprod.dfp_ad_id,
economistcomprod.dfp_site,
economistcomprod.dfp_zone,
economistcomprod.director_donor,
economistcomprod."domain",
economistcomprod.drupal_id,
NULL::"unknown" AS duplicate_events,
NULL::"unknown" AS duplicate_purchase,
NULL::"unknown" AS editors_pick_download,
NULL::"unknown" AS editors_pick_download_counter,
NULL::"unknown" AS editors_pick_download_prop,
economistcomprod.error_code,
economistcomprod.error_message,
economistcomprod.essay_section,
economistcomprod.event_id_partition_key,
NULL::"unknown" AS event_list,
NULL::"unknown" AS event_type,
economistcomprod.exclude_hit,
economistcomprod.facebook_widget_activity,
economistcomprod.fb_twitter_activity,
economistcomprod.first_hit_page_url,
economistcomprod.first_hit_pagename,
economistcomprod.first_hit_referrer,
economistcomprod.first_hit_time_gmt,
economistcomprod.form_name_field,
economistcomprod.form_sub_name,
economistcomprod.geo_city,
economistcomprod.geo_country,
economistcomprod.geo_dma,
economistcomprod.geo_region,
economistcomprod.geo_zip,
NULL::"unknown" AS google_play_subscriptions,
economistcomprod.grapeshot_value,
economistcomprod.hier1,
economistcomprod.hit_source,
economistcomprod.hit_time_gmt,
economistcomprod.hit_week,
economistcomprod.hitid_high,
economistcomprod.hitid_low,
economistcomprod.hour_of_day,
economistcomprod.int_sub_ads_first_click,
economistcomprod.int_sub_ads_last_click,
economistcomprod.internal_link,
economistcomprod.internal_link_external,
economistcomprod.ip,
economistcomprod.ip2,
economistcomprod.issue_date,
NULL::"unknown" AS issue_id,
NULL::"unknown" AS issue_region,
economistcomprod.key_interactions,
economistcomprod.key_interactions_pay_barrier_tracking,
economistcomprod."language",
economistcomprod.last_hit_time_gmt,
economistcomprod.last_purchase_num,
NULL::"unknown" AS last_purchase_time_gmt,
economistcomprod.link_name,
NULL::"unknown" AS link_page,
NULL::"unknown" AS loggedin,
NULL::"unknown" AS loggedin_prop,
economistcomprod.maximiser_campaign,
NULL::"unknown" AS mcvisid,
economistcomprod.meta_name,
economistcomprod.mobile_id,
economistcomprod.muls_subscription_type,
economistcomprod.multiuser_usage,
NULL::"unknown" AS navigated_by,
NULL::"unknown" AS navigated_by_prop,
economistcomprod.new_visit,
economistcomprod.newsletter_signup_from_reg,
NULL::"unknown" AS orientation,
NULL::"unknown" AS orientation_prop,
economistcomprod.os,
NULL::"unknown" AS os_version,
economistcomprod.page_event,
economistcomprod.page_event_var1,
NULL::"unknown" AS page_event_var2,
NULL::"unknown" AS page_event_var3,
economistcomprod.page_name,
economistcomprod.page_share_link,
economistcomprod.page_site_id,
economistcomprod.page_type,
NULL::"unknown" AS page_url,
economistcomprod.page_video_play,
NULL::"unknown" AS page_view,
NULL::"unknown" AS pagename,
NULL::"unknown" AS paid_free,
NULL::"unknown" AS paid_free_prop,
economistcomprod.paid_search,
economistcomprod.partner_referrals,
economistcomprod.payment_type,
economistcomprod.persistent_cookie,
NULL::"unknown" AS pointofinterest,
NULL::"unknown" AS pointofinterestdistance,
NULL::"unknown" AS post_ad_load_exit,
economistcomprod.post_campaign,
economistcomprod.post_channel,
economistcomprod.post_cookies,
economistcomprod.post_currency,
economistcomprod.post_event_list,
economistcomprod.post_hier1,
economistcomprod.post_hier2,
economistcomprod.post_hier3,
economistcomprod.post_hier4,
economistcomprod.post_hier5,
NULL::"unknown" AS post_java_enabled,
economistcomprod.post_keywords,
NULL::"unknown" AS post_mobileappid,
NULL::"unknown" AS post_mobiledayofweek,
NULL::"unknown" AS post_mobiledayssincefirstuse,
NULL::"unknown" AS post_mobiledayssincelastuse,
NULL::"unknown" AS post_mobiledevice,
NULL::"unknown" AS post_mobilehourofday,
NULL::"unknown" AS post_mobileinstalldate,
NULL::"unknown" AS post_mobilelaunchnumber,
NULL::"unknown" AS post_mobileosversion,
NULL::"unknown" AS post_mobileresolution,
economistcomprod.post_page_event,
economistcomprod.post_page_event_var1,
NULL::"unknown" AS post_page_event_var2,
NULL::"unknown" AS post_page_event_var3,
economistcomprod.post_page_url,
economistcomprod.post_pagename,
economistcomprod.post_pagename_no_url,
economistcomprod.post_partner_plugins,
NULL::"unknown" AS post_persistent_cookie,
NULL::"unknown" AS post_pointofinterest,
NULL::"unknown" AS post_pointofinterestdistance,
economistcomprod.post_product_list,
economistcomprod.post_purchaseid,
economistcomprod.post_referrer,
economistcomprod.post_search_engine,
economistcomprod.post_state,
economistcomprod.post_survey,
economistcomprod.post_t_time_info,
NULL::"unknown" AS post_zip,
economistcomprod.prev_page,
NULL::"unknown" AS product_id,
economistcomprod.product_list,
economistcomprod.promo_code,
economistcomprod.prop_article_published_date,
economistcomprod.prop_cust_type_prod,
economistcomprod.prop_drupal_id,
economistcomprod.prop_story_title,
economistcomprod.prop_user_login_status,
NULL::"unknown" AS purchase_id,
economistcomprod.purchaseid,
economistcomprod.ref_domain,
economistcomprod.ref_type,
economistcomprod.referrer,
economistcomprod.referring_subdomain,
economistcomprod."region",
economistcomprod.region_served,
economistcomprod.registration,
economistcomprod.renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
economistcomprod.s_resolution,
NULL::"unknown" AS sampled_hit,
economistcomprod.search_engine,
economistcomprod.search_page_num,
economistcomprod.search_results,
NULL::"unknown" AS secondary_hit,
economistcomprod.service,
NULL::"unknown" AS share_type,
NULL::"unknown" AS share_type_prop,
economistcomprod.sharelink,
economistcomprod.source,
economistcomprod.state,
economistcomprod.stats_server,
economistcomprod.story_title,
NULL::"unknown" AS story_title_prop,
economistcomprod.sub_data_protection,
economistcomprod.sub_date_end,
economistcomprod.sub_expiration,
economistcomprod.sub_length,
economistcomprod.sub_login_reg_activities,
economistcomprod.sub_start_date,
economistcomprod.sublength,
NULL::"unknown" AS subscriber_type,
NULL::"unknown" AS subscriber_type_prop,
economistcomprod.subscription_new,
economistcomprod.subscription_page_new,
economistcomprod.subscription_page_renew,
economistcomprod.subscription_renew,
NULL::"unknown" AS subscription_term_google_play,
economistcomprod.subsection,
economistcomprod.t_time_info,
economistcomprod.teg_hit_gmt_datetime,
economistcomprod.teg_hit_local_datetime,
economistcomprod.teg_hit_timezone_offset,
NULL::"unknown" AS "template",
NULL::"unknown" AS template_type,
economistcomprod.ub_form_abandonment,
economistcomprod.ub_offer_country,
economistcomprod.ub_product_code,
economistcomprod.ub_sub,
economistcomprod.url,
NULL::"unknown" AS user_agent,
NULL::"unknown" AS user_agent_evar,
NULL::"unknown" AS user_agent_prop,
economistcomprod.user_login_status,
economistcomprod.userid,
economistcomprod.username,
economistcomprod.valid_user,
economistcomprod.valid_view,
economistcomprod.valid_visit,
economistcomprod.video_play,
economistcomprod.video_segment,
economistcomprod.video_tags,
economistcomprod.video_tags_prop,
economistcomprod.videos,
economistcomprod.videos_formatted,
NULL::"unknown" AS visid_high,
NULL::"unknown" AS visid_low,
NULL::"unknown" AS visid_new,
economistcomprod.visid_timestamp,
economistcomprod.visid_type,
economistcomprod.visit_id,
economistcomprod.visit_keywords,
economistcomprod.visit_num,
economistcomprod.visit_number_new_repeat,
economistcomprod.visit_page_num,
economistcomprod.visit_referrer,
economistcomprod.visit_search_engine,
economistcomprod.visit_start_page_url,
economistcomprod.visit_start_pagename,
economistcomprod.visitor_id,
NULL::"unknown" AS visitor_id_evar,
economistcomprod.week_type,
economistcomprod.drupal_or_visitor_id,
economistcomprod.external_file_id,
economistcomprod.external_file_rownumber
   FROM adobe.economistcomprod
UNION ALL
 SELECT econprodappipad.accept_language,
econprodappipad.ad_impressions,
econprodappipad.ad_impresson,
econprodappipad.ad_load_exit,
NULL::"unknown" AS ad_region,
NULL::"unknown" AS ad_viewed_clicked,
NULL::"unknown" AS adload_adexit,
NULL::"unknown" AS advu_mpu,
NULL::"unknown" AS advu_mpu_prop,
NULL::"unknown" AS amstelnet_order_id,
econprodappipad.app_advertising_id,
econprodappipad.app_id,
econprodappipad.app_id_prop,
econprodappipad.app_name,
econprodappipad.app_rating,
econprodappipad.app_rating_prop,
NULL::"unknown" AS article_published_date,
NULL::"unknown" AS article_publishing,
NULL::"unknown" AS audio,
econprodappipad.audio_progress,
econprodappipad.audio_segment,
NULL::"unknown" AS br_camp_cid1_fst_click,
NULL::"unknown" AS br_camp_cid1_linear,
NULL::"unknown" AS br_camp_cid1_lst_click,
NULL::"unknown" AS br_camp_cid2_fst_click,
NULL::"unknown" AS br_camp_cid2_linear,
NULL::"unknown" AS br_camp_cid2_lst_click,
econprodappipad.browser::character varying(256) AS browser,
econprodappipad.browser_height::character varying(256) AS browser_height,
econprodappipad.browser_width,
NULL::"unknown" AS bulk_ip_address,
econprodappipad.campaign,
NULL::"unknown" AS campaign_attribution,
NULL::"unknown" AS campaign_attribution_owned_earned,
NULL::"unknown" AS campaign_attribution_paid,
NULL::"unknown" AS campaign_stacking_all,
NULL::"unknown" AS campaign_tracking,
econprodappipad.carrier,
econprodappipad.channel,
NULL::"unknown" AS click_action,
NULL::"unknown" AS click_action_type,
NULL::"unknown" AS click_tag,
econprodappipad.code_ver,
econprodappipad.connection_type,
econprodappipad.connection_type_prop,
NULL::"unknown" AS content_category,
econprodappipad.content_region,
econprodappipad.content_region_prop,
NULL::"unknown" AS content_source,
NULL::"unknown" AS content_type,
econprodappipad.cookies,
econprodappipad.country,
econprodappipad.country_residence,
econprodappipad.ct_connect_type,
NULL::"unknown" AS curr_factor,
econprodappipad.curr_rate,
econprodappipad.currency,
econprodappipad.cust_hit_time_gmt,
NULL::"unknown" AS cust_type_prod,
NULL::"unknown" AS cust_visid,
NULL::"unknown" AS customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
econprodappipad.date_time,
NULL::"unknown" AS delivery_method,
econprodappipad.device_advertising_id,
econprodappipad.device_id,
econprodappipad.device_id_prop,
NULL::"unknown" AS device_name,
econprodappipad.device_type,
econprodappipad.device_type_prop,
NULL::"unknown" AS device_vendor_id,
NULL::"unknown" AS dfp_ad_id,
NULL::"unknown" AS dfp_site,
NULL::"unknown" AS dfp_zone,
NULL::"unknown" AS director_donor,
econprodappipad."domain",
econprodappipad.drupal_id,
econprodappipad.duplicate_events,
econprodappipad.duplicate_purchase,
econprodappipad.editors_pick_download,
econprodappipad.editors_pick_download_counter,
econprodappipad.editors_pick_download_prop,
econprodappipad.error_code,
econprodappipad.error_message,
NULL::"unknown" AS essay_section,
econprodappipad.event_id_partition_key,
econprodappipad.event_list,
NULL::"unknown" AS event_type,
econprodappipad.exclude_hit,
NULL::"unknown" AS facebook_widget_activity,
NULL::"unknown" AS fb_twitter_activity,
econprodappipad.first_hit_page_url,
econprodappipad.first_hit_pagename,
econprodappipad.first_hit_referrer,
econprodappipad.first_hit_time_gmt,
NULL::"unknown" AS form_name_field,
NULL::"unknown" AS form_sub_name,
econprodappipad.geo_city,
econprodappipad.geo_country,
econprodappipad.geo_dma,
econprodappipad.geo_region,
econprodappipad.geo_zip,
econprodappipad.google_play_subscriptions,
NULL::"unknown" AS grapeshot_value,
NULL::"unknown" AS hier1,
econprodappipad.hit_source,
NULL::"unknown" AS hit_time_gmt,
econprodappipad.hit_week,
econprodappipad.hitid_high,
econprodappipad.hitid_low,
NULL::"unknown" AS hour_of_day,
NULL::"unknown" AS int_sub_ads_first_click,
NULL::"unknown" AS int_sub_ads_last_click,
NULL::"unknown" AS internal_link,
NULL::"unknown" AS internal_link_external,
econprodappipad.ip,
econprodappipad.ip2,
econprodappipad.issue_date,
econprodappipad.issue_id,
NULL::"unknown" AS issue_region,
NULL::"unknown" AS key_interactions,
NULL::"unknown" AS key_interactions_pay_barrier_tracking,
econprodappipad."language",
NULL::"unknown" AS last_hit_time_gmt,
NULL::"unknown" AS last_purchase_num,
econprodappipad.last_purchase_time_gmt,
NULL::"unknown" AS link_name,
econprodappipad.link_page,
econprodappipad.loggedin,
econprodappipad.loggedin_prop,
NULL::"unknown" AS maximiser_campaign,
econprodappipad.mcvisid,
NULL::"unknown" AS meta_name,
econprodappipad.mobile_id,
NULL::"unknown" AS muls_subscription_type,
NULL::"unknown" AS multiuser_usage,
econprodappipad.navigated_by,
econprodappipad.navigated_by_prop,
econprodappipad.new_visit,
NULL::"unknown" AS newsletter_signup_from_reg,
econprodappipad.orientation,
econprodappipad.orientation_prop,
econprodappipad.os,
NULL::"unknown" AS os_version,
NULL::"unknown" AS page_event,
NULL::"unknown" AS page_event_var1,
NULL::"unknown" AS page_event_var2,
NULL::"unknown" AS page_event_var3,
NULL::"unknown" AS page_name,
NULL::"unknown" AS page_share_link,
NULL::"unknown" AS page_site_id,
NULL::"unknown" AS page_type,
NULL::"unknown" AS page_url,
NULL::"unknown" AS page_video_play,
econprodappipad.page_view,
econprodappipad.pagename,
econprodappipad.paid_free,
econprodappipad.paid_free_prop,
econprodappipad.paid_search,
NULL::"unknown" AS partner_referrals,
NULL::"unknown" AS payment_type,
econprodappipad.persistent_cookie,
econprodappipad.pointofinterest,
econprodappipad.pointofinterestdistance,
econprodappipad.post_ad_load_exit,
econprodappipad.post_campaign,
econprodappipad.post_channel,
econprodappipad.post_cookies,
econprodappipad.post_currency,
econprodappipad.post_event_list,
NULL::"unknown" AS post_hier1,
NULL::"unknown" AS post_hier2,
NULL::"unknown" AS post_hier3,
NULL::"unknown" AS post_hier4,
NULL::"unknown" AS post_hier5,
econprodappipad.post_java_enabled,
econprodappipad.post_keywords,
econprodappipad.post_mobileappid,
econprodappipad.post_mobiledayofweek,
econprodappipad.post_mobiledayssincefirstuse,
econprodappipad.post_mobiledayssincelastuse,
econprodappipad.post_mobiledevice,
econprodappipad.post_mobilehourofday,
econprodappipad.post_mobileinstalldate,
econprodappipad.post_mobilelaunchnumber,
econprodappipad.post_mobileosversion,
econprodappipad.post_mobileresolution,
econprodappipad.post_page_event::character varying(255) AS post_page_event,
NULL::"unknown" AS post_page_event_var1,
NULL::"unknown" AS post_page_event_var2,
NULL::"unknown" AS post_page_event_var3,
NULL::"unknown" AS post_page_url,
econprodappipad.post_pagename,
econprodappipad.post_pagename_no_url,
NULL::"unknown" AS post_partner_plugins,
econprodappipad.post_persistent_cookie,
econprodappipad.post_pointofinterest,
econprodappipad.post_pointofinterestdistance,
econprodappipad.post_product_list,
econprodappipad.post_purchaseid,
NULL::"unknown" AS post_referrer,
econprodappipad.post_search_engine,
econprodappipad.post_state,
econprodappipad.post_survey,
econprodappipad.post_t_time_info,
econprodappipad.post_zip,
econprodappipad.prev_page,
NULL::"unknown" AS product_id,
econprodappipad.product_list,
NULL::"unknown" AS promo_code,
NULL::"unknown" AS prop_article_published_date,
NULL::"unknown" AS prop_cust_type_prod,
NULL::"unknown" AS prop_drupal_id,
NULL::"unknown" AS prop_story_title,
NULL::"unknown" AS prop_user_login_status,
NULL::"unknown" AS purchase_id,
econprodappipad.purchaseid,
NULL::"unknown" AS ref_domain,
NULL::"unknown" AS ref_type,
NULL::"unknown" AS referrer,
NULL::"unknown" AS referring_subdomain,
econprodappipad."region",
NULL::"unknown" AS region_served,
NULL::"unknown" AS registration,
NULL::"unknown" AS renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
econprodappipad.s_resolution,
econprodappipad.sampled_hit,
econprodappipad.search_engine,
econprodappipad.search_page_num,
NULL::"unknown" AS search_results,
econprodappipad.secondary_hit,
econprodappipad.service,
econprodappipad.share_type,
econprodappipad.share_type_prop,
NULL::"unknown" AS sharelink,
econprodappipad.source,
econprodappipad.state,
econprodappipad.stats_server,
econprodappipad.story_title,
econprodappipad.story_title_prop,
NULL::"unknown" AS sub_data_protection,
NULL::"unknown" AS sub_date_end,
NULL::"unknown" AS sub_expiration,
NULL::"unknown" AS sub_length,
NULL::"unknown" AS sub_login_reg_activities,
NULL::"unknown" AS sub_start_date,
NULL::"unknown" AS sublength,
econprodappipad.subscriber_type,
econprodappipad.subscriber_type_prop,
econprodappipad.subscription_new,
econprodappipad.subscription_page_new,
NULL::"unknown" AS subscription_page_renew,
NULL::"unknown" AS subscription_renew,
econprodappipad.subscription_term_google_play,
NULL::"unknown" AS subsection,
econprodappipad.t_time_info,
econprodappipad.teg_hit_gmt_datetime,
econprodappipad.teg_hit_local_datetime,
econprodappipad.teg_hit_timezone_offset,
econprodappipad."template",
econprodappipad.template_type,
NULL::"unknown" AS ub_form_abandonment,
NULL::"unknown" AS ub_offer_country,
NULL::"unknown" AS ub_product_code,
NULL::"unknown" AS ub_sub,
NULL::"unknown" AS url,
econprodappipad.user_agent,
econprodappipad.user_agent_evar,
econprodappipad.user_agent_prop,
NULL::"unknown" AS user_login_status,
NULL::"unknown" AS userid,
NULL::"unknown" AS username,
econprodappipad.valid_user,
econprodappipad.valid_view,
econprodappipad.valid_visit,
NULL::"unknown" AS video_play,
NULL::"unknown" AS video_segment,
NULL::"unknown" AS video_tags,
NULL::"unknown" AS video_tags_prop,
NULL::"unknown" AS videos,
NULL::"unknown" AS videos_formatted,
econprodappipad.visid_high,
econprodappipad.visid_low,
econprodappipad.visid_new,
econprodappipad.visid_timestamp,
econprodappipad.visid_type,
econprodappipad.visit_id,
econprodappipad.visit_keywords,
econprodappipad.visit_num,
NULL::"unknown" AS visit_number_new_repeat,
NULL::"unknown" AS visit_page_num,
econprodappipad.visit_referrer,
econprodappipad.visit_search_engine,
NULL::"unknown" AS visit_start_page_url,
econprodappipad.visit_start_pagename,
econprodappipad.visitor_id,
NULL::"unknown" AS visitor_id_evar,
NULL::"unknown" AS week_type,
econprodappipad.drupal_or_visitor_id,
econprodappipad.external_file_id,
econprodappipad.external_file_rownumber
   FROM adobe.econprodappipad)
UNION ALL
 SELECT econdarwinproduction.accept_language,
NULL::"unknown" AS ad_impressions,
NULL::"unknown" AS ad_impresson,
NULL::"unknown" AS ad_load_exit,
econdarwinproduction.ad_region,
NULL::"unknown" AS ad_viewed_clicked,
econdarwinproduction.adload_adexit,
NULL::"unknown" AS advu_mpu,
NULL::"unknown" AS advu_mpu_prop,
NULL::"unknown" AS amstelnet_order_id,
NULL::"unknown" AS app_advertising_id,
econdarwinproduction.app_id,
NULL::"unknown" AS app_id_prop,
NULL::"unknown" AS app_name,
NULL::"unknown" AS app_rating,
NULL::"unknown" AS app_rating_prop,
NULL::"unknown" AS article_published_date,
NULL::"unknown" AS article_publishing,
NULL::"unknown" AS audio,
NULL::"unknown" AS audio_progress,
NULL::"unknown" AS audio_segment,
NULL::"unknown" AS br_camp_cid1_fst_click,
NULL::"unknown" AS br_camp_cid1_linear,
NULL::"unknown" AS br_camp_cid1_lst_click,
NULL::"unknown" AS br_camp_cid2_fst_click,
NULL::"unknown" AS br_camp_cid2_linear,
NULL::"unknown" AS br_camp_cid2_lst_click,
econdarwinproduction.browser::character varying(256) AS browser,
econdarwinproduction.browser_height::character varying(256) AS browser_height,
econdarwinproduction.browser_width,
NULL::"unknown" AS bulk_ip_address,
econdarwinproduction.campaign,
NULL::"unknown" AS campaign_attribution,
NULL::"unknown" AS campaign_attribution_owned_earned,
NULL::"unknown" AS campaign_attribution_paid,
NULL::"unknown" AS campaign_stacking_all,
NULL::"unknown" AS campaign_tracking,
econdarwinproduction.carrier,
NULL::"unknown" AS channel,
econdarwinproduction.click_action,
econdarwinproduction.click_action_type,
NULL::"unknown" AS click_tag,
NULL::"unknown" AS code_ver,
econdarwinproduction.connection_type,
NULL::"unknown" AS connection_type_prop,
NULL::"unknown" AS content_category,
NULL::"unknown" AS content_region,
NULL::"unknown" AS content_region_prop,
NULL::"unknown" AS content_source,
NULL::"unknown" AS content_type,
econdarwinproduction.cookies,
econdarwinproduction.country,
NULL::"unknown" AS country_residence,
econdarwinproduction.ct_connect_type,
NULL::"unknown" AS curr_factor,
econdarwinproduction.curr_rate,
econdarwinproduction.currency,
econdarwinproduction.cust_hit_time_gmt,
NULL::"unknown" AS cust_type_prod,
econdarwinproduction.cust_visid,
NULL::"unknown" AS customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
econdarwinproduction.date_time,
econdarwinproduction.delivery_method,
NULL::"unknown" AS device_advertising_id,
NULL::"unknown" AS device_id,
NULL::"unknown" AS device_id_prop,
econdarwinproduction.device_name,
NULL::"unknown" AS device_type,
NULL::"unknown" AS device_type_prop,
econdarwinproduction.device_vendor_id,
NULL::"unknown" AS dfp_ad_id,
NULL::"unknown" AS dfp_site,
NULL::"unknown" AS dfp_zone,
NULL::"unknown" AS director_donor,
econdarwinproduction."domain",
econdarwinproduction.drupal_id,
NULL::"unknown" AS duplicate_events,
NULL::"unknown" AS duplicate_purchase,
NULL::"unknown" AS editors_pick_download,
NULL::"unknown" AS editors_pick_download_counter,
NULL::"unknown" AS editors_pick_download_prop,
NULL::"unknown" AS error_code,
NULL::"unknown" AS error_message,
NULL::"unknown" AS essay_section,
econdarwinproduction.event_id_partition_key,
econdarwinproduction.event_list,
econdarwinproduction.event_type,
econdarwinproduction.exclude_hit,
NULL::"unknown" AS facebook_widget_activity,
NULL::"unknown" AS fb_twitter_activity,
NULL::"unknown" AS first_hit_page_url,
NULL::"unknown" AS first_hit_pagename,
econdarwinproduction.first_hit_referrer,
NULL::"unknown" AS first_hit_time_gmt,
NULL::"unknown" AS form_name_field,
NULL::"unknown" AS form_sub_name,
econdarwinproduction.geo_city,
econdarwinproduction.geo_country,
econdarwinproduction.geo_dma,
econdarwinproduction.geo_region,
econdarwinproduction.geo_zip,
NULL::"unknown" AS google_play_subscriptions,
NULL::"unknown" AS grapeshot_value,
NULL::"unknown" AS hier1,
econdarwinproduction.hit_source,
NULL::"unknown" AS hit_time_gmt,
econdarwinproduction.hit_week,
econdarwinproduction.hitid_high,
econdarwinproduction.hitid_low,
econdarwinproduction.hour_of_day,
NULL::"unknown" AS int_sub_ads_first_click,
NULL::"unknown" AS int_sub_ads_last_click,
NULL::"unknown" AS internal_link,
NULL::"unknown" AS internal_link_external,
econdarwinproduction.ip,
econdarwinproduction.ip2,
econdarwinproduction.issue_date,
NULL::"unknown" AS issue_id,
econdarwinproduction.issue_region,
NULL::"unknown" AS key_interactions,
NULL::"unknown" AS key_interactions_pay_barrier_tracking,
econdarwinproduction."language",
NULL::"unknown" AS last_hit_time_gmt,
NULL::"unknown" AS last_purchase_num,
NULL::"unknown" AS last_purchase_time_gmt,
NULL::"unknown" AS link_name,
NULL::"unknown" AS link_page,
NULL::"unknown" AS loggedin,
NULL::"unknown" AS loggedin_prop,
NULL::"unknown" AS maximiser_campaign,
NULL::"unknown" AS mcvisid,
NULL::"unknown" AS meta_name,
econdarwinproduction.mobile_id,
NULL::"unknown" AS muls_subscription_type,
NULL::"unknown" AS multiuser_usage,
NULL::"unknown" AS navigated_by,
NULL::"unknown" AS navigated_by_prop,
econdarwinproduction.new_visit,
NULL::"unknown" AS newsletter_signup_from_reg,
NULL::"unknown" AS orientation,
NULL::"unknown" AS orientation_prop,
econdarwinproduction.os,
econdarwinproduction.os_version,
econdarwinproduction.page_event,
econdarwinproduction.page_event_var1,
econdarwinproduction.page_event_var2,
econdarwinproduction.page_event_var3,
NULL::"unknown" AS page_name,
NULL::"unknown" AS page_share_link,
NULL::"unknown" AS page_site_id,
econdarwinproduction.page_type,
econdarwinproduction.page_url,
NULL::"unknown" AS page_video_play,
NULL::"unknown" AS page_view,
econdarwinproduction.pagename,
NULL::"unknown" AS paid_free,
NULL::"unknown" AS paid_free_prop,
econdarwinproduction.paid_search,
NULL::"unknown" AS partner_referrals,
NULL::"unknown" AS payment_type,
econdarwinproduction.persistent_cookie,
NULL::"unknown" AS pointofinterest,
NULL::"unknown" AS pointofinterestdistance,
NULL::"unknown" AS post_ad_load_exit,
econdarwinproduction.post_campaign,
econdarwinproduction.post_channel,
econdarwinproduction.post_cookies,
econdarwinproduction.post_currency,
econdarwinproduction.post_event_list,
econdarwinproduction.post_hier1,
econdarwinproduction.post_hier2,
econdarwinproduction.post_hier3,
econdarwinproduction.post_hier4,
econdarwinproduction.post_hier5,
NULL::"unknown" AS post_java_enabled,
econdarwinproduction.post_keywords,
NULL::"unknown" AS post_mobileappid,
NULL::"unknown" AS post_mobiledayofweek,
NULL::"unknown" AS post_mobiledayssincefirstuse,
NULL::"unknown" AS post_mobiledayssincelastuse,
NULL::"unknown" AS post_mobiledevice,
NULL::"unknown" AS post_mobilehourofday,
NULL::"unknown" AS post_mobileinstalldate,
NULL::"unknown" AS post_mobilelaunchnumber,
NULL::"unknown" AS post_mobileosversion,
NULL::"unknown" AS post_mobileresolution,
econdarwinproduction.post_page_event::character varying(255) AS post_page_event,
econdarwinproduction.post_page_event_var1,
econdarwinproduction.post_page_event_var2,
econdarwinproduction.post_page_event_var3,
econdarwinproduction.post_page_url,
econdarwinproduction.post_pagename,
econdarwinproduction.post_pagename_no_url,
econdarwinproduction.post_partner_plugins,
econdarwinproduction.post_persistent_cookie,
NULL::"unknown" AS post_pointofinterest,
NULL::"unknown" AS post_pointofinterestdistance,
econdarwinproduction.post_product_list,
econdarwinproduction.post_purchaseid,
econdarwinproduction.post_referrer,
econdarwinproduction.post_search_engine,
econdarwinproduction.post_state,
econdarwinproduction.post_survey,
econdarwinproduction.post_t_time_info,
NULL::"unknown" AS post_zip,
econdarwinproduction.prev_page,
econdarwinproduction.product_id,
econdarwinproduction.product_list,
NULL::"unknown" AS promo_code,
NULL::"unknown" AS prop_article_published_date,
NULL::"unknown" AS prop_cust_type_prod,
NULL::"unknown" AS prop_drupal_id,
NULL::"unknown" AS prop_story_title,
NULL::"unknown" AS prop_user_login_status,
econdarwinproduction.purchase_id,
NULL::"unknown" AS purchaseid,
econdarwinproduction.ref_domain,
econdarwinproduction.ref_type,
econdarwinproduction.referrer,
econdarwinproduction.referring_subdomain,
econdarwinproduction."region",
NULL::"unknown" AS region_served,
NULL::"unknown" AS registration,
NULL::"unknown" AS renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
econdarwinproduction.s_resolution,
econdarwinproduction.sampled_hit,
econdarwinproduction.search_engine,
econdarwinproduction.search_page_num,
NULL::"unknown" AS search_results,
econdarwinproduction.secondary_hit,
econdarwinproduction.service,
NULL::"unknown" AS share_type,
NULL::"unknown" AS share_type_prop,
NULL::"unknown" AS sharelink,
econdarwinproduction.source,
econdarwinproduction.state,
econdarwinproduction.stats_server,
econdarwinproduction.story_title,
NULL::"unknown" AS story_title_prop,
NULL::"unknown" AS sub_data_protection,
NULL::"unknown" AS sub_date_end,
NULL::"unknown" AS sub_expiration,
NULL::"unknown" AS sub_length,
NULL::"unknown" AS sub_login_reg_activities,
NULL::"unknown" AS sub_start_date,
NULL::"unknown" AS sublength,
econdarwinproduction.subscriber_type,
NULL::"unknown" AS subscriber_type_prop,
econdarwinproduction.subscription_new,
econdarwinproduction.subscription_page_new,
NULL::"unknown" AS subscription_page_renew,
NULL::"unknown" AS subscription_renew,
NULL::"unknown" AS subscription_term_google_play,
NULL::"unknown" AS subsection,
econdarwinproduction.t_time_info,
econdarwinproduction.teg_hit_gmt_datetime,
econdarwinproduction.teg_hit_local_datetime,
econdarwinproduction.teg_hit_timezone_offset,
NULL::"unknown" AS "template",
NULL::"unknown" AS template_type,
NULL::"unknown" AS ub_form_abandonment,
NULL::"unknown" AS ub_offer_country,
NULL::"unknown" AS ub_product_code,
NULL::"unknown" AS ub_sub,
NULL::"unknown" AS url,
NULL::"unknown" AS user_agent,
NULL::"unknown" AS user_agent_evar,
NULL::"unknown" AS user_agent_prop,
NULL::"unknown" AS user_login_status,
NULL::"unknown" AS userid,
NULL::"unknown" AS username,
econdarwinproduction.valid_user,
econdarwinproduction.valid_view,
econdarwinproduction.valid_visit,
NULL::"unknown" AS video_play,
NULL::"unknown" AS video_segment,
NULL::"unknown" AS video_tags,
NULL::"unknown" AS video_tags_prop,
NULL::"unknown" AS videos,
NULL::"unknown" AS videos_formatted,
econdarwinproduction.visid_high,
econdarwinproduction.visid_low,
econdarwinproduction.visid_new,
econdarwinproduction.visid_timestamp,
econdarwinproduction.visid_type,
econdarwinproduction.visit_id,
econdarwinproduction.visit_keywords,
econdarwinproduction.visit_num,
NULL::"unknown" AS visit_number_new_repeat,
NULL::"unknown" AS visit_page_num,
econdarwinproduction.visit_referrer,
econdarwinproduction.visit_search_engine,
econdarwinproduction.visit_start_page_url,
econdarwinproduction.visit_start_pagename,
econdarwinproduction.visitor_id,
econdarwinproduction.visitor_id_evar,
NULL::"unknown" AS week_type,
econdarwinproduction.drupal_or_visitor_id,
econdarwinproduction.external_file_id,
econdarwinproduction.external_file_rownumber
   FROM adobe.econdarwinproduction;
GRANT SELECT ON adobe.combined TO GROUP readonly;

---------------------------------------------------------------------------------------------------
-- 00220_recreate_adobe_economistcomprod_rollback.sql
---------------------------------------------------------------------------------------------------
DROP VIEW adobe.combined;

CREATE TABLE adobe.economistcomprod_new
(browser VARCHAR(256) ENCODE lzo
        ,browser_height VARCHAR(128) ENCODE lzo
        ,browser_width BIGINT ENCODE lzo
        ,campaign VARCHAR(300) ENCODE lzo
        ,channel VARCHAR(256) ENCODE lzo
        ,click_action VARCHAR(256) ENCODE lzo
        ,click_action_type SMALLINT ENCODE lzo
        ,click_tag VARCHAR(256) ENCODE lzo
        ,ct_connect_type VARCHAR(256) ENCODE lzo
        ,curr_factor SMALLINT ENCODE lzo
        ,curr_rate DECIMAL ENCODE lzo
        ,currency VARCHAR(256) ENCODE lzo
        ,date_time TIMESTAMP ENCODE lzo
        ,domain VARCHAR(256) ENCODE lzo
        ,exclude_hit SMALLINT ENCODE lzo
        ,first_hit_page_url VARCHAR(320) ENCODE lzo
        ,first_hit_pagename VARCHAR(320) ENCODE lzo
        ,first_hit_referrer VARCHAR(320) ENCODE lzo
        ,first_hit_time_gmt TIMESTAMP ENCODE lzo
        ,geo_city VARCHAR(256) ENCODE lzo
        ,geo_dma BIGINT ENCODE lzo
        ,geo_region VARCHAR(256) ENCODE lzo
        ,geo_zip VARCHAR(256) ENCODE lzo
        ,hier1 VARCHAR(256) ENCODE lzo
        ,hit_source SMALLINT ENCODE lzo
        ,hit_time_gmt TIMESTAMP ENCODE lzo
        ,hitid_high BIGINT ENCODE lzo
        ,hitid_low BIGINT ENCODE lzo
        ,ip VARCHAR(256) ENCODE lzo
        ,ip2 VARCHAR(256) ENCODE lzo
        ,language BIGINT ENCODE lzo
        ,last_hit_time_gmt TIMESTAMP ENCODE lzo
        ,last_purchase_num BIGINT ENCODE lzo
        ,mobile_id BIGINT ENCODE lzo
        ,new_visit SMALLINT ENCODE lzo
        ,os BIGINT ENCODE lzo
        ,page_event SMALLINT ENCODE lzo
        ,page_event_var1 VARCHAR(65535) ENCODE lzo
        ,page_share_link VARCHAR(256) ENCODE lzo
        ,page_video_play VARCHAR(65535) ENCODE lzo
        ,page_type VARCHAR(256) ENCODE lzo
        ,paid_search SMALLINT ENCODE lzo
        ,persistent_cookie CHAR(1) ENCODE lzo
        ,post_campaign VARCHAR(300) ENCODE lzo
        ,post_channel VARCHAR(256) ENCODE lzo
        ,post_cookies CHAR(1) ENCODE lzo
        ,post_currency VARCHAR(256) ENCODE lzo
        ,issue_date VARCHAR(256) ENCODE lzo
        ,article_publishing VARCHAR(256) ENCODE lzo
        ,content_type VARCHAR(256) ENCODE lzo
        ,story_title VARCHAR(256) ENCODE lzo
        ,grapeshot_value VARCHAR(256) ENCODE lzo
        ,hour_of_day VARCHAR(256) ENCODE lzo
        ,week_type VARCHAR(256) ENCODE lzo
        ,user_login_status VARCHAR(256) ENCODE lzo
        ,cust_type_prod VARCHAR(256) ENCODE lzo
        ,referring_subdomain VARCHAR(256) ENCODE lzo
        ,facebook_widget_activity VARCHAR(256) ENCODE lzo
        ,visit_number_new_repeat VARCHAR(256) ENCODE lzo
        ,key_interactions_pay_barrier_tracking VARCHAR(256) ENCODE lzo
        ,partner_referrals VARCHAR(2000) ENCODE lzo
        ,content_category VARCHAR(256) ENCODE lzo
        ,advu_mpu VARCHAR(256) ENCODE lzo
        ,videos VARCHAR(256) ENCODE lzo
        ,newsletter_signup_from_reg VARCHAR(256) ENCODE lzo
        ,promo_code VARCHAR(256) ENCODE lzo
        ,article_published_date TIMESTAMP ENCODE lzo
        ,url VARCHAR(320) ENCODE lzo
        ,multiuser_usage VARCHAR(256) ENCODE lzo
        ,fb_twitter_activity VARCHAR(256) ENCODE lzo
        ,video_tags VARCHAR(256) ENCODE lzo
        ,page_name VARCHAR(256) ENCODE lzo
        ,region_served VARCHAR(256) ENCODE lzo
        ,drupal_id INTEGER ENCODE lzo
        ,dfp_site VARCHAR(256) ENCODE lzo
        ,dfp_zone VARCHAR(256) ENCODE lzo
        ,geo_country VARCHAR(256) ENCODE lzo
        ,ad_viewed_clicked VARCHAR(256) ENCODE lzo
        ,muls_subscription_type VARCHAR(256) ENCODE lzo
        ,bulk_ip_address VARCHAR(256) ENCODE lzo
        ,campaign_attribution_paid VARCHAR(256) ENCODE lzo
        ,campaign_attribution_owned_earned VARCHAR(256) ENCODE lzo
        ,campaign_stacking_all VARCHAR(256) ENCODE lzo
        ,maximiser_campaign VARCHAR(256) ENCODE lzo
        ,internal_link VARCHAR(256) ENCODE lzo
        ,internal_link_external VARCHAR(256) ENCODE lzo
        ,br_camp_cid1_linear VARCHAR(300) ENCODE lzo
        ,br_camp_cid1_lst_click VARCHAR(300) ENCODE lzo
        ,br_camp_cid1_fst_click VARCHAR(300) ENCODE lzo
        ,br_camp_cid2_linear VARCHAR(300) ENCODE lzo
        ,br_camp_cid2_lst_click VARCHAR(300) ENCODE lzo
        ,br_camp_cid2_fst_click VARCHAR(300) ENCODE lzo
        ,ub_offer_country VARCHAR(256) ENCODE lzo
        ,ub_product_code VARCHAR(256) ENCODE lzo
        ,form_sub_name VARCHAR(256) ENCODE lzo
        ,form_name_field VARCHAR(256) ENCODE lzo
        ,ub_form_abandonment VARCHAR(256) ENCODE lzo
        ,dfp_ad_id VARCHAR(256) ENCODE lzo
        ,sub_login_reg_activities VARCHAR(256) ENCODE lzo
        ,renewal_start_end_date VARCHAR(256) ENCODE lzo
        ,sub_date_end VARCHAR(256) ENCODE lzo
        ,page_site_id VARCHAR(256) ENCODE lzo
        ,subsection VARCHAR(256) ENCODE lzo
        ,int_sub_ads_last_click VARCHAR(256) ENCODE lzo
        ,int_sub_ads_first_click VARCHAR(256) ENCODE lzo
        ,amstelnet_order_id VARCHAR(256) ENCODE lzo
        ,sub_length VARCHAR(256) ENCODE lzo
        ,post_event_list VARCHAR(65535) ENCODE lzo
        ,post_hier1 VARCHAR(256) ENCODE lzo
        ,post_hier2 VARCHAR(256) ENCODE lzo
        ,post_hier3 VARCHAR(256) ENCODE lzo
        ,post_hier4 VARCHAR(256) ENCODE lzo
        ,post_hier5 VARCHAR(256) ENCODE lzo
        ,post_keywords VARCHAR(256) ENCODE lzo
        ,post_page_event VARCHAR(256) ENCODE lzo
        ,post_page_event_var1 VARCHAR(320) ENCODE lzo
        ,sharelink VARCHAR(320) ENCODE lzo
        ,video_play VARCHAR(65535) ENCODE lzo
        ,post_page_url VARCHAR(320) ENCODE lzo
        ,post_pagename VARCHAR(256) ENCODE lzo
        ,post_pagename_no_url VARCHAR(256) ENCODE lzo
        ,post_partner_plugins VARCHAR(256) ENCODE lzo
        ,post_product_list VARCHAR(65535) ENCODE lzo
        ,revamp_tracking VARCHAR(65535) ENCODE lzo
        ,post_purchaseid VARCHAR(256) ENCODE lzo
        ,post_referrer VARCHAR(320) ENCODE lzo
        ,post_search_engine BIGINT ENCODE lzo
        ,post_state VARCHAR(256) ENCODE lzo
        ,post_survey VARCHAR(65535) ENCODE lzo
        ,post_t_time_info VARCHAR(256) ENCODE lzo
        ,prev_page BIGINT ENCODE lzo
        ,product_list VARCHAR(65535) ENCODE lzo
        ,prop_subsection_old VARCHAR(256) ENCODE lzo
        ,prop_issue_date VARCHAR(256) ENCODE lzo
        ,content_Source VARCHAR(256) ENCODE lzo
        ,content_type_prop VARCHAR(256) ENCODE lzo
        ,prop_story_title VARCHAR(256) ENCODE lzo
        ,date_day_Weektype VARCHAR(256) ENCODE lzo
        ,prop_user_login_status VARCHAR(256) ENCODE lzo
        ,prop_cust_type_prod VARCHAR(256) ENCODE lzo
        ,key_interactions VARCHAR(256) ENCODE lzo
        ,video_segment VARCHAR(256) ENCODE lzo
        ,prop_partner_referrals VARCHAR(256) ENCODE lzo
        ,sub_start_date VARCHAR(256) ENCODE lzo
        ,meta_name VARCHAR(256) ENCODE lzo
        ,advu_mpu_prop VARCHAR(256) ENCODE lzo
        ,prop_article_published_date VARCHAR(256) ENCODE lzo
        ,sub_data_protection  VARCHAR(256) ENCODE lzo
        ,video_tags_prop VARCHAR(256) ENCODE lzo
        ,prop_drupal_id INTEGER ENCODE lzo
        ,link_name VARCHAR(256) ENCODE lzo
        ,essay_section VARCHAR(256) ENCODE lzo
        ,sub_expiration VARCHAR(256) ENCODE lzo
        ,customer_lifecycle VARCHAR(256) ENCODE lzo
        ,sublength VARCHAR(256) ENCODE lzo
        ,campaign_attribution VARCHAR(256) ENCODE lzo
        ,payment_type VARCHAR(256) ENCODE lzo
        ,prop_subsection VARCHAR(256) ENCODE lzo
        ,campaign_tracking VARCHAR(256) ENCODE lzo
        ,director_donor VARCHAR(256) ENCODE lzo
        ,ub_sub VARCHAR(256) ENCODE lzo
        ,search_results VARCHAR(256) ENCODE lzo
        ,error_code VARCHAR(256) ENCODE lzo
        ,error_message VARCHAR(256) ENCODE lzo
        ,purchaseid VARCHAR(256) ENCODE lzo
        ,ref_domain VARCHAR(256) ENCODE lzo
        ,ref_type SMALLINT ENCODE lzo
        ,referrer VARCHAR(320) ENCODE lzo
        ,s_resolution VARCHAR(256) ENCODE lzo
        ,search_engine BIGINT ENCODE lzo
        ,search_page_num BIGINT ENCODE lzo
        ,service CHAR(2) ENCODE lzo
        ,state VARCHAR(256) ENCODE lzo
        ,stats_server VARCHAR(256) ENCODE lzo
        ,t_time_info VARCHAR(256) ENCODE lzo
        ,visid_timestamp TIMESTAMP ENCODE lzo
        ,visid_type SMALLINT ENCODE lzo
        ,visit_keywords VARCHAR(256) ENCODE lzo
        ,visit_num BIGINT ENCODE lzo
        ,visit_referrer VARCHAR(320) ENCODE lzo
        ,visit_search_engine VARCHAR(256) ENCODE lzo
        ,visit_start_page_url VARCHAR(320) ENCODE lzo
        ,visit_start_pagename VARCHAR(256) ENCODE lzo
        ,visit_start_time_gmt TIMESTAMP ENCODE lzo
        ,accept_language VARCHAR(384) ENCODE lzo
        ,source VARCHAR(16) ENCODE lzo
        ,region VARCHAR(15) ENCODE lzo
        ,visitor_id varchar(256) ENCODE lzo
        ,visit_id VARCHAR(256) ENCODE lzo
        ,userid BIGINT ENCODE lzo
        ,username VARCHAR(256) ENCODE lzo
        ,visit_page_num BIGINT ENCODE lzo
        ,videos_formatted VARCHAR(256) ENCODE lzo
        ,audio INTEGER ENCODE lzo
        ,valid_user INTEGER ENCODE lzo
        ,valid_view INTEGER ENCODE lzo
        ,valid_visit INTEGER ENCODE lzo
        ,event_id_partition_key VARCHAR(87) ENCODE lzo
        ,hit_week TIMESTAMP ENCODE lzo
        ,subscription_page_new INTEGER ENCODE lzo
        ,subscription_page_renew INTEGER ENCODE lzo
        ,subscription_new INTEGER ENCODE lzo
        ,subscription_renew INTEGER ENCODE lzo
        ,registration INTEGER ENCODE lzo
        ,teg_hit_local_datetime TIMESTAMP ENCODE lzo
        ,teg_hit_gmt_datetime TIMESTAMP ENCODE lzo
        ,teg_hit_timezone_offset INTEGER ENCODE lzo
        ,drupal_or_visitor_id VARCHAR(256) ENCODE lzo
        ,EXTERNAL_FILE_ID BIGINT ENCODE lzo
        ,EXTERNAL_FILE_ROWNUMBER BIGINT ENCODE lzo
) DISTKEY (drupal_or_visitor_id) SORTKEY (teg_hit_local_datetime);

set wlm_query_slot_count to 8;

INSERT INTO adobe.economistcomprod_new
SELECT * FROM adobe.economistcomprod;

ALTER TABLE adobe.economistcomprod RENAME TO economistcomprod_oldb;
ALTER TABLE adobe.economistcomprod_new RENAME TO economistcomprod;

GRANT INSERT ON adobe.economistcomprod TO copyrole;
GRANT SELECT ON adobe.economistcomprod TO GROUP readonly;

CREATE OR REPLACE VIEW adobe.combined
(
  accept_language,
  ad_impressions,
  ad_impresson,
  ad_load_exit,
  ad_region,
  ad_viewed_clicked,
  adload_adexit,
  advu_mpu,
  advu_mpu_prop,
  amstelnet_order_id,
  app_advertising_id,
  app_id,
  app_id_prop,
  app_name,
  app_rating,
  app_rating_prop,
  article_published_date,
  article_publishing,
  audio,
  audio_progress,
  audio_segment,
  br_camp_cid1_fst_click,
  br_camp_cid1_linear,
  br_camp_cid1_lst_click,
  br_camp_cid2_fst_click,
  br_camp_cid2_linear,
  br_camp_cid2_lst_click,
  browser,
  browser_height,
  browser_width,
  bulk_ip_address,
  campaign,
  campaign_attribution,
  campaign_attribution_owned_earned,
  campaign_attribution_paid,
  campaign_stacking_all,
  campaign_tracking,
  carrier,
  channel,
  click_action,
  click_action_type,
  click_tag,
  code_ver,
  connection_type,
  connection_type_prop,
  content_category,
  content_region,
  content_region_prop,
  content_source,
  content_type,
  cookies,
  country,
  country_residence,
  ct_connect_type,
  curr_factor,
  curr_rate,
  currency,
  cust_hit_time_gmt,
  cust_type_prod,
  cust_visid,
  customer_lifecycle,
  date_day_weektype,
  date_time,
  delivery_method,
  device_advertising_id,
  device_id,
  device_id_prop,
  device_name,
  device_type,
  device_type_prop,
  device_vendor_id,
  dfp_ad_id,
  dfp_site,
  dfp_zone,
  director_donor,
  domain,
  drupal_id,
  duplicate_events,
  duplicate_purchase,
  editors_pick_download,
  editors_pick_download_counter,
  editors_pick_download_prop,
  error_code,
  error_message,
  essay_section,
  event_id_partition_key,
  event_list,
  event_type,
  exclude_hit,
  facebook_widget_activity,
  fb_twitter_activity,
  first_hit_page_url,
  first_hit_pagename,
  first_hit_referrer,
  first_hit_time_gmt,
  form_name_field,
  form_sub_name,
  geo_city,
  geo_country,
  geo_dma,
  geo_region,
  geo_zip,
  google_play_subscriptions,
  grapeshot_value,
  hier1,
  hit_source,
  hit_time_gmt,
  hit_week,
  hitid_high,
  hitid_low,
  hour_of_day,
  int_sub_ads_first_click,
  int_sub_ads_last_click,
  internal_link,
  internal_link_external,
  ip,
  ip2,
  issue_date,
  issue_id,
  issue_region,
  key_interactions,
  key_interactions_pay_barrier_tracking,
  language,
  last_hit_time_gmt,
  last_purchase_num,
  last_purchase_time_gmt,
  link_name,
  link_page,
  loggedin,
  loggedin_prop,
  maximiser_campaign,
  mcvisid,
  meta_name,
  mobile_id,
  muls_subscription_type,
  multiuser_usage,
  navigated_by,
  navigated_by_prop,
  new_visit,
  newsletter_signup_from_reg,
  orientation,
  orientation_prop,
  os,
  os_version,
  page_event,
  page_event_var1,
  page_event_var2,
  page_event_var3,
  page_name,
  page_share_link,
  page_site_id,
  page_type,
  page_url,
  page_video_play,
  page_view,
  pagename,
  paid_free,
  paid_free_prop,
  paid_search,
  partner_referrals,
  payment_type,
  persistent_cookie,
  pointofinterest,
  pointofinterestdistance,
  post_ad_load_exit,
  post_campaign,
  post_channel,
  post_cookies,
  post_currency,
  post_event_list,
  post_hier1,
  post_hier2,
  post_hier3,
  post_hier4,
  post_hier5,
  post_java_enabled,
  post_keywords,
  post_mobileappid,
  post_mobiledayofweek,
  post_mobiledayssincefirstuse,
  post_mobiledayssincelastuse,
  post_mobiledevice,
  post_mobilehourofday,
  post_mobileinstalldate,
  post_mobilelaunchnumber,
  post_mobileosversion,
  post_mobileresolution,
  post_page_event,
  post_page_event_var1,
  post_page_event_var2,
  post_page_event_var3,
  post_page_url,
  post_pagename,
  post_pagename_no_url,
  post_partner_plugins,
  post_persistent_cookie,
  post_pointofinterest,
  post_pointofinterestdistance,
  post_product_list,
  post_purchaseid,
  post_referrer,
  post_search_engine,
  post_state,
  post_survey,
  post_t_time_info,
  post_zip,
  prev_page,
  product_id,
  product_list,
  promo_code,
  prop_article_published_date,
  prop_cust_type_prod,
  prop_drupal_id,
  prop_story_title,
  prop_user_login_status,
  purchase_id,
  purchaseid,
  ref_domain,
  ref_type,
  referrer,
  referring_subdomain,
  region,
  region_served,
  registration,
  renewal_start_end_date,
  revamp_tracking,
  s_resolution,
  sampled_hit,
  search_engine,
  search_page_num,
  search_results,
  secondary_hit,
  service,
  share_type,
  share_type_prop,
  sharelink,
  source,
  state,
  stats_server,
  story_title,
  story_title_prop,
  sub_data_protection,
  sub_date_end,
  sub_expiration,
  sub_length,
  sub_login_reg_activities,
  sub_start_date,
  sublength,
  subscriber_type,
  subscriber_type_prop,
  subscription_new,
  subscription_page_new,
  subscription_page_renew,
  subscription_renew,
  subscription_term_google_play,
  subsection,
  t_time_info,
  teg_hit_gmt_datetime,
  teg_hit_local_datetime,
  teg_hit_timezone_offset,
  template,
  template_type,
  ub_form_abandonment,
  ub_offer_country,
  ub_product_code,
  ub_sub,
  url,
  user_agent,
  user_agent_evar,
  user_agent_prop,
  user_login_status,
  userid,
  username,
  valid_user,
  valid_view,
  valid_visit,
  video_play,
  video_segment,
  video_tags,
  video_tags_prop,
  videos,
  videos_formatted,
  visid_high,
  visid_low,
  visid_new,
  visid_timestamp,
  visid_type,
  visit_id,
  visit_keywords,
  visit_num,
  visit_number_new_repeat,
  visit_page_num,
  visit_referrer,
  visit_search_engine,
  visit_start_page_url,
  visit_start_pagename,
  visitor_id,
  visitor_id_evar,
  week_type,
  drupal_or_visitor_id,
  external_file_id,
  external_file_rownumber
)
AS
( SELECT economistcomprod.accept_language,
NULL::"unknown" AS ad_impressions,
NULL::"unknown" AS ad_impresson,
NULL::"unknown" AS ad_load_exit,
NULL::"unknown" AS ad_region,
economistcomprod.ad_viewed_clicked,
NULL::"unknown" AS adload_adexit,
economistcomprod.advu_mpu,
economistcomprod.advu_mpu_prop,
economistcomprod.amstelnet_order_id,
NULL::"unknown" AS app_advertising_id,
NULL::"unknown" AS app_id,
NULL::"unknown" AS app_id_prop,
NULL::"unknown" AS app_name,
NULL::"unknown" AS app_rating,
NULL::"unknown" AS app_rating_prop,
economistcomprod.article_published_date,
economistcomprod.article_publishing,
economistcomprod.audio,
NULL::"unknown" AS audio_progress,
NULL::"unknown" AS audio_segment,
economistcomprod.br_camp_cid1_fst_click,
economistcomprod.br_camp_cid1_linear,
economistcomprod.br_camp_cid1_lst_click,
economistcomprod.br_camp_cid2_fst_click,
economistcomprod.br_camp_cid2_linear,
economistcomprod.br_camp_cid2_lst_click,
economistcomprod.browser,
economistcomprod.browser_height,
economistcomprod.browser_width,
economistcomprod.bulk_ip_address,
economistcomprod.campaign,
economistcomprod.campaign_attribution,
economistcomprod.campaign_attribution_owned_earned,
economistcomprod.campaign_attribution_paid,
economistcomprod.campaign_stacking_all,
economistcomprod.campaign_tracking,
NULL::"unknown" AS carrier,
economistcomprod.channel,
economistcomprod.click_action,
economistcomprod.click_action_type,
economistcomprod.click_tag,
NULL::"unknown" AS code_ver,
NULL::"unknown" AS connection_type,
NULL::"unknown" AS connection_type_prop,
economistcomprod.content_category,
NULL::"unknown" AS content_region,
NULL::"unknown" AS content_region_prop,
NULL::"unknown" AS content_source,
economistcomprod.content_type,
NULL::"unknown" AS cookies,
NULL::"unknown" AS country,
NULL::"unknown" AS country_residence,
economistcomprod.ct_connect_type,
economistcomprod.curr_factor,
economistcomprod.curr_rate,
economistcomprod.currency,
NULL::"unknown" AS cust_hit_time_gmt,
economistcomprod.cust_type_prod,
NULL::"unknown" AS cust_visid,
economistcomprod.customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
economistcomprod.date_time,
NULL::"unknown" AS delivery_method,
NULL::"unknown" AS device_advertising_id,
NULL::"unknown" AS device_id,
NULL::"unknown" AS device_id_prop,
NULL::"unknown" AS device_name,
NULL::"unknown" AS device_type,
NULL::"unknown" AS device_type_prop,
NULL::"unknown" AS device_vendor_id,
economistcomprod.dfp_ad_id,
economistcomprod.dfp_site,
economistcomprod.dfp_zone,
economistcomprod.director_donor,
economistcomprod."domain",
economistcomprod.drupal_id,
NULL::"unknown" AS duplicate_events,
NULL::"unknown" AS duplicate_purchase,
NULL::"unknown" AS editors_pick_download,
NULL::"unknown" AS editors_pick_download_counter,
NULL::"unknown" AS editors_pick_download_prop,
economistcomprod.error_code,
economistcomprod.error_message,
economistcomprod.essay_section,
economistcomprod.event_id_partition_key,
NULL::"unknown" AS event_list,
NULL::"unknown" AS event_type,
economistcomprod.exclude_hit,
economistcomprod.facebook_widget_activity,
economistcomprod.fb_twitter_activity,
economistcomprod.first_hit_page_url,
economistcomprod.first_hit_pagename,
economistcomprod.first_hit_referrer,
economistcomprod.first_hit_time_gmt,
economistcomprod.form_name_field,
economistcomprod.form_sub_name,
economistcomprod.geo_city,
economistcomprod.geo_country,
economistcomprod.geo_dma,
economistcomprod.geo_region,
economistcomprod.geo_zip,
NULL::"unknown" AS google_play_subscriptions,
economistcomprod.grapeshot_value,
economistcomprod.hier1,
economistcomprod.hit_source,
economistcomprod.hit_time_gmt,
economistcomprod.hit_week,
economistcomprod.hitid_high,
economistcomprod.hitid_low,
economistcomprod.hour_of_day,
economistcomprod.int_sub_ads_first_click,
economistcomprod.int_sub_ads_last_click,
economistcomprod.internal_link,
economistcomprod.internal_link_external,
economistcomprod.ip,
economistcomprod.ip2,
economistcomprod.issue_date,
NULL::"unknown" AS issue_id,
NULL::"unknown" AS issue_region,
economistcomprod.key_interactions,
economistcomprod.key_interactions_pay_barrier_tracking,
economistcomprod."language",
economistcomprod.last_hit_time_gmt,
economistcomprod.last_purchase_num,
NULL::"unknown" AS last_purchase_time_gmt,
economistcomprod.link_name,
NULL::"unknown" AS link_page,
NULL::"unknown" AS loggedin,
NULL::"unknown" AS loggedin_prop,
economistcomprod.maximiser_campaign,
NULL::"unknown" AS mcvisid,
economistcomprod.meta_name,
economistcomprod.mobile_id,
economistcomprod.muls_subscription_type,
economistcomprod.multiuser_usage,
NULL::"unknown" AS navigated_by,
NULL::"unknown" AS navigated_by_prop,
economistcomprod.new_visit,
economistcomprod.newsletter_signup_from_reg,
NULL::"unknown" AS orientation,
NULL::"unknown" AS orientation_prop,
economistcomprod.os,
NULL::"unknown" AS os_version,
economistcomprod.page_event,
economistcomprod.page_event_var1,
NULL::"unknown" AS page_event_var2,
NULL::"unknown" AS page_event_var3,
economistcomprod.page_name,
economistcomprod.page_share_link,
economistcomprod.page_site_id,
economistcomprod.page_type,
NULL::"unknown" AS page_url,
economistcomprod.page_video_play,
NULL::"unknown" AS page_view,
NULL::"unknown" AS pagename,
NULL::"unknown" AS paid_free,
NULL::"unknown" AS paid_free_prop,
economistcomprod.paid_search,
economistcomprod.partner_referrals,
economistcomprod.payment_type,
economistcomprod.persistent_cookie,
NULL::"unknown" AS pointofinterest,
NULL::"unknown" AS pointofinterestdistance,
NULL::"unknown" AS post_ad_load_exit,
economistcomprod.post_campaign,
economistcomprod.post_channel,
economistcomprod.post_cookies,
economistcomprod.post_currency,
economistcomprod.post_event_list,
economistcomprod.post_hier1,
economistcomprod.post_hier2,
economistcomprod.post_hier3,
economistcomprod.post_hier4,
economistcomprod.post_hier5,
NULL::"unknown" AS post_java_enabled,
economistcomprod.post_keywords,
NULL::"unknown" AS post_mobileappid,
NULL::"unknown" AS post_mobiledayofweek,
NULL::"unknown" AS post_mobiledayssincefirstuse,
NULL::"unknown" AS post_mobiledayssincelastuse,
NULL::"unknown" AS post_mobiledevice,
NULL::"unknown" AS post_mobilehourofday,
NULL::"unknown" AS post_mobileinstalldate,
NULL::"unknown" AS post_mobilelaunchnumber,
NULL::"unknown" AS post_mobileosversion,
NULL::"unknown" AS post_mobileresolution,
economistcomprod.post_page_event,
economistcomprod.post_page_event_var1,
NULL::"unknown" AS post_page_event_var2,
NULL::"unknown" AS post_page_event_var3,
economistcomprod.post_page_url,
economistcomprod.post_pagename,
economistcomprod.post_pagename_no_url,
economistcomprod.post_partner_plugins,
NULL::"unknown" AS post_persistent_cookie,
NULL::"unknown" AS post_pointofinterest,
NULL::"unknown" AS post_pointofinterestdistance,
economistcomprod.post_product_list,
economistcomprod.post_purchaseid,
economistcomprod.post_referrer,
economistcomprod.post_search_engine,
economistcomprod.post_state,
economistcomprod.post_survey,
economistcomprod.post_t_time_info,
NULL::"unknown" AS post_zip,
economistcomprod.prev_page,
NULL::"unknown" AS product_id,
economistcomprod.product_list,
economistcomprod.promo_code,
economistcomprod.prop_article_published_date,
economistcomprod.prop_cust_type_prod,
economistcomprod.prop_drupal_id,
economistcomprod.prop_story_title,
economistcomprod.prop_user_login_status,
NULL::"unknown" AS purchase_id,
economistcomprod.purchaseid,
economistcomprod.ref_domain,
economistcomprod.ref_type,
economistcomprod.referrer,
economistcomprod.referring_subdomain,
economistcomprod."region",
economistcomprod.region_served,
economistcomprod.registration,
economistcomprod.renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
economistcomprod.s_resolution,
NULL::"unknown" AS sampled_hit,
economistcomprod.search_engine,
economistcomprod.search_page_num,
economistcomprod.search_results,
NULL::"unknown" AS secondary_hit,
economistcomprod.service,
NULL::"unknown" AS share_type,
NULL::"unknown" AS share_type_prop,
economistcomprod.sharelink,
economistcomprod.source,
economistcomprod.state,
economistcomprod.stats_server,
economistcomprod.story_title,
NULL::"unknown" AS story_title_prop,
economistcomprod.sub_data_protection,
economistcomprod.sub_date_end,
economistcomprod.sub_expiration,
economistcomprod.sub_length,
economistcomprod.sub_login_reg_activities,
economistcomprod.sub_start_date,
economistcomprod.sublength,
NULL::"unknown" AS subscriber_type,
NULL::"unknown" AS subscriber_type_prop,
economistcomprod.subscription_new,
economistcomprod.subscription_page_new,
economistcomprod.subscription_page_renew,
economistcomprod.subscription_renew,
NULL::"unknown" AS subscription_term_google_play,
economistcomprod.subsection,
economistcomprod.t_time_info,
economistcomprod.teg_hit_gmt_datetime,
economistcomprod.teg_hit_local_datetime,
economistcomprod.teg_hit_timezone_offset,
NULL::"unknown" AS "template",
NULL::"unknown" AS template_type,
economistcomprod.ub_form_abandonment,
economistcomprod.ub_offer_country,
economistcomprod.ub_product_code,
economistcomprod.ub_sub,
economistcomprod.url,
NULL::"unknown" AS user_agent,
NULL::"unknown" AS user_agent_evar,
NULL::"unknown" AS user_agent_prop,
economistcomprod.user_login_status,
economistcomprod.userid,
economistcomprod.username,
economistcomprod.valid_user,
economistcomprod.valid_view,
economistcomprod.valid_visit,
economistcomprod.video_play,
economistcomprod.video_segment,
economistcomprod.video_tags,
economistcomprod.video_tags_prop,
economistcomprod.videos,
economistcomprod.videos_formatted,
NULL::"unknown" AS visid_high,
NULL::"unknown" AS visid_low,
NULL::"unknown" AS visid_new,
economistcomprod.visid_timestamp,
economistcomprod.visid_type,
economistcomprod.visit_id,
economistcomprod.visit_keywords,
economistcomprod.visit_num,
economistcomprod.visit_number_new_repeat,
economistcomprod.visit_page_num,
economistcomprod.visit_referrer,
economistcomprod.visit_search_engine,
economistcomprod.visit_start_page_url,
economistcomprod.visit_start_pagename,
economistcomprod.visitor_id,
NULL::"unknown" AS visitor_id_evar,
economistcomprod.week_type,
economistcomprod.drupal_or_visitor_id,
economistcomprod.external_file_id,
economistcomprod.external_file_rownumber
   FROM adobe.economistcomprod
UNION ALL
 SELECT econprodappipad.accept_language,
econprodappipad.ad_impressions,
econprodappipad.ad_impresson,
econprodappipad.ad_load_exit,
NULL::"unknown" AS ad_region,
NULL::"unknown" AS ad_viewed_clicked,
NULL::"unknown" AS adload_adexit,
NULL::"unknown" AS advu_mpu,
NULL::"unknown" AS advu_mpu_prop,
NULL::"unknown" AS amstelnet_order_id,
econprodappipad.app_advertising_id,
econprodappipad.app_id,
econprodappipad.app_id_prop,
econprodappipad.app_name,
econprodappipad.app_rating,
econprodappipad.app_rating_prop,
NULL::"unknown" AS article_published_date,
NULL::"unknown" AS article_publishing,
NULL::"unknown" AS audio,
econprodappipad.audio_progress,
econprodappipad.audio_segment,
NULL::"unknown" AS br_camp_cid1_fst_click,
NULL::"unknown" AS br_camp_cid1_linear,
NULL::"unknown" AS br_camp_cid1_lst_click,
NULL::"unknown" AS br_camp_cid2_fst_click,
NULL::"unknown" AS br_camp_cid2_linear,
NULL::"unknown" AS br_camp_cid2_lst_click,
econprodappipad.browser::character varying(256) AS browser,
econprodappipad.browser_height::character varying(256) AS browser_height,
econprodappipad.browser_width,
NULL::"unknown" AS bulk_ip_address,
econprodappipad.campaign,
NULL::"unknown" AS campaign_attribution,
NULL::"unknown" AS campaign_attribution_owned_earned,
NULL::"unknown" AS campaign_attribution_paid,
NULL::"unknown" AS campaign_stacking_all,
NULL::"unknown" AS campaign_tracking,
econprodappipad.carrier,
econprodappipad.channel,
NULL::"unknown" AS click_action,
NULL::"unknown" AS click_action_type,
NULL::"unknown" AS click_tag,
econprodappipad.code_ver,
econprodappipad.connection_type,
econprodappipad.connection_type_prop,
NULL::"unknown" AS content_category,
econprodappipad.content_region,
econprodappipad.content_region_prop,
NULL::"unknown" AS content_source,
NULL::"unknown" AS content_type,
econprodappipad.cookies,
econprodappipad.country,
econprodappipad.country_residence,
econprodappipad.ct_connect_type,
NULL::"unknown" AS curr_factor,
econprodappipad.curr_rate,
econprodappipad.currency,
econprodappipad.cust_hit_time_gmt,
NULL::"unknown" AS cust_type_prod,
NULL::"unknown" AS cust_visid,
NULL::"unknown" AS customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
econprodappipad.date_time,
NULL::"unknown" AS delivery_method,
econprodappipad.device_advertising_id,
econprodappipad.device_id,
econprodappipad.device_id_prop,
NULL::"unknown" AS device_name,
econprodappipad.device_type,
econprodappipad.device_type_prop,
NULL::"unknown" AS device_vendor_id,
NULL::"unknown" AS dfp_ad_id,
NULL::"unknown" AS dfp_site,
NULL::"unknown" AS dfp_zone,
NULL::"unknown" AS director_donor,
econprodappipad."domain",
econprodappipad.drupal_id,
econprodappipad.duplicate_events,
econprodappipad.duplicate_purchase,
econprodappipad.editors_pick_download,
econprodappipad.editors_pick_download_counter,
econprodappipad.editors_pick_download_prop,
econprodappipad.error_code,
econprodappipad.error_message,
NULL::"unknown" AS essay_section,
econprodappipad.event_id_partition_key,
econprodappipad.event_list,
NULL::"unknown" AS event_type,
econprodappipad.exclude_hit,
NULL::"unknown" AS facebook_widget_activity,
NULL::"unknown" AS fb_twitter_activity,
econprodappipad.first_hit_page_url,
econprodappipad.first_hit_pagename,
econprodappipad.first_hit_referrer,
econprodappipad.first_hit_time_gmt,
NULL::"unknown" AS form_name_field,
NULL::"unknown" AS form_sub_name,
econprodappipad.geo_city,
econprodappipad.geo_country,
econprodappipad.geo_dma,
econprodappipad.geo_region,
econprodappipad.geo_zip,
econprodappipad.google_play_subscriptions,
NULL::"unknown" AS grapeshot_value,
NULL::"unknown" AS hier1,
econprodappipad.hit_source,
NULL::"unknown" AS hit_time_gmt,
econprodappipad.hit_week,
econprodappipad.hitid_high,
econprodappipad.hitid_low,
NULL::"unknown" AS hour_of_day,
NULL::"unknown" AS int_sub_ads_first_click,
NULL::"unknown" AS int_sub_ads_last_click,
NULL::"unknown" AS internal_link,
NULL::"unknown" AS internal_link_external,
econprodappipad.ip,
econprodappipad.ip2,
econprodappipad.issue_date,
econprodappipad.issue_id,
NULL::"unknown" AS issue_region,
NULL::"unknown" AS key_interactions,
NULL::"unknown" AS key_interactions_pay_barrier_tracking,
econprodappipad."language",
NULL::"unknown" AS last_hit_time_gmt,
NULL::"unknown" AS last_purchase_num,
econprodappipad.last_purchase_time_gmt,
NULL::"unknown" AS link_name,
econprodappipad.link_page,
econprodappipad.loggedin,
econprodappipad.loggedin_prop,
NULL::"unknown" AS maximiser_campaign,
econprodappipad.mcvisid,
NULL::"unknown" AS meta_name,
econprodappipad.mobile_id,
NULL::"unknown" AS muls_subscription_type,
NULL::"unknown" AS multiuser_usage,
econprodappipad.navigated_by,
econprodappipad.navigated_by_prop,
econprodappipad.new_visit,
NULL::"unknown" AS newsletter_signup_from_reg,
econprodappipad.orientation,
econprodappipad.orientation_prop,
econprodappipad.os,
NULL::"unknown" AS os_version,
NULL::"unknown" AS page_event,
NULL::"unknown" AS page_event_var1,
NULL::"unknown" AS page_event_var2,
NULL::"unknown" AS page_event_var3,
NULL::"unknown" AS page_name,
NULL::"unknown" AS page_share_link,
NULL::"unknown" AS page_site_id,
NULL::"unknown" AS page_type,
NULL::"unknown" AS page_url,
NULL::"unknown" AS page_video_play,
econprodappipad.page_view,
econprodappipad.pagename,
econprodappipad.paid_free,
econprodappipad.paid_free_prop,
econprodappipad.paid_search,
NULL::"unknown" AS partner_referrals,
NULL::"unknown" AS payment_type,
econprodappipad.persistent_cookie,
econprodappipad.pointofinterest,
econprodappipad.pointofinterestdistance,
econprodappipad.post_ad_load_exit,
econprodappipad.post_campaign,
econprodappipad.post_channel,
econprodappipad.post_cookies,
econprodappipad.post_currency,
econprodappipad.post_event_list,
NULL::"unknown" AS post_hier1,
NULL::"unknown" AS post_hier2,
NULL::"unknown" AS post_hier3,
NULL::"unknown" AS post_hier4,
NULL::"unknown" AS post_hier5,
econprodappipad.post_java_enabled,
econprodappipad.post_keywords,
econprodappipad.post_mobileappid,
econprodappipad.post_mobiledayofweek,
econprodappipad.post_mobiledayssincefirstuse,
econprodappipad.post_mobiledayssincelastuse,
econprodappipad.post_mobiledevice,
econprodappipad.post_mobilehourofday,
econprodappipad.post_mobileinstalldate,
econprodappipad.post_mobilelaunchnumber,
econprodappipad.post_mobileosversion,
econprodappipad.post_mobileresolution,
econprodappipad.post_page_event::character varying(255) AS post_page_event,
NULL::"unknown" AS post_page_event_var1,
NULL::"unknown" AS post_page_event_var2,
NULL::"unknown" AS post_page_event_var3,
NULL::"unknown" AS post_page_url,
econprodappipad.post_pagename,
econprodappipad.post_pagename_no_url,
NULL::"unknown" AS post_partner_plugins,
econprodappipad.post_persistent_cookie,
econprodappipad.post_pointofinterest,
econprodappipad.post_pointofinterestdistance,
econprodappipad.post_product_list,
econprodappipad.post_purchaseid,
NULL::"unknown" AS post_referrer,
econprodappipad.post_search_engine,
econprodappipad.post_state,
econprodappipad.post_survey,
econprodappipad.post_t_time_info,
econprodappipad.post_zip,
econprodappipad.prev_page,
NULL::"unknown" AS product_id,
econprodappipad.product_list,
NULL::"unknown" AS promo_code,
NULL::"unknown" AS prop_article_published_date,
NULL::"unknown" AS prop_cust_type_prod,
NULL::"unknown" AS prop_drupal_id,
NULL::"unknown" AS prop_story_title,
NULL::"unknown" AS prop_user_login_status,
NULL::"unknown" AS purchase_id,
econprodappipad.purchaseid,
NULL::"unknown" AS ref_domain,
NULL::"unknown" AS ref_type,
NULL::"unknown" AS referrer,
NULL::"unknown" AS referring_subdomain,
econprodappipad."region",
NULL::"unknown" AS region_served,
NULL::"unknown" AS registration,
NULL::"unknown" AS renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
econprodappipad.s_resolution,
econprodappipad.sampled_hit,
econprodappipad.search_engine,
econprodappipad.search_page_num,
NULL::"unknown" AS search_results,
econprodappipad.secondary_hit,
econprodappipad.service,
econprodappipad.share_type,
econprodappipad.share_type_prop,
NULL::"unknown" AS sharelink,
econprodappipad.source,
econprodappipad.state,
econprodappipad.stats_server,
econprodappipad.story_title,
econprodappipad.story_title_prop,
NULL::"unknown" AS sub_data_protection,
NULL::"unknown" AS sub_date_end,
NULL::"unknown" AS sub_expiration,
NULL::"unknown" AS sub_length,
NULL::"unknown" AS sub_login_reg_activities,
NULL::"unknown" AS sub_start_date,
NULL::"unknown" AS sublength,
econprodappipad.subscriber_type,
econprodappipad.subscriber_type_prop,
econprodappipad.subscription_new,
econprodappipad.subscription_page_new,
NULL::"unknown" AS subscription_page_renew,
NULL::"unknown" AS subscription_renew,
econprodappipad.subscription_term_google_play,
NULL::"unknown" AS subsection,
econprodappipad.t_time_info,
econprodappipad.teg_hit_gmt_datetime,
econprodappipad.teg_hit_local_datetime,
econprodappipad.teg_hit_timezone_offset,
econprodappipad."template",
econprodappipad.template_type,
NULL::"unknown" AS ub_form_abandonment,
NULL::"unknown" AS ub_offer_country,
NULL::"unknown" AS ub_product_code,
NULL::"unknown" AS ub_sub,
NULL::"unknown" AS url,
econprodappipad.user_agent,
econprodappipad.user_agent_evar,
econprodappipad.user_agent_prop,
NULL::"unknown" AS user_login_status,
NULL::"unknown" AS userid,
NULL::"unknown" AS username,
econprodappipad.valid_user,
econprodappipad.valid_view,
econprodappipad.valid_visit,
NULL::"unknown" AS video_play,
NULL::"unknown" AS video_segment,
NULL::"unknown" AS video_tags,
NULL::"unknown" AS video_tags_prop,
NULL::"unknown" AS videos,
NULL::"unknown" AS videos_formatted,
econprodappipad.visid_high,
econprodappipad.visid_low,
econprodappipad.visid_new,
econprodappipad.visid_timestamp,
econprodappipad.visid_type,
econprodappipad.visit_id,
econprodappipad.visit_keywords,
econprodappipad.visit_num,
NULL::"unknown" AS visit_number_new_repeat,
NULL::"unknown" AS visit_page_num,
econprodappipad.visit_referrer,
econprodappipad.visit_search_engine,
NULL::"unknown" AS visit_start_page_url,
econprodappipad.visit_start_pagename,
econprodappipad.visitor_id,
NULL::"unknown" AS visitor_id_evar,
NULL::"unknown" AS week_type,
econprodappipad.drupal_or_visitor_id,
econprodappipad.external_file_id,
econprodappipad.external_file_rownumber
   FROM adobe.econprodappipad)
UNION ALL
 SELECT econdarwinproduction.accept_language,
NULL::"unknown" AS ad_impressions,
NULL::"unknown" AS ad_impresson,
NULL::"unknown" AS ad_load_exit,
econdarwinproduction.ad_region,
NULL::"unknown" AS ad_viewed_clicked,
econdarwinproduction.adload_adexit,
NULL::"unknown" AS advu_mpu,
NULL::"unknown" AS advu_mpu_prop,
NULL::"unknown" AS amstelnet_order_id,
NULL::"unknown" AS app_advertising_id,
econdarwinproduction.app_id,
NULL::"unknown" AS app_id_prop,
NULL::"unknown" AS app_name,
NULL::"unknown" AS app_rating,
NULL::"unknown" AS app_rating_prop,
NULL::"unknown" AS article_published_date,
NULL::"unknown" AS article_publishing,
NULL::"unknown" AS audio,
NULL::"unknown" AS audio_progress,
NULL::"unknown" AS audio_segment,
NULL::"unknown" AS br_camp_cid1_fst_click,
NULL::"unknown" AS br_camp_cid1_linear,
NULL::"unknown" AS br_camp_cid1_lst_click,
NULL::"unknown" AS br_camp_cid2_fst_click,
NULL::"unknown" AS br_camp_cid2_linear,
NULL::"unknown" AS br_camp_cid2_lst_click,
econdarwinproduction.browser::character varying(256) AS browser,
econdarwinproduction.browser_height::character varying(256) AS browser_height,
econdarwinproduction.browser_width,
NULL::"unknown" AS bulk_ip_address,
econdarwinproduction.campaign,
NULL::"unknown" AS campaign_attribution,
NULL::"unknown" AS campaign_attribution_owned_earned,
NULL::"unknown" AS campaign_attribution_paid,
NULL::"unknown" AS campaign_stacking_all,
NULL::"unknown" AS campaign_tracking,
econdarwinproduction.carrier,
NULL::"unknown" AS channel,
econdarwinproduction.click_action,
econdarwinproduction.click_action_type,
NULL::"unknown" AS click_tag,
NULL::"unknown" AS code_ver,
econdarwinproduction.connection_type,
NULL::"unknown" AS connection_type_prop,
NULL::"unknown" AS content_category,
NULL::"unknown" AS content_region,
NULL::"unknown" AS content_region_prop,
NULL::"unknown" AS content_source,
NULL::"unknown" AS content_type,
econdarwinproduction.cookies,
econdarwinproduction.country,
NULL::"unknown" AS country_residence,
econdarwinproduction.ct_connect_type,
NULL::"unknown" AS curr_factor,
econdarwinproduction.curr_rate,
econdarwinproduction.currency,
econdarwinproduction.cust_hit_time_gmt,
NULL::"unknown" AS cust_type_prod,
econdarwinproduction.cust_visid,
NULL::"unknown" AS customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
econdarwinproduction.date_time,
econdarwinproduction.delivery_method,
NULL::"unknown" AS device_advertising_id,
NULL::"unknown" AS device_id,
NULL::"unknown" AS device_id_prop,
econdarwinproduction.device_name,
NULL::"unknown" AS device_type,
NULL::"unknown" AS device_type_prop,
econdarwinproduction.device_vendor_id,
NULL::"unknown" AS dfp_ad_id,
NULL::"unknown" AS dfp_site,
NULL::"unknown" AS dfp_zone,
NULL::"unknown" AS director_donor,
econdarwinproduction."domain",
econdarwinproduction.drupal_id,
NULL::"unknown" AS duplicate_events,
NULL::"unknown" AS duplicate_purchase,
NULL::"unknown" AS editors_pick_download,
NULL::"unknown" AS editors_pick_download_counter,
NULL::"unknown" AS editors_pick_download_prop,
NULL::"unknown" AS error_code,
NULL::"unknown" AS error_message,
NULL::"unknown" AS essay_section,
econdarwinproduction.event_id_partition_key,
econdarwinproduction.event_list,
econdarwinproduction.event_type,
econdarwinproduction.exclude_hit,
NULL::"unknown" AS facebook_widget_activity,
NULL::"unknown" AS fb_twitter_activity,
NULL::"unknown" AS first_hit_page_url,
NULL::"unknown" AS first_hit_pagename,
econdarwinproduction.first_hit_referrer,
NULL::"unknown" AS first_hit_time_gmt,
NULL::"unknown" AS form_name_field,
NULL::"unknown" AS form_sub_name,
econdarwinproduction.geo_city,
econdarwinproduction.geo_country,
econdarwinproduction.geo_dma,
econdarwinproduction.geo_region,
econdarwinproduction.geo_zip,
NULL::"unknown" AS google_play_subscriptions,
NULL::"unknown" AS grapeshot_value,
NULL::"unknown" AS hier1,
econdarwinproduction.hit_source,
NULL::"unknown" AS hit_time_gmt,
econdarwinproduction.hit_week,
econdarwinproduction.hitid_high,
econdarwinproduction.hitid_low,
econdarwinproduction.hour_of_day,
NULL::"unknown" AS int_sub_ads_first_click,
NULL::"unknown" AS int_sub_ads_last_click,
NULL::"unknown" AS internal_link,
NULL::"unknown" AS internal_link_external,
econdarwinproduction.ip,
econdarwinproduction.ip2,
econdarwinproduction.issue_date,
NULL::"unknown" AS issue_id,
econdarwinproduction.issue_region,
NULL::"unknown" AS key_interactions,
NULL::"unknown" AS key_interactions_pay_barrier_tracking,
econdarwinproduction."language",
NULL::"unknown" AS last_hit_time_gmt,
NULL::"unknown" AS last_purchase_num,
NULL::"unknown" AS last_purchase_time_gmt,
NULL::"unknown" AS link_name,
NULL::"unknown" AS link_page,
NULL::"unknown" AS loggedin,
NULL::"unknown" AS loggedin_prop,
NULL::"unknown" AS maximiser_campaign,
NULL::"unknown" AS mcvisid,
NULL::"unknown" AS meta_name,
econdarwinproduction.mobile_id,
NULL::"unknown" AS muls_subscription_type,
NULL::"unknown" AS multiuser_usage,
NULL::"unknown" AS navigated_by,
NULL::"unknown" AS navigated_by_prop,
econdarwinproduction.new_visit,
NULL::"unknown" AS newsletter_signup_from_reg,
NULL::"unknown" AS orientation,
NULL::"unknown" AS orientation_prop,
econdarwinproduction.os,
econdarwinproduction.os_version,
econdarwinproduction.page_event,
econdarwinproduction.page_event_var1,
econdarwinproduction.page_event_var2,
econdarwinproduction.page_event_var3,
NULL::"unknown" AS page_name,
NULL::"unknown" AS page_share_link,
NULL::"unknown" AS page_site_id,
econdarwinproduction.page_type,
econdarwinproduction.page_url,
NULL::"unknown" AS page_video_play,
NULL::"unknown" AS page_view,
econdarwinproduction.pagename,
NULL::"unknown" AS paid_free,
NULL::"unknown" AS paid_free_prop,
econdarwinproduction.paid_search,
NULL::"unknown" AS partner_referrals,
NULL::"unknown" AS payment_type,
econdarwinproduction.persistent_cookie,
NULL::"unknown" AS pointofinterest,
NULL::"unknown" AS pointofinterestdistance,
NULL::"unknown" AS post_ad_load_exit,
econdarwinproduction.post_campaign,
econdarwinproduction.post_channel,
econdarwinproduction.post_cookies,
econdarwinproduction.post_currency,
econdarwinproduction.post_event_list,
econdarwinproduction.post_hier1,
econdarwinproduction.post_hier2,
econdarwinproduction.post_hier3,
econdarwinproduction.post_hier4,
econdarwinproduction.post_hier5,
NULL::"unknown" AS post_java_enabled,
econdarwinproduction.post_keywords,
NULL::"unknown" AS post_mobileappid,
NULL::"unknown" AS post_mobiledayofweek,
NULL::"unknown" AS post_mobiledayssincefirstuse,
NULL::"unknown" AS post_mobiledayssincelastuse,
NULL::"unknown" AS post_mobiledevice,
NULL::"unknown" AS post_mobilehourofday,
NULL::"unknown" AS post_mobileinstalldate,
NULL::"unknown" AS post_mobilelaunchnumber,
NULL::"unknown" AS post_mobileosversion,
NULL::"unknown" AS post_mobileresolution,
econdarwinproduction.post_page_event::character varying(255) AS post_page_event,
econdarwinproduction.post_page_event_var1,
econdarwinproduction.post_page_event_var2,
econdarwinproduction.post_page_event_var3,
econdarwinproduction.post_page_url,
econdarwinproduction.post_pagename,
econdarwinproduction.post_pagename_no_url,
econdarwinproduction.post_partner_plugins,
econdarwinproduction.post_persistent_cookie,
NULL::"unknown" AS post_pointofinterest,
NULL::"unknown" AS post_pointofinterestdistance,
econdarwinproduction.post_product_list,
econdarwinproduction.post_purchaseid,
econdarwinproduction.post_referrer,
econdarwinproduction.post_search_engine,
econdarwinproduction.post_state,
econdarwinproduction.post_survey,
econdarwinproduction.post_t_time_info,
NULL::"unknown" AS post_zip,
econdarwinproduction.prev_page,
econdarwinproduction.product_id,
econdarwinproduction.product_list,
NULL::"unknown" AS promo_code,
NULL::"unknown" AS prop_article_published_date,
NULL::"unknown" AS prop_cust_type_prod,
NULL::"unknown" AS prop_drupal_id,
NULL::"unknown" AS prop_story_title,
NULL::"unknown" AS prop_user_login_status,
econdarwinproduction.purchase_id,
NULL::"unknown" AS purchaseid,
econdarwinproduction.ref_domain,
econdarwinproduction.ref_type,
econdarwinproduction.referrer,
econdarwinproduction.referring_subdomain,
econdarwinproduction."region",
NULL::"unknown" AS region_served,
NULL::"unknown" AS registration,
NULL::"unknown" AS renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
econdarwinproduction.s_resolution,
econdarwinproduction.sampled_hit,
econdarwinproduction.search_engine,
econdarwinproduction.search_page_num,
NULL::"unknown" AS search_results,
econdarwinproduction.secondary_hit,
econdarwinproduction.service,
NULL::"unknown" AS share_type,
NULL::"unknown" AS share_type_prop,
NULL::"unknown" AS sharelink,
econdarwinproduction.source,
econdarwinproduction.state,
econdarwinproduction.stats_server,
econdarwinproduction.story_title,
NULL::"unknown" AS story_title_prop,
NULL::"unknown" AS sub_data_protection,
NULL::"unknown" AS sub_date_end,
NULL::"unknown" AS sub_expiration,
NULL::"unknown" AS sub_length,
NULL::"unknown" AS sub_login_reg_activities,
NULL::"unknown" AS sub_start_date,
NULL::"unknown" AS sublength,
econdarwinproduction.subscriber_type,
NULL::"unknown" AS subscriber_type_prop,
econdarwinproduction.subscription_new,
econdarwinproduction.subscription_page_new,
NULL::"unknown" AS subscription_page_renew,
NULL::"unknown" AS subscription_renew,
NULL::"unknown" AS subscription_term_google_play,
NULL::"unknown" AS subsection,
econdarwinproduction.t_time_info,
econdarwinproduction.teg_hit_gmt_datetime,
econdarwinproduction.teg_hit_local_datetime,
econdarwinproduction.teg_hit_timezone_offset,
NULL::"unknown" AS "template",
NULL::"unknown" AS template_type,
NULL::"unknown" AS ub_form_abandonment,
NULL::"unknown" AS ub_offer_country,
NULL::"unknown" AS ub_product_code,
NULL::"unknown" AS ub_sub,
NULL::"unknown" AS url,
NULL::"unknown" AS user_agent,
NULL::"unknown" AS user_agent_evar,
NULL::"unknown" AS user_agent_prop,
NULL::"unknown" AS user_login_status,
NULL::"unknown" AS userid,
NULL::"unknown" AS username,
econdarwinproduction.valid_user,
econdarwinproduction.valid_view,
econdarwinproduction.valid_visit,
NULL::"unknown" AS video_play,
NULL::"unknown" AS video_segment,
NULL::"unknown" AS video_tags,
NULL::"unknown" AS video_tags_prop,
NULL::"unknown" AS videos,
NULL::"unknown" AS videos_formatted,
econdarwinproduction.visid_high,
econdarwinproduction.visid_low,
econdarwinproduction.visid_new,
econdarwinproduction.visid_timestamp,
econdarwinproduction.visid_type,
econdarwinproduction.visit_id,
econdarwinproduction.visit_keywords,
econdarwinproduction.visit_num,
NULL::"unknown" AS visit_number_new_repeat,
NULL::"unknown" AS visit_page_num,
econdarwinproduction.visit_referrer,
econdarwinproduction.visit_search_engine,
econdarwinproduction.visit_start_page_url,
econdarwinproduction.visit_start_pagename,
econdarwinproduction.visitor_id,
econdarwinproduction.visitor_id_evar,
NULL::"unknown" AS week_type,
econdarwinproduction.drupal_or_visitor_id,
econdarwinproduction.external_file_id,
econdarwinproduction.external_file_rownumber
   FROM adobe.econdarwinproduction;
GRANT SELECT ON adobe.combined TO GROUP readonly;

---------------------------------------------------------------------------------------------------
-- 00221_recreate_adobe_economistcomprod_events.sql
---------------------------------------------------------------------------------------------------
DROP VIEW adobe.combined_events;

ALTER TABLE adobe.economistcomprod_events RENAME TO economistcomprod_events_old;

CREATE TABLE adobe.economistcomprod_events
(
   drupal_or_visitor_id     VARCHAR(256) ENCODE zstd,
   external_file_id         BIGINT       ENCODE zstd,
   external_file_rownumber  BIGINT       ENCODE zstd,
   teg_hit_local_datetime   TIMESTAMP    ENCODE zstd,
   event_code               INTEGER      ENCODE zstd,
   event_value              VARCHAR(256) ENCODE zstd,
   event_total_count        INTEGER      ENCODE zstd,
   event_sequence           INTEGER      ENCODE zstd,
   visit_event_total_count  INTEGER      ENCODE zstd,
   visit_event_sequence     INTEGER      ENCODE zstd,
   visit_id                 VARCHAR(256) ENCODE zstd,
   visit_num                INTEGER      ENCODE zstd
) DISTKEY (drupal_or_visitor_id) COMPOUND SORTKEY (external_file_id, external_file_rownumber)
;

GRANT SELECT ON adobe.economistcomprod_events TO GROUP readonly;

INSERT INTO adobe.economistcomprod_events
SELECT * 
  FROM adobe.economistcomprod_events_old
;

DROP TABLE adobe.economistcomprod_events_old;

CREATE OR REPLACE VIEW adobe.combined_events
(
  drupal_or_visitor_id,
  external_file_id,
  external_file_rownumber,
  teg_hit_local_datetime,
  event_code,
  event_value,
  event_total_count,
  event_sequence,
  source,
  visit_event_total_count,
  visit_event_sequence,
  visit_id,
  visit_num
)
AS
( 
    SELECT
        economistcomprod_events.drupal_or_visitor_id
      , economistcomprod_events.external_file_id
      , economistcomprod_events.external_file_rownumber
      , economistcomprod_events.teg_hit_local_datetime
      , economistcomprod_events.event_code
      , economistcomprod_events.event_value
      , economistcomprod_events.event_total_count
      , economistcomprod_events.event_sequence
      , 'Economist Online' AS source
      , economistcomprod_events.visit_event_total_count
      , economistcomprod_events.visit_event_sequence
      , economistcomprod_events.visit_id
      , economistcomprod_events.visit_num
    FROM
        adobe.economistcomprod_events
    
    UNION ALL
    
    SELECT
        econdarwinproduction_events.drupal_or_visitor_id
      , econdarwinproduction_events.external_file_id
      , econdarwinproduction_events.external_file_rownumber
      , econdarwinproduction_events.teg_hit_local_datetime
      , econdarwinproduction_events.event_code
      , econdarwinproduction_events.event_value
      , econdarwinproduction_events.event_total_count
      , econdarwinproduction_events.event_sequence
      , 'Espresso' AS source
      , econdarwinproduction_events.visit_event_total_count
      , econdarwinproduction_events.visit_event_sequence
      , econdarwinproduction_events.visit_id
      , econdarwinproduction_events.visit_num
    FROM
        adobe.econdarwinproduction_events
)

UNION ALL

SELECT
    econprodappipad_events.drupal_or_visitor_id
  , econprodappipad_events.external_file_id
  , econprodappipad_events.external_file_rownumber
  , econprodappipad_events.teg_hit_local_datetime
  , econprodappipad_events.event_code
  , econprodappipad_events.event_value
  , econprodappipad_events.event_total_count
  , econprodappipad_events.event_sequence
  , 'Digital App' AS source
  , econprodappipad_events.visit_event_total_count
  , econprodappipad_events.visit_event_sequence
  , econprodappipad_events.visit_id
  , econprodappipad_events.visit_num
FROM
    adobe.econprodappipad_events
;

GRANT SELECT ON adobe.combined_events TO GROUP readonly;

---------------------------------------------------------------------------------------------------
-- 00221_recreate_adobe_economistcomprod_events_rollback.sql
---------------------------------------------------------------------------------------------------
DROP VIEW adobe.combined_events;

ALTER TABLE adobe.economistcomprod_events RENAME TO economistcomprod_events_old;

CREATE TABLE adobe.economistcomprod_events
(
   drupal_or_visitor_id     VARCHAR(256) ENCODE lzo,
   external_file_id         BIGINT,
   external_file_rownumber  BIGINT       ENCODE delta,
   teg_hit_local_datetime   TIMESTAMP    ENCODE lzo,
   event_code               INTEGER      ENCODE lzo,
   event_value              VARCHAR(256) ENCODE lzo,
   event_total_count        INTEGER      ENCODE lzo,
   event_sequence           INTEGER      ENCODE lzo,
   visit_event_total_count  INTEGER      ENCODE lzo,
   visit_event_sequence     INTEGER      ENCODE delta,
   visit_id                 VARCHAR(256) ENCODE lzo,
   visit_num                INTEGER      ENCODE lzo
) DISTKEY (drupal_or_visitor_id) COMPOUND SORTKEY (external_file_id, external_file_rownumber)
;

GRANT SELECT ON adobe.economistcomprod_events TO GROUP readonly;

INSERT INTO adobe.economistcomprod_events
SELECT * 
  FROM adobe.economistcomprod_events_old
;

DROP TABLE adobe.economistcomprod_events_old;

CREATE OR REPLACE VIEW adobe.combined_events
(
  drupal_or_visitor_id,
  external_file_id,
  external_file_rownumber,
  teg_hit_local_datetime,
  event_code,
  event_value,
  event_total_count,
  event_sequence,
  source,
  visit_event_total_count,
  visit_event_sequence,
  visit_id,
  visit_num
)
AS
( 
    SELECT
        economistcomprod_events.drupal_or_visitor_id
      , economistcomprod_events.external_file_id
      , economistcomprod_events.external_file_rownumber
      , economistcomprod_events.teg_hit_local_datetime
      , economistcomprod_events.event_code
      , economistcomprod_events.event_value
      , economistcomprod_events.event_total_count
      , economistcomprod_events.event_sequence
      , 'Economist Online' AS source
      , economistcomprod_events.visit_event_total_count
      , economistcomprod_events.visit_event_sequence
      , economistcomprod_events.visit_id
      , economistcomprod_events.visit_num
    FROM
        adobe.economistcomprod_events
    
    UNION ALL
    
    SELECT
        econdarwinproduction_events.drupal_or_visitor_id
      , econdarwinproduction_events.external_file_id
      , econdarwinproduction_events.external_file_rownumber
      , econdarwinproduction_events.teg_hit_local_datetime
      , econdarwinproduction_events.event_code
      , econdarwinproduction_events.event_value
      , econdarwinproduction_events.event_total_count
      , econdarwinproduction_events.event_sequence
      , 'Espresso' AS source
      , econdarwinproduction_events.visit_event_total_count
      , econdarwinproduction_events.visit_event_sequence
      , econdarwinproduction_events.visit_id
      , econdarwinproduction_events.visit_num
    FROM
        adobe.econdarwinproduction_events
)

UNION ALL

SELECT
    econprodappipad_events.drupal_or_visitor_id
  , econprodappipad_events.external_file_id
  , econprodappipad_events.external_file_rownumber
  , econprodappipad_events.teg_hit_local_datetime
  , econprodappipad_events.event_code
  , econprodappipad_events.event_value
  , econprodappipad_events.event_total_count
  , econprodappipad_events.event_sequence
  , 'Digital App' AS source
  , econprodappipad_events.visit_event_total_count
  , econprodappipad_events.visit_event_sequence
  , econprodappipad_events.visit_id
  , econprodappipad_events.visit_num
FROM
    adobe.econprodappipad_events
;

GRANT SELECT ON adobe.combined_events TO GROUP readonly;

---------------------------------------------------------------------------------------------------
-- 00222_recreate_adobe_econprodappipad.sql
---------------------------------------------------------------------------------------------------
DROP VIEW adobe.combined;

CREATE TABLE adobe.econprodappipad_new
(browser BIGINT ENCODE zstd
,browser_height BIGINT ENCODE zstd
,browser_width BIGINT ENCODE zstd
,campaign VARCHAR(300) ENCODE zstd
,carrier VARCHAR(128) ENCODE zstd
,channel VARCHAR(256) ENCODE zstd
,code_ver VARCHAR(256) ENCODE zstd
,cookies CHAR(1) ENCODE zstd
,country BIGINT ENCODE zstd
,ct_connect_type VARCHAR(256) ENCODE zstd
,curr_rate DECIMAL ENCODE zstd
,currency VARCHAR(256) ENCODE zstd
,cust_hit_time_gmt TIMESTAMP ENCODE zstd
,date_time TIMESTAMP ENCODE zstd
,domain VARCHAR(256) ENCODE zstd
,duplicate_events VARCHAR(256) ENCODE zstd
,duplicate_purchase SMALLINT ENCODE zstd
,event_list VARCHAR(65535) ENCODE zstd
,exclude_hit SMALLINT ENCODE zstd
,first_hit_page_url VARCHAR(256) ENCODE zstd
,first_hit_pagename VARCHAR(256) ENCODE zstd
,first_hit_referrer VARCHAR(256) ENCODE zstd
,first_hit_time_gmt TIMESTAMP ENCODE zstd
,geo_city VARCHAR(256) ENCODE zstd
,geo_country VARCHAR(256) ENCODE zstd
,geo_dma BIGINT ENCODE zstd
,geo_region VARCHAR(256) ENCODE zstd
,geo_zip VARCHAR(256) ENCODE zstd
,hit_source SMALLINT ENCODE zstd
,hitid_high BIGINT ENCODE zstd
,hitid_low BIGINT ENCODE zstd
,ip VARCHAR(256) ENCODE zstd
,ip2 VARCHAR(256) ENCODE zstd
,language BIGINT ENCODE zstd
,last_purchase_time_gmt BIGINT ENCODE zstd
,mcvisid VARCHAR(256) ENCODE zstd
,mobile_id BIGINT ENCODE zstd
,new_visit SMALLINT ENCODE zstd
,os BIGINT ENCODE zstd
,pagename VARCHAR(256) ENCODE zstd
,paid_search SMALLINT ENCODE zstd
,persistent_cookie CHAR(1) ENCODE zstd
,pointofinterest VARCHAR(256) ENCODE zstd
,pointofinterestdistance VARCHAR(256) ENCODE zstd
,post_campaign VARCHAR(300) ENCODE zstd
,post_channel VARCHAR(256) ENCODE zstd
,post_cookies CHAR(1) ENCODE zstd
,post_currency VARCHAR(256) ENCODE zstd
,issue_id VARCHAR(256) ENCODE zstd
,device_id VARCHAR(256) ENCODE zstd
,template_type VARCHAR(256) ENCODE zstd
,story_title VARCHAR(256) ENCODE zstd
,editors_pick_download VARCHAR(256) ENCODE zstd
,editors_pick_download_counter  VARCHAR(256) ENCODE zstd
,user_agent_evar VARCHAR(256) ENCODE zstd
,app_rating VARCHAR(256) ENCODE zstd
,loggedin VARCHAR(256) ENCODE zstd
,subscriber_type VARCHAR(256) ENCODE zstd
,content_region VARCHAR(256) ENCODE zstd
,share_type VARCHAR(256) ENCODE zstd
,audio_progress VARCHAR(256) ENCODE zstd
,orientation VARCHAR(256) ENCODE zstd
,ad_impresson VARCHAR(256) ENCODE zstd
,device_type VARCHAR(256) ENCODE zstd
,device_advertising_id VARCHAR(256) ENCODE zstd
,paid_free VARCHAR(256) ENCODE zstd
,drupal_id INTEGER ENCODE zstd
,connection_type VARCHAR(256) ENCODE zstd
,app_id VARCHAR(256) ENCODE zstd
,link_page VARCHAR(256) ENCODE zstd
,app_name VARCHAR(256) ENCODE zstd
,country_residence VARCHAR(256) ENCODE zstd
,post_ad_load_exit VARCHAR(256) ENCODE zstd
,navigated_by VARCHAR(256) ENCODE zstd
,subscription_term_google_play VARCHAR(256) ENCODE zstd
,error_code VARCHAR(256) ENCODE zstd
,error_message VARCHAR(65535) ENCODE zstd
,post_event_list VARCHAR(65535) ENCODE zstd
,post_java_enabled CHAR(1) ENCODE zstd
,post_keywords VARCHAR(256) ENCODE zstd
,post_mobileappid VARCHAR(256) ENCODE zstd
,post_mobiledayofweek VARCHAR(256) ENCODE zstd
,post_mobiledayssincefirstuse VARCHAR(256) ENCODE zstd
,post_mobiledayssincelastuse VARCHAR(256) ENCODE zstd
,post_mobiledevice VARCHAR(256) ENCODE zstd
,post_mobilehourofday VARCHAR(256) ENCODE zstd
,post_mobileinstalldate VARCHAR(256) ENCODE zstd
,post_mobilelaunchnumber VARCHAR(256) ENCODE zstd
,post_mobileosversion VARCHAR(256) ENCODE zstd
,post_mobileresolution VARCHAR(256) ENCODE zstd
,post_page_event SMALLINT ENCODE zstd
,post_pagename VARCHAR(256) ENCODE zstd
,post_pagename_no_url VARCHAR(256) ENCODE zstd
,post_persistent_cookie VARCHAR(256) ENCODE zstd
,post_pointofinterest VARCHAR(256) ENCODE zstd
,post_pointofinterestdistance VARCHAR(256) ENCODE zstd
,post_product_list VARCHAR(65535) ENCODE zstd
,issue_date VARCHAR(256) ENCODE zstd
,device_id_prop VARCHAR(256) ENCODE zstd
,template VARCHAR(256) ENCODE zstd
,story_title_prop VARCHAR(256) ENCODE zstd
,editors_pick_download_prop VARCHAR(256) ENCODE zstd
,user_agent_prop VARCHAR(256) ENCODE zstd
,app_rating_prop VARCHAR(256) ENCODE zstd
,loggedin_prop VARCHAR(256) ENCODE zstd
,subscriber_type_prop VARCHAR(256) ENCODE zstd
,content_region_prop VARCHAR(256) ENCODE zstd
,share_type_prop VARCHAR(256) ENCODE zstd
,audio_segment VARCHAR(256) ENCODE zstd
,orientation_prop VARCHAR(256) ENCODE zstd
,ad_impressions VARCHAR(256) ENCODE zstd
,device_type_prop VARCHAR(256) ENCODE zstd
,app_advertising_id VARCHAR(256) ENCODE zstd
,paid_free_prop VARCHAR(256) ENCODE zstd
,page_view VARCHAR(256) ENCODE zstd
,connection_type_prop VARCHAR(256) ENCODE zstd
,ad_load_exit VARCHAR(256) ENCODE zstd
,navigated_by_prop VARCHAR(256) ENCODE zstd
,google_play_subscriptions VARCHAR(256) ENCODE zstd
,app_id_prop VARCHAR(256) ENCODE zstd
,post_purchaseid VARCHAR(256) ENCODE zstd
,post_search_engine BIGINT ENCODE zstd
,post_state VARCHAR(256) ENCODE zstd
,post_survey VARCHAR(65535) ENCODE zstd
,post_t_time_info VARCHAR(256) ENCODE zstd
,post_zip VARCHAR(256) ENCODE zstd
,prev_page BIGINT ENCODE zstd
,product_list VARCHAR(65535) ENCODE zstd
,purchaseid VARCHAR(256) ENCODE zstd
,s_resolution VARCHAR(255) ENCODE zstd
,sampled_hit VARCHAR(256) ENCODE zstd
,search_engine BIGINT ENCODE zstd
,search_page_num BIGINT ENCODE zstd
,secondary_hit SMALLINT ENCODE zstd
,service CHAR(2) ENCODE zstd
,state VARCHAR(256) ENCODE zstd
,stats_server VARCHAR(256) ENCODE zstd
,t_time_info VARCHAR(256) ENCODE zstd
,user_agent VARCHAR(65535) ENCODE zstd
,visid_high BIGINT ENCODE zstd
,visid_low BIGINT ENCODE zstd
,visid_new CHAR(1) ENCODE zstd
,visid_timestamp TIMESTAMP ENCODE zstd
,visid_type SMALLINT ENCODE zstd
,visit_keywords VARCHAR(256) ENCODE zstd
,visit_num BIGINT ENCODE zstd
,visit_referrer VARCHAR(256) ENCODE zstd
,visit_search_engine VARCHAR(256) ENCODE zstd
,visit_start_pagename VARCHAR(256) ENCODE zstd
,visit_start_time_gmt TIMESTAMP ENCODE zstd
,accept_language VARCHAR(384) ENCODE zstd
,source VARCHAR(16) ENCODE zstd
,region VARCHAR(15) ENCODE zstd
,visitor_id varchar(256) ENCODE zstd
,visit_id VARCHAR(256) ENCODE zstd
,valid_user INTEGER ENCODE zstd
,valid_view INTEGER ENCODE zstd
,valid_visit INTEGER ENCODE zstd
,event_id_partition_key VARCHAR(87) ENCODE zstd
,hit_week TIMESTAMP ENCODE zstd
,subscription_page_new INTEGER ENCODE zstd
,subscription_new INTEGER ENCODE zstd
,teg_hit_local_datetime TIMESTAMP ENCODE zstd
,teg_hit_gmt_datetime TIMESTAMP ENCODE zstd
,teg_hit_timezone_offset INTEGER ENCODE zstd
,drupal_or_visitor_id VARCHAR(256) ENCODE zstd
,EXTERNAL_FILE_ID BIGINT ENCODE zstd
,EXTERNAL_FILE_ROWNUMBER BIGINT ENCODE zstd
) DISTKEY (drupal_or_visitor_id) SORTKEY (teg_hit_local_datetime)
;

set wlm_query_slot_count to 8;

INSERT INTO adobe.econprodappipad_new
SELECT * 
  FROM adobe.econprodappipad
;

ALTER TABLE adobe.econprodappipad RENAME TO econprodappipad_oldb;
ALTER TABLE adobe.econprodappipad_new RENAME TO econprodappipad;

GRANT INSERT ON adobe.econprodappipad TO copyrole;
GRANT SELECT ON adobe.econprodappipad TO GROUP readonly;

CREATE OR REPLACE VIEW adobe.combined
(
  accept_language,
  ad_impressions,
  ad_impresson,
  ad_load_exit,
  ad_region,
  ad_viewed_clicked,
  adload_adexit,
  advu_mpu,
  advu_mpu_prop,
  amstelnet_order_id,
  app_advertising_id,
  app_id,
  app_id_prop,
  app_name,
  app_rating,
  app_rating_prop,
  article_published_date,
  article_publishing,
  audio,
  audio_progress,
  audio_segment,
  br_camp_cid1_fst_click,
  br_camp_cid1_linear,
  br_camp_cid1_lst_click,
  br_camp_cid2_fst_click,
  br_camp_cid2_linear,
  br_camp_cid2_lst_click,
  browser,
  browser_height,
  browser_width,
  bulk_ip_address,
  campaign,
  campaign_attribution,
  campaign_attribution_owned_earned,
  campaign_attribution_paid,
  campaign_stacking_all,
  campaign_tracking,
  carrier,
  channel,
  click_action,
  click_action_type,
  click_tag,
  code_ver,
  connection_type,
  connection_type_prop,
  content_category,
  content_region,
  content_region_prop,
  content_source,
  content_type,
  cookies,
  country,
  country_residence,
  ct_connect_type,
  curr_factor,
  curr_rate,
  currency,
  cust_hit_time_gmt,
  cust_type_prod,
  cust_visid,
  customer_lifecycle,
  date_day_weektype,
  date_time,
  delivery_method,
  device_advertising_id,
  device_id,
  device_id_prop,
  device_name,
  device_type,
  device_type_prop,
  device_vendor_id,
  dfp_ad_id,
  dfp_site,
  dfp_zone,
  director_donor,
  domain,
  drupal_id,
  duplicate_events,
  duplicate_purchase,
  editors_pick_download,
  editors_pick_download_counter,
  editors_pick_download_prop,
  error_code,
  error_message,
  essay_section,
  event_id_partition_key,
  event_list,
  event_type,
  exclude_hit,
  facebook_widget_activity,
  fb_twitter_activity,
  first_hit_page_url,
  first_hit_pagename,
  first_hit_referrer,
  first_hit_time_gmt,
  form_name_field,
  form_sub_name,
  geo_city,
  geo_country,
  geo_dma,
  geo_region,
  geo_zip,
  google_play_subscriptions,
  grapeshot_value,
  hier1,
  hit_source,
  hit_time_gmt,
  hit_week,
  hitid_high,
  hitid_low,
  hour_of_day,
  int_sub_ads_first_click,
  int_sub_ads_last_click,
  internal_link,
  internal_link_external,
  ip,
  ip2,
  issue_date,
  issue_id,
  issue_region,
  key_interactions,
  key_interactions_pay_barrier_tracking,
  language,
  last_hit_time_gmt,
  last_purchase_num,
  last_purchase_time_gmt,
  link_name,
  link_page,
  loggedin,
  loggedin_prop,
  maximiser_campaign,
  mcvisid,
  meta_name,
  mobile_id,
  muls_subscription_type,
  multiuser_usage,
  navigated_by,
  navigated_by_prop,
  new_visit,
  newsletter_signup_from_reg,
  orientation,
  orientation_prop,
  os,
  os_version,
  page_event,
  page_event_var1,
  page_event_var2,
  page_event_var3,
  page_name,
  page_share_link,
  page_site_id,
  page_type,
  page_url,
  page_video_play,
  page_view,
  pagename,
  paid_free,
  paid_free_prop,
  paid_search,
  partner_referrals,
  payment_type,
  persistent_cookie,
  pointofinterest,
  pointofinterestdistance,
  post_ad_load_exit,
  post_campaign,
  post_channel,
  post_cookies,
  post_currency,
  post_event_list,
  post_hier1,
  post_hier2,
  post_hier3,
  post_hier4,
  post_hier5,
  post_java_enabled,
  post_keywords,
  post_mobileappid,
  post_mobiledayofweek,
  post_mobiledayssincefirstuse,
  post_mobiledayssincelastuse,
  post_mobiledevice,
  post_mobilehourofday,
  post_mobileinstalldate,
  post_mobilelaunchnumber,
  post_mobileosversion,
  post_mobileresolution,
  post_page_event,
  post_page_event_var1,
  post_page_event_var2,
  post_page_event_var3,
  post_page_url,
  post_pagename,
  post_pagename_no_url,
  post_partner_plugins,
  post_persistent_cookie,
  post_pointofinterest,
  post_pointofinterestdistance,
  post_product_list,
  post_purchaseid,
  post_referrer,
  post_search_engine,
  post_state,
  post_survey,
  post_t_time_info,
  post_zip,
  prev_page,
  product_id,
  product_list,
  promo_code,
  prop_article_published_date,
  prop_cust_type_prod,
  prop_drupal_id,
  prop_story_title,
  prop_user_login_status,
  purchase_id,
  purchaseid,
  ref_domain,
  ref_type,
  referrer,
  referring_subdomain,
  region,
  region_served,
  registration,
  renewal_start_end_date,
  revamp_tracking,
  s_resolution,
  sampled_hit,
  search_engine,
  search_page_num,
  search_results,
  secondary_hit,
  service,
  share_type,
  share_type_prop,
  sharelink,
  source,
  state,
  stats_server,
  story_title,
  story_title_prop,
  sub_data_protection,
  sub_date_end,
  sub_expiration,
  sub_length,
  sub_login_reg_activities,
  sub_start_date,
  sublength,
  subscriber_type,
  subscriber_type_prop,
  subscription_new,
  subscription_page_new,
  subscription_page_renew,
  subscription_renew,
  subscription_term_google_play,
  subsection,
  t_time_info,
  teg_hit_gmt_datetime,
  teg_hit_local_datetime,
  teg_hit_timezone_offset,
  template,
  template_type,
  ub_form_abandonment,
  ub_offer_country,
  ub_product_code,
  ub_sub,
  url,
  user_agent,
  user_agent_evar,
  user_agent_prop,
  user_login_status,
  userid,
  username,
  valid_user,
  valid_view,
  valid_visit,
  video_play,
  video_segment,
  video_tags,
  video_tags_prop,
  videos,
  videos_formatted,
  visid_high,
  visid_low,
  visid_new,
  visid_timestamp,
  visid_type,
  visit_id,
  visit_keywords,
  visit_num,
  visit_number_new_repeat,
  visit_page_num,
  visit_referrer,
  visit_search_engine,
  visit_start_page_url,
  visit_start_pagename,
  visitor_id,
  visitor_id_evar,
  week_type,
  drupal_or_visitor_id,
  external_file_id,
  external_file_rownumber
)
AS
( SELECT economistcomprod.accept_language,
NULL::"unknown" AS ad_impressions,
NULL::"unknown" AS ad_impresson,
NULL::"unknown" AS ad_load_exit,
NULL::"unknown" AS ad_region,
economistcomprod.ad_viewed_clicked,
NULL::"unknown" AS adload_adexit,
economistcomprod.advu_mpu,
economistcomprod.advu_mpu_prop,
economistcomprod.amstelnet_order_id,
NULL::"unknown" AS app_advertising_id,
NULL::"unknown" AS app_id,
NULL::"unknown" AS app_id_prop,
NULL::"unknown" AS app_name,
NULL::"unknown" AS app_rating,
NULL::"unknown" AS app_rating_prop,
economistcomprod.article_published_date,
economistcomprod.article_publishing,
economistcomprod.audio,
NULL::"unknown" AS audio_progress,
NULL::"unknown" AS audio_segment,
economistcomprod.br_camp_cid1_fst_click,
economistcomprod.br_camp_cid1_linear,
economistcomprod.br_camp_cid1_lst_click,
economistcomprod.br_camp_cid2_fst_click,
economistcomprod.br_camp_cid2_linear,
economistcomprod.br_camp_cid2_lst_click,
economistcomprod.browser,
economistcomprod.browser_height,
economistcomprod.browser_width,
economistcomprod.bulk_ip_address,
economistcomprod.campaign,
economistcomprod.campaign_attribution,
economistcomprod.campaign_attribution_owned_earned,
economistcomprod.campaign_attribution_paid,
economistcomprod.campaign_stacking_all,
economistcomprod.campaign_tracking,
NULL::"unknown" AS carrier,
economistcomprod.channel,
economistcomprod.click_action,
economistcomprod.click_action_type,
economistcomprod.click_tag,
NULL::"unknown" AS code_ver,
NULL::"unknown" AS connection_type,
NULL::"unknown" AS connection_type_prop,
economistcomprod.content_category,
NULL::"unknown" AS content_region,
NULL::"unknown" AS content_region_prop,
NULL::"unknown" AS content_source,
economistcomprod.content_type,
NULL::"unknown" AS cookies,
NULL::"unknown" AS country,
NULL::"unknown" AS country_residence,
economistcomprod.ct_connect_type,
economistcomprod.curr_factor,
economistcomprod.curr_rate,
economistcomprod.currency,
NULL::"unknown" AS cust_hit_time_gmt,
economistcomprod.cust_type_prod,
NULL::"unknown" AS cust_visid,
economistcomprod.customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
economistcomprod.date_time,
NULL::"unknown" AS delivery_method,
NULL::"unknown" AS device_advertising_id,
NULL::"unknown" AS device_id,
NULL::"unknown" AS device_id_prop,
NULL::"unknown" AS device_name,
NULL::"unknown" AS device_type,
NULL::"unknown" AS device_type_prop,
NULL::"unknown" AS device_vendor_id,
economistcomprod.dfp_ad_id,
economistcomprod.dfp_site,
economistcomprod.dfp_zone,
economistcomprod.director_donor,
economistcomprod."domain",
economistcomprod.drupal_id,
NULL::"unknown" AS duplicate_events,
NULL::"unknown" AS duplicate_purchase,
NULL::"unknown" AS editors_pick_download,
NULL::"unknown" AS editors_pick_download_counter,
NULL::"unknown" AS editors_pick_download_prop,
economistcomprod.error_code,
economistcomprod.error_message,
economistcomprod.essay_section,
economistcomprod.event_id_partition_key,
NULL::"unknown" AS event_list,
NULL::"unknown" AS event_type,
economistcomprod.exclude_hit,
economistcomprod.facebook_widget_activity,
economistcomprod.fb_twitter_activity,
economistcomprod.first_hit_page_url,
economistcomprod.first_hit_pagename,
economistcomprod.first_hit_referrer,
economistcomprod.first_hit_time_gmt,
economistcomprod.form_name_field,
economistcomprod.form_sub_name,
economistcomprod.geo_city,
economistcomprod.geo_country,
economistcomprod.geo_dma,
economistcomprod.geo_region,
economistcomprod.geo_zip,
NULL::"unknown" AS google_play_subscriptions,
economistcomprod.grapeshot_value,
economistcomprod.hier1,
economistcomprod.hit_source,
economistcomprod.hit_time_gmt,
economistcomprod.hit_week,
economistcomprod.hitid_high,
economistcomprod.hitid_low,
economistcomprod.hour_of_day,
economistcomprod.int_sub_ads_first_click,
economistcomprod.int_sub_ads_last_click,
economistcomprod.internal_link,
economistcomprod.internal_link_external,
economistcomprod.ip,
economistcomprod.ip2,
economistcomprod.issue_date,
NULL::"unknown" AS issue_id,
NULL::"unknown" AS issue_region,
economistcomprod.key_interactions,
economistcomprod.key_interactions_pay_barrier_tracking,
economistcomprod."language",
economistcomprod.last_hit_time_gmt,
economistcomprod.last_purchase_num,
NULL::"unknown" AS last_purchase_time_gmt,
economistcomprod.link_name,
NULL::"unknown" AS link_page,
NULL::"unknown" AS loggedin,
NULL::"unknown" AS loggedin_prop,
economistcomprod.maximiser_campaign,
NULL::"unknown" AS mcvisid,
economistcomprod.meta_name,
economistcomprod.mobile_id,
economistcomprod.muls_subscription_type,
economistcomprod.multiuser_usage,
NULL::"unknown" AS navigated_by,
NULL::"unknown" AS navigated_by_prop,
economistcomprod.new_visit,
economistcomprod.newsletter_signup_from_reg,
NULL::"unknown" AS orientation,
NULL::"unknown" AS orientation_prop,
economistcomprod.os,
NULL::"unknown" AS os_version,
economistcomprod.page_event,
economistcomprod.page_event_var1,
NULL::"unknown" AS page_event_var2,
NULL::"unknown" AS page_event_var3,
economistcomprod.page_name,
economistcomprod.page_share_link,
economistcomprod.page_site_id,
economistcomprod.page_type,
NULL::"unknown" AS page_url,
economistcomprod.page_video_play,
NULL::"unknown" AS page_view,
NULL::"unknown" AS pagename,
NULL::"unknown" AS paid_free,
NULL::"unknown" AS paid_free_prop,
economistcomprod.paid_search,
economistcomprod.partner_referrals,
economistcomprod.payment_type,
economistcomprod.persistent_cookie,
NULL::"unknown" AS pointofinterest,
NULL::"unknown" AS pointofinterestdistance,
NULL::"unknown" AS post_ad_load_exit,
economistcomprod.post_campaign,
economistcomprod.post_channel,
economistcomprod.post_cookies,
economistcomprod.post_currency,
economistcomprod.post_event_list,
economistcomprod.post_hier1,
economistcomprod.post_hier2,
economistcomprod.post_hier3,
economistcomprod.post_hier4,
economistcomprod.post_hier5,
NULL::"unknown" AS post_java_enabled,
economistcomprod.post_keywords,
NULL::"unknown" AS post_mobileappid,
NULL::"unknown" AS post_mobiledayofweek,
NULL::"unknown" AS post_mobiledayssincefirstuse,
NULL::"unknown" AS post_mobiledayssincelastuse,
NULL::"unknown" AS post_mobiledevice,
NULL::"unknown" AS post_mobilehourofday,
NULL::"unknown" AS post_mobileinstalldate,
NULL::"unknown" AS post_mobilelaunchnumber,
NULL::"unknown" AS post_mobileosversion,
NULL::"unknown" AS post_mobileresolution,
economistcomprod.post_page_event,
economistcomprod.post_page_event_var1,
NULL::"unknown" AS post_page_event_var2,
NULL::"unknown" AS post_page_event_var3,
economistcomprod.post_page_url,
economistcomprod.post_pagename,
economistcomprod.post_pagename_no_url,
economistcomprod.post_partner_plugins,
NULL::"unknown" AS post_persistent_cookie,
NULL::"unknown" AS post_pointofinterest,
NULL::"unknown" AS post_pointofinterestdistance,
economistcomprod.post_product_list,
economistcomprod.post_purchaseid,
economistcomprod.post_referrer,
economistcomprod.post_search_engine,
economistcomprod.post_state,
economistcomprod.post_survey,
economistcomprod.post_t_time_info,
NULL::"unknown" AS post_zip,
economistcomprod.prev_page,
NULL::"unknown" AS product_id,
economistcomprod.product_list,
economistcomprod.promo_code,
economistcomprod.prop_article_published_date,
economistcomprod.prop_cust_type_prod,
economistcomprod.prop_drupal_id,
economistcomprod.prop_story_title,
economistcomprod.prop_user_login_status,
NULL::"unknown" AS purchase_id,
economistcomprod.purchaseid,
economistcomprod.ref_domain,
economistcomprod.ref_type,
economistcomprod.referrer,
economistcomprod.referring_subdomain,
economistcomprod."region",
economistcomprod.region_served,
economistcomprod.registration,
economistcomprod.renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
economistcomprod.s_resolution,
NULL::"unknown" AS sampled_hit,
economistcomprod.search_engine,
economistcomprod.search_page_num,
economistcomprod.search_results,
NULL::"unknown" AS secondary_hit,
economistcomprod.service,
NULL::"unknown" AS share_type,
NULL::"unknown" AS share_type_prop,
economistcomprod.sharelink,
economistcomprod.source,
economistcomprod.state,
economistcomprod.stats_server,
economistcomprod.story_title,
NULL::"unknown" AS story_title_prop,
economistcomprod.sub_data_protection,
economistcomprod.sub_date_end,
economistcomprod.sub_expiration,
economistcomprod.sub_length,
economistcomprod.sub_login_reg_activities,
economistcomprod.sub_start_date,
economistcomprod.sublength,
NULL::"unknown" AS subscriber_type,
NULL::"unknown" AS subscriber_type_prop,
economistcomprod.subscription_new,
economistcomprod.subscription_page_new,
economistcomprod.subscription_page_renew,
economistcomprod.subscription_renew,
NULL::"unknown" AS subscription_term_google_play,
economistcomprod.subsection,
economistcomprod.t_time_info,
economistcomprod.teg_hit_gmt_datetime,
economistcomprod.teg_hit_local_datetime,
economistcomprod.teg_hit_timezone_offset,
NULL::"unknown" AS "template",
NULL::"unknown" AS template_type,
economistcomprod.ub_form_abandonment,
economistcomprod.ub_offer_country,
economistcomprod.ub_product_code,
economistcomprod.ub_sub,
economistcomprod.url,
NULL::"unknown" AS user_agent,
NULL::"unknown" AS user_agent_evar,
NULL::"unknown" AS user_agent_prop,
economistcomprod.user_login_status,
economistcomprod.userid,
economistcomprod.username,
economistcomprod.valid_user,
economistcomprod.valid_view,
economistcomprod.valid_visit,
economistcomprod.video_play,
economistcomprod.video_segment,
economistcomprod.video_tags,
economistcomprod.video_tags_prop,
economistcomprod.videos,
economistcomprod.videos_formatted,
NULL::"unknown" AS visid_high,
NULL::"unknown" AS visid_low,
NULL::"unknown" AS visid_new,
economistcomprod.visid_timestamp,
economistcomprod.visid_type,
economistcomprod.visit_id,
economistcomprod.visit_keywords,
economistcomprod.visit_num,
economistcomprod.visit_number_new_repeat,
economistcomprod.visit_page_num,
economistcomprod.visit_referrer,
economistcomprod.visit_search_engine,
economistcomprod.visit_start_page_url,
economistcomprod.visit_start_pagename,
economistcomprod.visitor_id,
NULL::"unknown" AS visitor_id_evar,
economistcomprod.week_type,
economistcomprod.drupal_or_visitor_id,
economistcomprod.external_file_id,
economistcomprod.external_file_rownumber
   FROM adobe.economistcomprod
UNION ALL
 SELECT econprodappipad.accept_language,
econprodappipad.ad_impressions,
econprodappipad.ad_impresson,
econprodappipad.ad_load_exit,
NULL::"unknown" AS ad_region,
NULL::"unknown" AS ad_viewed_clicked,
NULL::"unknown" AS adload_adexit,
NULL::"unknown" AS advu_mpu,
NULL::"unknown" AS advu_mpu_prop,
NULL::"unknown" AS amstelnet_order_id,
econprodappipad.app_advertising_id,
econprodappipad.app_id,
econprodappipad.app_id_prop,
econprodappipad.app_name,
econprodappipad.app_rating,
econprodappipad.app_rating_prop,
NULL::"unknown" AS article_published_date,
NULL::"unknown" AS article_publishing,
NULL::"unknown" AS audio,
econprodappipad.audio_progress,
econprodappipad.audio_segment,
NULL::"unknown" AS br_camp_cid1_fst_click,
NULL::"unknown" AS br_camp_cid1_linear,
NULL::"unknown" AS br_camp_cid1_lst_click,
NULL::"unknown" AS br_camp_cid2_fst_click,
NULL::"unknown" AS br_camp_cid2_linear,
NULL::"unknown" AS br_camp_cid2_lst_click,
econprodappipad.browser::character varying(256) AS browser,
econprodappipad.browser_height::character varying(256) AS browser_height,
econprodappipad.browser_width,
NULL::"unknown" AS bulk_ip_address,
econprodappipad.campaign,
NULL::"unknown" AS campaign_attribution,
NULL::"unknown" AS campaign_attribution_owned_earned,
NULL::"unknown" AS campaign_attribution_paid,
NULL::"unknown" AS campaign_stacking_all,
NULL::"unknown" AS campaign_tracking,
econprodappipad.carrier,
econprodappipad.channel,
NULL::"unknown" AS click_action,
NULL::"unknown" AS click_action_type,
NULL::"unknown" AS click_tag,
econprodappipad.code_ver,
econprodappipad.connection_type,
econprodappipad.connection_type_prop,
NULL::"unknown" AS content_category,
econprodappipad.content_region,
econprodappipad.content_region_prop,
NULL::"unknown" AS content_source,
NULL::"unknown" AS content_type,
econprodappipad.cookies,
econprodappipad.country,
econprodappipad.country_residence,
econprodappipad.ct_connect_type,
NULL::"unknown" AS curr_factor,
econprodappipad.curr_rate,
econprodappipad.currency,
econprodappipad.cust_hit_time_gmt,
NULL::"unknown" AS cust_type_prod,
NULL::"unknown" AS cust_visid,
NULL::"unknown" AS customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
econprodappipad.date_time,
NULL::"unknown" AS delivery_method,
econprodappipad.device_advertising_id,
econprodappipad.device_id,
econprodappipad.device_id_prop,
NULL::"unknown" AS device_name,
econprodappipad.device_type,
econprodappipad.device_type_prop,
NULL::"unknown" AS device_vendor_id,
NULL::"unknown" AS dfp_ad_id,
NULL::"unknown" AS dfp_site,
NULL::"unknown" AS dfp_zone,
NULL::"unknown" AS director_donor,
econprodappipad."domain",
econprodappipad.drupal_id,
econprodappipad.duplicate_events,
econprodappipad.duplicate_purchase,
econprodappipad.editors_pick_download,
econprodappipad.editors_pick_download_counter,
econprodappipad.editors_pick_download_prop,
econprodappipad.error_code,
econprodappipad.error_message,
NULL::"unknown" AS essay_section,
econprodappipad.event_id_partition_key,
econprodappipad.event_list,
NULL::"unknown" AS event_type,
econprodappipad.exclude_hit,
NULL::"unknown" AS facebook_widget_activity,
NULL::"unknown" AS fb_twitter_activity,
econprodappipad.first_hit_page_url,
econprodappipad.first_hit_pagename,
econprodappipad.first_hit_referrer,
econprodappipad.first_hit_time_gmt,
NULL::"unknown" AS form_name_field,
NULL::"unknown" AS form_sub_name,
econprodappipad.geo_city,
econprodappipad.geo_country,
econprodappipad.geo_dma,
econprodappipad.geo_region,
econprodappipad.geo_zip,
econprodappipad.google_play_subscriptions,
NULL::"unknown" AS grapeshot_value,
NULL::"unknown" AS hier1,
econprodappipad.hit_source,
NULL::"unknown" AS hit_time_gmt,
econprodappipad.hit_week,
econprodappipad.hitid_high,
econprodappipad.hitid_low,
NULL::"unknown" AS hour_of_day,
NULL::"unknown" AS int_sub_ads_first_click,
NULL::"unknown" AS int_sub_ads_last_click,
NULL::"unknown" AS internal_link,
NULL::"unknown" AS internal_link_external,
econprodappipad.ip,
econprodappipad.ip2,
econprodappipad.issue_date,
econprodappipad.issue_id,
NULL::"unknown" AS issue_region,
NULL::"unknown" AS key_interactions,
NULL::"unknown" AS key_interactions_pay_barrier_tracking,
econprodappipad."language",
NULL::"unknown" AS last_hit_time_gmt,
NULL::"unknown" AS last_purchase_num,
econprodappipad.last_purchase_time_gmt,
NULL::"unknown" AS link_name,
econprodappipad.link_page,
econprodappipad.loggedin,
econprodappipad.loggedin_prop,
NULL::"unknown" AS maximiser_campaign,
econprodappipad.mcvisid,
NULL::"unknown" AS meta_name,
econprodappipad.mobile_id,
NULL::"unknown" AS muls_subscription_type,
NULL::"unknown" AS multiuser_usage,
econprodappipad.navigated_by,
econprodappipad.navigated_by_prop,
econprodappipad.new_visit,
NULL::"unknown" AS newsletter_signup_from_reg,
econprodappipad.orientation,
econprodappipad.orientation_prop,
econprodappipad.os,
NULL::"unknown" AS os_version,
NULL::"unknown" AS page_event,
NULL::"unknown" AS page_event_var1,
NULL::"unknown" AS page_event_var2,
NULL::"unknown" AS page_event_var3,
NULL::"unknown" AS page_name,
NULL::"unknown" AS page_share_link,
NULL::"unknown" AS page_site_id,
NULL::"unknown" AS page_type,
NULL::"unknown" AS page_url,
NULL::"unknown" AS page_video_play,
econprodappipad.page_view,
econprodappipad.pagename,
econprodappipad.paid_free,
econprodappipad.paid_free_prop,
econprodappipad.paid_search,
NULL::"unknown" AS partner_referrals,
NULL::"unknown" AS payment_type,
econprodappipad.persistent_cookie,
econprodappipad.pointofinterest,
econprodappipad.pointofinterestdistance,
econprodappipad.post_ad_load_exit,
econprodappipad.post_campaign,
econprodappipad.post_channel,
econprodappipad.post_cookies,
econprodappipad.post_currency,
econprodappipad.post_event_list,
NULL::"unknown" AS post_hier1,
NULL::"unknown" AS post_hier2,
NULL::"unknown" AS post_hier3,
NULL::"unknown" AS post_hier4,
NULL::"unknown" AS post_hier5,
econprodappipad.post_java_enabled,
econprodappipad.post_keywords,
econprodappipad.post_mobileappid,
econprodappipad.post_mobiledayofweek,
econprodappipad.post_mobiledayssincefirstuse,
econprodappipad.post_mobiledayssincelastuse,
econprodappipad.post_mobiledevice,
econprodappipad.post_mobilehourofday,
econprodappipad.post_mobileinstalldate,
econprodappipad.post_mobilelaunchnumber,
econprodappipad.post_mobileosversion,
econprodappipad.post_mobileresolution,
econprodappipad.post_page_event::character varying(255) AS post_page_event,
NULL::"unknown" AS post_page_event_var1,
NULL::"unknown" AS post_page_event_var2,
NULL::"unknown" AS post_page_event_var3,
NULL::"unknown" AS post_page_url,
econprodappipad.post_pagename,
econprodappipad.post_pagename_no_url,
NULL::"unknown" AS post_partner_plugins,
econprodappipad.post_persistent_cookie,
econprodappipad.post_pointofinterest,
econprodappipad.post_pointofinterestdistance,
econprodappipad.post_product_list,
econprodappipad.post_purchaseid,
NULL::"unknown" AS post_referrer,
econprodappipad.post_search_engine,
econprodappipad.post_state,
econprodappipad.post_survey,
econprodappipad.post_t_time_info,
econprodappipad.post_zip,
econprodappipad.prev_page,
NULL::"unknown" AS product_id,
econprodappipad.product_list,
NULL::"unknown" AS promo_code,
NULL::"unknown" AS prop_article_published_date,
NULL::"unknown" AS prop_cust_type_prod,
NULL::"unknown" AS prop_drupal_id,
NULL::"unknown" AS prop_story_title,
NULL::"unknown" AS prop_user_login_status,
NULL::"unknown" AS purchase_id,
econprodappipad.purchaseid,
NULL::"unknown" AS ref_domain,
NULL::"unknown" AS ref_type,
NULL::"unknown" AS referrer,
NULL::"unknown" AS referring_subdomain,
econprodappipad."region",
NULL::"unknown" AS region_served,
NULL::"unknown" AS registration,
NULL::"unknown" AS renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
econprodappipad.s_resolution,
econprodappipad.sampled_hit,
econprodappipad.search_engine,
econprodappipad.search_page_num,
NULL::"unknown" AS search_results,
econprodappipad.secondary_hit,
econprodappipad.service,
econprodappipad.share_type,
econprodappipad.share_type_prop,
NULL::"unknown" AS sharelink,
econprodappipad.source,
econprodappipad.state,
econprodappipad.stats_server,
econprodappipad.story_title,
econprodappipad.story_title_prop,
NULL::"unknown" AS sub_data_protection,
NULL::"unknown" AS sub_date_end,
NULL::"unknown" AS sub_expiration,
NULL::"unknown" AS sub_length,
NULL::"unknown" AS sub_login_reg_activities,
NULL::"unknown" AS sub_start_date,
NULL::"unknown" AS sublength,
econprodappipad.subscriber_type,
econprodappipad.subscriber_type_prop,
econprodappipad.subscription_new,
econprodappipad.subscription_page_new,
NULL::"unknown" AS subscription_page_renew,
NULL::"unknown" AS subscription_renew,
econprodappipad.subscription_term_google_play,
NULL::"unknown" AS subsection,
econprodappipad.t_time_info,
econprodappipad.teg_hit_gmt_datetime,
econprodappipad.teg_hit_local_datetime,
econprodappipad.teg_hit_timezone_offset,
econprodappipad."template",
econprodappipad.template_type,
NULL::"unknown" AS ub_form_abandonment,
NULL::"unknown" AS ub_offer_country,
NULL::"unknown" AS ub_product_code,
NULL::"unknown" AS ub_sub,
NULL::"unknown" AS url,
econprodappipad.user_agent,
econprodappipad.user_agent_evar,
econprodappipad.user_agent_prop,
NULL::"unknown" AS user_login_status,
NULL::"unknown" AS userid,
NULL::"unknown" AS username,
econprodappipad.valid_user,
econprodappipad.valid_view,
econprodappipad.valid_visit,
NULL::"unknown" AS video_play,
NULL::"unknown" AS video_segment,
NULL::"unknown" AS video_tags,
NULL::"unknown" AS video_tags_prop,
NULL::"unknown" AS videos,
NULL::"unknown" AS videos_formatted,
econprodappipad.visid_high,
econprodappipad.visid_low,
econprodappipad.visid_new,
econprodappipad.visid_timestamp,
econprodappipad.visid_type,
econprodappipad.visit_id,
econprodappipad.visit_keywords,
econprodappipad.visit_num,
NULL::"unknown" AS visit_number_new_repeat,
NULL::"unknown" AS visit_page_num,
econprodappipad.visit_referrer,
econprodappipad.visit_search_engine,
NULL::"unknown" AS visit_start_page_url,
econprodappipad.visit_start_pagename,
econprodappipad.visitor_id,
NULL::"unknown" AS visitor_id_evar,
NULL::"unknown" AS week_type,
econprodappipad.drupal_or_visitor_id,
econprodappipad.external_file_id,
econprodappipad.external_file_rownumber
   FROM adobe.econprodappipad)
UNION ALL
 SELECT econdarwinproduction.accept_language,
NULL::"unknown" AS ad_impressions,
NULL::"unknown" AS ad_impresson,
NULL::"unknown" AS ad_load_exit,
econdarwinproduction.ad_region,
NULL::"unknown" AS ad_viewed_clicked,
econdarwinproduction.adload_adexit,
NULL::"unknown" AS advu_mpu,
NULL::"unknown" AS advu_mpu_prop,
NULL::"unknown" AS amstelnet_order_id,
NULL::"unknown" AS app_advertising_id,
econdarwinproduction.app_id,
NULL::"unknown" AS app_id_prop,
NULL::"unknown" AS app_name,
NULL::"unknown" AS app_rating,
NULL::"unknown" AS app_rating_prop,
NULL::"unknown" AS article_published_date,
NULL::"unknown" AS article_publishing,
NULL::"unknown" AS audio,
NULL::"unknown" AS audio_progress,
NULL::"unknown" AS audio_segment,
NULL::"unknown" AS br_camp_cid1_fst_click,
NULL::"unknown" AS br_camp_cid1_linear,
NULL::"unknown" AS br_camp_cid1_lst_click,
NULL::"unknown" AS br_camp_cid2_fst_click,
NULL::"unknown" AS br_camp_cid2_linear,
NULL::"unknown" AS br_camp_cid2_lst_click,
econdarwinproduction.browser::character varying(256) AS browser,
econdarwinproduction.browser_height::character varying(256) AS browser_height,
econdarwinproduction.browser_width,
NULL::"unknown" AS bulk_ip_address,
econdarwinproduction.campaign,
NULL::"unknown" AS campaign_attribution,
NULL::"unknown" AS campaign_attribution_owned_earned,
NULL::"unknown" AS campaign_attribution_paid,
NULL::"unknown" AS campaign_stacking_all,
NULL::"unknown" AS campaign_tracking,
econdarwinproduction.carrier,
NULL::"unknown" AS channel,
econdarwinproduction.click_action,
econdarwinproduction.click_action_type,
NULL::"unknown" AS click_tag,
NULL::"unknown" AS code_ver,
econdarwinproduction.connection_type,
NULL::"unknown" AS connection_type_prop,
NULL::"unknown" AS content_category,
NULL::"unknown" AS content_region,
NULL::"unknown" AS content_region_prop,
NULL::"unknown" AS content_source,
NULL::"unknown" AS content_type,
econdarwinproduction.cookies,
econdarwinproduction.country,
NULL::"unknown" AS country_residence,
econdarwinproduction.ct_connect_type,
NULL::"unknown" AS curr_factor,
econdarwinproduction.curr_rate,
econdarwinproduction.currency,
econdarwinproduction.cust_hit_time_gmt,
NULL::"unknown" AS cust_type_prod,
econdarwinproduction.cust_visid,
NULL::"unknown" AS customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
econdarwinproduction.date_time,
econdarwinproduction.delivery_method,
NULL::"unknown" AS device_advertising_id,
NULL::"unknown" AS device_id,
NULL::"unknown" AS device_id_prop,
econdarwinproduction.device_name,
NULL::"unknown" AS device_type,
NULL::"unknown" AS device_type_prop,
econdarwinproduction.device_vendor_id,
NULL::"unknown" AS dfp_ad_id,
NULL::"unknown" AS dfp_site,
NULL::"unknown" AS dfp_zone,
NULL::"unknown" AS director_donor,
econdarwinproduction."domain",
econdarwinproduction.drupal_id,
NULL::"unknown" AS duplicate_events,
NULL::"unknown" AS duplicate_purchase,
NULL::"unknown" AS editors_pick_download,
NULL::"unknown" AS editors_pick_download_counter,
NULL::"unknown" AS editors_pick_download_prop,
NULL::"unknown" AS error_code,
NULL::"unknown" AS error_message,
NULL::"unknown" AS essay_section,
econdarwinproduction.event_id_partition_key,
econdarwinproduction.event_list,
econdarwinproduction.event_type,
econdarwinproduction.exclude_hit,
NULL::"unknown" AS facebook_widget_activity,
NULL::"unknown" AS fb_twitter_activity,
NULL::"unknown" AS first_hit_page_url,
NULL::"unknown" AS first_hit_pagename,
econdarwinproduction.first_hit_referrer,
NULL::"unknown" AS first_hit_time_gmt,
NULL::"unknown" AS form_name_field,
NULL::"unknown" AS form_sub_name,
econdarwinproduction.geo_city,
econdarwinproduction.geo_country,
econdarwinproduction.geo_dma,
econdarwinproduction.geo_region,
econdarwinproduction.geo_zip,
NULL::"unknown" AS google_play_subscriptions,
NULL::"unknown" AS grapeshot_value,
NULL::"unknown" AS hier1,
econdarwinproduction.hit_source,
NULL::"unknown" AS hit_time_gmt,
econdarwinproduction.hit_week,
econdarwinproduction.hitid_high,
econdarwinproduction.hitid_low,
econdarwinproduction.hour_of_day,
NULL::"unknown" AS int_sub_ads_first_click,
NULL::"unknown" AS int_sub_ads_last_click,
NULL::"unknown" AS internal_link,
NULL::"unknown" AS internal_link_external,
econdarwinproduction.ip,
econdarwinproduction.ip2,
econdarwinproduction.issue_date,
NULL::"unknown" AS issue_id,
econdarwinproduction.issue_region,
NULL::"unknown" AS key_interactions,
NULL::"unknown" AS key_interactions_pay_barrier_tracking,
econdarwinproduction."language",
NULL::"unknown" AS last_hit_time_gmt,
NULL::"unknown" AS last_purchase_num,
NULL::"unknown" AS last_purchase_time_gmt,
NULL::"unknown" AS link_name,
NULL::"unknown" AS link_page,
NULL::"unknown" AS loggedin,
NULL::"unknown" AS loggedin_prop,
NULL::"unknown" AS maximiser_campaign,
NULL::"unknown" AS mcvisid,
NULL::"unknown" AS meta_name,
econdarwinproduction.mobile_id,
NULL::"unknown" AS muls_subscription_type,
NULL::"unknown" AS multiuser_usage,
NULL::"unknown" AS navigated_by,
NULL::"unknown" AS navigated_by_prop,
econdarwinproduction.new_visit,
NULL::"unknown" AS newsletter_signup_from_reg,
NULL::"unknown" AS orientation,
NULL::"unknown" AS orientation_prop,
econdarwinproduction.os,
econdarwinproduction.os_version,
econdarwinproduction.page_event,
econdarwinproduction.page_event_var1,
econdarwinproduction.page_event_var2,
econdarwinproduction.page_event_var3,
NULL::"unknown" AS page_name,
NULL::"unknown" AS page_share_link,
NULL::"unknown" AS page_site_id,
econdarwinproduction.page_type,
econdarwinproduction.page_url,
NULL::"unknown" AS page_video_play,
NULL::"unknown" AS page_view,
econdarwinproduction.pagename,
NULL::"unknown" AS paid_free,
NULL::"unknown" AS paid_free_prop,
econdarwinproduction.paid_search,
NULL::"unknown" AS partner_referrals,
NULL::"unknown" AS payment_type,
econdarwinproduction.persistent_cookie,
NULL::"unknown" AS pointofinterest,
NULL::"unknown" AS pointofinterestdistance,
NULL::"unknown" AS post_ad_load_exit,
econdarwinproduction.post_campaign,
econdarwinproduction.post_channel,
econdarwinproduction.post_cookies,
econdarwinproduction.post_currency,
econdarwinproduction.post_event_list,
econdarwinproduction.post_hier1,
econdarwinproduction.post_hier2,
econdarwinproduction.post_hier3,
econdarwinproduction.post_hier4,
econdarwinproduction.post_hier5,
NULL::"unknown" AS post_java_enabled,
econdarwinproduction.post_keywords,
NULL::"unknown" AS post_mobileappid,
NULL::"unknown" AS post_mobiledayofweek,
NULL::"unknown" AS post_mobiledayssincefirstuse,
NULL::"unknown" AS post_mobiledayssincelastuse,
NULL::"unknown" AS post_mobiledevice,
NULL::"unknown" AS post_mobilehourofday,
NULL::"unknown" AS post_mobileinstalldate,
NULL::"unknown" AS post_mobilelaunchnumber,
NULL::"unknown" AS post_mobileosversion,
NULL::"unknown" AS post_mobileresolution,
econdarwinproduction.post_page_event::character varying(255) AS post_page_event,
econdarwinproduction.post_page_event_var1,
econdarwinproduction.post_page_event_var2,
econdarwinproduction.post_page_event_var3,
econdarwinproduction.post_page_url,
econdarwinproduction.post_pagename,
econdarwinproduction.post_pagename_no_url,
econdarwinproduction.post_partner_plugins,
econdarwinproduction.post_persistent_cookie,
NULL::"unknown" AS post_pointofinterest,
NULL::"unknown" AS post_pointofinterestdistance,
econdarwinproduction.post_product_list,
econdarwinproduction.post_purchaseid,
econdarwinproduction.post_referrer,
econdarwinproduction.post_search_engine,
econdarwinproduction.post_state,
econdarwinproduction.post_survey,
econdarwinproduction.post_t_time_info,
NULL::"unknown" AS post_zip,
econdarwinproduction.prev_page,
econdarwinproduction.product_id,
econdarwinproduction.product_list,
NULL::"unknown" AS promo_code,
NULL::"unknown" AS prop_article_published_date,
NULL::"unknown" AS prop_cust_type_prod,
NULL::"unknown" AS prop_drupal_id,
NULL::"unknown" AS prop_story_title,
NULL::"unknown" AS prop_user_login_status,
econdarwinproduction.purchase_id,
NULL::"unknown" AS purchaseid,
econdarwinproduction.ref_domain,
econdarwinproduction.ref_type,
econdarwinproduction.referrer,
econdarwinproduction.referring_subdomain,
econdarwinproduction."region",
NULL::"unknown" AS region_served,
NULL::"unknown" AS registration,
NULL::"unknown" AS renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
econdarwinproduction.s_resolution,
econdarwinproduction.sampled_hit,
econdarwinproduction.search_engine,
econdarwinproduction.search_page_num,
NULL::"unknown" AS search_results,
econdarwinproduction.secondary_hit,
econdarwinproduction.service,
NULL::"unknown" AS share_type,
NULL::"unknown" AS share_type_prop,
NULL::"unknown" AS sharelink,
econdarwinproduction.source,
econdarwinproduction.state,
econdarwinproduction.stats_server,
econdarwinproduction.story_title,
NULL::"unknown" AS story_title_prop,
NULL::"unknown" AS sub_data_protection,
NULL::"unknown" AS sub_date_end,
NULL::"unknown" AS sub_expiration,
NULL::"unknown" AS sub_length,
NULL::"unknown" AS sub_login_reg_activities,
NULL::"unknown" AS sub_start_date,
NULL::"unknown" AS sublength,
econdarwinproduction.subscriber_type,
NULL::"unknown" AS subscriber_type_prop,
econdarwinproduction.subscription_new,
econdarwinproduction.subscription_page_new,
NULL::"unknown" AS subscription_page_renew,
NULL::"unknown" AS subscription_renew,
NULL::"unknown" AS subscription_term_google_play,
NULL::"unknown" AS subsection,
econdarwinproduction.t_time_info,
econdarwinproduction.teg_hit_gmt_datetime,
econdarwinproduction.teg_hit_local_datetime,
econdarwinproduction.teg_hit_timezone_offset,
NULL::"unknown" AS "template",
NULL::"unknown" AS template_type,
NULL::"unknown" AS ub_form_abandonment,
NULL::"unknown" AS ub_offer_country,
NULL::"unknown" AS ub_product_code,
NULL::"unknown" AS ub_sub,
NULL::"unknown" AS url,
NULL::"unknown" AS user_agent,
NULL::"unknown" AS user_agent_evar,
NULL::"unknown" AS user_agent_prop,
NULL::"unknown" AS user_login_status,
NULL::"unknown" AS userid,
NULL::"unknown" AS username,
econdarwinproduction.valid_user,
econdarwinproduction.valid_view,
econdarwinproduction.valid_visit,
NULL::"unknown" AS video_play,
NULL::"unknown" AS video_segment,
NULL::"unknown" AS video_tags,
NULL::"unknown" AS video_tags_prop,
NULL::"unknown" AS videos,
NULL::"unknown" AS videos_formatted,
econdarwinproduction.visid_high,
econdarwinproduction.visid_low,
econdarwinproduction.visid_new,
econdarwinproduction.visid_timestamp,
econdarwinproduction.visid_type,
econdarwinproduction.visit_id,
econdarwinproduction.visit_keywords,
econdarwinproduction.visit_num,
NULL::"unknown" AS visit_number_new_repeat,
NULL::"unknown" AS visit_page_num,
econdarwinproduction.visit_referrer,
econdarwinproduction.visit_search_engine,
econdarwinproduction.visit_start_page_url,
econdarwinproduction.visit_start_pagename,
econdarwinproduction.visitor_id,
econdarwinproduction.visitor_id_evar,
NULL::"unknown" AS week_type,
econdarwinproduction.drupal_or_visitor_id,
econdarwinproduction.external_file_id,
econdarwinproduction.external_file_rownumber
   FROM adobe.econdarwinproduction;
GRANT SELECT ON adobe.combined TO GROUP readonly;

---------------------------------------------------------------------------------------------------
-- 00222_recreate_adobe_econprodappipad_rollback.sql
---------------------------------------------------------------------------------------------------
DROP VIEW adobe.combined;

CREATE TABLE adobe.econprodappipad_new
(browser BIGINT ENCODE lzo
,browser_height BIGINT ENCODE lzo
,browser_width BIGINT ENCODE lzo
,campaign VARCHAR(300) ENCODE lzo
,carrier VARCHAR(128) ENCODE lzo
,channel VARCHAR(256) ENCODE lzo
,code_ver VARCHAR(256) ENCODE lzo
,cookies CHAR(1) ENCODE lzo
,country BIGINT ENCODE bytedict
,ct_connect_type VARCHAR(256) ENCODE lzo
,curr_rate DECIMAL ENCODE lzo
,currency VARCHAR(256) ENCODE lzo
,cust_hit_time_gmt TIMESTAMP ENCODE lzo
,date_time TIMESTAMP ENCODE lzo
,domain VARCHAR(256) ENCODE lzo
,duplicate_events VARCHAR(256) ENCODE lzo
,duplicate_purchase SMALLINT ENCODE lzo
,event_list VARCHAR(65535) ENCODE lzo
,exclude_hit SMALLINT ENCODE lzo
,first_hit_page_url VARCHAR(256) ENCODE lzo
,first_hit_pagename VARCHAR(256) ENCODE lzo
,first_hit_referrer VARCHAR(256) ENCODE lzo
,first_hit_time_gmt TIMESTAMP ENCODE lzo
,geo_city VARCHAR(256) ENCODE lzo
,geo_country VARCHAR(256) ENCODE lzo
,geo_dma BIGINT ENCODE bytedict
,geo_region VARCHAR(256) ENCODE lzo
,geo_zip VARCHAR(256) ENCODE lzo
,hit_source SMALLINT ENCODE lzo
,hitid_high BIGINT ENCODE lzo
,hitid_low BIGINT ENCODE lzo
,ip VARCHAR(256) ENCODE lzo
,ip2 VARCHAR(256) ENCODE lzo
,language BIGINT ENCODE lzo
,last_purchase_time_gmt BIGINT ENCODE lzo
,mcvisid VARCHAR(256) ENCODE lzo
,mobile_id BIGINT ENCODE lzo
,new_visit SMALLINT ENCODE lzo
,os BIGINT ENCODE bytedict
,pagename VARCHAR(256) ENCODE lzo
,paid_search SMALLINT ENCODE lzo
,persistent_cookie CHAR(1) ENCODE lzo
,pointofinterest VARCHAR(256) ENCODE lzo
,pointofinterestdistance VARCHAR(256) ENCODE lzo
,post_campaign VARCHAR(300) ENCODE lzo
,post_channel VARCHAR(256) ENCODE lzo
,post_cookies CHAR(1) ENCODE lzo
,post_currency VARCHAR(256) ENCODE lzo
,issue_id VARCHAR(256) ENCODE lzo
,device_id VARCHAR(256) ENCODE lzo
,template_type VARCHAR(256) ENCODE lzo
,story_title VARCHAR(256) ENCODE lzo
,editors_pick_download VARCHAR(256) ENCODE lzo
,editors_pick_download_counter  VARCHAR(256) ENCODE lzo
,user_agent_evar VARCHAR(256) ENCODE lzo
,app_rating VARCHAR(256) ENCODE lzo
,loggedin VARCHAR(256) ENCODE lzo
,subscriber_type VARCHAR(256) ENCODE lzo
,content_region VARCHAR(256) ENCODE lzo
,share_type VARCHAR(256) ENCODE lzo
,audio_progress VARCHAR(256) ENCODE lzo
,orientation VARCHAR(256) ENCODE lzo
,ad_impresson VARCHAR(256) ENCODE lzo
,device_type VARCHAR(256) ENCODE lzo
,device_advertising_id VARCHAR(256) ENCODE lzo
,paid_free VARCHAR(256) ENCODE lzo
,drupal_id INTEGER ENCODE lzo
,connection_type VARCHAR(256) ENCODE lzo
,app_id VARCHAR(256) ENCODE lzo
,link_page VARCHAR(256) ENCODE lzo
,app_name VARCHAR(256) ENCODE lzo
,country_residence VARCHAR(256) ENCODE lzo
,post_ad_load_exit VARCHAR(256) ENCODE lzo
,navigated_by VARCHAR(256) ENCODE lzo
,subscription_term_google_play VARCHAR(256) ENCODE lzo
,error_code VARCHAR(256) ENCODE lzo
,error_message VARCHAR(65535) ENCODE lzo
,post_event_list VARCHAR(65535) ENCODE lzo
,post_java_enabled CHAR(1) ENCODE lzo
,post_keywords VARCHAR(256) ENCODE lzo
,post_mobileappid VARCHAR(256) ENCODE lzo
,post_mobiledayofweek VARCHAR(256) ENCODE lzo
,post_mobiledayssincefirstuse VARCHAR(256) ENCODE lzo
,post_mobiledayssincelastuse VARCHAR(256) ENCODE lzo
,post_mobiledevice VARCHAR(256) ENCODE lzo
,post_mobilehourofday VARCHAR(256) ENCODE lzo
,post_mobileinstalldate VARCHAR(256) ENCODE lzo
,post_mobilelaunchnumber VARCHAR(256) ENCODE lzo
,post_mobileosversion VARCHAR(256) ENCODE lzo
,post_mobileresolution VARCHAR(256) ENCODE lzo
,post_page_event SMALLINT ENCODE lzo
,post_pagename VARCHAR(256) ENCODE lzo
,post_pagename_no_url VARCHAR(256) ENCODE lzo
,post_persistent_cookie VARCHAR(256) ENCODE lzo
,post_pointofinterest VARCHAR(256) ENCODE lzo
,post_pointofinterestdistance VARCHAR(256) ENCODE lzo
,post_product_list VARCHAR(65535) ENCODE lzo
,issue_date VARCHAR(256) ENCODE lzo
,device_id_prop VARCHAR(256) ENCODE lzo
,template VARCHAR(256) ENCODE lzo
,story_title_prop VARCHAR(256) ENCODE lzo
,editors_pick_download_prop VARCHAR(256) ENCODE lzo
,user_agent_prop VARCHAR(256) ENCODE lzo
,app_rating_prop VARCHAR(256) ENCODE lzo
,loggedin_prop VARCHAR(256) ENCODE lzo
,subscriber_type_prop VARCHAR(256) ENCODE lzo
,content_region_prop VARCHAR(256) ENCODE lzo
,share_type_prop VARCHAR(256) ENCODE lzo
,audio_segment VARCHAR(256) ENCODE lzo
,orientation_prop VARCHAR(256) ENCODE lzo
,ad_impressions VARCHAR(256) ENCODE lzo
,device_type_prop VARCHAR(256) ENCODE lzo
,app_advertising_id VARCHAR(256) ENCODE lzo
,paid_free_prop VARCHAR(256) ENCODE lzo
,page_view VARCHAR(256) ENCODE lzo
,connection_type_prop VARCHAR(256) ENCODE lzo
,ad_load_exit VARCHAR(256) ENCODE lzo
,navigated_by_prop VARCHAR(256) ENCODE lzo
,google_play_subscriptions VARCHAR(256) ENCODE lzo
,app_id_prop VARCHAR(256) ENCODE lzo
,post_purchaseid VARCHAR(256) ENCODE lzo
,post_search_engine BIGINT ENCODE lzo
,post_state VARCHAR(256) ENCODE lzo
,post_survey VARCHAR(65535) ENCODE lzo
,post_t_time_info VARCHAR(256) ENCODE lzo
,post_zip VARCHAR(256) ENCODE lzo
,prev_page BIGINT ENCODE lzo
,product_list VARCHAR(65535) ENCODE lzo
,purchaseid VARCHAR(256) ENCODE lzo
,s_resolution VARCHAR(255) ENCODE lzo
,sampled_hit VARCHAR(256) ENCODE lzo
,search_engine BIGINT ENCODE lzo
,search_page_num BIGINT ENCODE lzo
,secondary_hit SMALLINT ENCODE lzo
,service CHAR(2) ENCODE lzo
,state VARCHAR(256) ENCODE lzo
,stats_server VARCHAR(256) ENCODE lzo
,t_time_info VARCHAR(256) ENCODE lzo
,user_agent VARCHAR(65535) ENCODE lzo
,visid_high BIGINT ENCODE lzo
,visid_low BIGINT ENCODE lzo
,visid_new CHAR(1) ENCODE lzo
,visid_timestamp TIMESTAMP ENCODE lzo
,visid_type SMALLINT ENCODE lzo
,visit_keywords VARCHAR(256) ENCODE lzo
,visit_num BIGINT ENCODE lzo
,visit_referrer VARCHAR(256) ENCODE lzo
,visit_search_engine VARCHAR(256) ENCODE lzo
,visit_start_pagename VARCHAR(256) ENCODE lzo
,visit_start_time_gmt TIMESTAMP ENCODE lzo
,accept_language VARCHAR(384) ENCODE lzo
,source VARCHAR(16) ENCODE lzo
,region VARCHAR(15) ENCODE bytedict
,visitor_id varchar(256) ENCODE lzo
,visit_id VARCHAR(256) ENCODE lzo
,valid_user INTEGER ENCODE lzo
,valid_view INTEGER ENCODE lzo
,valid_visit INTEGER ENCODE lzo
,event_id_partition_key VARCHAR(87) ENCODE lzo
,hit_week TIMESTAMP ENCODE lzo
,subscription_page_new INTEGER ENCODE lzo
,subscription_new INTEGER ENCODE lzo
,teg_hit_local_datetime TIMESTAMP ENCODE lzo
,teg_hit_gmt_datetime TIMESTAMP ENCODE lzo
,teg_hit_timezone_offset INTEGER ENCODE bytedict
,drupal_or_visitor_id VARCHAR(256) ENCODE lzo
,EXTERNAL_FILE_ID BIGINT ENCODE lzo
,EXTERNAL_FILE_ROWNUMBER BIGINT ENCODE lzo
) DISTKEY (drupal_or_visitor_id) SORTKEY (teg_hit_local_datetime)
;

set wlm_query_slot_count to 8;

INSERT INTO adobe.econprodappipad_new
SELECT * 
  FROM adobe.econprodappipad
;

ALTER TABLE adobe.econprodappipad RENAME TO econprodappipad_oldb;
ALTER TABLE adobe.econprodappipad_new RENAME TO econprodappipad;

GRANT INSERT ON adobe.econprodappipad TO copyrole;
GRANT SELECT ON adobe.econprodappipad TO GROUP readonly;

CREATE OR REPLACE VIEW adobe.combined
(
  accept_language,
  ad_impressions,
  ad_impresson,
  ad_load_exit,
  ad_region,
  ad_viewed_clicked,
  adload_adexit,
  advu_mpu,
  advu_mpu_prop,
  amstelnet_order_id,
  app_advertising_id,
  app_id,
  app_id_prop,
  app_name,
  app_rating,
  app_rating_prop,
  article_published_date,
  article_publishing,
  audio,
  audio_progress,
  audio_segment,
  br_camp_cid1_fst_click,
  br_camp_cid1_linear,
  br_camp_cid1_lst_click,
  br_camp_cid2_fst_click,
  br_camp_cid2_linear,
  br_camp_cid2_lst_click,
  browser,
  browser_height,
  browser_width,
  bulk_ip_address,
  campaign,
  campaign_attribution,
  campaign_attribution_owned_earned,
  campaign_attribution_paid,
  campaign_stacking_all,
  campaign_tracking,
  carrier,
  channel,
  click_action,
  click_action_type,
  click_tag,
  code_ver,
  connection_type,
  connection_type_prop,
  content_category,
  content_region,
  content_region_prop,
  content_source,
  content_type,
  cookies,
  country,
  country_residence,
  ct_connect_type,
  curr_factor,
  curr_rate,
  currency,
  cust_hit_time_gmt,
  cust_type_prod,
  cust_visid,
  customer_lifecycle,
  date_day_weektype,
  date_time,
  delivery_method,
  device_advertising_id,
  device_id,
  device_id_prop,
  device_name,
  device_type,
  device_type_prop,
  device_vendor_id,
  dfp_ad_id,
  dfp_site,
  dfp_zone,
  director_donor,
  domain,
  drupal_id,
  duplicate_events,
  duplicate_purchase,
  editors_pick_download,
  editors_pick_download_counter,
  editors_pick_download_prop,
  error_code,
  error_message,
  essay_section,
  event_id_partition_key,
  event_list,
  event_type,
  exclude_hit,
  facebook_widget_activity,
  fb_twitter_activity,
  first_hit_page_url,
  first_hit_pagename,
  first_hit_referrer,
  first_hit_time_gmt,
  form_name_field,
  form_sub_name,
  geo_city,
  geo_country,
  geo_dma,
  geo_region,
  geo_zip,
  google_play_subscriptions,
  grapeshot_value,
  hier1,
  hit_source,
  hit_time_gmt,
  hit_week,
  hitid_high,
  hitid_low,
  hour_of_day,
  int_sub_ads_first_click,
  int_sub_ads_last_click,
  internal_link,
  internal_link_external,
  ip,
  ip2,
  issue_date,
  issue_id,
  issue_region,
  key_interactions,
  key_interactions_pay_barrier_tracking,
  language,
  last_hit_time_gmt,
  last_purchase_num,
  last_purchase_time_gmt,
  link_name,
  link_page,
  loggedin,
  loggedin_prop,
  maximiser_campaign,
  mcvisid,
  meta_name,
  mobile_id,
  muls_subscription_type,
  multiuser_usage,
  navigated_by,
  navigated_by_prop,
  new_visit,
  newsletter_signup_from_reg,
  orientation,
  orientation_prop,
  os,
  os_version,
  page_event,
  page_event_var1,
  page_event_var2,
  page_event_var3,
  page_name,
  page_share_link,
  page_site_id,
  page_type,
  page_url,
  page_video_play,
  page_view,
  pagename,
  paid_free,
  paid_free_prop,
  paid_search,
  partner_referrals,
  payment_type,
  persistent_cookie,
  pointofinterest,
  pointofinterestdistance,
  post_ad_load_exit,
  post_campaign,
  post_channel,
  post_cookies,
  post_currency,
  post_event_list,
  post_hier1,
  post_hier2,
  post_hier3,
  post_hier4,
  post_hier5,
  post_java_enabled,
  post_keywords,
  post_mobileappid,
  post_mobiledayofweek,
  post_mobiledayssincefirstuse,
  post_mobiledayssincelastuse,
  post_mobiledevice,
  post_mobilehourofday,
  post_mobileinstalldate,
  post_mobilelaunchnumber,
  post_mobileosversion,
  post_mobileresolution,
  post_page_event,
  post_page_event_var1,
  post_page_event_var2,
  post_page_event_var3,
  post_page_url,
  post_pagename,
  post_pagename_no_url,
  post_partner_plugins,
  post_persistent_cookie,
  post_pointofinterest,
  post_pointofinterestdistance,
  post_product_list,
  post_purchaseid,
  post_referrer,
  post_search_engine,
  post_state,
  post_survey,
  post_t_time_info,
  post_zip,
  prev_page,
  product_id,
  product_list,
  promo_code,
  prop_article_published_date,
  prop_cust_type_prod,
  prop_drupal_id,
  prop_story_title,
  prop_user_login_status,
  purchase_id,
  purchaseid,
  ref_domain,
  ref_type,
  referrer,
  referring_subdomain,
  region,
  region_served,
  registration,
  renewal_start_end_date,
  revamp_tracking,
  s_resolution,
  sampled_hit,
  search_engine,
  search_page_num,
  search_results,
  secondary_hit,
  service,
  share_type,
  share_type_prop,
  sharelink,
  source,
  state,
  stats_server,
  story_title,
  story_title_prop,
  sub_data_protection,
  sub_date_end,
  sub_expiration,
  sub_length,
  sub_login_reg_activities,
  sub_start_date,
  sublength,
  subscriber_type,
  subscriber_type_prop,
  subscription_new,
  subscription_page_new,
  subscription_page_renew,
  subscription_renew,
  subscription_term_google_play,
  subsection,
  t_time_info,
  teg_hit_gmt_datetime,
  teg_hit_local_datetime,
  teg_hit_timezone_offset,
  template,
  template_type,
  ub_form_abandonment,
  ub_offer_country,
  ub_product_code,
  ub_sub,
  url,
  user_agent,
  user_agent_evar,
  user_agent_prop,
  user_login_status,
  userid,
  username,
  valid_user,
  valid_view,
  valid_visit,
  video_play,
  video_segment,
  video_tags,
  video_tags_prop,
  videos,
  videos_formatted,
  visid_high,
  visid_low,
  visid_new,
  visid_timestamp,
  visid_type,
  visit_id,
  visit_keywords,
  visit_num,
  visit_number_new_repeat,
  visit_page_num,
  visit_referrer,
  visit_search_engine,
  visit_start_page_url,
  visit_start_pagename,
  visitor_id,
  visitor_id_evar,
  week_type,
  drupal_or_visitor_id,
  external_file_id,
  external_file_rownumber
)
AS
( SELECT economistcomprod.accept_language,
NULL::"unknown" AS ad_impressions,
NULL::"unknown" AS ad_impresson,
NULL::"unknown" AS ad_load_exit,
NULL::"unknown" AS ad_region,
economistcomprod.ad_viewed_clicked,
NULL::"unknown" AS adload_adexit,
economistcomprod.advu_mpu,
economistcomprod.advu_mpu_prop,
economistcomprod.amstelnet_order_id,
NULL::"unknown" AS app_advertising_id,
NULL::"unknown" AS app_id,
NULL::"unknown" AS app_id_prop,
NULL::"unknown" AS app_name,
NULL::"unknown" AS app_rating,
NULL::"unknown" AS app_rating_prop,
economistcomprod.article_published_date,
economistcomprod.article_publishing,
economistcomprod.audio,
NULL::"unknown" AS audio_progress,
NULL::"unknown" AS audio_segment,
economistcomprod.br_camp_cid1_fst_click,
economistcomprod.br_camp_cid1_linear,
economistcomprod.br_camp_cid1_lst_click,
economistcomprod.br_camp_cid2_fst_click,
economistcomprod.br_camp_cid2_linear,
economistcomprod.br_camp_cid2_lst_click,
economistcomprod.browser,
economistcomprod.browser_height,
economistcomprod.browser_width,
economistcomprod.bulk_ip_address,
economistcomprod.campaign,
economistcomprod.campaign_attribution,
economistcomprod.campaign_attribution_owned_earned,
economistcomprod.campaign_attribution_paid,
economistcomprod.campaign_stacking_all,
economistcomprod.campaign_tracking,
NULL::"unknown" AS carrier,
economistcomprod.channel,
economistcomprod.click_action,
economistcomprod.click_action_type,
economistcomprod.click_tag,
NULL::"unknown" AS code_ver,
NULL::"unknown" AS connection_type,
NULL::"unknown" AS connection_type_prop,
economistcomprod.content_category,
NULL::"unknown" AS content_region,
NULL::"unknown" AS content_region_prop,
NULL::"unknown" AS content_source,
economistcomprod.content_type,
NULL::"unknown" AS cookies,
NULL::"unknown" AS country,
NULL::"unknown" AS country_residence,
economistcomprod.ct_connect_type,
economistcomprod.curr_factor,
economistcomprod.curr_rate,
economistcomprod.currency,
NULL::"unknown" AS cust_hit_time_gmt,
economistcomprod.cust_type_prod,
NULL::"unknown" AS cust_visid,
economistcomprod.customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
economistcomprod.date_time,
NULL::"unknown" AS delivery_method,
NULL::"unknown" AS device_advertising_id,
NULL::"unknown" AS device_id,
NULL::"unknown" AS device_id_prop,
NULL::"unknown" AS device_name,
NULL::"unknown" AS device_type,
NULL::"unknown" AS device_type_prop,
NULL::"unknown" AS device_vendor_id,
economistcomprod.dfp_ad_id,
economistcomprod.dfp_site,
economistcomprod.dfp_zone,
economistcomprod.director_donor,
economistcomprod."domain",
economistcomprod.drupal_id,
NULL::"unknown" AS duplicate_events,
NULL::"unknown" AS duplicate_purchase,
NULL::"unknown" AS editors_pick_download,
NULL::"unknown" AS editors_pick_download_counter,
NULL::"unknown" AS editors_pick_download_prop,
economistcomprod.error_code,
economistcomprod.error_message,
economistcomprod.essay_section,
economistcomprod.event_id_partition_key,
NULL::"unknown" AS event_list,
NULL::"unknown" AS event_type,
economistcomprod.exclude_hit,
economistcomprod.facebook_widget_activity,
economistcomprod.fb_twitter_activity,
economistcomprod.first_hit_page_url,
economistcomprod.first_hit_pagename,
economistcomprod.first_hit_referrer,
economistcomprod.first_hit_time_gmt,
economistcomprod.form_name_field,
economistcomprod.form_sub_name,
economistcomprod.geo_city,
economistcomprod.geo_country,
economistcomprod.geo_dma,
economistcomprod.geo_region,
economistcomprod.geo_zip,
NULL::"unknown" AS google_play_subscriptions,
economistcomprod.grapeshot_value,
economistcomprod.hier1,
economistcomprod.hit_source,
economistcomprod.hit_time_gmt,
economistcomprod.hit_week,
economistcomprod.hitid_high,
economistcomprod.hitid_low,
economistcomprod.hour_of_day,
economistcomprod.int_sub_ads_first_click,
economistcomprod.int_sub_ads_last_click,
economistcomprod.internal_link,
economistcomprod.internal_link_external,
economistcomprod.ip,
economistcomprod.ip2,
economistcomprod.issue_date,
NULL::"unknown" AS issue_id,
NULL::"unknown" AS issue_region,
economistcomprod.key_interactions,
economistcomprod.key_interactions_pay_barrier_tracking,
economistcomprod."language",
economistcomprod.last_hit_time_gmt,
economistcomprod.last_purchase_num,
NULL::"unknown" AS last_purchase_time_gmt,
economistcomprod.link_name,
NULL::"unknown" AS link_page,
NULL::"unknown" AS loggedin,
NULL::"unknown" AS loggedin_prop,
economistcomprod.maximiser_campaign,
NULL::"unknown" AS mcvisid,
economistcomprod.meta_name,
economistcomprod.mobile_id,
economistcomprod.muls_subscription_type,
economistcomprod.multiuser_usage,
NULL::"unknown" AS navigated_by,
NULL::"unknown" AS navigated_by_prop,
economistcomprod.new_visit,
economistcomprod.newsletter_signup_from_reg,
NULL::"unknown" AS orientation,
NULL::"unknown" AS orientation_prop,
economistcomprod.os,
NULL::"unknown" AS os_version,
economistcomprod.page_event,
economistcomprod.page_event_var1,
NULL::"unknown" AS page_event_var2,
NULL::"unknown" AS page_event_var3,
economistcomprod.page_name,
economistcomprod.page_share_link,
economistcomprod.page_site_id,
economistcomprod.page_type,
NULL::"unknown" AS page_url,
economistcomprod.page_video_play,
NULL::"unknown" AS page_view,
NULL::"unknown" AS pagename,
NULL::"unknown" AS paid_free,
NULL::"unknown" AS paid_free_prop,
economistcomprod.paid_search,
economistcomprod.partner_referrals,
economistcomprod.payment_type,
economistcomprod.persistent_cookie,
NULL::"unknown" AS pointofinterest,
NULL::"unknown" AS pointofinterestdistance,
NULL::"unknown" AS post_ad_load_exit,
economistcomprod.post_campaign,
economistcomprod.post_channel,
economistcomprod.post_cookies,
economistcomprod.post_currency,
economistcomprod.post_event_list,
economistcomprod.post_hier1,
economistcomprod.post_hier2,
economistcomprod.post_hier3,
economistcomprod.post_hier4,
economistcomprod.post_hier5,
NULL::"unknown" AS post_java_enabled,
economistcomprod.post_keywords,
NULL::"unknown" AS post_mobileappid,
NULL::"unknown" AS post_mobiledayofweek,
NULL::"unknown" AS post_mobiledayssincefirstuse,
NULL::"unknown" AS post_mobiledayssincelastuse,
NULL::"unknown" AS post_mobiledevice,
NULL::"unknown" AS post_mobilehourofday,
NULL::"unknown" AS post_mobileinstalldate,
NULL::"unknown" AS post_mobilelaunchnumber,
NULL::"unknown" AS post_mobileosversion,
NULL::"unknown" AS post_mobileresolution,
economistcomprod.post_page_event,
economistcomprod.post_page_event_var1,
NULL::"unknown" AS post_page_event_var2,
NULL::"unknown" AS post_page_event_var3,
economistcomprod.post_page_url,
economistcomprod.post_pagename,
economistcomprod.post_pagename_no_url,
economistcomprod.post_partner_plugins,
NULL::"unknown" AS post_persistent_cookie,
NULL::"unknown" AS post_pointofinterest,
NULL::"unknown" AS post_pointofinterestdistance,
economistcomprod.post_product_list,
economistcomprod.post_purchaseid,
economistcomprod.post_referrer,
economistcomprod.post_search_engine,
economistcomprod.post_state,
economistcomprod.post_survey,
economistcomprod.post_t_time_info,
NULL::"unknown" AS post_zip,
economistcomprod.prev_page,
NULL::"unknown" AS product_id,
economistcomprod.product_list,
economistcomprod.promo_code,
economistcomprod.prop_article_published_date,
economistcomprod.prop_cust_type_prod,
economistcomprod.prop_drupal_id,
economistcomprod.prop_story_title,
economistcomprod.prop_user_login_status,
NULL::"unknown" AS purchase_id,
economistcomprod.purchaseid,
economistcomprod.ref_domain,
economistcomprod.ref_type,
economistcomprod.referrer,
economistcomprod.referring_subdomain,
economistcomprod."region",
economistcomprod.region_served,
economistcomprod.registration,
economistcomprod.renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
economistcomprod.s_resolution,
NULL::"unknown" AS sampled_hit,
economistcomprod.search_engine,
economistcomprod.search_page_num,
economistcomprod.search_results,
NULL::"unknown" AS secondary_hit,
economistcomprod.service,
NULL::"unknown" AS share_type,
NULL::"unknown" AS share_type_prop,
economistcomprod.sharelink,
economistcomprod.source,
economistcomprod.state,
economistcomprod.stats_server,
economistcomprod.story_title,
NULL::"unknown" AS story_title_prop,
economistcomprod.sub_data_protection,
economistcomprod.sub_date_end,
economistcomprod.sub_expiration,
economistcomprod.sub_length,
economistcomprod.sub_login_reg_activities,
economistcomprod.sub_start_date,
economistcomprod.sublength,
NULL::"unknown" AS subscriber_type,
NULL::"unknown" AS subscriber_type_prop,
economistcomprod.subscription_new,
economistcomprod.subscription_page_new,
economistcomprod.subscription_page_renew,
economistcomprod.subscription_renew,
NULL::"unknown" AS subscription_term_google_play,
economistcomprod.subsection,
economistcomprod.t_time_info,
economistcomprod.teg_hit_gmt_datetime,
economistcomprod.teg_hit_local_datetime,
economistcomprod.teg_hit_timezone_offset,
NULL::"unknown" AS "template",
NULL::"unknown" AS template_type,
economistcomprod.ub_form_abandonment,
economistcomprod.ub_offer_country,
economistcomprod.ub_product_code,
economistcomprod.ub_sub,
economistcomprod.url,
NULL::"unknown" AS user_agent,
NULL::"unknown" AS user_agent_evar,
NULL::"unknown" AS user_agent_prop,
economistcomprod.user_login_status,
economistcomprod.userid,
economistcomprod.username,
economistcomprod.valid_user,
economistcomprod.valid_view,
economistcomprod.valid_visit,
economistcomprod.video_play,
economistcomprod.video_segment,
economistcomprod.video_tags,
economistcomprod.video_tags_prop,
economistcomprod.videos,
economistcomprod.videos_formatted,
NULL::"unknown" AS visid_high,
NULL::"unknown" AS visid_low,
NULL::"unknown" AS visid_new,
economistcomprod.visid_timestamp,
economistcomprod.visid_type,
economistcomprod.visit_id,
economistcomprod.visit_keywords,
economistcomprod.visit_num,
economistcomprod.visit_number_new_repeat,
economistcomprod.visit_page_num,
economistcomprod.visit_referrer,
economistcomprod.visit_search_engine,
economistcomprod.visit_start_page_url,
economistcomprod.visit_start_pagename,
economistcomprod.visitor_id,
NULL::"unknown" AS visitor_id_evar,
economistcomprod.week_type,
economistcomprod.drupal_or_visitor_id,
economistcomprod.external_file_id,
economistcomprod.external_file_rownumber
   FROM adobe.economistcomprod
UNION ALL
 SELECT econprodappipad.accept_language,
econprodappipad.ad_impressions,
econprodappipad.ad_impresson,
econprodappipad.ad_load_exit,
NULL::"unknown" AS ad_region,
NULL::"unknown" AS ad_viewed_clicked,
NULL::"unknown" AS adload_adexit,
NULL::"unknown" AS advu_mpu,
NULL::"unknown" AS advu_mpu_prop,
NULL::"unknown" AS amstelnet_order_id,
econprodappipad.app_advertising_id,
econprodappipad.app_id,
econprodappipad.app_id_prop,
econprodappipad.app_name,
econprodappipad.app_rating,
econprodappipad.app_rating_prop,
NULL::"unknown" AS article_published_date,
NULL::"unknown" AS article_publishing,
NULL::"unknown" AS audio,
econprodappipad.audio_progress,
econprodappipad.audio_segment,
NULL::"unknown" AS br_camp_cid1_fst_click,
NULL::"unknown" AS br_camp_cid1_linear,
NULL::"unknown" AS br_camp_cid1_lst_click,
NULL::"unknown" AS br_camp_cid2_fst_click,
NULL::"unknown" AS br_camp_cid2_linear,
NULL::"unknown" AS br_camp_cid2_lst_click,
econprodappipad.browser::character varying(256) AS browser,
econprodappipad.browser_height::character varying(256) AS browser_height,
econprodappipad.browser_width,
NULL::"unknown" AS bulk_ip_address,
econprodappipad.campaign,
NULL::"unknown" AS campaign_attribution,
NULL::"unknown" AS campaign_attribution_owned_earned,
NULL::"unknown" AS campaign_attribution_paid,
NULL::"unknown" AS campaign_stacking_all,
NULL::"unknown" AS campaign_tracking,
econprodappipad.carrier,
econprodappipad.channel,
NULL::"unknown" AS click_action,
NULL::"unknown" AS click_action_type,
NULL::"unknown" AS click_tag,
econprodappipad.code_ver,
econprodappipad.connection_type,
econprodappipad.connection_type_prop,
NULL::"unknown" AS content_category,
econprodappipad.content_region,
econprodappipad.content_region_prop,
NULL::"unknown" AS content_source,
NULL::"unknown" AS content_type,
econprodappipad.cookies,
econprodappipad.country,
econprodappipad.country_residence,
econprodappipad.ct_connect_type,
NULL::"unknown" AS curr_factor,
econprodappipad.curr_rate,
econprodappipad.currency,
econprodappipad.cust_hit_time_gmt,
NULL::"unknown" AS cust_type_prod,
NULL::"unknown" AS cust_visid,
NULL::"unknown" AS customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
econprodappipad.date_time,
NULL::"unknown" AS delivery_method,
econprodappipad.device_advertising_id,
econprodappipad.device_id,
econprodappipad.device_id_prop,
NULL::"unknown" AS device_name,
econprodappipad.device_type,
econprodappipad.device_type_prop,
NULL::"unknown" AS device_vendor_id,
NULL::"unknown" AS dfp_ad_id,
NULL::"unknown" AS dfp_site,
NULL::"unknown" AS dfp_zone,
NULL::"unknown" AS director_donor,
econprodappipad."domain",
econprodappipad.drupal_id,
econprodappipad.duplicate_events,
econprodappipad.duplicate_purchase,
econprodappipad.editors_pick_download,
econprodappipad.editors_pick_download_counter,
econprodappipad.editors_pick_download_prop,
econprodappipad.error_code,
econprodappipad.error_message,
NULL::"unknown" AS essay_section,
econprodappipad.event_id_partition_key,
econprodappipad.event_list,
NULL::"unknown" AS event_type,
econprodappipad.exclude_hit,
NULL::"unknown" AS facebook_widget_activity,
NULL::"unknown" AS fb_twitter_activity,
econprodappipad.first_hit_page_url,
econprodappipad.first_hit_pagename,
econprodappipad.first_hit_referrer,
econprodappipad.first_hit_time_gmt,
NULL::"unknown" AS form_name_field,
NULL::"unknown" AS form_sub_name,
econprodappipad.geo_city,
econprodappipad.geo_country,
econprodappipad.geo_dma,
econprodappipad.geo_region,
econprodappipad.geo_zip,
econprodappipad.google_play_subscriptions,
NULL::"unknown" AS grapeshot_value,
NULL::"unknown" AS hier1,
econprodappipad.hit_source,
NULL::"unknown" AS hit_time_gmt,
econprodappipad.hit_week,
econprodappipad.hitid_high,
econprodappipad.hitid_low,
NULL::"unknown" AS hour_of_day,
NULL::"unknown" AS int_sub_ads_first_click,
NULL::"unknown" AS int_sub_ads_last_click,
NULL::"unknown" AS internal_link,
NULL::"unknown" AS internal_link_external,
econprodappipad.ip,
econprodappipad.ip2,
econprodappipad.issue_date,
econprodappipad.issue_id,
NULL::"unknown" AS issue_region,
NULL::"unknown" AS key_interactions,
NULL::"unknown" AS key_interactions_pay_barrier_tracking,
econprodappipad."language",
NULL::"unknown" AS last_hit_time_gmt,
NULL::"unknown" AS last_purchase_num,
econprodappipad.last_purchase_time_gmt,
NULL::"unknown" AS link_name,
econprodappipad.link_page,
econprodappipad.loggedin,
econprodappipad.loggedin_prop,
NULL::"unknown" AS maximiser_campaign,
econprodappipad.mcvisid,
NULL::"unknown" AS meta_name,
econprodappipad.mobile_id,
NULL::"unknown" AS muls_subscription_type,
NULL::"unknown" AS multiuser_usage,
econprodappipad.navigated_by,
econprodappipad.navigated_by_prop,
econprodappipad.new_visit,
NULL::"unknown" AS newsletter_signup_from_reg,
econprodappipad.orientation,
econprodappipad.orientation_prop,
econprodappipad.os,
NULL::"unknown" AS os_version,
NULL::"unknown" AS page_event,
NULL::"unknown" AS page_event_var1,
NULL::"unknown" AS page_event_var2,
NULL::"unknown" AS page_event_var3,
NULL::"unknown" AS page_name,
NULL::"unknown" AS page_share_link,
NULL::"unknown" AS page_site_id,
NULL::"unknown" AS page_type,
NULL::"unknown" AS page_url,
NULL::"unknown" AS page_video_play,
econprodappipad.page_view,
econprodappipad.pagename,
econprodappipad.paid_free,
econprodappipad.paid_free_prop,
econprodappipad.paid_search,
NULL::"unknown" AS partner_referrals,
NULL::"unknown" AS payment_type,
econprodappipad.persistent_cookie,
econprodappipad.pointofinterest,
econprodappipad.pointofinterestdistance,
econprodappipad.post_ad_load_exit,
econprodappipad.post_campaign,
econprodappipad.post_channel,
econprodappipad.post_cookies,
econprodappipad.post_currency,
econprodappipad.post_event_list,
NULL::"unknown" AS post_hier1,
NULL::"unknown" AS post_hier2,
NULL::"unknown" AS post_hier3,
NULL::"unknown" AS post_hier4,
NULL::"unknown" AS post_hier5,
econprodappipad.post_java_enabled,
econprodappipad.post_keywords,
econprodappipad.post_mobileappid,
econprodappipad.post_mobiledayofweek,
econprodappipad.post_mobiledayssincefirstuse,
econprodappipad.post_mobiledayssincelastuse,
econprodappipad.post_mobiledevice,
econprodappipad.post_mobilehourofday,
econprodappipad.post_mobileinstalldate,
econprodappipad.post_mobilelaunchnumber,
econprodappipad.post_mobileosversion,
econprodappipad.post_mobileresolution,
econprodappipad.post_page_event::character varying(255) AS post_page_event,
NULL::"unknown" AS post_page_event_var1,
NULL::"unknown" AS post_page_event_var2,
NULL::"unknown" AS post_page_event_var3,
NULL::"unknown" AS post_page_url,
econprodappipad.post_pagename,
econprodappipad.post_pagename_no_url,
NULL::"unknown" AS post_partner_plugins,
econprodappipad.post_persistent_cookie,
econprodappipad.post_pointofinterest,
econprodappipad.post_pointofinterestdistance,
econprodappipad.post_product_list,
econprodappipad.post_purchaseid,
NULL::"unknown" AS post_referrer,
econprodappipad.post_search_engine,
econprodappipad.post_state,
econprodappipad.post_survey,
econprodappipad.post_t_time_info,
econprodappipad.post_zip,
econprodappipad.prev_page,
NULL::"unknown" AS product_id,
econprodappipad.product_list,
NULL::"unknown" AS promo_code,
NULL::"unknown" AS prop_article_published_date,
NULL::"unknown" AS prop_cust_type_prod,
NULL::"unknown" AS prop_drupal_id,
NULL::"unknown" AS prop_story_title,
NULL::"unknown" AS prop_user_login_status,
NULL::"unknown" AS purchase_id,
econprodappipad.purchaseid,
NULL::"unknown" AS ref_domain,
NULL::"unknown" AS ref_type,
NULL::"unknown" AS referrer,
NULL::"unknown" AS referring_subdomain,
econprodappipad."region",
NULL::"unknown" AS region_served,
NULL::"unknown" AS registration,
NULL::"unknown" AS renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
econprodappipad.s_resolution,
econprodappipad.sampled_hit,
econprodappipad.search_engine,
econprodappipad.search_page_num,
NULL::"unknown" AS search_results,
econprodappipad.secondary_hit,
econprodappipad.service,
econprodappipad.share_type,
econprodappipad.share_type_prop,
NULL::"unknown" AS sharelink,
econprodappipad.source,
econprodappipad.state,
econprodappipad.stats_server,
econprodappipad.story_title,
econprodappipad.story_title_prop,
NULL::"unknown" AS sub_data_protection,
NULL::"unknown" AS sub_date_end,
NULL::"unknown" AS sub_expiration,
NULL::"unknown" AS sub_length,
NULL::"unknown" AS sub_login_reg_activities,
NULL::"unknown" AS sub_start_date,
NULL::"unknown" AS sublength,
econprodappipad.subscriber_type,
econprodappipad.subscriber_type_prop,
econprodappipad.subscription_new,
econprodappipad.subscription_page_new,
NULL::"unknown" AS subscription_page_renew,
NULL::"unknown" AS subscription_renew,
econprodappipad.subscription_term_google_play,
NULL::"unknown" AS subsection,
econprodappipad.t_time_info,
econprodappipad.teg_hit_gmt_datetime,
econprodappipad.teg_hit_local_datetime,
econprodappipad.teg_hit_timezone_offset,
econprodappipad."template",
econprodappipad.template_type,
NULL::"unknown" AS ub_form_abandonment,
NULL::"unknown" AS ub_offer_country,
NULL::"unknown" AS ub_product_code,
NULL::"unknown" AS ub_sub,
NULL::"unknown" AS url,
econprodappipad.user_agent,
econprodappipad.user_agent_evar,
econprodappipad.user_agent_prop,
NULL::"unknown" AS user_login_status,
NULL::"unknown" AS userid,
NULL::"unknown" AS username,
econprodappipad.valid_user,
econprodappipad.valid_view,
econprodappipad.valid_visit,
NULL::"unknown" AS video_play,
NULL::"unknown" AS video_segment,
NULL::"unknown" AS video_tags,
NULL::"unknown" AS video_tags_prop,
NULL::"unknown" AS videos,
NULL::"unknown" AS videos_formatted,
econprodappipad.visid_high,
econprodappipad.visid_low,
econprodappipad.visid_new,
econprodappipad.visid_timestamp,
econprodappipad.visid_type,
econprodappipad.visit_id,
econprodappipad.visit_keywords,
econprodappipad.visit_num,
NULL::"unknown" AS visit_number_new_repeat,
NULL::"unknown" AS visit_page_num,
econprodappipad.visit_referrer,
econprodappipad.visit_search_engine,
NULL::"unknown" AS visit_start_page_url,
econprodappipad.visit_start_pagename,
econprodappipad.visitor_id,
NULL::"unknown" AS visitor_id_evar,
NULL::"unknown" AS week_type,
econprodappipad.drupal_or_visitor_id,
econprodappipad.external_file_id,
econprodappipad.external_file_rownumber
   FROM adobe.econprodappipad)
UNION ALL
 SELECT econdarwinproduction.accept_language,
NULL::"unknown" AS ad_impressions,
NULL::"unknown" AS ad_impresson,
NULL::"unknown" AS ad_load_exit,
econdarwinproduction.ad_region,
NULL::"unknown" AS ad_viewed_clicked,
econdarwinproduction.adload_adexit,
NULL::"unknown" AS advu_mpu,
NULL::"unknown" AS advu_mpu_prop,
NULL::"unknown" AS amstelnet_order_id,
NULL::"unknown" AS app_advertising_id,
econdarwinproduction.app_id,
NULL::"unknown" AS app_id_prop,
NULL::"unknown" AS app_name,
NULL::"unknown" AS app_rating,
NULL::"unknown" AS app_rating_prop,
NULL::"unknown" AS article_published_date,
NULL::"unknown" AS article_publishing,
NULL::"unknown" AS audio,
NULL::"unknown" AS audio_progress,
NULL::"unknown" AS audio_segment,
NULL::"unknown" AS br_camp_cid1_fst_click,
NULL::"unknown" AS br_camp_cid1_linear,
NULL::"unknown" AS br_camp_cid1_lst_click,
NULL::"unknown" AS br_camp_cid2_fst_click,
NULL::"unknown" AS br_camp_cid2_linear,
NULL::"unknown" AS br_camp_cid2_lst_click,
econdarwinproduction.browser::character varying(256) AS browser,
econdarwinproduction.browser_height::character varying(256) AS browser_height,
econdarwinproduction.browser_width,
NULL::"unknown" AS bulk_ip_address,
econdarwinproduction.campaign,
NULL::"unknown" AS campaign_attribution,
NULL::"unknown" AS campaign_attribution_owned_earned,
NULL::"unknown" AS campaign_attribution_paid,
NULL::"unknown" AS campaign_stacking_all,
NULL::"unknown" AS campaign_tracking,
econdarwinproduction.carrier,
NULL::"unknown" AS channel,
econdarwinproduction.click_action,
econdarwinproduction.click_action_type,
NULL::"unknown" AS click_tag,
NULL::"unknown" AS code_ver,
econdarwinproduction.connection_type,
NULL::"unknown" AS connection_type_prop,
NULL::"unknown" AS content_category,
NULL::"unknown" AS content_region,
NULL::"unknown" AS content_region_prop,
NULL::"unknown" AS content_source,
NULL::"unknown" AS content_type,
econdarwinproduction.cookies,
econdarwinproduction.country,
NULL::"unknown" AS country_residence,
econdarwinproduction.ct_connect_type,
NULL::"unknown" AS curr_factor,
econdarwinproduction.curr_rate,
econdarwinproduction.currency,
econdarwinproduction.cust_hit_time_gmt,
NULL::"unknown" AS cust_type_prod,
econdarwinproduction.cust_visid,
NULL::"unknown" AS customer_lifecycle,
NULL::"unknown" AS date_day_weektype,
econdarwinproduction.date_time,
econdarwinproduction.delivery_method,
NULL::"unknown" AS device_advertising_id,
NULL::"unknown" AS device_id,
NULL::"unknown" AS device_id_prop,
econdarwinproduction.device_name,
NULL::"unknown" AS device_type,
NULL::"unknown" AS device_type_prop,
econdarwinproduction.device_vendor_id,
NULL::"unknown" AS dfp_ad_id,
NULL::"unknown" AS dfp_site,
NULL::"unknown" AS dfp_zone,
NULL::"unknown" AS director_donor,
econdarwinproduction."domain",
econdarwinproduction.drupal_id,
NULL::"unknown" AS duplicate_events,
NULL::"unknown" AS duplicate_purchase,
NULL::"unknown" AS editors_pick_download,
NULL::"unknown" AS editors_pick_download_counter,
NULL::"unknown" AS editors_pick_download_prop,
NULL::"unknown" AS error_code,
NULL::"unknown" AS error_message,
NULL::"unknown" AS essay_section,
econdarwinproduction.event_id_partition_key,
econdarwinproduction.event_list,
econdarwinproduction.event_type,
econdarwinproduction.exclude_hit,
NULL::"unknown" AS facebook_widget_activity,
NULL::"unknown" AS fb_twitter_activity,
NULL::"unknown" AS first_hit_page_url,
NULL::"unknown" AS first_hit_pagename,
econdarwinproduction.first_hit_referrer,
NULL::"unknown" AS first_hit_time_gmt,
NULL::"unknown" AS form_name_field,
NULL::"unknown" AS form_sub_name,
econdarwinproduction.geo_city,
econdarwinproduction.geo_country,
econdarwinproduction.geo_dma,
econdarwinproduction.geo_region,
econdarwinproduction.geo_zip,
NULL::"unknown" AS google_play_subscriptions,
NULL::"unknown" AS grapeshot_value,
NULL::"unknown" AS hier1,
econdarwinproduction.hit_source,
NULL::"unknown" AS hit_time_gmt,
econdarwinproduction.hit_week,
econdarwinproduction.hitid_high,
econdarwinproduction.hitid_low,
econdarwinproduction.hour_of_day,
NULL::"unknown" AS int_sub_ads_first_click,
NULL::"unknown" AS int_sub_ads_last_click,
NULL::"unknown" AS internal_link,
NULL::"unknown" AS internal_link_external,
econdarwinproduction.ip,
econdarwinproduction.ip2,
econdarwinproduction.issue_date,
NULL::"unknown" AS issue_id,
econdarwinproduction.issue_region,
NULL::"unknown" AS key_interactions,
NULL::"unknown" AS key_interactions_pay_barrier_tracking,
econdarwinproduction."language",
NULL::"unknown" AS last_hit_time_gmt,
NULL::"unknown" AS last_purchase_num,
NULL::"unknown" AS last_purchase_time_gmt,
NULL::"unknown" AS link_name,
NULL::"unknown" AS link_page,
NULL::"unknown" AS loggedin,
NULL::"unknown" AS loggedin_prop,
NULL::"unknown" AS maximiser_campaign,
NULL::"unknown" AS mcvisid,
NULL::"unknown" AS meta_name,
econdarwinproduction.mobile_id,
NULL::"unknown" AS muls_subscription_type,
NULL::"unknown" AS multiuser_usage,
NULL::"unknown" AS navigated_by,
NULL::"unknown" AS navigated_by_prop,
econdarwinproduction.new_visit,
NULL::"unknown" AS newsletter_signup_from_reg,
NULL::"unknown" AS orientation,
NULL::"unknown" AS orientation_prop,
econdarwinproduction.os,
econdarwinproduction.os_version,
econdarwinproduction.page_event,
econdarwinproduction.page_event_var1,
econdarwinproduction.page_event_var2,
econdarwinproduction.page_event_var3,
NULL::"unknown" AS page_name,
NULL::"unknown" AS page_share_link,
NULL::"unknown" AS page_site_id,
econdarwinproduction.page_type,
econdarwinproduction.page_url,
NULL::"unknown" AS page_video_play,
NULL::"unknown" AS page_view,
econdarwinproduction.pagename,
NULL::"unknown" AS paid_free,
NULL::"unknown" AS paid_free_prop,
econdarwinproduction.paid_search,
NULL::"unknown" AS partner_referrals,
NULL::"unknown" AS payment_type,
econdarwinproduction.persistent_cookie,
NULL::"unknown" AS pointofinterest,
NULL::"unknown" AS pointofinterestdistance,
NULL::"unknown" AS post_ad_load_exit,
econdarwinproduction.post_campaign,
econdarwinproduction.post_channel,
econdarwinproduction.post_cookies,
econdarwinproduction.post_currency,
econdarwinproduction.post_event_list,
econdarwinproduction.post_hier1,
econdarwinproduction.post_hier2,
econdarwinproduction.post_hier3,
econdarwinproduction.post_hier4,
econdarwinproduction.post_hier5,
NULL::"unknown" AS post_java_enabled,
econdarwinproduction.post_keywords,
NULL::"unknown" AS post_mobileappid,
NULL::"unknown" AS post_mobiledayofweek,
NULL::"unknown" AS post_mobiledayssincefirstuse,
NULL::"unknown" AS post_mobiledayssincelastuse,
NULL::"unknown" AS post_mobiledevice,
NULL::"unknown" AS post_mobilehourofday,
NULL::"unknown" AS post_mobileinstalldate,
NULL::"unknown" AS post_mobilelaunchnumber,
NULL::"unknown" AS post_mobileosversion,
NULL::"unknown" AS post_mobileresolution,
econdarwinproduction.post_page_event::character varying(255) AS post_page_event,
econdarwinproduction.post_page_event_var1,
econdarwinproduction.post_page_event_var2,
econdarwinproduction.post_page_event_var3,
econdarwinproduction.post_page_url,
econdarwinproduction.post_pagename,
econdarwinproduction.post_pagename_no_url,
econdarwinproduction.post_partner_plugins,
econdarwinproduction.post_persistent_cookie,
NULL::"unknown" AS post_pointofinterest,
NULL::"unknown" AS post_pointofinterestdistance,
econdarwinproduction.post_product_list,
econdarwinproduction.post_purchaseid,
econdarwinproduction.post_referrer,
econdarwinproduction.post_search_engine,
econdarwinproduction.post_state,
econdarwinproduction.post_survey,
econdarwinproduction.post_t_time_info,
NULL::"unknown" AS post_zip,
econdarwinproduction.prev_page,
econdarwinproduction.product_id,
econdarwinproduction.product_list,
NULL::"unknown" AS promo_code,
NULL::"unknown" AS prop_article_published_date,
NULL::"unknown" AS prop_cust_type_prod,
NULL::"unknown" AS prop_drupal_id,
NULL::"unknown" AS prop_story_title,
NULL::"unknown" AS prop_user_login_status,
econdarwinproduction.purchase_id,
NULL::"unknown" AS purchaseid,
econdarwinproduction.ref_domain,
econdarwinproduction.ref_type,
econdarwinproduction.referrer,
econdarwinproduction.referring_subdomain,
econdarwinproduction."region",
NULL::"unknown" AS region_served,
NULL::"unknown" AS registration,
NULL::"unknown" AS renewal_start_end_date,
NULL::"unknown" AS revamp_tracking,
econdarwinproduction.s_resolution,
econdarwinproduction.sampled_hit,
econdarwinproduction.search_engine,
econdarwinproduction.search_page_num,
NULL::"unknown" AS search_results,
econdarwinproduction.secondary_hit,
econdarwinproduction.service,
NULL::"unknown" AS share_type,
NULL::"unknown" AS share_type_prop,
NULL::"unknown" AS sharelink,
econdarwinproduction.source,
econdarwinproduction.state,
econdarwinproduction.stats_server,
econdarwinproduction.story_title,
NULL::"unknown" AS story_title_prop,
NULL::"unknown" AS sub_data_protection,
NULL::"unknown" AS sub_date_end,
NULL::"unknown" AS sub_expiration,
NULL::"unknown" AS sub_length,
NULL::"unknown" AS sub_login_reg_activities,
NULL::"unknown" AS sub_start_date,
NULL::"unknown" AS sublength,
econdarwinproduction.subscriber_type,
NULL::"unknown" AS subscriber_type_prop,
econdarwinproduction.subscription_new,
econdarwinproduction.subscription_page_new,
NULL::"unknown" AS subscription_page_renew,
NULL::"unknown" AS subscription_renew,
NULL::"unknown" AS subscription_term_google_play,
NULL::"unknown" AS subsection,
econdarwinproduction.t_time_info,
econdarwinproduction.teg_hit_gmt_datetime,
econdarwinproduction.teg_hit_local_datetime,
econdarwinproduction.teg_hit_timezone_offset,
NULL::"unknown" AS "template",
NULL::"unknown" AS template_type,
NULL::"unknown" AS ub_form_abandonment,
NULL::"unknown" AS ub_offer_country,
NULL::"unknown" AS ub_product_code,
NULL::"unknown" AS ub_sub,
NULL::"unknown" AS url,
NULL::"unknown" AS user_agent,
NULL::"unknown" AS user_agent_evar,
NULL::"unknown" AS user_agent_prop,
NULL::"unknown" AS user_login_status,
NULL::"unknown" AS userid,
NULL::"unknown" AS username,
econdarwinproduction.valid_user,
econdarwinproduction.valid_view,
econdarwinproduction.valid_visit,
NULL::"unknown" AS video_play,
NULL::"unknown" AS video_segment,
NULL::"unknown" AS video_tags,
NULL::"unknown" AS video_tags_prop,
NULL::"unknown" AS videos,
NULL::"unknown" AS videos_formatted,
econdarwinproduction.visid_high,
econdarwinproduction.visid_low,
econdarwinproduction.visid_new,
econdarwinproduction.visid_timestamp,
econdarwinproduction.visid_type,
econdarwinproduction.visit_id,
econdarwinproduction.visit_keywords,
econdarwinproduction.visit_num,
NULL::"unknown" AS visit_number_new_repeat,
NULL::"unknown" AS visit_page_num,
econdarwinproduction.visit_referrer,
econdarwinproduction.visit_search_engine,
econdarwinproduction.visit_start_page_url,
econdarwinproduction.visit_start_pagename,
econdarwinproduction.visitor_id,
econdarwinproduction.visitor_id_evar,
NULL::"unknown" AS week_type,
econdarwinproduction.drupal_or_visitor_id,
econdarwinproduction.external_file_id,
econdarwinproduction.external_file_rownumber
   FROM adobe.econdarwinproduction;
GRANT SELECT ON adobe.combined TO GROUP readonly;

---------------------------------------------------------------------------------------------------
-- 00223_recreate_adobe_econprodappipad_events.sql
---------------------------------------------------------------------------------------------------
DROP VIEW adobe.combined_events;

ALTER TABLE adobe.econprodappipad_events RENAME TO econprodappipad_events_old;

CREATE TABLE adobe.econprodappipad_events
(
   drupal_or_visitor_id     VARCHAR(256) ENCODE zstd,
   external_file_id         BIGINT       ENCODE zstd,
   external_file_rownumber  BIGINT       ENCODE zstd,
   teg_hit_local_datetime   TIMESTAMP    ENCODE zstd,
   event_code               INTEGER      ENCODE zstd,
   event_value              VARCHAR(256) ENCODE zstd,
   event_total_count        INTEGER      ENCODE zstd,
   event_sequence           INTEGER      ENCODE zstd,
   visit_event_total_count  INTEGER      ENCODE zstd,
   visit_event_sequence     INTEGER      ENCODE zstd,
   visit_id                 VARCHAR(256) ENCODE zstd,
   visit_num                INTEGER      ENCODE zstd
) DISTKEY (drupal_or_visitor_id) COMPOUND SORTKEY (external_file_id, external_file_rownumber)
;

GRANT SELECT ON adobe.econprodappipad_events TO GROUP readonly;

INSERT INTO adobe.econprodappipad_events
SELECT * 
  FROM adobe.econprodappipad_events_old
;

DROP TABLE adobe.econprodappipad_events_old;

CREATE OR REPLACE VIEW adobe.combined_events
(
  drupal_or_visitor_id,
  external_file_id,
  external_file_rownumber,
  teg_hit_local_datetime,
  event_code,
  event_value,
  event_total_count,
  event_sequence,
  source,
  visit_event_total_count,
  visit_event_sequence,
  visit_id,
  visit_num
)
AS
(
     SELECT
            economistcomprod_events.drupal_or_visitor_id
          , economistcomprod_events.external_file_id
          , economistcomprod_events.external_file_rownumber
          , economistcomprod_events.teg_hit_local_datetime
          , economistcomprod_events.event_code
          , economistcomprod_events.event_value
          , economistcomprod_events.event_total_count
          , economistcomprod_events.event_sequence
          , 'Economist Online' AS source
          , economistcomprod_events.visit_event_total_count
          , economistcomprod_events.visit_event_sequence
          , economistcomprod_events.visit_id
          , economistcomprod_events.visit_num
       FROM
            adobe.economistcomprod_events
    
    UNION ALL
     
     SELECT
            econdarwinproduction_events.drupal_or_visitor_id
          , econdarwinproduction_events.external_file_id
          , econdarwinproduction_events.external_file_rownumber
          , econdarwinproduction_events.teg_hit_local_datetime
          , econdarwinproduction_events.event_code
          , econdarwinproduction_events.event_value
          , econdarwinproduction_events.event_total_count
          , econdarwinproduction_events.event_sequence
          , 'Espresso' AS source
          , econdarwinproduction_events.visit_event_total_count
          , econdarwinproduction_events.visit_event_sequence
          , econdarwinproduction_events.visit_id
          , econdarwinproduction_events.visit_num
       FROM
            adobe.econdarwinproduction_events
)

UNION ALL

SELECT
    econprodappipad_events.drupal_or_visitor_id
  , econprodappipad_events.external_file_id
  , econprodappipad_events.external_file_rownumber
  , econprodappipad_events.teg_hit_local_datetime
  , econprodappipad_events.event_code
  , econprodappipad_events.event_value
  , econprodappipad_events.event_total_count
  , econprodappipad_events.event_sequence
  , 'Digital App' AS source
  , econprodappipad_events.visit_event_total_count
  , econprodappipad_events.visit_event_sequence
  , econprodappipad_events.visit_id
  , econprodappipad_events.visit_num
FROM
    adobe.econprodappipad_events
;

GRANT SELECT ON adobe.combined_events TO GROUP readonly;

---------------------------------------------------------------------------------------------------
-- 00223_recreate_adobe_econprodappipad_events_rollback.sql
---------------------------------------------------------------------------------------------------
DROP VIEW adobe.combined_events;

ALTER TABLE adobe.econprodappipad_events RENAME TO econprodappipad_events_old;

CREATE TABLE adobe.econprodappipad_events
(
   drupal_or_visitor_id     VARCHAR(256) ENCODE lzo,
   external_file_id         BIGINT,
   external_file_rownumber  BIGINT       ENCODE delta,
   teg_hit_local_datetime   TIMESTAMP    ENCODE lzo,
   event_code               INTEGER      ENCODE lzo,
   event_value              VARCHAR(256) ENCODE lzo,
   event_total_count        INTEGER      ENCODE lzo,
   event_sequence           INTEGER      ENCODE lzo,
   visit_event_total_count  INTEGER      ENCODE lzo,
   visit_event_sequence     INTEGER      ENCODE delta,
   visit_id                 VARCHAR(256) ENCODE lzo,
   visit_num                INTEGER      ENCODE lzo
) DISTKEY (drupal_or_visitor_id) COMPOUND SORTKEY (external_file_id, external_file_rownumber)
;

GRANT SELECT ON adobe.econprodappipad_events TO GROUP readonly;

INSERT INTO adobe.econprodappipad_events
SELECT * 
  FROM adobe.econprodappipad_events_old
;

DROP TABLE adobe.econprodappipad_events_old;

CREATE OR REPLACE VIEW adobe.combined_events
(
  drupal_or_visitor_id,
  external_file_id,
  external_file_rownumber,
  teg_hit_local_datetime,
  event_code,
  event_value,
  event_total_count,
  event_sequence,
  source,
  visit_event_total_count,
  visit_event_sequence,
  visit_id,
  visit_num
)
AS
(
     SELECT
            economistcomprod_events.drupal_or_visitor_id
          , economistcomprod_events.external_file_id
          , economistcomprod_events.external_file_rownumber
          , economistcomprod_events.teg_hit_local_datetime
          , economistcomprod_events.event_code
          , economistcomprod_events.event_value
          , economistcomprod_events.event_total_count
          , economistcomprod_events.event_sequence
          , 'Economist Online' AS source
          , economistcomprod_events.visit_event_total_count
          , economistcomprod_events.visit_event_sequence
          , economistcomprod_events.visit_id
          , economistcomprod_events.visit_num
       FROM
            adobe.economistcomprod_events
    
    UNION ALL
     
     SELECT
            econdarwinproduction_events.drupal_or_visitor_id
          , econdarwinproduction_events.external_file_id
          , econdarwinproduction_events.external_file_rownumber
          , econdarwinproduction_events.teg_hit_local_datetime
          , econdarwinproduction_events.event_code
          , econdarwinproduction_events.event_value
          , econdarwinproduction_events.event_total_count
          , econdarwinproduction_events.event_sequence
          , 'Espresso' AS source
          , econdarwinproduction_events.visit_event_total_count
          , econdarwinproduction_events.visit_event_sequence
          , econdarwinproduction_events.visit_id
          , econdarwinproduction_events.visit_num
       FROM
            adobe.econdarwinproduction_events
)

UNION ALL

SELECT
    econprodappipad_events.drupal_or_visitor_id
  , econprodappipad_events.external_file_id
  , econprodappipad_events.external_file_rownumber
  , econprodappipad_events.teg_hit_local_datetime
  , econprodappipad_events.event_code
  , econprodappipad_events.event_value
  , econprodappipad_events.event_total_count
  , econprodappipad_events.event_sequence
  , 'Digital App' AS source
  , econprodappipad_events.visit_event_total_count
  , econprodappipad_events.visit_event_sequence
  , econprodappipad_events.visit_id
  , econprodappipad_events.visit_num
FROM
    adobe.econprodappipad_events
;

GRANT SELECT ON adobe.combined_events TO GROUP readonly;

---------------------------------------------------------------------------------------------------
-- 00224_recreate_adobe_event_code_ref.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.event_code_ref RENAME TO adobe_event_code_ref_old;

CREATE TABLE adobe.event_code_ref
(
   event_code_pk          INTEGER      ENCODE zstd,
   event_code             INTEGER      ENCODE zstd,
   derivation_field       VARCHAR(255) ENCODE zstd,
   event_code_description VARCHAR(255) ENCODE zstd,
   source                 VARCHAR(255) ENCODE zstd
);
GRANT INSERT ON adobe.event_code_ref TO copyrole;
GRANT SELECT ON adobe.event_code_ref TO GROUP readonly;

INSERT INTO adobe.event_code_ref
SELECT * 
  FROM adobe.adobe_event_code_ref_old
;

DROP TABLE adobe.adobe_event_code_ref_old;

---------------------------------------------------------------------------------------------------
-- 00224_recreate_adobe_event_code_ref_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.event_code_ref RENAME TO adobe_event_code_ref_old;

CREATE TABLE adobe.event_code_ref
(
   event_code_pk          integer,
   event_code             integer,
   derivation_field       varchar(255),
   event_code_description varchar(255),
   source                 varchar(255)
);
GRANT INSERT ON adobe.event_code_ref TO copyrole;
GRANT SELECT ON adobe.event_code_ref TO GROUP readonly;

INSERT INTO adobe.event_code_ref
SELECT * 
  FROM adobe.adobe_event_code_ref_old
;

DROP TABLE adobe.adobe_event_code_ref_old;

---------------------------------------------------------------------------------------------------
-- 00225_recreate_adobe_javascript_version.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.javascript_version RENAME TO adobe_javascript_version_old;

CREATE TABLE adobe.javascript_version
    (
        id                      BIGINT       ENCODE zstd
      , javascript_version      VARCHAR(256) ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.javascript_version TO copyrole;
GRANT SELECT ON adobe.javascript_version TO GROUP readonly;

INSERT INTO adobe.javascript_version
SELECT * 
  FROM adobe.adobe_javascript_version_old
;

DROP TABLE adobe.adobe_javascript_version_old;

---------------------------------------------------------------------------------------------------
-- 00225_recreate_adobe_javascript_version_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.javascript_version RENAME TO adobe_javascript_version_old;

CREATE TABLE adobe.javascript_version
    (
        id                      BIGINT       ENCODE lzo
      , javascript_version      VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.javascript_version TO copyrole;
GRANT SELECT ON adobe.javascript_version TO GROUP readonly;

INSERT INTO adobe.javascript_version
SELECT * 
  FROM adobe.adobe_javascript_version_old
;

DROP TABLE adobe.adobe_javascript_version_old;

---------------------------------------------------------------------------------------------------
-- 00226_recreate_adobe_languages.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.languages RENAME TO adobe_languages_old;

CREATE TABLE adobe.languages
    (
        id                      BIGINT       ENCODE zstd
      , languages               VARCHAR(256) ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.languages TO copyrole;
GRANT SELECT ON adobe.languages TO GROUP readonly;

INSERT INTO adobe.languages
SELECT * 
  FROM adobe.adobe_languages_old
;

DROP TABLE adobe.adobe_languages_old;

---------------------------------------------------------------------------------------------------
-- 00226_recreate_adobe_languages_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.languages RENAME TO adobe_languages_old;

CREATE TABLE adobe.languages
    (
        id                      BIGINT       ENCODE lzo
      , languages               VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY (id)
;
GRANT INSERT ON adobe.languages TO copyrole;
GRANT SELECT ON adobe.languages TO GROUP readonly;

INSERT INTO adobe.languages
SELECT * 
  FROM adobe.adobe_languages_old
;

DROP TABLE adobe.adobe_languages_old;

---------------------------------------------------------------------------------------------------
-- 00227_recreate_adobe_operating_systems.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.operating_systems RENAME TO adobe_operating_systems_old;

CREATE TABLE adobe.operating_systems
    (
        id                      BIGINT       ENCODE zstd
      , operating_systems       VARCHAR(256) ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY(id)
;
GRANT INSERT ON adobe.operating_systems TO copyrole;
GRANT SELECT ON adobe.operating_systems TO GROUP readonly;

INSERT INTO adobe.operating_systems
SELECT * 
  FROM adobe.adobe_operating_systems_old
;

DROP TABLE adobe.adobe_operating_systems_old;

---------------------------------------------------------------------------------------------------
-- 00227_recreate_adobe_operating_systems_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.operating_systems RENAME TO adobe_operating_systems_old;

CREATE TABLE adobe.operating_systems
    (
        id                      BIGINT       ENCODE lzo
      , operating_systems       VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY(id)
;
GRANT INSERT ON adobe.operating_systems TO copyrole;
GRANT SELECT ON adobe.operating_systems TO GROUP readonly;

INSERT INTO adobe.operating_systems
SELECT * 
  FROM adobe.adobe_operating_systems_old
;

DROP TABLE adobe.adobe_operating_systems_old;

---------------------------------------------------------------------------------------------------
-- 00228_recreate_adobe_plugins.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.plugins RENAME TO adobe_plugins_old;

CREATE TABLE adobe.plugins
    (
        id                      BIGINT       ENCODE zstd
      , plugins                 VARCHAR(256) ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY(id)
;
GRANT INSERT ON adobe.plugins TO copyrole;
GRANT SELECT ON adobe.plugins TO GROUP readonly;

INSERT INTO adobe.plugins
SELECT * 
  FROM adobe.adobe_plugins_old
;

DROP TABLE adobe.adobe_plugins_old;

---------------------------------------------------------------------------------------------------
-- 00228_recreate_adobe_plugins_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.plugins RENAME TO adobe_plugins_old;

CREATE TABLE adobe.plugins
    (
        id                      BIGINT       ENCODE lzo
      , plugins                 VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY(id)
;
GRANT INSERT ON adobe.plugins TO copyrole;
GRANT SELECT ON adobe.plugins TO GROUP readonly;

INSERT INTO adobe.plugins
SELECT * 
  FROM adobe.adobe_plugins_old
;

DROP TABLE adobe.adobe_plugins_old;

---------------------------------------------------------------------------------------------------
-- 00229_recreate_adobe_referrer_type.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.referrer_type RENAME TO adobe_referrer_type_old;

CREATE TABLE adobe.referrer_type
    (
        id                      BIGINT       ENCODE zstd
      , referrer_type_text      VARCHAR(256) ENCODE zstd
      , referrer_type           VARCHAR(256) ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY(id)
;
GRANT INSERT ON adobe.referrer_type TO copyrole;
GRANT SELECT ON adobe.referrer_type TO GROUP readonly;

INSERT INTO adobe.referrer_type
SELECT * 
  FROM adobe.adobe_referrer_type_old
;

DROP TABLE adobe.adobe_referrer_type_old;

---------------------------------------------------------------------------------------------------
-- 00229_recreate_adobe_referrer_type_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.referrer_type RENAME TO adobe_referrer_type_old;

CREATE TABLE adobe.referrer_type
    (
        id                      BIGINT       ENCODE lzo
      , referrer_type_text      VARCHAR(256) ENCODE lzo
      , referrer_type           VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY(id)
;
GRANT INSERT ON adobe.referrer_type TO copyrole;
GRANT SELECT ON adobe.referrer_type TO GROUP readonly;

INSERT INTO adobe.referrer_type
SELECT * 
  FROM adobe.adobe_referrer_type_old
;

DROP TABLE adobe.adobe_referrer_type_old;

---------------------------------------------------------------------------------------------------
-- 00230_recreate_adobe_resolution.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.resolution RENAME TO adobe_resolution_old;

CREATE TABLE adobe.resolution
    (
        id                      BIGINT       ENCODE zstd
      , resolution              VARCHAR(256) ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY(id)
;
GRANT INSERT ON adobe.resolution TO copyrole;
GRANT SELECT ON adobe.resolution TO GROUP readonly;

INSERT INTO adobe.resolution
SELECT * 
  FROM adobe.adobe_resolution_old
;

DROP TABLE adobe.adobe_resolution_old;

---------------------------------------------------------------------------------------------------
-- 00230_recreate_adobe_resolution_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.resolution RENAME TO adobe_resolution_old;

CREATE TABLE adobe.resolution
    (
        id                      BIGINT       ENCODE lzo
      , resolution              VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY(id)
;
GRANT INSERT ON adobe.resolution TO copyrole;
GRANT SELECT ON adobe.resolution TO GROUP readonly;

INSERT INTO adobe.resolution
SELECT * 
  FROM adobe.adobe_resolution_old
;

DROP TABLE adobe.adobe_resolution_old;

---------------------------------------------------------------------------------------------------
-- 00231_recreate_adobe_search_engines.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.search_engines RENAME TO adobe_search_engines_old;

CREATE TABLE adobe.search_engines
    (
        id                      BIGINT       ENCODE zstd
      , search_engines          VARCHAR(256) ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
    )
    DISTSTYLE EVEN SORTKEY(id)
;
GRANT INSERT ON adobe.search_engines TO copyrole;
GRANT SELECT ON adobe.search_engines TO GROUP readonly;

INSERT INTO adobe.search_engines
SELECT * 
  FROM adobe.adobe_search_engines_old
;

DROP TABLE adobe.adobe_search_engines_old;

---------------------------------------------------------------------------------------------------
-- 00231_recreate_adobe_search_engines_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.search_engines RENAME TO adobe_search_engines_old;

CREATE TABLE adobe.search_engines
    (
        id                      BIGINT       ENCODE lzo
      , search_engines          VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY(id)
;
GRANT INSERT ON adobe.search_engines TO copyrole;
GRANT SELECT ON adobe.search_engines TO GROUP readonly;

INSERT INTO adobe.search_engines
SELECT * 
  FROM adobe.adobe_search_engines_old
;

DROP TABLE adobe.adobe_search_engines_old;

---------------------------------------------------------------------------------------------------
-- TODO: adobe.econdarwinproduction_reload DDL required at end
---------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------
-- 00224_recreate_reload_tables.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.econdarwinproduction_reload RENAME TO adobe_econdarwinproduction_reload_old;
ALTER TABLE adobe.econprodappipad_reload RENAME TO adobe_econprodappipad_reload_old;

CREATE TABLE adobe.econdarwinproduction_reload (LIKE adobe.econdarwinproduction);
GRANT INSERT ON adobe.econdarwinproduction_reload TO copyrole;
GRANT SELECT ON adobe.econprodappipad_reload TO GROUP readonly;

CREATE TABLE adobe.econprodappipad_reload (LIKE adobe.econprodappipad);
GRANT INSERT ON adobe.econprodappipad_reload TO copyrole;
GRANT SELECT ON adobe.econdarwinproduction_reload TO GROUP readonly;

INSERT INTO adobe.econdarwinproduction_reload
SELECT * 
  FROM adobe.adobe_econdarwinproduction_reload_old
;

INSERT INTO adobe.econprodappipad_reload
SELECT * 
  FROM adobe.adobe_econprodappipad_reload_old
;

DROP TABLE adobe.adobe_econdarwinproduction_reload_old;
DROP TABLE adobe.adobe_econprodappipad_reload_old;

---------------------------------------------------------------------------------------------------
-- 00224_recreate_reload_tables.sql - post failure
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.econdarwinproduction_reload RENAME TO adobe_econdarwinproduction_reload_old;
ALTER TABLE adobe.econprodappipad_reload RENAME TO adobe_econprodappipad_reload_old;

CREATE TABLE adobe.econdarwinproduction_reload 
AS 
SELECT * 
  FROM adobe.adobe_econdarwinproduction
;
GRANT INSERT ON adobe.econdarwinproduction_reload TO copyrole;
GRANT SELECT ON adobe.econprodappipad_reload TO GROUP readonly;  

CREATE TABLE adobe.econprodappipad_reload 
AS
SELECT *
  FROM adobe.adobe_econprodappipad
;

DROP TABLE adobe.adobe_econdarwinproduction_reload_old;
DROP TABLE adobe.adobe_econprodappipad_reload_old;

---------------------------------------------------------------------------------------------------
-- 00224_recreate_reload_tables.sql - post failure
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.econdarwinproduction_reload RENAME TO adobe_econdarwinproduction_reload_old;
ALTER TABLE adobe.econprodappipad_reload RENAME TO adobe_econprodappipad_reload_old;

CREATE TABLE adobe.econdarwinproduction_reload (LIKE adobe.econdarwinproduction);
GRANT INSERT ON adobe.econdarwinproduction_reload TO copyrole;
GRANT SELECT ON adobe.econdarwinproduction_reload TO GROUP readonly;

CREATE TABLE adobe.econprodappipad_reload (LIKE adobe.econprodappipad);
GRANT INSERT ON adobe.econprodappipad_reload TO copyrole;
GRANT SELECT ON adobe.econprodappipad_reload TO GROUP readonly;

DROP TABLE adobe.adobe_econdarwinproduction_reload_old;
DROP TABLE adobe.adobe_econprodappipad_reload_old;

---------------------------------------------------------------------------------------------------
-- 00231_recreate_adobe_search_engines_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.search_engines RENAME TO adobe_search_engines_old;

CREATE TABLE adobe.search_engines
    (
        id                      BIGINT       ENCODE lzo
      , search_engines          VARCHAR(256) ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
    )
    DISTSTYLE EVEN SORTKEY(id)
;
GRANT INSERT ON adobe.search_engines TO copyrole;
GRANT SELECT ON adobe.search_engines TO GROUP readonly;

INSERT INTO adobe.search_engines
SELECT * 
  FROM adobe.adobe_search_engines_old
;

DROP TABLE adobe.adobe_search_engines_old;

---------------------------------------------------------------------------------------------------
-- 00234_recreate_ga_accounts.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE ga.accounts RENAME TO ga_accounts_old;

CREATE TABLE ga.accounts
    (
        account_id              BIGINT       ENCODE zstd
      , account_name            VARCHAR(255) ENCODE zstd
      , date_created            TIMESTAMP    ENCODE zstd
      , date_updated            TIMESTAMP    ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
      , PRIMARY KEY (account_id)
    )
    DISTSTYLE EVEN SORTKEY(account_id)
;
GRANT INSERT ON ga.accounts TO copyrole;
GRANT SELECT ON ga.accounts TO GROUP readonly;

INSERT INTO ga.accounts
SELECT * 
  FROM adobe.ga_accounts_old
;

DROP TABLE adobe.ga_accounts_old;

---------------------------------------------------------------------------------------------------
-- 00234_recreate_ga_accounts_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE ga.accounts RENAME TO ga_accounts_old;

CREATE TABLE ga.accounts
    (
        account_id              BIGINT       ENCODE lzo
      , account_name            VARCHAR(255) ENCODE lzo
      , date_created            TIMESTAMP    ENCODE lzo
      , date_updated            TIMESTAMP    ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
      , PRIMARY KEY (account_id)
    )
    DISTSTYLE EVEN SORTKEY(account_id)
;
GRANT INSERT ON ga.accounts TO copyrole;
GRANT SELECT ON ga.accounts TO GROUP readonly;

INSERT INTO ga.accounts
SELECT * 
  FROM adobe.ga_accounts_old
;

DROP TABLE adobe.ga_accounts_old;

---------------------------------------------------------------------------------------------------
-- 00235_recreate_ga_events.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE ga.events RENAME TO ga_events_old;

CREATE TABLE ga.events
    (
        profile_id              BIGINT        ENCODE zstd
      , session_time            TIMESTAMP     ENCODE zstd
      , country_code            VARCHAR(2)    ENCODE zstd
      , device_category         VARCHAR(16)   ENCODE zstd
      , browser_size            VARCHAR(16)   ENCODE zstd
      , event_category          VARCHAR(255)  ENCODE zstd
      , event_action            VARCHAR(1024) ENCODE zstd
      , event_label             VARCHAR(512)  ENCODE zstd
      , total_hits              INTEGER       ENCODE zstd
      , total_events            INTEGER       ENCODE zstd
      , event_value             INTEGER       ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT        ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT        ENCODE zstd
      , PRIMARY KEY( profile_id 
	               , session_time 
				   , country_code 
				   , device_category 
				   , browser_size 
				   , event_category 
				   , event_action 
				   , event_label
				   )
    )
    DISTSTYLE EVEN SORTKEY(session_time)
;
GRANT INSERT ON ga.events TO copyrole;
GRANT SELECT ON ga.events TO GROUP readonly;

INSERT INTO ga.events
SELECT * 
  FROM ga.ga_events_old
;

DROP TABLE ga.ga_events_old;

---------------------------------------------------------------------------------------------------
-- 00235_recreate_ga_events_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE ga.events RENAME TO ga_events_old;

CREATE TABLE ga.events
    (
        profile_id              BIGINT        ENCODE lzo
      , session_time            TIMESTAMP     ENCODE lzo
      , country_code            VARCHAR(2)    ENCODE bytedict
      , device_category         VARCHAR(16)   ENCODE bytedict
      , browser_size            VARCHAR(16)   ENCODE bytedict
      , event_category          VARCHAR(255)  ENCODE lzo
      , event_action            VARCHAR(1024) ENCODE lzo
      , event_label             VARCHAR(512)  ENCODE lzo
      , total_hits              INTEGER       ENCODE bytedict
      , total_events            INTEGER       ENCODE bytedict
      , event_value             INTEGER       ENCODE bytedict
      , EXTERNAL_FILE_ID        BIGINT        ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT        ENCODE lzo
      , PRIMARY KEY( profile_id 
	               , session_time 
				   , country_code 
				   , device_category 
				   , browser_size 
				   , event_category 
				   , event_action 
				   , event_label
				   )
    )
    DISTSTYLE EVEN SORTKEY(session_time)
;
GRANT INSERT ON ga.events TO copyrole;
GRANT SELECT ON ga.events TO GROUP readonly;

INSERT INTO ga.events
SELECT * 
  FROM ga.ga_events_old
;

DROP TABLE ga.ga_events_old;

---------------------------------------------------------------------------------------------------
-- 00236_recreate_ga_pagestats.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE ga.pagestats RENAME TO ga_pagestats_old;

CREATE TABLE ga.pagestats
    (
        profile_id              BIGINT        ENCODE zstd
      , session_time            TIMESTAMP     ENCODE zstd
      , country_code            VARCHAR(2)    ENCODE zstd
      , device_category         VARCHAR(16)   ENCODE zstd
      , site_hostname           VARCHAR(255)  ENCODE zstd
      , page_path               VARCHAR(1024) ENCODE zstd
      , page_title              VARCHAR(2048) ENCODE zstd
      , source_medium           VARCHAR(255)  ENCODE zstd
      , users_total             INTEGER       ENCODE zstd
      , users_new               INTEGER       ENCODE zstd
      , page_views_total        INTEGER       ENCODE zstd
      , page_views_unique       INTEGER       ENCODE zstd
      , time_on_page            NUMERIC(9,2)  ENCODE zstd
      , page_exits              INTEGER       ENCODE zstd
      , page_entrances          INTEGER       ENCODE zstd
      , page_bounces            INTEGER       ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT        ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT        ENCODE zstd
      , PRIMARY KEY( profile_id 
	               , session_time 
				   , country_code 
				   , device_category 
				   , site_hostname 
				   , page_path 
				   , page_title 
				   , source_medium
				   )
    )
    DISTSTYLE EVEN
;
GRANT INSERT ON ga.pagestats TO copyrole;
GRANT SELECT ON ga.pagestats TO GROUP readonly;

INSERT INTO ga.pagestats
SELECT * 
  FROM ga.ga_pagestats_old
;

DROP TABLE ga.ga_pagestats_old;

---------------------------------------------------------------------------------------------------
-- 00236_recreate_ga_pagestats_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE ga.pagestats RENAME TO ga_pagestats_old;

CREATE TABLE ga.pagestats
    (
        profile_id              BIGINT        ENCODE lzo
      , session_time            TIMESTAMP     ENCODE lzo
      , country_code            VARCHAR(2)    ENCODE lzo
      , device_category         VARCHAR(16)   ENCODE lzo
      , site_hostname           VARCHAR(255)  ENCODE lzo
      , page_path               VARCHAR(1024) ENCODE lzo
      , page_title              VARCHAR(2048) ENCODE lzo
      , source_medium           VARCHAR(255)  ENCODE lzo
      , users_total             INTEGER       ENCODE lzo
      , users_new               INTEGER       ENCODE lzo
      , page_views_total        INTEGER       ENCODE lzo
      , page_views_unique       INTEGER       ENCODE lzo
      , time_on_page            NUMERIC(9,2)  ENCODE lzo
      , page_exits              INTEGER       ENCODE lzo
      , page_entrances          INTEGER       ENCODE lzo
      , page_bounces            INTEGER       ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT        ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT        ENCODE lzo
      , PRIMARY KEY( profile_id 
	               , session_time 
				   , country_code 
				   , device_category 
				   , site_hostname 
				   , page_path 
				   , page_title 
				   , source_medium
				   )
    )
    DISTSTYLE EVEN
;
GRANT INSERT ON ga.pagestats TO copyrole;
GRANT SELECT ON ga.pagestats TO GROUP readonly;

INSERT INTO ga.pagestats
SELECT * 
  FROM ga.ga_pagestats_old
;

DROP TABLE ga.ga_pagestats_old;

---------------------------------------------------------------------------------------------------
-- 00237_recreate_ga_profiles.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE ga.profiles RENAME TO ga_profiles_old;

CREATE TABLE ga.profiles
    (
        profile_id                            BIGINT       ENCODE zstd
      , account_id                            BIGINT       ENCODE zstd
      , webproperty_id                        VARCHAR(32)  ENCODE zstd
      , internal_webproperty_id               BIGINT       ENCODE zstd
      , profile_kind                          VARCHAR(32)  ENCODE zstd
      , profile_type                          VARCHAR(16)  ENCODE zstd
      , bot_filtering_enabled                 BOOLEAN      
      , profile_currency                      VARCHAR(4)   ENCODE zstd
      , profile_timezone                      VARCHAR(32)  ENCODE zstd
      , ecommerce_tracking                    BOOLEAN
      , enhanced_ecommerce_tracking           BOOLEAN
      , profile_name                          VARCHAR(255) ENCODE zstd
      , website_url                           VARCHAR(255) ENCODE zstd
      , default_page                          VARCHAR(255) ENCODE zstd
      , exclude_query_parameters              VARCHAR(255) ENCODE zstd
      , strip_site_search_category_parameters BOOLEAN
      , strip_site_search_query_parameters    BOOLEAN
      , site_search_category_parameters       VARCHAR(255) ENCODE zstd
      , site_search_query_parameters          VARCHAR(255) ENCODE zstd
      , date_created TIMESTAMP ENCODE lzo
      , date_updated TIMESTAMP ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT ENCODE lzo
      , PRIMARY KEY (profile_id)
    )
    DISTSTYLE EVEN SORTKEY(profile_id)
;
GRANT INSERT ON ga.profiles TO copyrole;
GRANT SELECT ON ga.profiles TO GROUP readonly;

INSERT INTO ga.profiles
SELECT * 
  FROM ga.ga_profiles_old
;

DROP TABLE ga.ga_profiles_old;

---------------------------------------------------------------------------------------------------
-- 00237_recreate_ga_profiles_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE ga.profiles RENAME TO ga_profiles_old;

CREATE TABLE ga.profiles
    (
        profile_id                            BIGINT       ENCODE lzo
      , account_id                            BIGINT       ENCODE lzo
      , webproperty_id                        VARCHAR(32)  ENCODE lzo
      , internal_webproperty_id               BIGINT       ENCODE lzo
      , profile_kind                          VARCHAR(32)  ENCODE lzo
      , profile_type                          VARCHAR(16)  ENCODE lzo
      , bot_filtering_enabled                 BOOLEAN      
      , profile_currency                      VARCHAR(4)   ENCODE lzo
      , profile_timezone                      VARCHAR(32)  ENCODE lzo
      , ecommerce_tracking                    BOOLEAN
      , enhanced_ecommerce_tracking           BOOLEAN
      , profile_name                          VARCHAR(255) ENCODE lzo
      , website_url                           VARCHAR(255) ENCODE lzo
      , default_page                          VARCHAR(255) ENCODE lzo
      , exclude_query_parameters              VARCHAR(255) ENCODE lzo
      , strip_site_search_category_parameters BOOLEAN
      , strip_site_search_query_parameters    BOOLEAN
      , site_search_category_parameters       VARCHAR(255) ENCODE lzo
      , site_search_query_parameters          VARCHAR(255) ENCODE lzo
      , date_created TIMESTAMP ENCODE lzo
      , date_updated TIMESTAMP ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT ENCODE lzo
      , PRIMARY KEY (profile_id)
    )
    DISTSTYLE EVEN SORTKEY(profile_id)
;
GRANT INSERT ON ga.profiles TO copyrole;
GRANT SELECT ON ga.profiles TO GROUP readonly;

INSERT INTO ga.profiles
SELECT * 
  FROM ga.ga_profiles_old
;

DROP TABLE ga.ga_profiles_old;

---------------------------------------------------------------------------------------------------
-- 00238_recreate_ga_sessions.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE ga.sessions RENAME TO ga_sessions_old;

CREATE TABLE ga.sessions
    (
        profile_id              BIGINT       ENCODE zstd
      , session_time            TIMESTAMP    ENCODE zstd
      , country_code            VARCHAR(2)   ENCODE zstd
      , device_category         VARCHAR(16)  ENCODE zstd
      , source_medium           VARCHAR(255) ENCODE zstd
      , city_name               VARCHAR(64)  ENCODE zstd
      , city_latitude           NUMERIC(6,4) ENCODE zstd
      , city_longitude          NUMERIC(7,4) ENCODE zstd
      , sessions_total          INTEGER      ENCODE zstd
      , session_duration        NUMERIC(9,2) ENCODE zstd
      , users_total             INTEGER      ENCODE zstd
      , users_new               INTEGER      ENCODE zstd
      , page_views_total        INTEGER      ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
      , PRIMARY KEY ( profile_id 
	                , session_time 
					, country_code 
					, device_category 
					, source_medium 
					, city_name 
					, city_latitude 
					, city_longitude
					)
    )
    DISTSTYLE EVEN SORTKEY(session_time)
;
GRANT INSERT ON ga.sessions TO copyrole;
GRANT SELECT ON ga.sessions TO GROUP readonly;

INSERT INTO ga.sessions
SELECT * 
  FROM ga.ga_sessions_old
;

DROP TABLE ga.ga_sessions_old;

---------------------------------------------------------------------------------------------------
-- 00238_recreate_ga_sessions_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE ga.sessions RENAME TO ga_sessions_old;

CREATE TABLE ga.sessions
    (
        profile_id              BIGINT       ENCODE lzo
      , session_time            TIMESTAMP    ENCODE lzo
      , country_code            VARCHAR(2)   ENCODE lzo
      , device_category         VARCHAR(16)  ENCODE lzo
      , source_medium           VARCHAR(255) ENCODE lzo
      , city_name               VARCHAR(64)  ENCODE lzo
      , city_latitude           NUMERIC(6,4) ENCODE lzo
      , city_longitude          NUMERIC(7,4) ENCODE lzo
      , sessions_total          INTEGER      ENCODE lzo
      , session_duration        NUMERIC(9,2) ENCODE lzo
      , users_total             INTEGER      ENCODE lzo
      , users_new               INTEGER      ENCODE lzo
      , page_views_total        INTEGER      ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
      , PRIMARY KEY ( profile_id 
	                , session_time 
					, country_code 
					, device_category 
					, source_medium 
					, city_name 
					, city_latitude 
					, city_longitude
					)
    )
    DISTSTYLE EVEN SORTKEY(session_time)
;
GRANT INSERT ON ga.sessions TO copyrole;
GRANT SELECT ON ga.sessions TO GROUP readonly;

INSERT INTO ga.sessions
SELECT * 
  FROM ga.ga_sessions_old
;

DROP TABLE ga.ga_sessions_old;

---------------------------------------------------------------------------------------------------
-- 00239_recreate_ga_webproperties.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE ga.webproperties RENAME TO ga_webproperties_old;

CREATE TABLE ga.webproperties
    (
        webproperty_id          VARCHAR(32)  ENCODE zstd
      , internal_webproperty_id BIGINT       ENCODE zstd
      , account_id              BIGINT       ENCODE zstd
      , profile_count           SMALLINT     ENCODE zstd
      , default_profile_Id      BIGINT       ENCODE zstd
      , industry_vertical       VARCHAR(64)  ENCODE zstd
      , webproperty_kind        VARCHAR(32)  ENCODE zstd
      , webproperty_level       VARCHAR(32)  ENCODE zstd
      , webproperty_name        VARCHAR(255) ENCODE zstd
      , website_url             VARCHAR(255) ENCODE zstd
      , date_created            TIMESTAMP    ENCODE zstd
      , date_updated            TIMESTAMP    ENCODE zstd
      , EXTERNAL_FILE_ID        BIGINT       ENCODE zstd
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE zstd
      , PRIMARY KEY (webproperty_id)
    )
    DISTSTYLE EVEN SORTKEY(webproperty_id)
;
GRANT INSERT ON ga.webproperties TO copyrole;
GRANT SELECT ON ga.webproperties TO GROUP readonly;

INSERT INTO ga.webproperties
SELECT * 
  FROM ga.ga_webproperties_old
;

DROP TABLE ga.ga_webproperties_old;

---------------------------------------------------------------------------------------------------
-- 00239_recreate_ga_webproperties_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE ga.webproperties RENAME TO ga_webproperties_old;

CREATE TABLE ga.webproperties
    (
        webproperty_id          VARCHAR(32)  ENCODE lzo
      , internal_webproperty_id BIGINT       ENCODE lzo
      , account_id              BIGINT       ENCODE lzo
      , profile_count           SMALLINT     ENCODE lzo
      , default_profile_Id      BIGINT       ENCODE lzo
      , industry_vertical       VARCHAR(64)  ENCODE lzo
      , webproperty_kind        VARCHAR(32)  ENCODE lzo
      , webproperty_level       VARCHAR(32)  ENCODE lzo
      , webproperty_name        VARCHAR(255) ENCODE lzo
      , website_url             VARCHAR(255) ENCODE lzo
      , date_created            TIMESTAMP    ENCODE lzo
      , date_updated            TIMESTAMP    ENCODE lzo
      , EXTERNAL_FILE_ID        BIGINT       ENCODE lzo
      , EXTERNAL_FILE_ROWNUMBER BIGINT       ENCODE lzo
      , PRIMARY KEY (webproperty_id)
    )
    DISTSTYLE EVEN SORTKEY(webproperty_id)
;
GRANT INSERT ON ga.webproperties TO copyrole;
GRANT SELECT ON ga.webproperties TO GROUP readonly;

INSERT INTO ga.webproperties
SELECT * 
  FROM ga.ga_webproperties_old
;

DROP TABLE ga.ga_webproperties_old;

---------------------------------------------------------------------------------------------------
-- 00232_recreate_adobe_econprodappipad_reload.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.econprodappipad_reload RENAME TO adobe_econprodappipad_reload_old
;

CREATE TABLE adobe.econprodappipad_reload
    (
        browser                       BIGINT         ENCODE zstd
      , browser_height                BIGINT         ENCODE zstd
      , browser_width                 BIGINT         ENCODE zstd
      , campaign                      VARCHAR(300)   ENCODE zstd
      , carrier                       VARCHAR(128)   ENCODE zstd
      , channel                       VARCHAR(256)   ENCODE zstd
      , code_ver                      VARCHAR(256)   ENCODE zstd
      , cookies                       CHAR(1)        ENCODE zstd
      , country                       BIGINT         ENCODE zstd
      , ct_connect_type               VARCHAR(256)   ENCODE zstd
      , curr_rate                     NUMERIC(18, 0) ENCODE zstd
      , currency                      VARCHAR(256)   ENCODE zstd
      , cust_hit_time_gmt             TIMESTAMP      ENCODE zstd
      , date_time                     TIMESTAMP      ENCODE zstd
      , domain                        VARCHAR(256)   ENCODE zstd
      , duplicate_events              VARCHAR(256)   ENCODE zstd
      , duplicate_purchase            SMALLINT       ENCODE zstd
      , event_list                    VARCHAR(65535) ENCODE zstd
      , exclude_hit                   SMALLINT       ENCODE zstd
      , first_hit_page_url            VARCHAR(256)   ENCODE zstd
      , first_hit_pagename            VARCHAR(256)   ENCODE zstd
      , first_hit_referrer            VARCHAR(256)   ENCODE zstd
      , first_hit_time_gmt            TIMESTAMP      ENCODE zstd
      , geo_city                      VARCHAR(256)   ENCODE zstd
      , geo_country                   VARCHAR(256)   ENCODE zstd
      , geo_dma                       BIGINT         ENCODE zstd
      , geo_region                    VARCHAR(256)   ENCODE zstd
      , geo_zip                       VARCHAR(256)   ENCODE zstd
      , hit_source                    SMALLINT       ENCODE zstd
      , hitid_high                    BIGINT         ENCODE zstd
      , hitid_low                     BIGINT         ENCODE zstd
      , ip                            VARCHAR(256)   ENCODE zstd
      , ip2                           VARCHAR(256)   ENCODE zstd
      , language                      BIGINT         ENCODE zstd
      , last_purchase_time_gmt        BIGINT         ENCODE zstd
      , mcvisid                       VARCHAR(256)   ENCODE zstd
      , mobile_id                     BIGINT         ENCODE zstd
      , new_visit                     SMALLINT       ENCODE zstd
      , os                            BIGINT         ENCODE zstd
      , pagename                      VARCHAR(256)   ENCODE zstd
      , paid_search                   SMALLINT       ENCODE zstd
      , persistent_cookie             CHAR(1)        ENCODE zstd
      , pointofinterest               VARCHAR(256)   ENCODE zstd
      , pointofinterestdistance       VARCHAR(256)   ENCODE zstd
      , post_campaign                 VARCHAR(300)   ENCODE zstd
      , post_channel                  VARCHAR(256)   ENCODE zstd
      , post_cookies                  CHAR(1)        ENCODE zstd
      , post_currency                 VARCHAR(256)   ENCODE zstd
      , issue_id                      VARCHAR(256)   ENCODE zstd
      , device_id                     VARCHAR(256)   ENCODE zstd
      , template_type                 VARCHAR(256)   ENCODE zstd
      , story_title                   VARCHAR(256)   ENCODE zstd
      , editors_pick_download         VARCHAR(256)   ENCODE zstd
      , editors_pick_download_counter VARCHAR(256)   ENCODE zstd
      , user_agent_evar               VARCHAR(256)   ENCODE zstd
      , app_rating                    VARCHAR(256)   ENCODE zstd
      , loggedin                      VARCHAR(256)   ENCODE zstd
      , subscriber_type               VARCHAR(256)   ENCODE zstd
      , content_region                VARCHAR(256)   ENCODE zstd
      , share_type                    VARCHAR(256)   ENCODE zstd
      , audio_progress                VARCHAR(256)   ENCODE zstd
      , orientation                   VARCHAR(256)   ENCODE zstd
      , ad_impresson                  VARCHAR(256)   ENCODE zstd
      , device_type                   VARCHAR(256)   ENCODE zstd
      , device_advertising_id         VARCHAR(256)   ENCODE zstd
      , paid_free                     VARCHAR(256)   ENCODE zstd
      , drupal_id                     INTEGER        ENCODE zstd
      , connection_type               VARCHAR(256)   ENCODE zstd
      , app_id                        VARCHAR(256)   ENCODE zstd
      , link_page                     VARCHAR(256)   ENCODE zstd
      , app_name                      VARCHAR(256)   ENCODE zstd
      , country_residence             VARCHAR(256)   ENCODE zstd
      , post_ad_load_exit             VARCHAR(256)   ENCODE zstd
      , navigated_by                  VARCHAR(256)   ENCODE zstd
      , subscription_term_google_play VARCHAR(256)   ENCODE zstd
      , error_code                    VARCHAR(256)   ENCODE zstd
      , error_message                 VARCHAR(65535) ENCODE zstd
      , post_event_list               VARCHAR(65535) ENCODE zstd
      , post_java_enabled             CHAR(1)        ENCODE zstd
      , post_keywords                 VARCHAR(256)   ENCODE zstd
      , post_mobileappid              VARCHAR(256)   ENCODE zstd
      , post_mobiledayofweek          VARCHAR(256)   ENCODE zstd
      , post_mobiledayssincefirstuse  VARCHAR(256)   ENCODE zstd
      , post_mobiledayssincelastuse   VARCHAR(256)   ENCODE zstd
      , post_mobiledevice             VARCHAR(256)   ENCODE zstd
      , post_mobilehourofday          VARCHAR(256)   ENCODE zstd
      , post_mobileinstalldate        VARCHAR(256)   ENCODE zstd
      , post_mobilelaunchnumber       VARCHAR(256)   ENCODE zstd
      , post_mobileosversion          VARCHAR(256)   ENCODE zstd
      , post_mobileresolution         VARCHAR(256)   ENCODE zstd
      , post_page_event               SMALLINT       ENCODE zstd
      , post_pagename                 VARCHAR(256)   ENCODE zstd
      , post_pagename_no_url          VARCHAR(256)   ENCODE zstd
      , post_persistent_cookie        VARCHAR(256)   ENCODE zstd
      , post_pointofinterest          VARCHAR(256)   ENCODE zstd
      , post_pointofinterestdistance  VARCHAR(256)   ENCODE zstd
      , post_product_list             VARCHAR(65535) ENCODE zstd
      , issue_date                    VARCHAR(256)   ENCODE zstd
      , device_id_prop                VARCHAR(256)   ENCODE zstd
      , template                      VARCHAR(256)   ENCODE zstd
      , story_title_prop              VARCHAR(256)   ENCODE zstd
      , editors_pick_download_prop    VARCHAR(256)   ENCODE zstd
      , user_agent_prop               VARCHAR(256)   ENCODE zstd
      , app_rating_prop               VARCHAR(256)   ENCODE zstd
      , loggedin_prop                 VARCHAR(256)   ENCODE zstd
      , subscriber_type_prop          VARCHAR(256)   ENCODE zstd
      , content_region_prop           VARCHAR(256)   ENCODE zstd
      , share_type_prop               VARCHAR(256)   ENCODE zstd
      , audio_segment                 VARCHAR(256)   ENCODE zstd
      , orientation_prop              VARCHAR(256)   ENCODE zstd
      , ad_impressions                VARCHAR(256)   ENCODE zstd
      , device_type_prop              VARCHAR(256)   ENCODE zstd
      , app_advertising_id            VARCHAR(256)   ENCODE zstd
      , paid_free_prop                VARCHAR(256)   ENCODE zstd
      , page_view                     VARCHAR(256)   ENCODE zstd
      , connection_type_prop          VARCHAR(256)   ENCODE zstd
      , ad_load_exit                  VARCHAR(256)   ENCODE zstd
      , navigated_by_prop             VARCHAR(256)   ENCODE zstd
      , google_play_subscriptions     VARCHAR(256)   ENCODE zstd
      , app_id_prop                   VARCHAR(256)   ENCODE zstd
      , post_purchaseid               VARCHAR(256)   ENCODE zstd
      , post_search_engine            BIGINT         ENCODE zstd
      , post_state                    VARCHAR(256)   ENCODE zstd
      , post_survey                   VARCHAR(65535) ENCODE zstd
      , post_t_time_info              VARCHAR(256)   ENCODE zstd
      , post_zip                      VARCHAR(256)   ENCODE zstd
      , prev_page                     BIGINT         ENCODE zstd
      , product_list                  VARCHAR(65535) ENCODE zstd
      , purchaseid                    VARCHAR(256)   ENCODE zstd
      , s_resolution                  VARCHAR(255)   ENCODE zstd
      , sampled_hit                   VARCHAR(256)   ENCODE zstd
      , search_engine                 BIGINT         ENCODE zstd
      , search_page_num               BIGINT         ENCODE zstd
      , secondary_hit                 SMALLINT       ENCODE zstd
      , service                       CHAR(2)        ENCODE zstd
      , state                         VARCHAR(256)   ENCODE zstd
      , stats_server                  VARCHAR(256)   ENCODE zstd
      , t_time_info                   VARCHAR(256)   ENCODE zstd
      , user_agent                    VARCHAR(65535) ENCODE zstd
      , visid_high                    BIGINT         ENCODE zstd
      , visid_low                     BIGINT         ENCODE zstd
      , visid_new                     CHAR(1)        ENCODE zstd
      , visid_timestamp               TIMESTAMP      ENCODE zstd
      , visid_type                    SMALLINT       ENCODE zstd
      , visit_keywords                VARCHAR(256)   ENCODE zstd
      , visit_num                     BIGINT         ENCODE zstd
      , visit_referrer                VARCHAR(256)   ENCODE zstd
      , visit_search_engine           VARCHAR(256)   ENCODE zstd
      , visit_start_pagename          VARCHAR(256)   ENCODE zstd
      , visit_start_time_gmt          TIMESTAMP      ENCODE zstd
      , accept_language               VARCHAR(384)   ENCODE zstd
      , source                        VARCHAR(16)    ENCODE zstd
      , region                        VARCHAR(15)    ENCODE zstd
      , visitor_id                    VARCHAR(256)   ENCODE zstd
      , visit_id                      VARCHAR(256)   ENCODE zstd
      , valid_user                    INTEGER        ENCODE zstd
      , valid_view                    INTEGER        ENCODE zstd
      , valid_visit                   INTEGER        ENCODE zstd
      , event_id_partition_key        VARCHAR(87)    ENCODE zstd
      , hit_week                      TIMESTAMP      ENCODE zstd
      , subscription_page_new         INTEGER        ENCODE zstd
      , subscription_new              INTEGER        ENCODE zstd
      , teg_hit_local_datetime        TIMESTAMP      ENCODE zstd
      , teg_hit_gmt_datetime          TIMESTAMP      ENCODE zstd
      , teg_hit_timezone_offset       INTEGER        ENCODE zstd
      , drupal_or_visitor_id          VARCHAR(256)   ENCODE zstd DISTKEY
      , external_file_id              BIGINT         ENCODE zstd
      , external_file_rownumber       BIGINT         ENCODE zstd
    )
    SORTKEY(teg_hit_local_datetime)
;

INSERT INTO adobe.econprodappipad_reload
SELECT * 
  FROM adobe.adobe_econprodappipad_reload_old
;

DROP TABLE adobe.adobe_econprodappipad_reload_old;

---------------------------------------------------------------------------------------------------
-- 00232_recreate_adobe_econprodappipad_reload_rollback.sql
---------------------------------------------------------------------------------------------------
ALTER TABLE adobe.econprodappipad_reload RENAME TO adobe_econprodappipad_reload_old;

CREATE TABLE adobe.econprodappipad_reload
    (
        browser                       BIGINT         ENCODE lzo
      , browser_height                BIGINT         ENCODE lzo
      , browser_width                 BIGINT         ENCODE lzo
      , campaign                      VARCHAR(300)   ENCODE lzo
      , carrier                       VARCHAR(128)   ENCODE lzo
      , channel                       VARCHAR(256)   ENCODE lzo
      , code_ver                      VARCHAR(256)   ENCODE lzo
      , cookies                       CHAR(1)        ENCODE lzo
      , country                       BIGINT         ENCODE bytedict
      , ct_connect_type               VARCHAR(256)   ENCODE lzo
      , curr_rate                     NUMERIC(18, 0) ENCODE lzo
      , currency                      VARCHAR(256)   ENCODE lzo
      , cust_hit_time_gmt             TIMESTAMP      ENCODE lzo
      , date_time                     TIMESTAMP      ENCODE lzo
      , domain                        VARCHAR(256)   ENCODE lzo
      , duplicate_events              VARCHAR(256)   ENCODE lzo
      , duplicate_purchase            SMALLINT       ENCODE lzo
      , event_list                    VARCHAR(65535) ENCODE lzo
      , exclude_hit                   SMALLINT       ENCODE lzo
      , first_hit_page_url            VARCHAR(256)   ENCODE lzo
      , first_hit_pagename            VARCHAR(256)   ENCODE lzo
      , first_hit_referrer            VARCHAR(256)   ENCODE lzo
      , first_hit_time_gmt            TIMESTAMP      ENCODE lzo
      , geo_city                      VARCHAR(256)   ENCODE lzo
      , geo_country                   VARCHAR(256)   ENCODE lzo
      , geo_dma                       BIGINT         ENCODE bytedict
      , geo_region                    VARCHAR(256)   ENCODE lzo
      , geo_zip                       VARCHAR(256)   ENCODE lzo
      , hit_source                    SMALLINT       ENCODE lzo
      , hitid_high                    BIGINT         ENCODE lzo
      , hitid_low                     BIGINT         ENCODE lzo
      , ip                            VARCHAR(256)   ENCODE lzo
      , ip2                           VARCHAR(256)   ENCODE lzo
      , language                      BIGINT         ENCODE lzo
      , last_purchase_time_gmt        BIGINT         ENCODE lzo
      , mcvisid                       VARCHAR(256)   ENCODE lzo
      , mobile_id                     BIGINT         ENCODE lzo
      , new_visit                     SMALLINT       ENCODE lzo
      , os                            BIGINT         ENCODE bytedict
      , pagename                      VARCHAR(256)   ENCODE lzo
      , paid_search                   SMALLINT       ENCODE lzo
      , persistent_cookie             CHAR(1)        ENCODE lzo
      , pointofinterest               VARCHAR(256)   ENCODE lzo
      , pointofinterestdistance       VARCHAR(256)   ENCODE lzo
      , post_campaign                 VARCHAR(300)   ENCODE lzo
      , post_channel                  VARCHAR(256)   ENCODE lzo
      , post_cookies                  CHAR(1)        ENCODE lzo
      , post_currency                 VARCHAR(256)   ENCODE lzo
      , issue_id                      VARCHAR(256)   ENCODE lzo
      , device_id                     VARCHAR(256)   ENCODE lzo
      , template_type                 VARCHAR(256)   ENCODE lzo
      , story_title                   VARCHAR(256)   ENCODE lzo
      , editors_pick_download         VARCHAR(256)   ENCODE lzo
      , editors_pick_download_counter VARCHAR(256)   ENCODE lzo
      , user_agent_evar               VARCHAR(256)   ENCODE lzo
      , app_rating                    VARCHAR(256)   ENCODE lzo
      , loggedin                      VARCHAR(256)   ENCODE lzo
      , subscriber_type               VARCHAR(256)   ENCODE lzo
      , content_region                VARCHAR(256)   ENCODE lzo
      , share_type                    VARCHAR(256)   ENCODE lzo
      , audio_progress                VARCHAR(256)   ENCODE lzo
      , orientation                   VARCHAR(256)   ENCODE lzo
      , ad_impresson                  VARCHAR(256)   ENCODE lzo
      , device_type                   VARCHAR(256)   ENCODE lzo
      , device_advertising_id         VARCHAR(256)   ENCODE lzo
      , paid_free                     VARCHAR(256)   ENCODE lzo
      , drupal_id                     INTEGER        ENCODE lzo
      , connection_type               VARCHAR(256)   ENCODE lzo
      , app_id                        VARCHAR(256)   ENCODE lzo
      , link_page                     VARCHAR(256)   ENCODE lzo
      , app_name                      VARCHAR(256)   ENCODE lzo
      , country_residence             VARCHAR(256)   ENCODE lzo
      , post_ad_load_exit             VARCHAR(256)   ENCODE lzo
      , navigated_by                  VARCHAR(256)   ENCODE lzo
      , subscription_term_google_play VARCHAR(256)   ENCODE lzo
      , error_code                    VARCHAR(256)   ENCODE lzo
      , error_message                 VARCHAR(65535) ENCODE lzo
      , post_event_list               VARCHAR(65535) ENCODE lzo
      , post_java_enabled             CHAR(1)        ENCODE lzo
      , post_keywords                 VARCHAR(256)   ENCODE lzo
      , post_mobileappid              VARCHAR(256)   ENCODE lzo
      , post_mobiledayofweek          VARCHAR(256)   ENCODE lzo
      , post_mobiledayssincefirstuse  VARCHAR(256)   ENCODE lzo
      , post_mobiledayssincelastuse   VARCHAR(256)   ENCODE lzo
      , post_mobiledevice             VARCHAR(256)   ENCODE lzo
      , post_mobilehourofday          VARCHAR(256)   ENCODE lzo
      , post_mobileinstalldate        VARCHAR(256)   ENCODE lzo
      , post_mobilelaunchnumber       VARCHAR(256)   ENCODE lzo
      , post_mobileosversion          VARCHAR(256)   ENCODE lzo
      , post_mobileresolution         VARCHAR(256)   ENCODE lzo
      , post_page_event               SMALLINT       ENCODE lzo
      , post_pagename                 VARCHAR(256)   ENCODE lzo
      , post_pagename_no_url          VARCHAR(256)   ENCODE lzo
      , post_persistent_cookie        VARCHAR(256)   ENCODE lzo
      , post_pointofinterest          VARCHAR(256)   ENCODE lzo
      , post_pointofinterestdistance  VARCHAR(256)   ENCODE lzo
      , post_product_list             VARCHAR(65535) ENCODE lzo
      , issue_date                    VARCHAR(256)   ENCODE lzo
      , device_id_prop                VARCHAR(256)   ENCODE lzo
      , template                      VARCHAR(256)   ENCODE lzo
      , story_title_prop              VARCHAR(256)   ENCODE lzo
      , editors_pick_download_prop    VARCHAR(256)   ENCODE lzo
      , user_agent_prop               VARCHAR(256)   ENCODE lzo
      , app_rating_prop               VARCHAR(256)   ENCODE lzo
      , loggedin_prop                 VARCHAR(256)   ENCODE lzo
      , subscriber_type_prop          VARCHAR(256)   ENCODE lzo
      , content_region_prop           VARCHAR(256)   ENCODE lzo
      , share_type_prop               VARCHAR(256)   ENCODE lzo
      , audio_segment                 VARCHAR(256)   ENCODE lzo
      , orientation_prop              VARCHAR(256)   ENCODE lzo
      , ad_impressions                VARCHAR(256)   ENCODE lzo
      , device_type_prop              VARCHAR(256)   ENCODE lzo
      , app_advertising_id            VARCHAR(256)   ENCODE lzo
      , paid_free_prop                VARCHAR(256)   ENCODE lzo
      , page_view                     VARCHAR(256)   ENCODE lzo
      , connection_type_prop          VARCHAR(256)   ENCODE lzo
      , ad_load_exit                  VARCHAR(256)   ENCODE lzo
      , navigated_by_prop             VARCHAR(256)   ENCODE lzo
      , google_play_subscriptions     VARCHAR(256)   ENCODE lzo
      , app_id_prop                   VARCHAR(256)   ENCODE lzo
      , post_purchaseid               VARCHAR(256)   ENCODE lzo
      , post_search_engine            BIGINT         ENCODE lzo
      , post_state                    VARCHAR(256)   ENCODE lzo
      , post_survey                   VARCHAR(65535) ENCODE lzo
      , post_t_time_info              VARCHAR(256)   ENCODE lzo
      , post_zip                      VARCHAR(256)   ENCODE lzo
      , prev_page                     BIGINT         ENCODE lzo
      , product_list                  VARCHAR(65535) ENCODE lzo
      , purchaseid                    VARCHAR(256)   ENCODE lzo
      , s_resolution                  VARCHAR(255)   ENCODE lzo
      , sampled_hit                   VARCHAR(256)   ENCODE lzo
      , search_engine                 BIGINT         ENCODE lzo
      , search_page_num               BIGINT         ENCODE lzo
      , secondary_hit                 SMALLINT       ENCODE lzo
      , service                       CHAR(2)        ENCODE lzo
      , state                         VARCHAR(256)   ENCODE lzo
      , stats_server                  VARCHAR(256)   ENCODE lzo
      , t_time_info                   VARCHAR(256)   ENCODE lzo
      , user_agent                    VARCHAR(65535) ENCODE lzo
      , visid_high                    BIGINT         ENCODE lzo
      , visid_low                     BIGINT         ENCODE lzo
      , visid_new                     CHAR(1)        ENCODE lzo
      , visid_timestamp               TIMESTAMP      ENCODE lzo
      , visid_type                    SMALLINT       ENCODE lzo
      , visit_keywords                VARCHAR(256)   ENCODE lzo
      , visit_num                     BIGINT         ENCODE lzo
      , visit_referrer                VARCHAR(256)   ENCODE lzo
      , visit_search_engine           VARCHAR(256)   ENCODE lzo
      , visit_start_pagename          VARCHAR(256)   ENCODE lzo
      , visit_start_time_gmt          TIMESTAMP      ENCODE lzo
      , accept_language               VARCHAR(384)   ENCODE lzo
      , source                        VARCHAR(16)    ENCODE lzo
      , region                        VARCHAR(15)    ENCODE bytedict
      , visitor_id                    VARCHAR(256)   ENCODE lzo
      , visit_id                      VARCHAR(256)   ENCODE lzo
      , valid_user                    INTEGER        ENCODE lzo
      , valid_view                    INTEGER        ENCODE lzo
      , valid_visit                   INTEGER        ENCODE lzo
      , event_id_partition_key        VARCHAR(87)    ENCODE lzo
      , hit_week                      TIMESTAMP      ENCODE lzo
      , subscription_page_new         INTEGER        ENCODE lzo
      , subscription_new              INTEGER        ENCODE lzo
      , teg_hit_local_datetime        TIMESTAMP      ENCODE lzo
      , teg_hit_gmt_datetime          TIMESTAMP      ENCODE lzo
      , teg_hit_timezone_offset       INTEGER        ENCODE bytedict
      , drupal_or_visitor_id          VARCHAR(256)   ENCODE lzo DISTKEY
      , external_file_id              BIGINT         ENCODE lzo
      , external_file_rownumber       BIGINT         ENCODE lzo
    )
    SORTKEY(teg_hit_local_datetime)
;

INSERT INTO adobe.econprodappipad_reload
SELECT * 
  FROM adobe.adobe_econprodappipad_reload_old
;

DROP TABLE adobe.adobe_econprodappipad_reload_old;

---------------------------------------------------------------------------------------------------
-- AWS download directory for files 
---------------------------------------------------------------------------------------------------
C:\Users\mdjuk\Downloads\LoadingDataSampleFiles.zip\LoadingDataSampleFiles

---------------------------------------------------------------------------------------------------
-- cloudbilimited AWS account details
---------------------------------------------------------------------------------------------------
334086281941

---------------------------------------------------------------------------------------------------
-- my EC2 instance
---------------------------------------------------------------------------------------------------
Currently selected: t2.micro (Variable ECUs, 1 vCPUs, 2.5 GHz, Intel Xeon Family, 1 GiB memory, EBS only) 

Security group name: launch-wizard-1	
Description: launch-wizard-1 created 2017-04-17T16:16:18.253+01:00

Type	Protocol  	Port Range 		Source
SSH		TCP			22				My IP	86.138.95.9/32 

---------------------------------------------------------------------------------------------------
-- My ec2 instance.....
---------------------------------------------------------------------------------------------------
ec2-user@ec2-54-201-101-55.us-west-2.compute.amazonaws.com


Policies		AdministratorAccess
Summary	
Policy ARN:		arn:aws:iam::aws:policy/AdministratorAccess
Description: 	Provides full access to AWS services and resources.

Users with AWS Management Console access can sign-in at: https://678752479360.signin.aws.amazon.com/console
aws_access_key_id = AKIAJ4H2LRQQYHJ2DK5Q
aws_secret_access_key = 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

CREDENTIALS 'aws_iam_role=arn:aws:iam::678752479360:role/admin'

---------------------------------------------------------------------------------------------------
-- My mdj_marko Redshift instance.....
---------------------------------------------------------------------------------------------------
User Name	aws_access_key_id		aws_secret_access_key						Console login
---------------------------------------------------------------------------------------------------
mdj_marko	AKIAIZWDU37VQR6BZWJA	smJb6hw1cp0s3JXWvaZ1QiEoLLSo4AGFiXCh4ATp	https://678752479360.signin.aws.amazon.com/console

CREDENTIALS 'aws_iam_role=arn:aws:iam::678752479360:role/admin'

CREDENTIALS 'aws_iam_role=arn:aws:iam::678752479360:role/RedshiftCopyUnload'

CREDENTIALS 'aws_iam_role=arn:aws:iam::678752479360:role/admin'


CREDENTIALS 'aws_iam_role=arn:aws:iam::1234567890123:role/RedshiftCopyUnload'



ERROR: XX000: User arn:aws:redshift:us-west-2:678752479360:dbuser:mdjcluster/mdj_marko is not 
authorized to assume IAM Role arn:aws:iam::678752479360:role/RedshiftCopyUnload

split command

copy supplier_wo_encoding from 's3://us-west-2-aws-training/awsu-spl/redshift-quest/supplier/supplier.json' 
CREDENTIALS 'aws_iam_role=arn:aws:iam::678752479360:role/RedshiftCopyUnload'
lzop delimiter '|' 
COMPUPDATE OFF 
manifest
;

NOTE: The varchar data type supports 3-byte UTF-8 characters, but the CHAR data type
only accepts singl-byte ASCII characters.  You cannot load 4-byte or more characters
into Redshift tables.
If your data includes non-ASCII multi-byte characters, you must load the data into 
VARCHAR columns.  In th enext part of this lab, you will load multibyte characters into varchar columns.

This JSON file below, is named supplier_manifest.json
{
"entries": [
			{"endpoint":"ec2-54-201-101-55.us-west-2.compute.amazonaws.com", 
  			 "command": "cat ~/q_qwiklabs/supplier.data",
			 "mandatory":true,
			 "username": "ec2-user"}
		   ]
}

---------------------------------------------------------------------------------------------------
-- Slack Webhoock to be used from Lambda.....mdjukic@slack.com	
---------------------------------------------------------------------------------------------------
https://hooks.slack.com/services/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


ec2-54-201-101-55.us-west-2.compute.amazonaws.com

Connect To Your Instance
I would like to connect with
A standalone SSH client
A Java SSH Client directly from my browser (Java required)
To access your instance:
Open an SSH client. (find out how to connect using PuTTY)
Locate your private key file (mdjKeyPair.pem). The wizard automatically detects the key you used to launch the instance.
Your key must not be publicly viewable for SSH to work. Use this command if needed:
chmod 400 mdjKeyPair.pem
Connect to your instance using its Public DNS:
ec2-54-201-101-55.us-west-2.compute.amazonaws.com
Example:
ssh -i "mdjKeyPair.pem" ec2-user@ec2-54-201-101-55.us-west-2.compute.amazonaws.com
Please note that in most cases the username above will be correct, however please ensure that you read your AMI usage instructions to ensure that the AMI owner has not changed the default AMI username.
If you need any assistance connecting to your instance, please see our connection documentation.
Close

---------------------------------------------------------------------------------------------------
-- Misc notes for data pipeline.....
---------------------------------------------------------------------------------------------------
Public DNS: ec2-54-201-101-55.us-west-2.compute.amazonaws.com

jdbc:redshift://mdjcluster.comcbtx9pdcp.us-west-2.redshift.amazonaws.com:5439/mdjdb

psql --host=<Redshift-Endpoint> --port=5439 --username=awsuser --dbname=redshiftdemo

copy supplier_remote_load from 's3://<YOUR-BUCKET>/manifest.json' 
credentials 'aws_access_key_id=<YOUR-ACCESS-KEY-ID>;aws_secret_access_key=<YOUR-SECRET-ACCESS-KEY>'
credentials 'aws_access_key_id=AKIAIZWDU37VQR6BZWJA;aws_secret_access_key=smJb6hw1cp0s3JXWvaZ1QiEoLLSo4AGFiXCh4ATp'
 delimiter '|' COMPUPDATE ON ssh;

 
 set -e; 
 ssh markod@172.20.0.174 'source ~/bigdataconfig.py; 
 psql -v "ON_ERROR_STOP=1" --host=${redshifthostname} --port=${redshiftport} --username=${myredshiftusername} --dbname=${myredshiftdbname} 



 -c "SET wlm_query_slot_count = 2; select top 10 * from common.country_region; select top 10 * from common.country_regions; " '
 
  psql --host=mdjcluster.comcbtx9pdcp.us-west-2.redshift.amazonaws.com --port=5439 --username=mdj_marko --dbname=mdjdb -c 'select * from supplier limit 11;'

---------------------------------------------------------------------------------------------------  
-- COPY Command
---------------------------------------------------------------------------------------------------  
You can analyze a table explicitly by running ANALYZE command.  
When ou load data with the COPY command, you can perform an analysis automatically by 
setting the STARTUPDATE option to ON.  By default, the COPY command performs an analysis after
it loads data into an empty table.

---------------------------------------------------------------------------------------------------  
-- the_woof_garden_cuckoo Role
---------------------------------------------------------------------------------------------------  
arn:aws:iam::678752479360:role/the_woof_garden_cuckoo  

---------------------------------------------------------------------------------------------------  
-- call to psql via bash to redshift
---------------------------------------------------------------------------------------------------  
  
"source ~/bigdataconfig.py; psql 
--host=\${redshifthostname} 
--port=\${redshiftport} 
--username=\${myredshiftusername} 
--dbname=\${myredshiftdbname} \-c \" unload ('select * from (select * from mrd.ga_pagestats );' ) to 's3://economist-analytics-euw1-int01/mrd.ga_pagestats/' iam_role 'arn:aws:iam::334086281941:role/prd-redshift-copy-unload' BZIP2 ESCAPE DELIMITER '\t' ALLOWOVERWRITE; \" "


--bigdataconfig.py contains the following parameters
redshifthostname='mdjcluster.comcbtx9pdcp.us-west-2.redshift.amazonaws.com'
redshiftport=5439
myredshiftusername='mdj_marko'
myredshiftdbname='mdjdb'
 
---------------------------------------------------------------------------------------------------  
-- To install graphviz for python
---------------------------------------------------------------------------------------------------   
sudo yum install graphviz-python

 